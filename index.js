var MS=Object.defineProperty;var FS=(i,e,t)=>e in i?MS(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var cs=(i,e,t)=>(FS(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function et(){}function ur(i,e){for(const t in e)i[t]=e[t];return i}function BS(i){return!!i&&(typeof i=="object"||typeof i=="function")&&typeof i.then=="function"}function gy(i){return i()}function xg(){return Object.create(null)}function Yr(i){i.forEach(gy)}function _y(i){return typeof i=="function"}function zn(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}function US(i){return Object.keys(i).length===0}function VS(i,e,t,n){if(i){const r=yy(i,e,t,n);return i[0](r)}}function yy(i,e,t,n){return i[1]&&n?ur(t.ctx.slice(),i[1](n(e))):t.ctx}function jS(i,e,t,n){if(i[2]&&n){const r=i[2](n(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],a=Math.max(e.dirty.length,r.length);for(let o=0;o<a;o+=1)s[o]=e.dirty[o]|r[o];return s}return e.dirty|r}return e.dirty}function $S(i,e,t,n,r,s){if(r){const a=yy(e,t,n,s);i.p(a,r)}}function qS(i){if(i.ctx.length>32){const e=[],t=i.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function vy(i){const e={};for(const t in i)t[0]!=="$"&&(e[t]=i[t]);return e}function fl(i,e){const t={};e=new Set(e);for(const n in i)!e.has(n)&&n[0]!=="$"&&(t[n]=i[n]);return t}function De(i,e){i.appendChild(e)}function Dt(i,e,t){i.insertBefore(e,t||null)}function Tt(i){i.parentNode&&i.parentNode.removeChild(i)}function Ty(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function Fe(i){return document.createElement(i)}function by(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function qr(i){return document.createTextNode(i)}function pi(){return qr(" ")}function kf(){return qr("")}function Xi(i,e,t,n){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t,n)}function we(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}const HS=["width","height"];function Cg(i,e){const t=Object.getOwnPropertyDescriptors(i.__proto__);for(const n in e)e[n]==null?i.removeAttribute(n):n==="style"?i.style.cssText=e[n]:n==="__value"?i.value=i[n]=e[n]:t[n]&&t[n].set&&HS.indexOf(n)===-1?i[n]=e[n]:we(i,n,e[n])}function pl(i,e){for(const t in e)we(i,t,e[t])}function GS(i){return Array.from(i.childNodes)}function _d(i,e){e=""+e,i.data!==e&&(i.data=e)}function tr(i,e,t,n){t==null?i.style.removeProperty(e):i.style.setProperty(e,t,n?"important":"")}function wg(i,e,t){for(let n=0;n<i.options.length;n+=1){const r=i.options[n];if(r.__value===e){r.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function zS(i){const e=i.querySelector(":checked");return e&&e.__value}function WS(i,e,{bubbles:t=!1,cancelable:n=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(i,t,n,e),r}let So;function Ln(i){So=i}function Pf(){if(!So)throw new Error("Function called outside component initialization");return So}function Ey(i){Pf().$$.on_mount.push(i)}function Rf(){const i=Pf();return(e,t,{cancelable:n=!1}={})=>{const r=i.$$.callbacks[e];if(r){const s=WS(e,t,{cancelable:n});return r.slice().forEach(a=>{a.call(i,s)}),!s.defaultPrevented}return!0}}const Ts=[],Bt=[];let Is=[];const yd=[],Sy=Promise.resolve();let vd=!1;function xy(){vd||(vd=!0,Sy.then(Of))}function KS(){return xy(),Sy}function ml(i){Is.push(i)}function on(i){yd.push(i)}const Ah=new Set;let hs=0;function Of(){if(hs!==0)return;const i=So;do{try{for(;hs<Ts.length;){const e=Ts[hs];hs++,Ln(e),XS(e.$$)}}catch(e){throw Ts.length=0,hs=0,e}for(Ln(null),Ts.length=0,hs=0;Bt.length;)Bt.pop()();for(let e=0;e<Is.length;e+=1){const t=Is[e];Ah.has(t)||(Ah.add(t),t())}Is.length=0}while(Ts.length);for(;yd.length;)yd.pop()();vd=!1,Ah.clear(),Ln(i)}function XS(i){if(i.fragment!==null){i.update(),Yr(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(ml)}}function YS(i){const e=[],t=[];Is.forEach(n=>i.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Is=e}const sl=new Set;let Rr;function Wo(){Rr={r:0,c:[],p:Rr}}function Ko(){Rr.r||Yr(Rr.c),Rr=Rr.p}function Ue(i,e){i&&i.i&&(sl.delete(i),i.i(e))}function Qe(i,e,t,n){if(i&&i.o){if(sl.has(i))return;sl.add(i),Rr.c.push(()=>{sl.delete(i),n&&(t&&i.d(1),n())}),i.o(e)}else n&&n()}function Ag(i,e){const t=e.token={};function n(r,s,a,o){if(e.token!==t)return;e.resolved=o;let u=e.ctx;a!==void 0&&(u=u.slice(),u[a]=o);const c=r&&(e.current=r)(u);let h=!1;e.block&&(e.blocks?e.blocks.forEach((g,y)=>{y!==s&&g&&(Wo(),Qe(g,1,1,()=>{e.blocks[y]===g&&(e.blocks[y]=null)}),Ko())}):e.block.d(1),c.c(),Ue(c,1),c.m(e.mount(),e.anchor),h=!0),e.block=c,e.blocks&&(e.blocks[s]=c),h&&Of()}if(BS(i)){const r=Pf();if(i.then(s=>{Ln(r),n(e.then,1,e.value,s),Ln(null)},s=>{if(Ln(r),n(e.catch,2,e.error,s),Ln(null),!e.hasCatch)throw s}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,i),!0;e.resolved=i}}function QS(i,e,t){const n=e.slice(),{resolved:r}=i;i.current===i.then&&(n[i.value]=r),i.current===i.catch&&(n[i.error]=r),i.block.p(n,t)}function Lf(i,e){const t={},n={},r={$$scope:1};let s=i.length;for(;s--;){const a=i[s],o=e[s];if(o){for(const u in a)u in o||(n[u]=1);for(const u in o)r[u]||(t[u]=o[u],r[u]=1);i[s]=o}else for(const u in a)r[u]=1}for(const a in n)a in t||(t[a]=void 0);return t}function un(i,e,t){const n=i.$$.props[e];n!==void 0&&(i.$$.bound[n]=t,t(i.$$.ctx[n]))}function _i(i){i&&i.c()}function ti(i,e,t,n){const{fragment:r,after_update:s}=i.$$;r&&r.m(e,t),n||ml(()=>{const a=i.$$.on_mount.map(gy).filter(_y);i.$$.on_destroy?i.$$.on_destroy.push(...a):Yr(a),i.$$.on_mount=[]}),s.forEach(ml)}function ii(i,e){const t=i.$$;t.fragment!==null&&(YS(t.after_update),Yr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function JS(i,e){i.$$.dirty[0]===-1&&(Ts.push(i),xy(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function Wn(i,e,t,n,r,s,a,o=[-1]){const u=So;Ln(i);const c=i.$$={fragment:null,ctx:[],props:s,update:et,not_equal:r,bound:xg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:xg(),dirty:o,skip_bound:!1,root:e.target||u.$$.root};a&&a(c.root);let h=!1;if(c.ctx=t?t(i,e.props||{},(g,y,...T)=>{const v=T.length?T[0]:y;return c.ctx&&r(c.ctx[g],c.ctx[g]=v)&&(!c.skip_bound&&c.bound[g]&&c.bound[g](v),h&&JS(i,g)),y}):[],c.update(),h=!0,Yr(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const g=GS(e.target);c.fragment&&c.fragment.l(g),g.forEach(Tt)}else c.fragment&&c.fragment.c();e.intro&&Ue(i.$$.fragment),ti(i,e.target,e.anchor,e.customElement),Of()}Ln(u)}class Kn{$destroy(){ii(this,1),this.$destroy=et}$on(e,t){if(!_y(t))return et;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!US(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cy=function(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(i.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},ZS=function(i){const e=[];let t=0,n=0;for(;t<i.length;){const r=i[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const s=i[t++];e[n++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=i[t++],a=i[t++],o=i[t++],u=((r&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{const s=i[t++],a=i[t++];e[n++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},wy={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<i.length;r+=3){const s=i[r],a=r+1<i.length,o=a?i[r+1]:0,u=r+2<i.length,c=u?i[r+2]:0,h=s>>2,g=(s&3)<<4|o>>4;let y=(o&15)<<2|c>>6,T=c&63;u||(T=64,a||(y=64)),n.push(t[h],t[g],t[y],t[T])}return n.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(Cy(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):ZS(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<i.length;){const s=t[i.charAt(r++)],o=r<i.length?t[i.charAt(r)]:0;++r;const c=r<i.length?t[i.charAt(r)]:64;++r;const g=r<i.length?t[i.charAt(r)]:64;if(++r,s==null||o==null||c==null||g==null)throw new ex;const y=s<<2|o>>4;if(n.push(y),c!==64){const T=o<<4&240|c>>2;if(n.push(T),g!==64){const v=c<<6&192|g;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class ex extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const tx=function(i){const e=Cy(i);return wy.encodeByteArray(e,!0)},gl=function(i){return tx(i).replace(/\./g,"")},ix=function(i){try{return wy.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rx=()=>nx().__FIREBASE_DEFAULTS__,sx=()=>{if(typeof process>"u"||typeof process.env>"u")return;const i={}.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},ax=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&ix(i[1]);return e&&JSON.parse(e)},Ay=()=>{try{return rx()||sx()||ax()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},ox=i=>{var e,t;return(t=(e=Ay())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[i]},ux=i=>{const e=ox(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},Dy=()=>{var i;return(i=Ay())===null||i===void 0?void 0:i.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cx(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=i.iat||0,s=i.sub||i.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},i),o="";return[gl(JSON.stringify(t)),gl(JSON.stringify(a)),o].join(".")}function hx(){try{return typeof indexedDB=="object"}catch{return!1}}function dx(){return new Promise((i,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),i(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fx="FirebaseError";class fa extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=fx,Object.setPrototypeOf(this,fa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Iy.prototype.create)}}class Iy{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?px(s,n):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new fa(r,o,n)}}function px(i,e){return i.replace(mx,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const mx=/\{\$([^}]+)}/g;function Td(i,e){if(i===e)return!0;const t=Object.keys(i),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const s=i[r],a=e[r];if(Dg(s)&&Dg(a)){if(!Td(s,a))return!1}else if(s!==a)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function Dg(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(i){return i&&i._delegate?i._delegate:i}let xo=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new lx;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(yx(e))try{this.getOrInitializeService({instanceIdentifier:Dr})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});n.resolve(s)}catch{}}}}clearInstance(e=Dr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Dr){return this.instances.has(e)}getOptions(e=Dr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);n===o&&a.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=(n=this.onInitCallbacks.get(r))!==null&&n!==void 0?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const a=this.instances.get(r);return a&&e(a,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:_x(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Dr){return this.component?this.component.multipleInstances?e:Dr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _x(i){return i===Dr?void 0:i}function yx(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new gx(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ne;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Ne||(Ne={}));const Tx={debug:Ne.DEBUG,verbose:Ne.VERBOSE,info:Ne.INFO,warn:Ne.WARN,error:Ne.ERROR,silent:Ne.SILENT},bx=Ne.INFO,Ex={[Ne.DEBUG]:"log",[Ne.VERBOSE]:"log",[Ne.INFO]:"info",[Ne.WARN]:"warn",[Ne.ERROR]:"error"},Sx=(i,e,...t)=>{if(e<i.logLevel)return;const n=new Date().toISOString(),r=Ex[e];if(r)console[r](`[${n}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ky{constructor(e){this.name=e,this._logLevel=bx,this._logHandler=Sx,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ne))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Tx[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ne.DEBUG,...e),this._logHandler(this,Ne.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ne.VERBOSE,...e),this._logHandler(this,Ne.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ne.INFO,...e),this._logHandler(this,Ne.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ne.WARN,...e),this._logHandler(this,Ne.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ne.ERROR,...e),this._logHandler(this,Ne.ERROR,...e)}}const xx=(i,e)=>e.some(t=>i instanceof t);let Ig,kg;function Cx(){return Ig||(Ig=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wx(){return kg||(kg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Py=new WeakMap,bd=new WeakMap,Ry=new WeakMap,Dh=new WeakMap,Nf=new WeakMap;function Ax(i){const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("success",s),i.removeEventListener("error",a)},s=()=>{t(ar(i.result)),r()},a=()=>{n(i.error),r()};i.addEventListener("success",s),i.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Py.set(t,i)}).catch(()=>{}),Nf.set(e,i),e}function Dx(i){if(bd.has(i))return;const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("complete",s),i.removeEventListener("error",a),i.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{n(i.error||new DOMException("AbortError","AbortError")),r()};i.addEventListener("complete",s),i.addEventListener("error",a),i.addEventListener("abort",a)});bd.set(i,e)}let Ed={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return bd.get(i);if(e==="objectStoreNames")return i.objectStoreNames||Ry.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ar(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function Ix(i){Ed=i(Ed)}function kx(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=i.call(Ih(this),e,...t);return Ry.set(n,e.sort?e.sort():[e]),ar(n)}:wx().includes(i)?function(...e){return i.apply(Ih(this),e),ar(Py.get(this))}:function(...e){return ar(i.apply(Ih(this),e))}}function Px(i){return typeof i=="function"?kx(i):(i instanceof IDBTransaction&&Dx(i),xx(i,Cx())?new Proxy(i,Ed):i)}function ar(i){if(i instanceof IDBRequest)return Ax(i);if(Dh.has(i))return Dh.get(i);const e=Px(i);return e!==i&&(Dh.set(i,e),Nf.set(e,i)),e}const Ih=i=>Nf.get(i);function Rx(i,e,{blocked:t,upgrade:n,blocking:r,terminated:s}={}){const a=indexedDB.open(i,e),o=ar(a);return n&&a.addEventListener("upgradeneeded",u=>{n(ar(a.result),u.oldVersion,u.newVersion,ar(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),o.then(u=>{s&&u.addEventListener("close",()=>s()),r&&u.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const Ox=["get","getKey","getAll","getAllKeys","count"],Lx=["put","add","delete","clear"],kh=new Map;function Pg(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(kh.get(e))return kh.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=Lx.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||Ox.includes(t)))return;const s=async function(a,...o){const u=this.transaction(a,r?"readwrite":"readonly");let c=u.store;return n&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),r&&u.done]))[0]};return kh.set(e,s),s}Ix(i=>({...i,get:(e,t,n)=>Pg(e,t)||i.get(e,t,n),has:(e,t)=>!!Pg(e,t)||i.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nx{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Mx(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Mx(i){const e=i.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Sd="@firebase/app",Rg="0.9.15";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hr=new ky("@firebase/app"),Fx="@firebase/app-compat",Bx="@firebase/analytics-compat",Ux="@firebase/analytics",Vx="@firebase/app-check-compat",jx="@firebase/app-check",$x="@firebase/auth",qx="@firebase/auth-compat",Hx="@firebase/database",Gx="@firebase/database-compat",zx="@firebase/functions",Wx="@firebase/functions-compat",Kx="@firebase/installations",Xx="@firebase/installations-compat",Yx="@firebase/messaging",Qx="@firebase/messaging-compat",Jx="@firebase/performance",Zx="@firebase/performance-compat",eC="@firebase/remote-config",tC="@firebase/remote-config-compat",iC="@firebase/storage",nC="@firebase/storage-compat",rC="@firebase/firestore",sC="@firebase/firestore-compat",aC="firebase",oC="10.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xd="[DEFAULT]",uC={[Sd]:"fire-core",[Fx]:"fire-core-compat",[Ux]:"fire-analytics",[Bx]:"fire-analytics-compat",[jx]:"fire-app-check",[Vx]:"fire-app-check-compat",[$x]:"fire-auth",[qx]:"fire-auth-compat",[Hx]:"fire-rtdb",[Gx]:"fire-rtdb-compat",[zx]:"fire-fn",[Wx]:"fire-fn-compat",[Kx]:"fire-iid",[Xx]:"fire-iid-compat",[Yx]:"fire-fcm",[Qx]:"fire-fcm-compat",[Jx]:"fire-perf",[Zx]:"fire-perf-compat",[eC]:"fire-rc",[tC]:"fire-rc-compat",[iC]:"fire-gcs",[nC]:"fire-gcs-compat",[rC]:"fire-fst",[sC]:"fire-fst-compat","fire-js":"fire-js",[aC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl=new Map,Cd=new Map;function lC(i,e){try{i.container.addComponent(e)}catch(t){Hr.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function vl(i){const e=i.name;if(Cd.has(e))return Hr.debug(`There were multiple attempts to register component ${e}.`),!1;Cd.set(e,i);for(const t of yl.values())lC(t,i);return!0}function cC(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},or=new Iy("app","Firebase",hC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new xo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw or.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC=oC;function Oy(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const n=Object.assign({name:xd,automaticDataCollectionEnabled:!1},e),r=n.name;if(typeof r!="string"||!r)throw or.create("bad-app-name",{appName:String(r)});if(t||(t=Dy()),!t)throw or.create("no-options");const s=yl.get(r);if(s){if(Td(t,s.options)&&Td(n,s.config))return s;throw or.create("duplicate-app",{appName:r})}const a=new vx(r);for(const u of Cd.values())a.addComponent(u);const o=new dC(t,n,a);return yl.set(r,o),o}function pC(i=xd){const e=yl.get(i);if(!e&&i===xd&&Dy())return Oy();if(!e)throw or.create("no-app",{appName:i});return e}function ks(i,e,t){var n;let r=(n=uC[i])!==null&&n!==void 0?n:i;t&&(r+=`-${t}`);const s=r.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hr.warn(o.join(" "));return}vl(new xo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC="firebase-heartbeat-database",gC=1,Co="firebase-heartbeat-store";let Ph=null;function Ly(){return Ph||(Ph=Rx(mC,gC,{upgrade:(i,e)=>{switch(e){case 0:i.createObjectStore(Co)}}}).catch(i=>{throw or.create("idb-open",{originalErrorMessage:i.message})})),Ph}async function _C(i){try{return await(await Ly()).transaction(Co).objectStore(Co).get(Ny(i))}catch(e){if(e instanceof fa)Hr.warn(e.message);else{const t=or.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Hr.warn(t.message)}}}async function Og(i,e){try{const n=(await Ly()).transaction(Co,"readwrite");await n.objectStore(Co).put(e,Ny(i)),await n.done}catch(t){if(t instanceof fa)Hr.warn(t.message);else{const n=or.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Hr.warn(n.message)}}}function Ny(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC=1024,vC=30*24*60*60*1e3;class TC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new EC(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Lg();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(r=>r.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const s=new Date(r.date).valueOf();return Date.now()-s<=vC}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Lg(),{heartbeatsToSend:t,unsentEntries:n}=bC(this._heartbeatsCache.heartbeats),r=gl(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Lg(){return new Date().toISOString().substring(0,10)}function bC(i,e=yC){const t=[];let n=i.slice();for(const r of i){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),Ng(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Ng(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class EC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return hx()?dx().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await _C(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Og(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Og(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Ng(i){return gl(JSON.stringify({version:2,heartbeats:i})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SC(i){vl(new xo("platform-logger",e=>new Nx(e),"PRIVATE")),vl(new xo("heartbeat",e=>new TC(e),"PRIVATE")),ks(Sd,Rg,i),ks(Sd,Rg,"esm2017"),ks("fire-js","")}SC("");var xC="firebase",CC="10.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ks(xC,CC,"app");const wC={apiKey:"AIzaSyARBKzaouW4fSbBwlJrVzCDYLIUZnku_ds",authDomain:"surfview-001.firebaseapp.com",projectId:"surfview-001",storageBucket:"surfview-001.appspot.com",messagingSenderId:"778677178141",appId:"1:778677178141:web:17f15426c5929c1da31bf4",measurementId:"G-V2S1CF6BP3"};Oy(wC);var Tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function My(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}),t}var to;typeof window<"u"?to=window:typeof Tl<"u"?to=Tl:typeof self<"u"?to=self:to={};var oc=to;const I=mr(oc),AC={},DC=Object.freeze(Object.defineProperty({__proto__:null,default:AC},Symbol.toStringTag,{value:"Module"})),IC=My(DC);var Mg=typeof Tl<"u"?Tl:typeof window<"u"?window:{},kC=IC,io;typeof document<"u"?io=document:(io=Mg["__GLOBAL_DOCUMENT_CACHE@4"],io||(io=Mg["__GLOBAL_DOCUMENT_CACHE@4"]=kC));var Fy=io;const K=mr(Fy);var wd={exports:{}};(function(i,e){function t(u){if(u&&typeof u=="object"){var c=u.which||u.keyCode||u.charCode;c&&(u=c)}if(typeof u=="number")return a[u];var h=String(u),g=n[h.toLowerCase()];if(g)return g;var g=r[h.toLowerCase()];if(g)return g;if(h.length===1)return h.charCodeAt(0)}t.isEventKey=function(c,h){if(c&&typeof c=="object"){var g=c.which||c.keyCode||c.charCode;if(g==null)return!1;if(typeof h=="string"){var y=n[h.toLowerCase()];if(y)return y===g;var y=r[h.toLowerCase()];if(y)return y===g}else if(typeof h=="number")return h===g;return!1}},e=i.exports=t;var n=e.code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(s=97;s<123;s++)n[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)n[s-48]=s;for(s=1;s<13;s++)n["f"+s]=s+111;for(s=0;s<10;s++)n["numpad "+s]=s+96;var a=e.names=e.title={};for(s in n)a[n[s]]=s;for(var o in r)n[o]=r[o]})(wd,wd.exports);var PC=wd.exports;const ge=mr(PC);var RC=OC;function OC(i,e){var t,n=null;try{t=JSON.parse(i,e)}catch(r){n=r}return[n,t]}const LC=mr(RC);var Mf={exports:{}};function Bn(){return Bn=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Bn.apply(this,arguments)}const NC=Object.freeze(Object.defineProperty({__proto__:null,default:Bn},Symbol.toStringTag,{value:"Module"})),MC=My(NC);var FC=UC,BC=Object.prototype.toString;function UC(i){if(!i)return!1;var e=BC.call(i);return e==="[object Function]"||typeof i=="function"&&e!=="[object RegExp]"||typeof window<"u"&&(i===window.setTimeout||i===window.alert||i===window.confirm||i===window.prompt)}var VC=oc,jC=function(e,t){return t===void 0&&(t=!1),function(n,r,s){if(n){e(n);return}if(r.statusCode>=400&&r.statusCode<=599){var a=s;if(t)if(VC.TextDecoder){var o=$C(r.headers&&r.headers["content-type"]);try{a=new TextDecoder(o).decode(s)}catch{}}else a=String.fromCharCode.apply(null,new Uint8Array(s));e({cause:a});return}e(null,s)}};function $C(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(e,t){var n=t.split("="),r=n[0],s=n[1];return r.trim()==="charset"?s.trim():e},"utf-8")}var qC=jC,By=oc,HC=MC,GC=FC;yn.httpHandler=qC;/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Björklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var zC=function(e){var t={};return e&&e.trim().split(`
`).forEach(function(n){var r=n.indexOf(":"),s=n.slice(0,r).trim().toLowerCase(),a=n.slice(r+1).trim();typeof t[s]>"u"?t[s]=a:Array.isArray(t[s])?t[s].push(a):t[s]=[t[s],a]}),t};Mf.exports=yn;Mf.exports.default=yn;yn.XMLHttpRequest=By.XMLHttpRequest||YC;yn.XDomainRequest="withCredentials"in new yn.XMLHttpRequest?yn.XMLHttpRequest:By.XDomainRequest;WC(["get","put","post","patch","head","delete"],function(i){yn[i==="delete"?"del":i]=function(e,t,n){return t=Uy(e,t,n),t.method=i.toUpperCase(),Vy(t)}});function WC(i,e){for(var t=0;t<i.length;t++)e(i[t])}function KC(i){for(var e in i)if(i.hasOwnProperty(e))return!1;return!0}function Uy(i,e,t){var n=i;return GC(e)?(t=e,typeof i=="string"&&(n={uri:i})):n=HC({},e,{uri:i}),n.callback=t,n}function yn(i,e,t){return e=Uy(i,e,t),Vy(e)}function Vy(i){if(typeof i.callback>"u")throw new Error("callback argument missing");var e=!1,t=function(M,O,R){e||(e=!0,i.callback(M,O,R))};function n(){o.readyState===4&&setTimeout(a,0)}function r(){var P=void 0;if(o.response?P=o.response:P=o.responseText||XC(o),x)try{P=JSON.parse(P)}catch{}return P}function s(P){return clearTimeout(A),P instanceof Error||(P=new Error(""+(P||"Unknown XMLHttpRequest Error"))),P.statusCode=0,t(P,D)}function a(){if(!c){var P;clearTimeout(A),i.useXDR&&o.status===void 0?P=200:P=o.status===1223?204:o.status;var M=D,O=null;return P!==0?(M={body:r(),statusCode:P,method:g,headers:{},url:h,rawRequest:o},o.getAllResponseHeaders&&(M.headers=zC(o.getAllResponseHeaders()))):O=new Error("Internal XMLHttpRequest Error"),t(O,M,M.body)}}var o=i.xhr||null;o||(i.cors||i.useXDR?o=new yn.XDomainRequest:o=new yn.XMLHttpRequest);var u,c,h=o.url=i.uri||i.url,g=o.method=i.method||"GET",y=i.body||i.data,T=o.headers=i.headers||{},v=!!i.sync,x=!1,A,D={body:void 0,headers:{},statusCode:0,method:g,url:h,rawRequest:o};if("json"in i&&i.json!==!1&&(x=!0,T.accept||T.Accept||(T.Accept="application/json"),g!=="GET"&&g!=="HEAD"&&(T["content-type"]||T["Content-Type"]||(T["Content-Type"]="application/json"),y=JSON.stringify(i.json===!0?y:i.json))),o.onreadystatechange=n,o.onload=a,o.onerror=s,o.onprogress=function(){},o.onabort=function(){c=!0},o.ontimeout=s,o.open(g,h,!v,i.username,i.password),v||(o.withCredentials=!!i.withCredentials),!v&&i.timeout>0&&(A=setTimeout(function(){if(!c){c=!0,o.abort("timeout");var P=new Error("XMLHttpRequest timeout");P.code="ETIMEDOUT",s(P)}},i.timeout)),o.setRequestHeader)for(u in T)T.hasOwnProperty(u)&&o.setRequestHeader(u,T[u]);else if(i.headers&&!KC(i.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in i&&(o.responseType=i.responseType),"beforeSend"in i&&typeof i.beforeSend=="function"&&i.beforeSend(o),o.send(y||null),o}function XC(i){try{if(i.responseType==="document")return i.responseXML;var e=i.responseXML&&i.responseXML.documentElement.nodeName==="parsererror";if(i.responseType===""&&!e)return i.responseXML}catch{}return null}function YC(){}var QC=Mf.exports;const jy=mr(QC);var $y={exports:{}},Fg=Fy,Ff=Object.create||function(){function i(){}return function(e){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return i.prototype=e,new i}}();function Ii(i,e){this.name="ParsingError",this.code=i.code,this.message=e||i.message}Ii.prototype=Ff(Error.prototype);Ii.prototype.constructor=Ii;Ii.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function Bf(i){function e(n,r,s,a){return(n|0)*3600+(r|0)*60+(s|0)+(a|0)/1e3}var t=i.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return t?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):t[1]>59?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null}function ho(){this.values=Ff(null)}ho.prototype={set:function(i,e){!this.get(i)&&e!==""&&(this.values[i]=e)},get:function(i,e,t){return t?this.has(i)?this.values[i]:e[t]:this.has(i)?this.values[i]:e},has:function(i){return i in this.values},alt:function(i,e,t){for(var n=0;n<t.length;++n)if(e===t[n]){this.set(i,e);break}},integer:function(i,e){/^-?\d+$/.test(e)&&this.set(i,parseInt(e,10))},percent:function(i,e){return e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e),e>=0&&e<=100)?(this.set(i,e),!0):!1}};function no(i,e,t,n){var r=n?i.split(n):[i];for(var s in r)if(typeof r[s]=="string"){var a=r[s].split(t);if(a.length===2){var o=a[0].trim(),u=a[1].trim();e(o,u)}}}function JC(i,e,t){var n=i;function r(){var o=Bf(i);if(o===null)throw new Ii(Ii.Errors.BadTimeStamp,"Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,u){var c=new ho;no(o,function(h,g){switch(h){case"region":for(var y=t.length-1;y>=0;y--)if(t[y].id===g){c.set(h,t[y].region);break}break;case"vertical":c.alt(h,g,["rl","lr"]);break;case"line":var T=g.split(","),v=T[0];c.integer(h,v),c.percent(h,v)&&c.set("snapToLines",!1),c.alt(h,v,["auto"]),T.length===2&&c.alt("lineAlign",T[1],["start","center","end"]);break;case"position":T=g.split(","),c.percent(h,T[0]),T.length===2&&c.alt("positionAlign",T[1],["start","center","end"]);break;case"size":c.percent(h,g);break;case"align":c.alt(h,g,["start","center","end","left","right"]);break}},/:/,/\s/),u.region=c.get("region",null),u.vertical=c.get("vertical","");try{u.line=c.get("line","auto")}catch{}u.lineAlign=c.get("lineAlign","start"),u.snapToLines=c.get("snapToLines",!0),u.size=c.get("size",100);try{u.align=c.get("align","center")}catch{u.align=c.get("align","middle")}try{u.position=c.get("position","auto")}catch{u.position=c.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},u.align)}u.positionAlign=c.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},u.align)}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),i.substr(0,3)!=="-->")throw new Ii(Ii.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.substr(3),a(),e.endTime=r(),a(),s(i,e)}var Rh=Fg.createElement&&Fg.createElement("textarea"),ZC={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Bg={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},ew={v:"title",lang:"lang"},Ug={rt:"ruby"};function qy(i,e){function t(){if(!e)return null;function v(A){return e=e.substr(A.length),A}var x=e.match(/^([^<]*)(<[^>]*>?)?/);return v(x[1]?x[1]:x[2])}function n(v){return Rh.innerHTML=v,v=Rh.textContent,Rh.textContent="",v}function r(v,x){return!Ug[x.localName]||Ug[x.localName]===v.localName}function s(v,x){var A=ZC[v];if(!A)return null;var D=i.document.createElement(A),P=ew[v];return P&&x&&(D[P]=x.trim()),D}for(var a=i.document.createElement("div"),o=a,u,c=[];(u=t())!==null;){if(u[0]==="<"){if(u[1]==="/"){c.length&&c[c.length-1]===u.substr(2).replace(">","")&&(c.pop(),o=o.parentNode);continue}var h=Bf(u.substr(1,u.length-2)),g;if(h){g=i.document.createProcessingInstruction("timestamp",h),o.appendChild(g);continue}var y=u.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!y||(g=s(y[1],y[3]),!g)||!r(o,g))continue;if(y[2]){var T=y[2].split(".");T.forEach(function(v){var x=/^bg_/.test(v),A=x?v.slice(3):v;if(Bg.hasOwnProperty(A)){var D=x?"background-color":"color",P=Bg[A];g.style[D]=P}}),g.className=T.join(" ")}c.push(y[1]),o.appendChild(g),o=g;continue}o.appendChild(i.document.createTextNode(n(u)))}return a}var Vg=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function tw(i){for(var e=0;e<Vg.length;e++){var t=Vg[e];if(i>=t[0]&&i<=t[1])return!0}return!1}function iw(i){var e=[],t="",n;if(!i||!i.childNodes)return"ltr";function r(o,u){for(var c=u.childNodes.length-1;c>=0;c--)o.push(u.childNodes[c])}function s(o){if(!o||!o.length)return null;var u=o.pop(),c=u.textContent||u.innerText;if(c){var h=c.match(/^.*(\n|\r)/);return h?(o.length=0,h[0]):c}if(u.tagName==="ruby")return s(o);if(u.childNodes)return r(o,u),s(o)}for(r(e,i);t=s(e);)for(var a=0;a<t.length;a++)if(n=t.charCodeAt(a),tw(n))return"rtl";return"ltr"}function nw(i){if(typeof i.line=="number"&&(i.snapToLines||i.line>=0&&i.line<=100))return i.line;if(!i.track||!i.track.textTrackList||!i.track.textTrackList.mediaElement)return-1;for(var e=i.track,t=e.textTrackList,n=0,r=0;r<t.length&&t[r]!==e;r++)t[r].mode==="showing"&&n++;return++n*-1}function uc(){}uc.prototype.applyStyles=function(i,e){e=e||this.div;for(var t in i)i.hasOwnProperty(t)&&(e.style[t]=i[t])};uc.prototype.formatStyle=function(i,e){return i===0?0:i+e};function bl(i,e,t){uc.call(this),this.cue=e,this.cueDiv=qy(i,e.text);var n={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(n,this.cueDiv),this.div=i.document.createElement("div"),n={direction:iw(this.cueDiv),writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:e.align==="middle"?"center":e.align,font:t.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var r=0;switch(e.positionAlign){case"start":r=e.position;break;case"center":r=e.position-e.size/2;break;case"end":r=e.position-e.size;break}e.vertical===""?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(e.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(e.size,"%")}),this.move=function(s){this.applyStyles({top:this.formatStyle(s.top,"px"),bottom:this.formatStyle(s.bottom,"px"),left:this.formatStyle(s.left,"px"),right:this.formatStyle(s.right,"px"),height:this.formatStyle(s.height,"px"),width:this.formatStyle(s.width,"px")})}}bl.prototype=Ff(uc.prototype);bl.prototype.constructor=bl;function ri(i){var e,t,n,r;if(i.div){t=i.div.offsetHeight,n=i.div.offsetWidth,r=i.div.offsetTop;var s=(s=i.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();i=i.div.getBoundingClientRect(),e=s?Math.max(s[0]&&s[0].height||0,i.height/s.length):0}this.left=i.left,this.right=i.right,this.top=i.top||r,this.height=i.height||t,this.bottom=i.bottom||r+(i.height||t),this.width=i.width||n,this.lineHeight=e!==void 0?e:i.lineHeight}ri.prototype.move=function(i,e){switch(e=e!==void 0?e:this.lineHeight,i){case"+x":this.left+=e,this.right+=e;break;case"-x":this.left-=e,this.right-=e;break;case"+y":this.top+=e,this.bottom+=e;break;case"-y":this.top-=e,this.bottom-=e;break}};ri.prototype.overlaps=function(i){return this.left<i.right&&this.right>i.left&&this.top<i.bottom&&this.bottom>i.top};ri.prototype.overlapsAny=function(i){for(var e=0;e<i.length;e++)if(this.overlaps(i[e]))return!0;return!1};ri.prototype.within=function(i){return this.top>=i.top&&this.bottom<=i.bottom&&this.left>=i.left&&this.right<=i.right};ri.prototype.overlapsOppositeAxis=function(i,e){switch(e){case"+x":return this.left<i.left;case"-x":return this.right>i.right;case"+y":return this.top<i.top;case"-y":return this.bottom>i.bottom}};ri.prototype.intersectPercentage=function(i){var e=Math.max(0,Math.min(this.right,i.right)-Math.max(this.left,i.left)),t=Math.max(0,Math.min(this.bottom,i.bottom)-Math.max(this.top,i.top)),n=e*t;return n/(this.height*this.width)};ri.prototype.toCSSCompatValues=function(i){return{top:this.top-i.top,bottom:i.bottom-this.bottom,left:this.left-i.left,right:i.right-this.right,height:this.height,width:this.width}};ri.getSimpleBoxPosition=function(i){var e=i.div?i.div.offsetHeight:i.tagName?i.offsetHeight:0,t=i.div?i.div.offsetWidth:i.tagName?i.offsetWidth:0,n=i.div?i.div.offsetTop:i.tagName?i.offsetTop:0;i=i.div?i.div.getBoundingClientRect():i.tagName?i.getBoundingClientRect():i;var r={left:i.left,right:i.right,top:i.top||n,height:i.height||e,bottom:i.bottom||n+(i.height||e),width:i.width||t};return r};function rw(i,e,t,n){function r(A,D){for(var P,M=new ri(A),O=1,R=0;R<D.length;R++){for(;A.overlapsOppositeAxis(t,D[R])||A.within(t)&&A.overlapsAny(n);)A.move(D[R]);if(A.within(t))return A;var $=A.intersectPercentage(t);O>$&&(P=new ri(A),O=$),A=new ri(M)}return P||M}var s=new ri(e),a=e.cue,o=nw(a),u=[];if(a.snapToLines){var c;switch(a.vertical){case"":u=["+y","-y"],c="height";break;case"rl":u=["+x","-x"],c="width";break;case"lr":u=["-x","+x"],c="width";break}var h=s.lineHeight,g=h*Math.round(o),y=t[c]+h,T=u[0];Math.abs(g)>y&&(g=g<0?-1:1,g*=Math.ceil(y/h)*h),o<0&&(g+=a.vertical===""?t.height:t.width,u=u.reverse()),s.move(T,g)}else{var v=s.lineHeight/t.height*100;switch(a.lineAlign){case"center":o-=v/2;break;case"end":o-=v;break}switch(a.vertical){case"":e.applyStyles({top:e.formatStyle(o,"%")});break;case"rl":e.applyStyles({left:e.formatStyle(o,"%")});break;case"lr":e.applyStyles({right:e.formatStyle(o,"%")});break}u=["+y","-x","+x","-y"],s=new ri(e)}var x=r(s,u);e.move(x.toCSSCompatValues(t))}function pa(){}pa.StringDecoder=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}};pa.convertCueToDOMTree=function(i,e){return!i||!e?null:qy(i,e)};var sw=.05,aw="sans-serif",ow="1.5%";pa.processCues=function(i,e,t){if(!i||!e||!t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);var n=i.document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin=ow,t.appendChild(n);function r(h){for(var g=0;g<h.length;g++)if(h[g].hasBeenReset||!h[g].displayState)return!0;return!1}if(!r(e)){for(var s=0;s<e.length;s++)n.appendChild(e[s].displayState);return}var a=[],o=ri.getSimpleBoxPosition(n),u=Math.round(o.height*sw*100)/100,c={font:u+"px "+aw};(function(){for(var h,g,y=0;y<e.length;y++)g=e[y],h=new bl(i,g,c),n.appendChild(h.div),rw(i,h,o,a),g.displayState=h.div,a.push(ri.getSimpleBoxPosition(h))})()};pa.Parser=function(i,e,t){t||(t=e,e={}),e||(e={}),this.window=i,this.vttjs=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]};pa.Parser.prototype={reportOrThrowError:function(i){if(i instanceof Ii)this.onparsingerror&&this.onparsingerror(i);else throw i},parse:function(i){var e=this;i&&(e.buffer+=e.decoder.decode(i,{stream:!0}));function t(){for(var h=e.buffer,g=0;g<h.length&&h[g]!=="\r"&&h[g]!==`
`;)++g;var y=h.substr(0,g);return h[g]==="\r"&&++g,h[g]===`
`&&++g,e.buffer=h.substr(g),y}function n(h){var g=new ho;if(no(h,function(T,v){switch(T){case"id":g.set(T,v);break;case"width":g.percent(T,v);break;case"lines":g.integer(T,v);break;case"regionanchor":case"viewportanchor":var x=v.split(",");if(x.length!==2)break;var A=new ho;if(A.percent("x",x[0]),A.percent("y",x[1]),!A.has("x")||!A.has("y"))break;g.set(T+"X",A.get("x")),g.set(T+"Y",A.get("y"));break;case"scroll":g.alt(T,v,["up"]);break}},/=/,/\s/),g.has("id")){var y=new(e.vttjs.VTTRegion||e.window.VTTRegion);y.width=g.get("width",100),y.lines=g.get("lines",3),y.regionAnchorX=g.get("regionanchorX",0),y.regionAnchorY=g.get("regionanchorY",100),y.viewportAnchorX=g.get("viewportanchorX",0),y.viewportAnchorY=g.get("viewportanchorY",100),y.scroll=g.get("scroll",""),e.onregion&&e.onregion(y),e.regionList.push({id:g.get("id"),region:y})}}function r(h){var g=new ho;no(h,function(y,T){switch(y){case"MPEGT":g.integer(y+"S",T);break;case"LOCA":g.set(y+"L",Bf(T));break}},/[^\d]:/,/,/),e.ontimestampmap&&e.ontimestampmap({MPEGTS:g.get("MPEGTS"),LOCAL:g.get("LOCAL")})}function s(h){h.match(/X-TIMESTAMP-MAP/)?no(h,function(g,y){switch(g){case"X-TIMESTAMP-MAP":r(y);break}},/=/):no(h,function(g,y){switch(g){case"Region":n(y);break}},/:/)}try{var a;if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=t();var o=a.match(/^WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Ii(Ii.Errors.BadSignature);e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:a=t(),e.state){case"HEADER":/:/.test(a)?s(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;e.cue=new(e.vttjs.VTTCue||e.window.VTTCue)(0,0,"");try{e.cue.align="center"}catch{e.cue.align="middle"}if(e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":try{JC(a,e.cue,e.regionList)}catch(h){e.reportOrThrowError(h),e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var c=a.indexOf("-->")!==-1;if(!a||c&&(u=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":a||(e.state="ID");continue}}}catch(h){e.reportOrThrowError(h),e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var i=this;try{if(i.buffer+=i.decoder.decode(),(i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL")throw new Ii(Ii.Errors.BadSignature)}catch(e){i.reportOrThrowError(e)}return i.onflush&&i.onflush(),this}};var uw=pa,lw="auto",cw={"":1,lr:1,rl:1},hw={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function dw(i){if(typeof i!="string")return!1;var e=cw[i.toLowerCase()];return e?i.toLowerCase():!1}function Oh(i){if(typeof i!="string")return!1;var e=hw[i.toLowerCase()];return e?i.toLowerCase():!1}function Hy(i,e,t){this.hasBeenReset=!1;var n="",r=!1,s=i,a=e,o=t,u=null,c="",h=!0,g="auto",y="start",T="auto",v="auto",x=100,A="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return n},set:function(D){n=""+D}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(D){r=!!D}},startTime:{enumerable:!0,get:function(){return s},set:function(D){if(typeof D!="number")throw new TypeError("Start time must be set to a number.");s=D,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return a},set:function(D){if(typeof D!="number")throw new TypeError("End time must be set to a number.");a=D,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(D){o=""+D,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return u},set:function(D){u=D,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return c},set:function(D){var P=dw(D);if(P===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");c=P,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return h},set:function(D){h=!!D,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return g},set:function(D){if(typeof D!="number"&&D!==lw)throw new SyntaxError("Line: an invalid number or illegal string was specified.");g=D,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return y},set:function(D){var P=Oh(D);P?(y=P,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return T},set:function(D){if(D<0||D>100)throw new Error("Position must be between 0 and 100.");T=D,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return v},set:function(D){var P=Oh(D);P?(v=P,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return x},set:function(D){if(D<0||D>100)throw new Error("Size must be between 0 and 100.");x=D,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return A},set:function(D){var P=Oh(D);if(!P)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");A=P,this.hasBeenReset=!0}}}),this.displayState=void 0}Hy.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var fw=Hy,pw={"":!0,up:!0};function mw(i){if(typeof i!="string")return!1;var e=pw[i.toLowerCase()];return e?i.toLowerCase():!1}function za(i){return typeof i=="number"&&i>=0&&i<=100}function gw(){var i=100,e=3,t=0,n=100,r=0,s=100,a="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return i},set:function(o){if(!za(o))throw new Error("Width must be between 0 and 100.");i=o}},lines:{enumerable:!0,get:function(){return e},set:function(o){if(typeof o!="number")throw new TypeError("Lines must be set to a number.");e=o}},regionAnchorY:{enumerable:!0,get:function(){return n},set:function(o){if(!za(o))throw new Error("RegionAnchorX must be between 0 and 100.");n=o}},regionAnchorX:{enumerable:!0,get:function(){return t},set:function(o){if(!za(o))throw new Error("RegionAnchorY must be between 0 and 100.");t=o}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(o){if(!za(o))throw new Error("ViewportAnchorY must be between 0 and 100.");s=o}},viewportAnchorX:{enumerable:!0,get:function(){return r},set:function(o){if(!za(o))throw new Error("ViewportAnchorX must be between 0 and 100.");r=o}},scroll:{enumerable:!0,get:function(){return a},set:function(o){var u=mw(o);u===!1?console.warn("Scroll: an invalid or illegal string was specified."):a=u}}})}var _w=gw,Un=oc,Qr=$y.exports={WebVTT:uw,VTTCue:fw,VTTRegion:_w};Un.vttjs=Qr;Un.WebVTT=Qr.WebVTT;var yw=Qr.VTTCue,vw=Qr.VTTRegion,Tw=Un.VTTCue,bw=Un.VTTRegion;Qr.shim=function(){Un.VTTCue=yw,Un.VTTRegion=vw};Qr.restore=function(){Un.VTTCue=Tw,Un.VTTRegion=bw};Un.VTTCue||Qr.shim();var Ew=$y.exports;const jg=mr(Ew);var Gy={exports:{}};(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(u,c,h){if(h=h||{},u=u.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return u;var g=o.parseURL(u);if(!g)throw new Error("Error trying to parse base URL.");return g.path=o.normalizePath(g.path),o.buildURLFromParts(g)}var y=o.parseURL(c);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return h.alwaysNormalize?(y.path=o.normalizePath(y.path),o.buildURLFromParts(y)):c;var T=o.parseURL(u);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var v=r.exec(T.path);T.netLoc=v[1],T.path=v[2]}T.netLoc&&!T.path&&(T.path="/");var x={scheme:T.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(x.netLoc=T.netLoc,y.path[0]!=="/"))if(!y.path)x.path=T.path,y.params||(x.params=T.params,y.query||(x.query=T.query));else{var A=T.path,D=A.substring(0,A.lastIndexOf("/")+1)+y.path;x.path=o.normalizePath(D)}return x.path===null&&(x.path=h.alwaysNormalize?o.normalizePath(y.path):y.path),o.buildURLFromParts(x)},parseURL:function(u){var c=n.exec(u);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(a,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};i.exports=o})()})(Gy);var Sw=Gy.exports;const El=mr(Sw);var $g="http://example.com",xw=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=I.location&&I.location.href||"");var n=typeof I.URL=="function",r=/^\/\//.test(e),s=!I.location&&!/\/\//i.test(e);if(n?e=new I.URL(e,I.location||$g):/\/\//i.test(e)||(e=El.buildAbsoluteURL(I.location&&I.location.href||"",e)),n){var a=new URL(t,e);return s?a.href.slice($g.length):r?a.href.slice(a.protocol.length):a.href}return El.buildAbsoluteURL(e,t)},Uf=function(){function i(){this.listeners={}}var e=i.prototype;return e.on=function(n,r){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(r)},e.off=function(n,r){if(!this.listeners[n])return!1;var s=this.listeners[n].indexOf(r);return this.listeners[n]=this.listeners[n].slice(0),this.listeners[n].splice(s,1),s>-1},e.trigger=function(n){var r=this.listeners[n];if(r)if(arguments.length===2)for(var s=r.length,a=0;a<s;++a)r[a].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),u=r.length,c=0;c<u;++c)r[c].apply(this,o)},e.dispose=function(){this.listeners={}},e.pipe=function(n){this.on("data",function(r){n.push(r)})},i}(),Cw=function(e){return I.atob?I.atob(e):Buffer.from(e,"base64").toString("binary")};function ww(i){for(var e=Cw(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}/*! @name m3u8-parser @version 6.2.0 @license Apache-2.0 */class Aw extends Uf{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const Dw=String.fromCharCode(9),Lh=function(i){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(i||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},Iw=function(){const i="[^=]*",e='"[^"]*"|[^,]*',t="(?:"+i+")=(?:"+e+")";return new RegExp("(?:^|,)("+t+")")},Mi=function(i){const e={};if(!i)return e;const t=i.split(Iw());let n=t.length,r;for(;n--;)t[n]!==""&&(r=/([^=]*)=(.*)/.exec(t[n]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),e[r[0]]=r[1]);return e};class kw extends Uf{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((s,a)=>{const o=a(e);return o===e?s:s.concat([o])},[e]).forEach(s=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,s))return;if(s.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:s.slice(1)});return}if(s=s.replace("\r",""),t=/^#EXTM3U/.exec(s),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(s),t){n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),this.trigger("data",n);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(s),t){n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),this.trigger("data",n);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(s),t){n=Bn(Lh(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",n);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(s),t){n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(s),t){if(n={type:"tag",tagType:"map"},t[1]){const a=Mi(t[1]);a.URI&&(n.uri=a.URI),a.BYTERANGE&&(n.byterange=Lh(a.BYTERANGE))}this.trigger("data",n);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(s),t){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=Mi(t[1]),n.attributes.RESOLUTION){const a=n.attributes.RESOLUTION.split("x"),o={};a[0]&&(o.width=parseInt(a[0],10)),a[1]&&(o.height=parseInt(a[1],10)),n.attributes.RESOLUTION=o}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(s),t){n={type:"tag",tagType:"media"},t[1]&&(n.attributes=Mi(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-ENDLIST/.exec(s),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(s),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(s),t){n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(s),t){n={type:"tag",tagType:"key"},t[1]&&(n.attributes=Mi(t[1]),n.attributes.IV&&(n.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),this.trigger("data",n);return}if(t=/^#EXT-X-START:(.*)$/.exec(s),t){n={type:"tag",tagType:"start"},t[1]&&(n.attributes=Mi(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"skip"},n.attributes=Mi(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(Dw)),this.trigger("data",n);return}if(t=/^#EXT-X-PART:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"part"},n.attributes=Mi(t[1]),["DURATION"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=Lh(n.attributes.BYTERANGE)),this.trigger("data",n);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"server-control"},n.attributes=Mi(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"part-inf"},n.attributes=Mi(t[1]),["PART-TARGET"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"preload-hint"},n.attributes=Mi(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(n.attributes.hasOwnProperty(a)){n.attributes[a]=parseInt(n.attributes[a],10);const o=a==="BYTERANGE-LENGTH"?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[o]=n.attributes[a],delete n.attributes[a]}}),this.trigger("data",n);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"rendition-report"},n.attributes=Mi(t[1]),["LAST-MSN","LAST-PART"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseInt(n.attributes[a],10))}),this.trigger("data",n);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=Mi(t[1]),["ID","CLASS"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=String(n.attributes[o]))}),["START-DATE","END-DATE"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=new Date(n.attributes[o]))}),["DURATION","PLANNED-DURATION"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=parseFloat(n.attributes[o]))}),["END-ON-NEXT"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=/YES/i.test(n.attributes[o]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=n.attributes[o].toString(16))});const a=/^X-([A-Z]+-)+[A-Z]+$/;for(const o in n.attributes){if(!a.test(o))continue;const u=/[0-9A-Fa-f]{6}/g.test(n.attributes[o]),c=/^\d+(\.\d+)?$/.test(n.attributes[o]);n.attributes[o]=u?n.attributes[o].toString(16):c?parseFloat(n.attributes[o]):String(n.attributes[o])}this.trigger("data",n);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(s),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}this.trigger("data",{type:"tag",data:s.slice(4)})})}addParser({expression:e,customType:t,dataParser:n,segment:r}){typeof n!="function"&&(n=s=>s),this.customParsers.push(s=>{if(e.exec(s))return this.trigger("data",{type:"custom",data:n(s),customType:t,segment:r}),!0})}addTagMapper({expression:e,map:t}){const n=r=>e.test(r)?t(r):r;this.tagMappers.push(n)}}const Pw=i=>i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),wr=function(i){const e={};return Object.keys(i).forEach(function(t){e[Pw(t)]=i[t]}),e},Nh=function(i){const{serverControl:e,targetDuration:t,partTargetDuration:n}=i;if(!e)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=t&&t*3,u=n&&n*2;t&&!e.hasOwnProperty(s)&&(e[s]=o,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&e[s]<o&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${e[s]}) to targetDuration * 3 (${o})`}),e[s]=o),n&&!e.hasOwnProperty(a)&&(e[a]=n*3,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),n&&e[a]<u&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${u}).`}),e[a]=u)};class Rw extends Uf{constructor(){super(),this.lineStream=new Aw,this.parseStream=new kw,this.lineStream.pipe(this.parseStream);const e=this,t=[];let n={},r,s,a=!1;const o=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let h=0;this.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};let g=0,y=0;const T={};this.on("end",()=>{n.uri||!n.parts&&!n.preloadHints||(!n.map&&r&&(n.map=r),!n.key&&s&&(n.key=s),!n.timeline&&typeof h=="number"&&(n.timeline=h),this.manifest.preloadSegment=n)}),this.parseStream.on("data",function(v){let x,A;({tag(){({version(){v.version&&(this.manifest.version=v.version)},"allow-cache"(){this.manifest.allowCache=v.allowed,"allowed"in v||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const D={};"length"in v&&(n.byterange=D,D.length=v.length,"offset"in v||(v.offset=g)),"offset"in v&&(n.byterange=D,D.offset=v.offset),g=D.offset+D.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),v.duration>0&&(n.duration=v.duration),v.duration===0&&(n.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(!v.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(v.attributes.METHOD==="NONE"){s=null;return}if(!v.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(v.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:v.attributes};return}if(v.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:v.attributes.URI};return}if(v.attributes.KEYFORMAT===c){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(v.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(v.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),v.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(v.attributes.KEYID&&v.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:v.attributes.KEYFORMAT,keyId:v.attributes.KEYID.substring(2)},pssh:ww(v.attributes.URI.split(",")[1])};return}v.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),s={method:v.attributes.METHOD||"AES-128",uri:v.attributes.URI},typeof v.attributes.IV<"u"&&(s.iv=v.attributes.IV)},"media-sequence"(){if(!isFinite(v.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+v.number});return}this.manifest.mediaSequence=v.number},"discontinuity-sequence"(){if(!isFinite(v.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+v.number});return}this.manifest.discontinuitySequence=v.number,h=v.number},"playlist-type"(){if(!/VOD|EVENT/.test(v.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+v.playlist});return}this.manifest.playlistType=v.playlistType},map(){r={},v.uri&&(r.uri=v.uri),v.byterange&&(r.byterange=v.byterange),s&&(r.key=s)},"stream-inf"(){if(this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||u,!v.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}n.attributes||(n.attributes={}),Bn(n.attributes,v.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,!(v.attributes&&v.attributes.TYPE&&v.attributes["GROUP-ID"]&&v.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const D=this.manifest.mediaGroups[v.attributes.TYPE];D[v.attributes["GROUP-ID"]]=D[v.attributes["GROUP-ID"]]||{},x=D[v.attributes["GROUP-ID"]],A={default:/yes/i.test(v.attributes.DEFAULT)},A.default?A.autoselect=!0:A.autoselect=/yes/i.test(v.attributes.AUTOSELECT),v.attributes.LANGUAGE&&(A.language=v.attributes.LANGUAGE),v.attributes.URI&&(A.uri=v.attributes.URI),v.attributes["INSTREAM-ID"]&&(A.instreamId=v.attributes["INSTREAM-ID"]),v.attributes.CHARACTERISTICS&&(A.characteristics=v.attributes.CHARACTERISTICS),v.attributes.FORCED&&(A.forced=/yes/i.test(v.attributes.FORCED)),x[v.attributes.NAME]=A},discontinuity(){h+=1,n.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=v.dateTimeString,this.manifest.dateTimeObject=v.dateTimeObject),n.dateTimeString=v.dateTimeString,n.dateTimeObject=v.dateTimeObject},targetduration(){if(!isFinite(v.duration)||v.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+v.duration});return}this.manifest.targetDuration=v.duration,Nh.call(this,this.manifest)},start(){if(!v.attributes||isNaN(v.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:v.attributes["TIME-OFFSET"],precise:v.attributes.PRECISE}},"cue-out"(){n.cueOut=v.data},"cue-out-cont"(){n.cueOutCont=v.data},"cue-in"(){n.cueIn=v.data},skip(){this.manifest.skip=wr(v.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",v.attributes,["SKIPPED-SEGMENTS"])},part(){a=!0;const D=this.manifest.segments.length,P=wr(v.attributes);n.parts=n.parts||[],n.parts.push(P),P.byterange&&(P.byterange.hasOwnProperty("offset")||(P.byterange.offset=y),y=P.byterange.offset+P.byterange.length);const M=n.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${M} for segment #${D}`,v.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((O,R)=>{O.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${R} lacks required attribute(s): LAST-PART`})})},"server-control"(){const D=this.manifest.serverControl=wr(v.attributes);D.hasOwnProperty("canBlockReload")||(D.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Nh.call(this,this.manifest),D.canSkipDateranges&&!D.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const D=this.manifest.segments.length,P=wr(v.attributes),M=P.type&&P.type==="PART";n.preloadHints=n.preloadHints||[],n.preloadHints.push(P),P.byterange&&(P.byterange.hasOwnProperty("offset")||(P.byterange.offset=M?y:0,M&&(y=P.byterange.offset+P.byterange.length)));const O=n.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${O} for segment #${D}`,v.attributes,["TYPE","URI"]),!!P.type)for(let R=0;R<n.preloadHints.length-1;R++){const $=n.preloadHints[R];$.type&&$.type===P.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${O} for segment #${D} has the same TYPE ${P.type} as preload hint #${R}`})}},"rendition-report"(){const D=wr(v.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(D);const P=this.manifest.renditionReports.length-1,M=["LAST-MSN","URI"];a&&M.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${P}`,v.attributes,M)},"part-inf"(){this.manifest.partInf=wr(v.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",v.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Nh.call(this,this.manifest)},daterange(){this.manifest.daterange=this.manifest.daterange||[],this.manifest.daterange.push(wr(v.attributes));const D=this.manifest.daterange.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${D}`,v.attributes,["ID","START-DATE"]);const P=this.manifest.daterange[D];P.endDate&&P.startDate&&new Date(P.endDate)<new Date(P.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),P.duration&&P.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),P.plannedDuration&&P.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const M=!!P.endOnNext;if(M&&!P.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),M&&(P.duration||P.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),P.duration&&P.endDate){const O=P.startDate,R=O.setSeconds(O.getSeconds()+P.duration);this.manifest.daterange[D].endDate=new Date(R)}if(P&&!this.manifest.dateTimeString&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),!T[P.id])T[P.id]=P;else for(const O in T[P.id])if(T[P.id][O]!==P[O]){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes and same attribute values"});break}},"independent-segments"(){this.manifest.independentSegments=!0}}[v.tagType]||o).call(e)},uri(){n.uri=v.uri,t.push(n),this.manifest.targetDuration&&!("duration"in n)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),n.duration=this.manifest.targetDuration),s&&(n.key=s),n.timeline=h,r&&(n.map=r),y=0,n={}},comment(){},custom(){v.segment?(n.custom=n.custom||{},n.custom[v.customType]=v.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[v.customType]=v.data)}})[v.type].call(e)})}warnOnMissingAttributes_(e,t,n){const r=[];n.forEach(function(s){t.hasOwnProperty(s)||r.push(s)}),r.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${r.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var Fr={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},Ow=["video","audio","text"],qg=["Video","Audio","Text"],zy=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(t,n,r){var s=("00"+Number(n).toString(16)).slice(-2),a=("00"+Number(r).toString(16)).slice(-2);return"avc1."+s+"00"+a})},ln=function(e){e===void 0&&(e="");var t=e.split(","),n=[];return t.forEach(function(r){r=r.trim();var s;Ow.forEach(function(a){var o=Fr[a].exec(r.toLowerCase());if(!(!o||o.length<=1)){s=a;var u=r.substring(0,o[1].length),c=r.replace(u,"");n.push({type:u,details:c,mediaType:a})}}),s||n.push({type:r,details:"",mediaType:"unknown"})}),n},Lw=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var r in n){var s=n[r];if(s.default&&s.playlists)return ln(s.playlists[0].attributes.CODECS)}return null},Wy=function(e){return e===void 0&&(e=""),Fr.audio.test(e.trim().toLowerCase())},Nw=function(e){return e===void 0&&(e=""),Fr.text.test(e.trim().toLowerCase())},wo=function(e){if(!(!e||typeof e!="string")){var t=e.toLowerCase().split(",").map(function(s){return zy(s.trim())}),n="video";t.length===1&&Wy(t[0])?n="audio":t.length===1&&Nw(t[0])&&(n="application");var r="mp4";return t.every(function(s){return Fr.mp4.test(s)})?r="mp4":t.every(function(s){return Fr.webm.test(s)})?r="webm":t.every(function(s){return Fr.ogg.test(s)})&&(r="ogg"),n+"/"+r+';codecs="'+e+'"'}},al=function(e){return e===void 0&&(e=""),I.MediaSource&&I.MediaSource.isTypeSupported&&I.MediaSource.isTypeSupported(wo(e))||!1},Mh=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(t){t=t.trim();for(var n=0;n<qg.length;n++){var r=qg[n];if(Fr["muxer"+r].test(t))return!0}return!1})},Hg="mp4a.40.2",Mw="avc1.4d400d",Fw=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,Bw=/^application\/dash\+xml/i,Ky=function(e){return Fw.test(e)?"hls":Bw.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},Uw=function(e){return e.toString(2).length},Vw=function(e){return Math.ceil(Uw(e)/8)},Xy=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},jw=function(e){return Xy(e)},oe=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!jw(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},Pt=I.BigInt||Number,Ad=[Pt("0x1"),Pt("0x100"),Pt("0x10000"),Pt("0x1000000"),Pt("0x100000000"),Pt("0x10000000000"),Pt("0x1000000000000"),Pt("0x100000000000000"),Pt("0x10000000000000000")];(function(){var i=new Uint16Array([65484]),e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var $w=function(e,t){var n=t===void 0?{}:t,r=n.signed,s=r===void 0?!1:r,a=n.le,o=a===void 0?!1:a;e=oe(e);var u=o?"reduce":"reduceRight",c=e[u]?e[u]:Array.prototype[u],h=c.call(e,function(y,T,v){var x=o?v:Math.abs(v+1-e.length);return y+Pt(T)*Ad[x]},Pt(0));if(s){var g=Ad[e.length]/Pt(2)-Pt(1);h=Pt(h),h>g&&(h-=g,h-=g,h-=Pt(2))}return Number(h)},qw=function(e,t){var n=t===void 0?{}:t,r=n.le,s=r===void 0?!1:r;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=Pt(e);for(var a=Vw(e),o=new Uint8Array(new ArrayBuffer(a)),u=0;u<a;u++){var c=s?u:Math.abs(u+1-o.length);o[c]=Number(e/Ad[u]&Pt(255)),e<0&&(o[c]=Math.abs(~o[c]),o[c]-=u===0?1:2)}return o},Yy=function(e,t){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},Hw=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter(function(o){return o&&(o.byteLength||o.length)&&typeof o!="string"}),t.length<=1)return oe(t[0]);var r=t.reduce(function(o,u,c){return o+(u.byteLength||u.length)},0),s=new Uint8Array(r),a=0;return t.forEach(function(o){o=oe(o),s.set(o,a),a+=o.byteLength}),s},Ze=function(e,t,n){var r=n===void 0?{}:n,s=r.offset,a=s===void 0?0:s,o=r.mask,u=o===void 0?[]:o;e=oe(e),t=oe(t);var c=t.every?t.every:Array.prototype.every;return t.length&&e.length-a>=t.length&&c.call(t,function(h,g){var y=u[g]?u[g]&e[a+g]:e[a+g];return h===y})},Gg="http://example.com",Vf=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=I.location&&I.location.href||"");var n=typeof I.URL=="function",r=/^\/\//.test(e),s=!I.location&&!/\/\//i.test(e);if(n?e=new I.URL(e,I.location||Gg):/\/\//i.test(e)||(e=El.buildAbsoluteURL(I.location&&I.location.href||"",e)),n){var a=new URL(t,e);return s?a.href.slice(Gg.length):r?a.href.slice(a.protocol.length):a.href}return El.buildAbsoluteURL(e,t)},Gw=function(e,t,n){t.forEach(function(r){for(var s in e.mediaGroups[r])for(var a in e.mediaGroups[r][s]){var o=e.mediaGroups[r][s][a];n(o,r,s,a)}})},zw=function(e){return I.atob?I.atob(e):Buffer.from(e,"base64").toString("binary")};function Ww(i){for(var e=zw(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}var gr={},Xn={};function Kw(i,e,t){if(t===void 0&&(t=Array.prototype),i&&typeof t.find=="function")return t.find.call(i,e);for(var n=0;n<i.length;n++)if(Object.prototype.hasOwnProperty.call(i,n)){var r=i[n];if(e.call(void 0,r,n,i))return r}}function jf(i,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(i):i}function Xw(i,e){if(i===null||typeof i!="object")throw new TypeError("target is not an object");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t]);return i}var Qy=jf({HTML:"text/html",isHTML:function(i){return i===Qy.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Jy=jf({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(i){return i===Jy.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});Xn.assign=Xw;Xn.find=Kw;Xn.freeze=jf;Xn.MIME_TYPE=Qy;Xn.NAMESPACE=Jy;var Zy=Xn,vn=Zy.find,Ao=Zy.NAMESPACE;function Yw(i){return i!==""}function Qw(i){return i?i.split(/[\t\n\f\r ]+/).filter(Yw):[]}function Jw(i,e){return i.hasOwnProperty(e)||(i[e]=!0),i}function zg(i){if(!i)return[];var e=Qw(i);return Object.keys(e.reduce(Jw,{}))}function Zw(i){return function(e){return i&&i.indexOf(e)!==-1}}function Xo(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function bi(i,e){var t=i.prototype;if(!(t instanceof e)){let r=function(){};var n=r;r.prototype=e.prototype,r=new r,Xo(t,r),i.prototype=t=r}t.constructor!=i&&(typeof i!="function"&&console.error("unknown Class:"+i),t.constructor=i)}var Ei={},Yi=Ei.ELEMENT_NODE=1,zs=Ei.ATTRIBUTE_NODE=2,Sl=Ei.TEXT_NODE=3,ev=Ei.CDATA_SECTION_NODE=4,tv=Ei.ENTITY_REFERENCE_NODE=5,eA=Ei.ENTITY_NODE=6,iv=Ei.PROCESSING_INSTRUCTION_NODE=7,nv=Ei.COMMENT_NODE=8,rv=Ei.DOCUMENT_NODE=9,sv=Ei.DOCUMENT_TYPE_NODE=10,Vn=Ei.DOCUMENT_FRAGMENT_NODE=11,tA=Ei.NOTATION_NODE=12,Xt={},wt={};Xt.INDEX_SIZE_ERR=(wt[1]="Index size error",1);Xt.DOMSTRING_SIZE_ERR=(wt[2]="DOMString size error",2);var yi=Xt.HIERARCHY_REQUEST_ERR=(wt[3]="Hierarchy request error",3);Xt.WRONG_DOCUMENT_ERR=(wt[4]="Wrong document",4);Xt.INVALID_CHARACTER_ERR=(wt[5]="Invalid character",5);Xt.NO_DATA_ALLOWED_ERR=(wt[6]="No data allowed",6);Xt.NO_MODIFICATION_ALLOWED_ERR=(wt[7]="No modification allowed",7);var av=Xt.NOT_FOUND_ERR=(wt[8]="Not found",8);Xt.NOT_SUPPORTED_ERR=(wt[9]="Not supported",9);var Wg=Xt.INUSE_ATTRIBUTE_ERR=(wt[10]="Attribute in use",10);Xt.INVALID_STATE_ERR=(wt[11]="Invalid state",11);Xt.SYNTAX_ERR=(wt[12]="Syntax error",12);Xt.INVALID_MODIFICATION_ERR=(wt[13]="Invalid modification",13);Xt.NAMESPACE_ERR=(wt[14]="Invalid namespace",14);Xt.INVALID_ACCESS_ERR=(wt[15]="Invalid access",15);function ct(i,e){if(e instanceof Error)var t=e;else t=this,Error.call(this,wt[i]),this.message=wt[i],Error.captureStackTrace&&Error.captureStackTrace(this,ct);return t.code=i,e&&(this.message=this.message+": "+e),t}ct.prototype=Error.prototype;Xo(Xt,ct);function Mn(){}Mn.prototype={length:0,item:function(i){return i>=0&&i<this.length?this[i]:null},toString:function(i,e){for(var t=[],n=0;n<this.length;n++)xs(this[n],t,i,e);return t.join("")},filter:function(i){return Array.prototype.filter.call(this,i)},indexOf:function(i){return Array.prototype.indexOf.call(this,i)}};function Ws(i,e){this._node=i,this._refresh=e,$f(this)}function $f(i){var e=i._node._inc||i._node.ownerDocument._inc;if(i._inc!==e){var t=i._refresh(i._node);if(yv(i,"length",t.length),!i.$$length||t.length<i.$$length)for(var n=t.length;n in i;n++)Object.prototype.hasOwnProperty.call(i,n)&&delete i[n];Xo(t,i),i._inc=e}}Ws.prototype.item=function(i){return $f(this),this[i]||null};bi(Ws,Mn);function xl(){}function ov(i,e){for(var t=i.length;t--;)if(i[t]===e)return t}function Kg(i,e,t,n){if(n?e[ov(e,n)]=t:e[e.length++]=t,i){t.ownerElement=i;var r=i.ownerDocument;r&&(n&&cv(r,i,n),iA(r,i,t))}}function Xg(i,e,t){var n=ov(e,t);if(n>=0){for(var r=e.length-1;n<r;)e[n]=e[++n];if(e.length=r,i){var s=i.ownerDocument;s&&(cv(s,i,t),t.ownerElement=null)}}else throw new ct(av,new Error(i.tagName+"@"+t))}xl.prototype={length:0,item:Mn.prototype.item,getNamedItem:function(i){for(var e=this.length;e--;){var t=this[e];if(t.nodeName==i)return t}},setNamedItem:function(i){var e=i.ownerElement;if(e&&e!=this._ownerElement)throw new ct(Wg);var t=this.getNamedItem(i.nodeName);return Kg(this._ownerElement,this,i,t),t},setNamedItemNS:function(i){var e=i.ownerElement,t;if(e&&e!=this._ownerElement)throw new ct(Wg);return t=this.getNamedItemNS(i.namespaceURI,i.localName),Kg(this._ownerElement,this,i,t),t},removeNamedItem:function(i){var e=this.getNamedItem(i);return Xg(this._ownerElement,this,e),e},removeNamedItemNS:function(i,e){var t=this.getNamedItemNS(i,e);return Xg(this._ownerElement,this,t),t},getNamedItemNS:function(i,e){for(var t=this.length;t--;){var n=this[t];if(n.localName==e&&n.namespaceURI==i)return n}return null}};function uv(){}uv.prototype={hasFeature:function(i,e){return!0},createDocument:function(i,e,t){var n=new Yo;if(n.implementation=this,n.childNodes=new Mn,n.doctype=t||null,t&&n.appendChild(t),e){var r=n.createElementNS(i,e);n.appendChild(r)}return n},createDocumentType:function(i,e,t){var n=new lc;return n.name=i,n.nodeName=i,n.publicId=e||"",n.systemId=t||"",n}};function Ve(){}Ve.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(i,e){return Cl(this,i,e)},replaceChild:function(i,e){Cl(this,i,e,dv),e&&this.removeChild(e)},removeChild:function(i){return hv(this,i)},appendChild:function(i){return this.insertBefore(i,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(i){return Dd(this.ownerDocument||this,this,i)},normalize:function(){for(var i=this.firstChild;i;){var e=i.nextSibling;e&&e.nodeType==Sl&&i.nodeType==Sl?(this.removeChild(e),i.appendData(e.data)):(i.normalize(),i=e)}},isSupported:function(i,e){return this.ownerDocument.implementation.hasFeature(i,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(i){for(var e=this;e;){var t=e._nsMap;if(t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&t[n]===i)return n}e=e.nodeType==zs?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(i){for(var e=this;e;){var t=e._nsMap;if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i];e=e.nodeType==zs?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(i){var e=this.lookupPrefix(i);return e==null}};function lv(i){return i=="<"&&"&lt;"||i==">"&&"&gt;"||i=="&"&&"&amp;"||i=='"'&&"&quot;"||"&#"+i.charCodeAt()+";"}Xo(Ei,Ve);Xo(Ei,Ve.prototype);function Do(i,e){if(e(i))return!0;if(i=i.firstChild)do if(Do(i,e))return!0;while(i=i.nextSibling)}function Yo(){this.ownerDocument=this}function iA(i,e,t){i&&i._inc++;var n=t.namespaceURI;n===Ao.XMLNS&&(e._nsMap[t.prefix?t.localName:""]=t.value)}function cv(i,e,t,n){i&&i._inc++;var r=t.namespaceURI;r===Ao.XMLNS&&delete e._nsMap[t.prefix?t.localName:""]}function qf(i,e,t){if(i&&i._inc){i._inc++;var n=e.childNodes;if(t)n[n.length++]=t;else{for(var r=e.firstChild,s=0;r;)n[s++]=r,r=r.nextSibling;n.length=s,delete n[n.length]}}}function hv(i,e){var t=e.previousSibling,n=e.nextSibling;return t?t.nextSibling=n:i.firstChild=n,n?n.previousSibling=t:i.lastChild=t,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,qf(i.ownerDocument,i),e}function nA(i){return i&&(i.nodeType===Ve.DOCUMENT_NODE||i.nodeType===Ve.DOCUMENT_FRAGMENT_NODE||i.nodeType===Ve.ELEMENT_NODE)}function rA(i){return i&&(Tn(i)||Hf(i)||jn(i)||i.nodeType===Ve.DOCUMENT_FRAGMENT_NODE||i.nodeType===Ve.COMMENT_NODE||i.nodeType===Ve.PROCESSING_INSTRUCTION_NODE)}function jn(i){return i&&i.nodeType===Ve.DOCUMENT_TYPE_NODE}function Tn(i){return i&&i.nodeType===Ve.ELEMENT_NODE}function Hf(i){return i&&i.nodeType===Ve.TEXT_NODE}function Yg(i,e){var t=i.childNodes||[];if(vn(t,Tn)||jn(e))return!1;var n=vn(t,jn);return!(e&&n&&t.indexOf(n)>t.indexOf(e))}function Qg(i,e){var t=i.childNodes||[];function n(s){return Tn(s)&&s!==e}if(vn(t,n))return!1;var r=vn(t,jn);return!(e&&r&&t.indexOf(r)>t.indexOf(e))}function sA(i,e,t){if(!nA(i))throw new ct(yi,"Unexpected parent node type "+i.nodeType);if(t&&t.parentNode!==i)throw new ct(av,"child not in parent");if(!rA(e)||jn(e)&&i.nodeType!==Ve.DOCUMENT_NODE)throw new ct(yi,"Unexpected node type "+e.nodeType+" for parent node type "+i.nodeType)}function aA(i,e,t){var n=i.childNodes||[],r=e.childNodes||[];if(e.nodeType===Ve.DOCUMENT_FRAGMENT_NODE){var s=r.filter(Tn);if(s.length>1||vn(r,Hf))throw new ct(yi,"More than one element or text in fragment");if(s.length===1&&!Yg(i,t))throw new ct(yi,"Element in fragment can not be inserted before doctype")}if(Tn(e)&&!Yg(i,t))throw new ct(yi,"Only one element can be added and only after doctype");if(jn(e)){if(vn(n,jn))throw new ct(yi,"Only one doctype is allowed");var a=vn(n,Tn);if(t&&n.indexOf(a)<n.indexOf(t))throw new ct(yi,"Doctype can only be inserted before an element");if(!t&&a)throw new ct(yi,"Doctype can not be appended since element is present")}}function dv(i,e,t){var n=i.childNodes||[],r=e.childNodes||[];if(e.nodeType===Ve.DOCUMENT_FRAGMENT_NODE){var s=r.filter(Tn);if(s.length>1||vn(r,Hf))throw new ct(yi,"More than one element or text in fragment");if(s.length===1&&!Qg(i,t))throw new ct(yi,"Element in fragment can not be inserted before doctype")}if(Tn(e)&&!Qg(i,t))throw new ct(yi,"Only one element can be added and only after doctype");if(jn(e)){let u=function(c){return jn(c)&&c!==t};var o=u;if(vn(n,u))throw new ct(yi,"Only one doctype is allowed");var a=vn(n,Tn);if(t&&n.indexOf(a)<n.indexOf(t))throw new ct(yi,"Doctype can only be inserted before an element")}}function Cl(i,e,t,n){sA(i,e,t),i.nodeType===Ve.DOCUMENT_NODE&&(n||aA)(i,e,t);var r=e.parentNode;if(r&&r.removeChild(e),e.nodeType===Vn){var s=e.firstChild;if(s==null)return e;var a=e.lastChild}else s=a=e;var o=t?t.previousSibling:i.lastChild;s.previousSibling=o,a.nextSibling=t,o?o.nextSibling=s:i.firstChild=s,t==null?i.lastChild=a:t.previousSibling=a;do s.parentNode=i;while(s!==a&&(s=s.nextSibling));return qf(i.ownerDocument||i,i),e.nodeType==Vn&&(e.firstChild=e.lastChild=null),e}function oA(i,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=i,e.previousSibling=i.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:i.firstChild=e,i.lastChild=e,qf(i.ownerDocument,i,e),e}Yo.prototype={nodeName:"#document",nodeType:rv,doctype:null,documentElement:null,_inc:1,insertBefore:function(i,e){if(i.nodeType==Vn){for(var t=i.firstChild;t;){var n=t.nextSibling;this.insertBefore(t,e),t=n}return i}return Cl(this,i,e),i.ownerDocument=this,this.documentElement===null&&i.nodeType===Yi&&(this.documentElement=i),i},removeChild:function(i){return this.documentElement==i&&(this.documentElement=null),hv(this,i)},replaceChild:function(i,e){Cl(this,i,e,dv),i.ownerDocument=this,e&&this.removeChild(e),Tn(i)&&(this.documentElement=i)},importNode:function(i,e){return _v(this,i,e)},getElementById:function(i){var e=null;return Do(this.documentElement,function(t){if(t.nodeType==Yi&&t.getAttribute("id")==i)return e=t,!0}),e},getElementsByClassName:function(i){var e=zg(i);return new Ws(this,function(t){var n=[];return e.length>0&&Do(t.documentElement,function(r){if(r!==t&&r.nodeType===Yi){var s=r.getAttribute("class");if(s){var a=i===s;if(!a){var o=zg(s);a=e.every(Zw(o))}a&&n.push(r)}}}),n})},createElement:function(i){var e=new Gr;e.ownerDocument=this,e.nodeName=i,e.tagName=i,e.localName=i,e.childNodes=new Mn;var t=e.attributes=new xl;return t._ownerElement=e,e},createDocumentFragment:function(){var i=new cc;return i.ownerDocument=this,i.childNodes=new Mn,i},createTextNode:function(i){var e=new Gf;return e.ownerDocument=this,e.appendData(i),e},createComment:function(i){var e=new zf;return e.ownerDocument=this,e.appendData(i),e},createCDATASection:function(i){var e=new Wf;return e.ownerDocument=this,e.appendData(i),e},createProcessingInstruction:function(i,e){var t=new Xf;return t.ownerDocument=this,t.tagName=t.nodeName=t.target=i,t.nodeValue=t.data=e,t},createAttribute:function(i){var e=new wl;return e.ownerDocument=this,e.name=i,e.nodeName=i,e.localName=i,e.specified=!0,e},createEntityReference:function(i){var e=new Kf;return e.ownerDocument=this,e.nodeName=i,e},createElementNS:function(i,e){var t=new Gr,n=e.split(":"),r=t.attributes=new xl;return t.childNodes=new Mn,t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.namespaceURI=i,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,r._ownerElement=t,t},createAttributeNS:function(i,e){var t=new wl,n=e.split(":");return t.ownerDocument=this,t.nodeName=e,t.name=e,t.namespaceURI=i,t.specified=!0,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,t}};bi(Yo,Ve);function Gr(){this._nsMap={}}Gr.prototype={nodeType:Yi,hasAttribute:function(i){return this.getAttributeNode(i)!=null},getAttribute:function(i){var e=this.getAttributeNode(i);return e&&e.value||""},getAttributeNode:function(i){return this.attributes.getNamedItem(i)},setAttribute:function(i,e){var t=this.ownerDocument.createAttribute(i);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(i){var e=this.getAttributeNode(i);e&&this.removeAttributeNode(e)},appendChild:function(i){return i.nodeType===Vn?this.insertBefore(i,null):oA(this,i)},setAttributeNode:function(i){return this.attributes.setNamedItem(i)},setAttributeNodeNS:function(i){return this.attributes.setNamedItemNS(i)},removeAttributeNode:function(i){return this.attributes.removeNamedItem(i.nodeName)},removeAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);t&&this.removeAttributeNode(t)},hasAttributeNS:function(i,e){return this.getAttributeNodeNS(i,e)!=null},getAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);return t&&t.value||""},setAttributeNS:function(i,e,t){var n=this.ownerDocument.createAttributeNS(i,e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},getAttributeNodeNS:function(i,e){return this.attributes.getNamedItemNS(i,e)},getElementsByTagName:function(i){return new Ws(this,function(e){var t=[];return Do(e,function(n){n!==e&&n.nodeType==Yi&&(i==="*"||n.tagName==i)&&t.push(n)}),t})},getElementsByTagNameNS:function(i,e){return new Ws(this,function(t){var n=[];return Do(t,function(r){r!==t&&r.nodeType===Yi&&(i==="*"||r.namespaceURI===i)&&(e==="*"||r.localName==e)&&n.push(r)}),n})}};Yo.prototype.getElementsByTagName=Gr.prototype.getElementsByTagName;Yo.prototype.getElementsByTagNameNS=Gr.prototype.getElementsByTagNameNS;bi(Gr,Ve);function wl(){}wl.prototype.nodeType=zs;bi(wl,Ve);function Qo(){}Qo.prototype={data:"",substringData:function(i,e){return this.data.substring(i,i+e)},appendData:function(i){i=this.data+i,this.nodeValue=this.data=i,this.length=i.length},insertData:function(i,e){this.replaceData(i,0,e)},appendChild:function(i){throw new Error(wt[yi])},deleteData:function(i,e){this.replaceData(i,e,"")},replaceData:function(i,e,t){var n=this.data.substring(0,i),r=this.data.substring(i+e);t=n+t+r,this.nodeValue=this.data=t,this.length=t.length}};bi(Qo,Ve);function Gf(){}Gf.prototype={nodeName:"#text",nodeType:Sl,splitText:function(i){var e=this.data,t=e.substring(i);e=e.substring(0,i),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}};bi(Gf,Qo);function zf(){}zf.prototype={nodeName:"#comment",nodeType:nv};bi(zf,Qo);function Wf(){}Wf.prototype={nodeName:"#cdata-section",nodeType:ev};bi(Wf,Qo);function lc(){}lc.prototype.nodeType=sv;bi(lc,Ve);function fv(){}fv.prototype.nodeType=tA;bi(fv,Ve);function pv(){}pv.prototype.nodeType=eA;bi(pv,Ve);function Kf(){}Kf.prototype.nodeType=tv;bi(Kf,Ve);function cc(){}cc.prototype.nodeName="#document-fragment";cc.prototype.nodeType=Vn;bi(cc,Ve);function Xf(){}Xf.prototype.nodeType=iv;bi(Xf,Ve);function mv(){}mv.prototype.serializeToString=function(i,e,t){return gv.call(i,e,t)};Ve.prototype.toString=gv;function gv(i,e){var t=[],n=this.nodeType==9&&this.documentElement||this,r=n.prefix,s=n.namespaceURI;if(s&&r==null){var r=n.lookupPrefix(s);if(r==null)var a=[{namespace:s,prefix:null}]}return xs(this,t,i,e,a),t.join("")}function Jg(i,e,t){var n=i.prefix||"",r=i.namespaceURI;if(!r||n==="xml"&&r===Ao.XML||r===Ao.XMLNS)return!1;for(var s=t.length;s--;){var a=t[s];if(a.prefix===n)return a.namespace!==r}return!0}function Fh(i,e,t){i.push(" ",e,'="',t.replace(/[<>&"\t\n\r]/g,lv),'"')}function xs(i,e,t,n,r){if(r||(r=[]),n)if(i=n(i),i){if(typeof i=="string"){e.push(i);return}}else return;switch(i.nodeType){case Yi:var s=i.attributes,a=s.length,D=i.firstChild,o=i.tagName;t=Ao.isHTML(i.namespaceURI)||t;var u=o;if(!t&&!i.prefix&&i.namespaceURI){for(var c,h=0;h<s.length;h++)if(s.item(h).name==="xmlns"){c=s.item(h).value;break}if(!c)for(var g=r.length-1;g>=0;g--){var y=r[g];if(y.prefix===""&&y.namespace===i.namespaceURI){c=y.namespace;break}}if(c!==i.namespaceURI)for(var g=r.length-1;g>=0;g--){var y=r[g];if(y.namespace===i.namespaceURI){y.prefix&&(u=y.prefix+":"+o);break}}}e.push("<",u);for(var T=0;T<a;T++){var v=s.item(T);v.prefix=="xmlns"?r.push({prefix:v.localName,namespace:v.value}):v.nodeName=="xmlns"&&r.push({prefix:"",namespace:v.value})}for(var T=0;T<a;T++){var v=s.item(T);if(Jg(v,t,r)){var x=v.prefix||"",A=v.namespaceURI;Fh(e,x?"xmlns:"+x:"xmlns",A),r.push({prefix:x,namespace:A})}xs(v,e,t,n,r)}if(o===u&&Jg(i,t,r)){var x=i.prefix||"",A=i.namespaceURI;Fh(e,x?"xmlns:"+x:"xmlns",A),r.push({prefix:x,namespace:A})}if(D||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(o)){if(e.push(">"),t&&/^script$/i.test(o))for(;D;)D.data?e.push(D.data):xs(D,e,t,n,r.slice()),D=D.nextSibling;else for(;D;)xs(D,e,t,n,r.slice()),D=D.nextSibling;e.push("</",u,">")}else e.push("/>");return;case rv:case Vn:for(var D=i.firstChild;D;)xs(D,e,t,n,r.slice()),D=D.nextSibling;return;case zs:return Fh(e,i.name,i.value);case Sl:return e.push(i.data.replace(/[<&>]/g,lv));case ev:return e.push("<![CDATA[",i.data,"]]>");case nv:return e.push("<!--",i.data,"-->");case sv:var P=i.publicId,M=i.systemId;if(e.push("<!DOCTYPE ",i.name),P)e.push(" PUBLIC ",P),M&&M!="."&&e.push(" ",M),e.push(">");else if(M&&M!=".")e.push(" SYSTEM ",M,">");else{var O=i.internalSubset;O&&e.push(" [",O,"]"),e.push(">")}return;case iv:return e.push("<?",i.target," ",i.data,"?>");case tv:return e.push("&",i.nodeName,";");default:e.push("??",i.nodeName)}}function _v(i,e,t){var n;switch(e.nodeType){case Yi:n=e.cloneNode(!1),n.ownerDocument=i;case Vn:break;case zs:t=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=i,n.parentNode=null,t)for(var r=e.firstChild;r;)n.appendChild(_v(i,r,t)),r=r.nextSibling;return n}function Dd(i,e,t){var n=new e.constructor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=e[r];typeof s!="object"&&s!=n[r]&&(n[r]=s)}switch(e.childNodes&&(n.childNodes=new Mn),n.ownerDocument=i,n.nodeType){case Yi:var a=e.attributes,o=n.attributes=new xl,u=a.length;o._ownerElement=n;for(var c=0;c<u;c++)n.setAttributeNode(Dd(i,a.item(c),!0));break;case zs:t=!0}if(t)for(var h=e.firstChild;h;)n.appendChild(Dd(i,h,t)),h=h.nextSibling;return n}function yv(i,e,t){i[e]=t}try{if(Object.defineProperty){let i=function(e){switch(e.nodeType){case Yi:case Vn:var t=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&t.push(i(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}};var SF=i;Object.defineProperty(Ws.prototype,"length",{get:function(){return $f(this),this.$$length}}),Object.defineProperty(Ve.prototype,"textContent",{get:function(){return i(this)},set:function(e){switch(this.nodeType){case Yi:case Vn:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),yv=function(e,t,n){e["$$"+t]=n}}}catch{}gr.DocumentType=lc;gr.DOMException=ct;gr.DOMImplementation=uv;gr.Element=Gr;gr.Node=Ve;gr.NodeList=Mn;gr.XMLSerializer=mv;var hc={},vv={};(function(i){var e=Xn.freeze;i.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),i.HTML_ENTITIES=e({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),i.entityMap=i.HTML_ENTITIES})(vv);var Yf={},Io=Xn.NAMESPACE,Id=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Zg=new RegExp("[\\-\\.0-9"+Id.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),e0=new RegExp("^"+Id.source+Zg.source+"*(?::"+Id.source+Zg.source+"*)?$"),Wa=0,ir=1,ds=2,Ka=3,fs=4,ps=5,Xa=6,Bu=7;function Ks(i,e){this.message=i,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Ks)}Ks.prototype=new Error;Ks.prototype.name=Ks.name;function Tv(){}Tv.prototype={parse:function(i,e,t){var n=this.domBuilder;n.startDocument(),bv(e,e={}),uA(i,e,t,n,this.errorHandler),n.endDocument()}};function uA(i,e,t,n,r){function s(Ce){if(Ce>65535){Ce-=65536;var $e=55296+(Ce>>10),tt=56320+(Ce&1023);return String.fromCharCode($e,tt)}else return String.fromCharCode(Ce)}function a(Ce){var $e=Ce.slice(1,-1);return Object.hasOwnProperty.call(t,$e)?t[$e]:$e.charAt(0)==="#"?s(parseInt($e.substr(1).replace("x","0x"))):(r.error("entity not found:"+Ce),Ce)}function o(Ce){if(Ce>x){var $e=i.substring(x,Ce).replace(/&#?\w+;/g,a);y&&u(x),n.characters($e,0,Ce-x),x=Ce}}function u(Ce,$e){for(;Ce>=h&&($e=g.exec(i));)c=$e.index,h=c+$e[0].length,y.lineNumber++;y.columnNumber=Ce-c+1}for(var c=0,h=0,g=/.*(?:\r\n?|\n)|.*$/g,y=n.locator,T=[{currentNSMap:e}],v={},x=0;;){try{var A=i.indexOf("<",x);if(A<0){if(!i.substr(x).match(/^\s*$/)){var D=n.doc,P=D.createTextNode(i.substr(x));D.appendChild(P),n.currentElement=P}return}switch(A>x&&o(A),i.charAt(A+1)){case"/":var _e=i.indexOf(">",A+3),M=i.substring(A+2,_e).replace(/[ \t\n\r]+$/g,""),O=T.pop();_e<0?(M=i.substring(A+2).replace(/[\s<].*/,""),r.error("end tag name: "+M+" is not complete:"+O.tagName),_e=A+1+M.length):M.match(/\s</)&&(M=M.replace(/[\s<].*/,""),r.error("end tag name: "+M+" maybe not complete"),_e=A+1+M.length);var R=O.localNSMap,$=O.tagName==M,V=$||O.tagName&&O.tagName.toLowerCase()==M.toLowerCase();if(V){if(n.endElement(O.uri,O.localName,M),R)for(var ie in R)Object.prototype.hasOwnProperty.call(R,ie)&&n.endPrefixMapping(ie);$||r.fatalError("end tag name: "+M+" is not match the current start tagName:"+O.tagName)}else T.push(O);_e++;break;case"?":y&&u(A),_e=fA(i,A,n);break;case"!":y&&u(A),_e=dA(i,A,n,r);break;default:y&&u(A);var Z=new Ev,he=T[T.length-1].currentNSMap,_e=lA(i,A,Z,he,a,r),me=Z.length;if(!Z.closed&&hA(i,_e,Z.tagName,v)&&(Z.closed=!0,t.nbsp||r.warning("unclosed xml attribute")),y&&me){for(var X=t0(y,{}),Ae=0;Ae<me;Ae++){var rt=Z[Ae];u(rt.offset),rt.locator=t0(y,{})}n.locator=X,i0(Z,n,he)&&T.push(Z),n.locator=y}else i0(Z,n,he)&&T.push(Z);Io.isHTML(Z.uri)&&!Z.closed?_e=cA(i,_e,Z.tagName,a,n):_e++}}catch(Ce){if(Ce instanceof Ks)throw Ce;r.error("element parse error: "+Ce),_e=-1}_e>x?x=_e:o(Math.max(A,x)+1)}}function t0(i,e){return e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber,e}function lA(i,e,t,n,r,s){function a(y,T,v){t.attributeNames.hasOwnProperty(y)&&s.fatalError("Attribute "+y+" redefined"),t.addValue(y,T.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,r),v)}for(var o,u,c=++e,h=Wa;;){var g=i.charAt(c);switch(g){case"=":if(h===ir)o=i.slice(e,c),h=Ka;else if(h===ds)h=Ka;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(h===Ka||h===ir)if(h===ir&&(s.warning('attribute value must after "="'),o=i.slice(e,c)),e=c+1,c=i.indexOf(g,e),c>0)u=i.slice(e,c),a(o,u,e-1),h=ps;else throw new Error("attribute value no end '"+g+"' match");else if(h==fs)u=i.slice(e,c),a(o,u,e),s.warning('attribute "'+o+'" missed start quot('+g+")!!"),e=c+1,h=ps;else throw new Error('attribute value must after "="');break;case"/":switch(h){case Wa:t.setTagName(i.slice(e,c));case ps:case Xa:case Bu:h=Bu,t.closed=!0;case fs:case ir:break;case ds:t.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),h==Wa&&t.setTagName(i.slice(e,c)),c;case">":switch(h){case Wa:t.setTagName(i.slice(e,c));case ps:case Xa:case Bu:break;case fs:case ir:u=i.slice(e,c),u.slice(-1)==="/"&&(t.closed=!0,u=u.slice(0,-1));case ds:h===ds&&(u=o),h==fs?(s.warning('attribute "'+u+'" missed quot(")!'),a(o,u,e)):((!Io.isHTML(n[""])||!u.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),a(u,u,e));break;case Ka:throw new Error("attribute value missed!!")}return c;case"":g=" ";default:if(g<=" ")switch(h){case Wa:t.setTagName(i.slice(e,c)),h=Xa;break;case ir:o=i.slice(e,c),h=ds;break;case fs:var u=i.slice(e,c);s.warning('attribute "'+u+'" missed quot(")!!'),a(o,u,e);case ps:h=Xa;break}else switch(h){case ds:t.tagName,(!Io.isHTML(n[""])||!o.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),a(o,o,e),e=c,h=ir;break;case ps:s.warning('attribute space is required"'+o+'"!!');case Xa:h=ir,e=c;break;case Ka:h=fs,e=c;break;case Bu:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function i0(i,e,t){for(var n=i.tagName,r=null,g=i.length;g--;){var s=i[g],a=s.qName,o=s.value,y=a.indexOf(":");if(y>0)var u=s.prefix=a.slice(0,y),c=a.slice(y+1),h=u==="xmlns"&&c;else c=a,u=null,h=a==="xmlns"&&"";s.localName=c,h!==!1&&(r==null&&(r={},bv(t,t={})),t[h]=r[h]=o,s.uri=Io.XMLNS,e.startPrefixMapping(h,o))}for(var g=i.length;g--;){s=i[g];var u=s.prefix;u&&(u==="xml"&&(s.uri=Io.XML),u!=="xmlns"&&(s.uri=t[u||""]))}var y=n.indexOf(":");y>0?(u=i.prefix=n.slice(0,y),c=i.localName=n.slice(y+1)):(u=null,c=i.localName=n);var T=i.uri=t[u||""];if(e.startElement(T,c,n,i),i.closed){if(e.endElement(T,c,n),r)for(u in r)Object.prototype.hasOwnProperty.call(r,u)&&e.endPrefixMapping(u)}else return i.currentNSMap=t,i.localNSMap=r,!0}function cA(i,e,t,n,r){if(/^(?:script|textarea)$/i.test(t)){var s=i.indexOf("</"+t+">",e),a=i.substring(e+1,s);if(/[&<]/.test(a))return/^script$/i.test(t)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,n),r.characters(a,0,a.length),s)}return e+1}function hA(i,e,t,n){var r=n[t];return r==null&&(r=i.lastIndexOf("</"+t+">"),r<e&&(r=i.lastIndexOf("</"+t)),n[t]=r),r<e}function bv(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function dA(i,e,t,n){var r=i.charAt(e+2);switch(r){case"-":if(i.charAt(e+3)==="-"){var s=i.indexOf("-->",e+4);return s>e?(t.comment(i,e+4,s-e-4),s+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(i.substr(e+3,6)=="CDATA["){var s=i.indexOf("]]>",e+9);return t.startCDATA(),t.characters(i,e+9,s-e-9),t.endCDATA(),s+3}var a=pA(i,e),o=a.length;if(o>1&&/!doctype/i.test(a[0][0])){var u=a[1][0],c=!1,h=!1;o>3&&(/^public$/i.test(a[2][0])?(c=a[3][0],h=o>4&&a[4][0]):/^system$/i.test(a[2][0])&&(h=a[3][0]));var g=a[o-1];return t.startDTD(u,c,h),t.endDTD(),g.index+g[0].length}}return-1}function fA(i,e,t){var n=i.indexOf("?>",e);if(n){var r=i.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return r?(r[0].length,t.processingInstruction(r[1],r[2]),n+2):-1}return-1}function Ev(){this.attributeNames={}}Ev.prototype={setTagName:function(i){if(!e0.test(i))throw new Error("invalid tagName:"+i);this.tagName=i},addValue:function(i,e,t){if(!e0.test(i))throw new Error("invalid attribute:"+i);this.attributeNames[i]=this.length,this[this.length++]={qName:i,value:e,offset:t}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function pA(i,e){var t,n=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(r.lastIndex=e,r.exec(i);t=r.exec(i);)if(n.push(t),t[1])return n}Yf.XMLReader=Tv;Yf.ParseError=Ks;var mA=Xn,gA=gr,n0=vv,Sv=Yf,_A=gA.DOMImplementation,r0=mA.NAMESPACE,yA=Sv.ParseError,vA=Sv.XMLReader;function xv(i){return i.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function Cv(i){this.options=i||{locator:{}}}Cv.prototype.parseFromString=function(i,e){var t=this.options,n=new vA,r=t.domBuilder||new Jo,s=t.errorHandler,a=t.locator,o=t.xmlns||{},u=/\/x?html?$/.test(e),c=u?n0.HTML_ENTITIES:n0.XML_ENTITIES;a&&r.setDocumentLocator(a),n.errorHandler=TA(s,r,a),n.domBuilder=t.domBuilder||r,u&&(o[""]=r0.HTML),o.xml=o.xml||r0.XML;var h=t.normalizeLineEndings||xv;return i&&typeof i=="string"?n.parse(h(i),o,c):n.errorHandler.error("invalid doc source"),r.doc};function TA(i,e,t){if(!i){if(e instanceof Jo)return e;i=e}var n={},r=i instanceof Function;t=t||{};function s(a){var o=i[a];!o&&r&&(o=i.length==2?function(u){i(a,u)}:i),n[a]=o&&function(u){o("[xmldom "+a+"]	"+u+kd(t))}||function(){}}return s("warning"),s("error"),s("fatalError"),n}function Jo(){this.cdata=!1}function ms(i,e){e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber}Jo.prototype={startDocument:function(){this.doc=new _A().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(i,e,t,n){var r=this.doc,s=r.createElementNS(i,t||e),a=n.length;Uu(this,s),this.currentElement=s,this.locator&&ms(this.locator,s);for(var o=0;o<a;o++){var i=n.getURI(o),u=n.getValue(o),t=n.getQName(o),c=r.createAttributeNS(i,t);this.locator&&ms(n.getLocator(o),c),c.value=c.nodeValue=u,s.setAttributeNode(c)}},endElement:function(i,e,t){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(i,e){},endPrefixMapping:function(i){},processingInstruction:function(i,e){var t=this.doc.createProcessingInstruction(i,e);this.locator&&ms(this.locator,t),Uu(this,t)},ignorableWhitespace:function(i,e,t){},characters:function(i,e,t){if(i=s0.apply(this,arguments),i){if(this.cdata)var n=this.doc.createCDATASection(i);else var n=this.doc.createTextNode(i);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(i)&&this.doc.appendChild(n),this.locator&&ms(this.locator,n)}},skippedEntity:function(i){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(i){(this.locator=i)&&(i.lineNumber=0)},comment:function(i,e,t){i=s0.apply(this,arguments);var n=this.doc.createComment(i);this.locator&&ms(this.locator,n),Uu(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(i,e,t){var n=this.doc.implementation;if(n&&n.createDocumentType){var r=n.createDocumentType(i,e,t);this.locator&&ms(this.locator,r),Uu(this,r),this.doc.doctype=r}},warning:function(i){console.warn("[xmldom warning]	"+i,kd(this.locator))},error:function(i){console.error("[xmldom error]	"+i,kd(this.locator))},fatalError:function(i){throw new yA(i,this.locator)}};function kd(i){if(i)return`
@`+(i.systemId||"")+"#[line:"+i.lineNumber+",col:"+i.columnNumber+"]"}function s0(i,e,t){return typeof i=="string"?i.substr(e,t):i.length>=e+t||e?new java.lang.String(i,e,t)+"":i}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(i){Jo.prototype[i]=function(){return null}});function Uu(i,e){i.currentElement?i.currentElement.appendChild(e):i.doc.appendChild(e)}hc.__DOMHandler=Jo;hc.normalizeLineEndings=xv;hc.DOMParser=Cv;var bA=hc.DOMParser;/*! @name mpd-parser @version 1.1.1 @license Apache-2.0 */const a0=i=>!!i&&typeof i=="object",$t=(...i)=>i.reduce((e,t)=>(typeof t!="object"||Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):a0(e[n])&&a0(t[n])?e[n]=$t(e[n],t[n]):e[n]=t[n]}),e),{}),wv=i=>Object.keys(i).map(e=>i[e]),EA=(i,e)=>{const t=[];for(let n=i;n<e;n++)t.push(n);return t},Xs=i=>i.reduce((e,t)=>e.concat(t),[]),Av=i=>{if(!i.length)return[];const e=[];for(let t=0;t<i.length;t++)e.push(i[t]);return e},SA=(i,e)=>i.reduce((t,n,r)=>(n[e]&&t.push(r),t),[]),xA=(i,e)=>wv(i.reduce((t,n)=>(n.forEach(r=>{t[e(r)]=r}),t),{}));var Ys={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const ko=({baseUrl:i="",source:e="",range:t="",indexRange:n=""})=>{const r={uri:e,resolvedUri:Vf(i||"",e)};if(t||n){const a=(t||n).split("-");let o=I.BigInt?I.BigInt(a[0]):parseInt(a[0],10),u=I.BigInt?I.BigInt(a[1]):parseInt(a[1],10);o<Number.MAX_SAFE_INTEGER&&typeof o=="bigint"&&(o=Number(o)),u<Number.MAX_SAFE_INTEGER&&typeof u=="bigint"&&(u=Number(u));let c;typeof u=="bigint"||typeof o=="bigint"?c=I.BigInt(u)-I.BigInt(o)+I.BigInt(1):c=u-o+1,typeof c=="bigint"&&c<Number.MAX_SAFE_INTEGER&&(c=Number(c)),r.byterange={length:c,offset:o}}return r},CA=i=>{let e;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=I.BigInt(i.offset)+I.BigInt(i.length)-I.BigInt(1):e=i.offset+i.length-1,`${i.offset}-${e}`},o0=i=>(i&&typeof i!="number"&&(i=parseInt(i,10)),isNaN(i)?null:i),wA={static(i){const{duration:e,timescale:t=1,sourceDuration:n,periodDuration:r}=i,s=o0(i.endNumber),a=e/t;return typeof s=="number"?{start:0,end:s}:typeof r=="number"?{start:0,end:r/a}:{start:0,end:n/a}},dynamic(i){const{NOW:e,clientOffset:t,availabilityStartTime:n,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:u=1/0}=i,c=o0(i.endNumber),h=(e+t)/1e3,g=n+a,T=h+o-g,v=Math.ceil(T*r/s),x=Math.floor((h-g-u)*r/s),A=Math.floor((h-g)*r/s);return{start:Math.max(0,x),end:typeof c=="number"?c:Math.min(v,A)}}},AA=i=>e=>{const{duration:t,timescale:n=1,periodStart:r,startNumber:s=1}=i;return{number:s+e,duration:t/n,timeline:r,time:e*t}},Qf=i=>{const{type:e,duration:t,timescale:n=1,periodDuration:r,sourceDuration:s}=i,{start:a,end:o}=wA[e](i),u=EA(a,o).map(AA(i));if(e==="static"){const c=u.length-1,h=typeof r=="number"?r:s;u[c].duration=h-t/n*c}return u},Dv=i=>{const{baseUrl:e,initialization:t={},sourceDuration:n,indexRange:r="",periodStart:s,presentationTime:a,number:o=0,duration:u}=i;if(!e)throw new Error(Ys.NO_BASE_URL);const c=ko({baseUrl:e,source:t.sourceURL,range:t.range}),h=ko({baseUrl:e,source:e,indexRange:r});if(h.map=c,u){const g=Qf(i);g.length&&(h.duration=g[0].duration,h.timeline=g[0].timeline)}else n&&(h.duration=n,h.timeline=s);return h.presentationTime=a||s,h.number=o,[h]},Jf=(i,e,t)=>{const n=i.sidx.map?i.sidx.map:null,r=i.sidx.duration,s=i.timeline||0,a=i.sidx.byterange,o=a.offset+a.length,u=e.timescale,c=e.references.filter(A=>A.referenceType!==1),h=[],g=i.endList?"static":"dynamic",y=i.sidx.timeline;let T=y,v=i.mediaSequence||0,x;typeof e.firstOffset=="bigint"?x=I.BigInt(o)+e.firstOffset:x=o+e.firstOffset;for(let A=0;A<c.length;A++){const D=e.references[A],P=D.referencedSize,M=D.subsegmentDuration;let O;typeof x=="bigint"?O=x+I.BigInt(P)-I.BigInt(1):O=x+P-1;const R=`${x}-${O}`,V=Dv({baseUrl:t,timescale:u,timeline:s,periodStart:y,presentationTime:T,number:v,duration:M,sourceDuration:r,indexRange:R,type:g})[0];n&&(V.map=n),h.push(V),typeof x=="bigint"?x+=I.BigInt(P):x+=P,T+=M/u,v++}return i.segments=h,i},DA=["AUDIO","SUBTITLES"],IA=1/60,Iv=i=>xA(i,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1),kA=(i,e)=>{for(let t=0;t<i.length;t++)if(i[t].attributes.NAME===e)return i[t];return null},u0=i=>{let e=[];return Gw(i,DA,(t,n,r,s)=>{e=e.concat(t.playlists||[])}),e},l0=({playlist:i,mediaSequence:e})=>{i.mediaSequence=e,i.segments.forEach((t,n)=>{t.number=i.mediaSequence+n})},PA=({oldPlaylists:i,newPlaylists:e,timelineStarts:t})=>{e.forEach(n=>{n.discontinuitySequence=t.findIndex(function({timeline:u}){return u===n.timeline});const r=kA(i,n.attributes.NAME);if(!r||n.sidx)return;const s=n.segments[0],a=r.segments.findIndex(function(u){return Math.abs(u.presentationTime-s.presentationTime)<IA});if(a===-1){l0({playlist:n,mediaSequence:r.mediaSequence+r.segments.length}),n.segments[0].discontinuity=!0,n.discontinuityStarts.unshift(0),(!r.segments.length&&n.timeline>r.timeline||r.segments.length&&n.timeline>r.segments[r.segments.length-1].timeline)&&n.discontinuitySequence--;return}r.segments[a].discontinuity&&!s.discontinuity&&(s.discontinuity=!0,n.discontinuityStarts.unshift(0),n.discontinuitySequence--),l0({playlist:n,mediaSequence:r.segments[a].number})})},RA=({oldManifest:i,newManifest:e})=>{const t=i.playlists.concat(u0(i)),n=e.playlists.concat(u0(e));return e.timelineStarts=Iv([i.timelineStarts,e.timelineStarts]),PA({oldPlaylists:t,newPlaylists:n,timelineStarts:e.timelineStarts}),e},dc=i=>i&&i.uri+"-"+CA(i.byterange),Bh=i=>wv(i.reduce((t,n)=>{const r=n.attributes.id+(n.attributes.lang||"");return t[r]?(n.segments&&(n.segments[0]&&(n.segments[0].discontinuity=!0),t[r].segments.push(...n.segments)),n.attributes.contentProtection&&(t[r].attributes.contentProtection=n.attributes.contentProtection)):(t[r]=n,t[r].attributes.timelineStarts=[]),t[r].attributes.timelineStarts.push({start:n.attributes.periodStart,timeline:n.attributes.periodStart}),t},{})).map(t=>(t.discontinuityStarts=SA(t.segments||[],"discontinuity"),t)),Zf=(i,e)=>{const t=dc(i.sidx),n=t&&e[t]&&e[t].sidx;return n&&Jf(i,n,i.sidx.resolvedUri),i},OA=(i,e={})=>{if(!Object.keys(e).length)return i;for(const t in i)i[t]=Zf(i[t],e);return i},LA=({attributes:i,segments:e,sidx:t,mediaSequence:n,discontinuitySequence:r,discontinuityStarts:s},a)=>{const o={attributes:{NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:"",targetDuration:i.duration,discontinuitySequence:r,discontinuityStarts:s,timelineStarts:i.timelineStarts,mediaSequence:n,segments:e};return i.contentProtection&&(o.contentProtection=i.contentProtection),t&&(o.sidx=t),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o},NA=({attributes:i,segments:e,mediaSequence:t,discontinuityStarts:n,discontinuitySequence:r})=>{typeof e>"u"&&(e=[{uri:i.baseUrl,timeline:i.periodStart,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration);const s={NAME:i.id,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1};return i.codecs&&(s.CODECS=i.codecs),{attributes:s,uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,timelineStarts:i.timelineStarts,discontinuityStarts:n,discontinuitySequence:r,mediaSequence:t,segments:e}},MA=(i,e={},t=!1)=>{let n;const r=i.reduce((s,a)=>{const o=a.attributes.role&&a.attributes.role.value||"",u=a.attributes.lang||"";let c=a.attributes.label||"main";if(u&&!a.attributes.label){const g=o?` (${o})`:"";c=`${a.attributes.lang}${g}`}s[c]||(s[c]={language:u,autoselect:!0,default:o==="main",playlists:[],uri:""});const h=Zf(LA(a,t),e);return s[c].playlists.push(h),typeof n>"u"&&o==="main"&&(n=a,n.default=!0),s},{});if(!n){const s=Object.keys(r)[0];r[s].default=!0}return r},FA=(i,e={})=>i.reduce((t,n)=>{const r=n.attributes.label||n.attributes.lang||"text";return t[r]||(t[r]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),t[r].playlists.push(Zf(NA(n),e)),t},{}),BA=i=>i.reduce((e,t)=>(t&&t.forEach(n=>{const{channel:r,language:s}=n;e[s]={autoselect:!1,default:!1,instreamId:r,language:s},n.hasOwnProperty("aspectRatio")&&(e[s].aspectRatio=n.aspectRatio),n.hasOwnProperty("easyReader")&&(e[s].easyReader=n.easyReader),n.hasOwnProperty("3D")&&(e[s]["3D"]=n["3D"])}),e),{}),UA=({attributes:i,segments:e,sidx:t,discontinuityStarts:n})=>{const r={attributes:{NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:"",targetDuration:i.duration,discontinuityStarts:n,timelineStarts:i.timelineStarts,segments:e};return i.frameRate&&(r.attributes["FRAME-RATE"]=i.frameRate),i.contentProtection&&(r.contentProtection=i.contentProtection),t&&(r.sidx=t),r},VA=({attributes:i})=>i.mimeType==="video/mp4"||i.mimeType==="video/webm"||i.contentType==="video",jA=({attributes:i})=>i.mimeType==="audio/mp4"||i.mimeType==="audio/webm"||i.contentType==="audio",$A=({attributes:i})=>i.mimeType==="text/vtt"||i.contentType==="text",qA=(i,e)=>{i.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=e.findIndex(function({timeline:n}){return n===t.timeline}),t.segments&&t.segments.forEach((n,r)=>{n.number=r})})},c0=i=>i?Object.keys(i).reduce((e,t)=>{const n=i[t];return e.concat(n.playlists)},[]):[],HA=({dashPlaylists:i,locations:e,sidxMapping:t={},previousManifest:n,eventStream:r})=>{if(!i.length)return{};const{sourceDuration:s,type:a,suggestedPresentationDelay:o,minimumUpdatePeriod:u}=i[0].attributes,c=Bh(i.filter(VA)).map(UA),h=Bh(i.filter(jA)),g=Bh(i.filter($A)),y=i.map(M=>M.attributes.captionServices).filter(Boolean),T={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:s,playlists:OA(c,t)};u>=0&&(T.minimumUpdatePeriod=u*1e3),e&&(T.locations=e),a==="dynamic"&&(T.suggestedPresentationDelay=o),r&&r.length>0&&(T.eventStream=r);const v=T.playlists.length===0,x=h.length?MA(h,t,v):null,A=g.length?FA(g,t):null,D=c.concat(c0(x),c0(A)),P=D.map(({timelineStarts:M})=>M);return T.timelineStarts=Iv(P),qA(D,T.timelineStarts),x&&(T.mediaGroups.AUDIO.audio=x),A&&(T.mediaGroups.SUBTITLES.subs=A),y.length&&(T.mediaGroups["CLOSED-CAPTIONS"].cc=BA(y)),n?RA({oldManifest:n,newManifest:T}):T},GA=(i,e,t)=>{const{NOW:n,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:u=0}=i,c=(n+r)/1e3,h=s+o,y=c+u-h;return Math.ceil((y*a-e)/t)},kv=(i,e)=>{const{type:t,minimumUpdatePeriod:n=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:o=1,periodStart:u}=i,c=[];let h=-1;for(let g=0;g<e.length;g++){const y=e[g],T=y.d,v=y.r||0,x=y.t||0;h<0&&(h=x),x&&x>h&&(h=x);let A;if(v<0){const M=g+1;M===e.length?t==="dynamic"&&n>0&&r.indexOf("$Number$")>0?A=GA(i,h,T):A=(s*a-h)/T:A=(e[M].t-h)/T}else A=v+1;const D=o+c.length+A;let P=o+c.length;for(;P<D;)c.push({number:P,duration:T/a,time:h,timeline:u}),h+=T,P++}return c},zA=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,WA=i=>(e,t,n,r)=>{if(e==="$$")return"$";if(typeof i[t]>"u")return e;const s=""+i[t];return t==="RepresentationID"||(n?r=parseInt(r,10):r=1,s.length>=r)?s:`${new Array(r-s.length+1).join("0")}${s}`},h0=(i,e)=>i.replace(zA,WA(e)),KA=(i,e)=>!i.duration&&!e?[{number:i.startNumber||1,duration:i.sourceDuration,time:0,timeline:i.periodStart}]:i.duration?Qf(i):kv(i,e),XA=(i,e)=>{const t={RepresentationID:i.id,Bandwidth:i.bandwidth||0},{initialization:n={sourceURL:"",range:""}}=i,r=ko({baseUrl:i.baseUrl,source:h0(n.sourceURL,t),range:n.range});return KA(i,e).map(a=>{t.Number=a.number,t.Time=a.time;const o=h0(i.media||"",t),u=i.timescale||1,c=i.presentationTimeOffset||0,h=i.periodStart+(a.time-c)/u;return{uri:o,timeline:a.timeline,duration:a.duration,resolvedUri:Vf(i.baseUrl||"",o),map:r,number:a.number,presentationTime:h}})},YA=(i,e)=>{const{baseUrl:t,initialization:n={}}=i,r=ko({baseUrl:t,source:n.sourceURL,range:n.range}),s=ko({baseUrl:t,source:e.media,range:e.mediaRange});return s.map=r,s},QA=(i,e)=>{const{duration:t,segmentUrls:n=[],periodStart:r}=i;if(!t&&!e||t&&e)throw new Error(Ys.SEGMENT_TIME_UNSPECIFIED);const s=n.map(u=>YA(i,u));let a;return t&&(a=Qf(i)),e&&(a=kv(i,e)),a.map((u,c)=>{if(s[c]){const h=s[c],g=i.timescale||1,y=i.presentationTimeOffset||0;return h.timeline=u.timeline,h.duration=u.duration,h.number=u.number,h.presentationTime=r+(u.time-y)/g,h}}).filter(u=>u)},JA=({attributes:i,segmentInfo:e})=>{let t,n;e.template?(n=XA,t=$t(i,e.template)):e.base?(n=Dv,t=$t(i,e.base)):e.list&&(n=QA,t=$t(i,e.list));const r={attributes:i};if(!n)return r;const s=n(t,e.segmentTimeline);if(t.duration){const{duration:a,timescale:o=1}=t;t.duration=a/o}else s.length?t.duration=s.reduce((a,o)=>Math.max(a,Math.ceil(o.duration)),0):t.duration=0;return r.attributes=t,r.segments=s,e.base&&t.indexRange&&(r.sidx=s[0],r.segments=[]),r},ZA=i=>i.map(JA),it=(i,e)=>Av(i.childNodes).filter(({tagName:t})=>t===e),fc=i=>i.textContent.trim(),eD=i=>parseFloat(i.split("/").reduce((e,t)=>e/t)),gs=i=>{const o=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(i);if(!o)return 0;const[u,c,h,g,y,T]=o.slice(1);return parseFloat(u||0)*31536e3+parseFloat(c||0)*2592e3+parseFloat(h||0)*86400+parseFloat(g||0)*3600+parseFloat(y||0)*60+parseFloat(T||0)},tD=i=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(i)&&(i+="Z"),Date.parse(i)),d0={mediaPresentationDuration(i){return gs(i)},availabilityStartTime(i){return tD(i)/1e3},minimumUpdatePeriod(i){return gs(i)},suggestedPresentationDelay(i){return gs(i)},type(i){return i},timeShiftBufferDepth(i){return gs(i)},start(i){return gs(i)},width(i){return parseInt(i,10)},height(i){return parseInt(i,10)},bandwidth(i){return parseInt(i,10)},frameRate(i){return eD(i)},startNumber(i){return parseInt(i,10)},timescale(i){return parseInt(i,10)},presentationTimeOffset(i){return parseInt(i,10)},duration(i){const e=parseInt(i,10);return isNaN(e)?gs(i):e},d(i){return parseInt(i,10)},t(i){return parseInt(i,10)},r(i){return parseInt(i,10)},presentationTime(i){return parseInt(i,10)},DEFAULT(i){return i}},St=i=>i&&i.attributes?Av(i.attributes).reduce((e,t)=>{const n=d0[t.name]||d0.DEFAULT;return e[t.name]=n(t.value),e},{}):{},iD={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},pc=(i,e)=>e.length?Xs(i.map(function(t){return e.map(function(n){return Vf(t,fc(n))})})):i,ep=i=>{const e=it(i,"SegmentTemplate")[0],t=it(i,"SegmentList")[0],n=t&&it(t,"SegmentURL").map(g=>$t({tag:"SegmentURL"},St(g))),r=it(i,"SegmentBase")[0],s=t||e,a=s&&it(s,"SegmentTimeline")[0],o=t||r||e,u=o&&it(o,"Initialization")[0],c=e&&St(e);c&&u?c.initialization=u&&St(u):c&&c.initialization&&(c.initialization={sourceURL:c.initialization});const h={template:c,segmentTimeline:a&&it(a,"S").map(g=>St(g)),list:t&&$t(St(t),{segmentUrls:n,initialization:St(u)}),base:r&&$t(St(r),{initialization:St(u)})};return Object.keys(h).forEach(g=>{h[g]||delete h[g]}),h},nD=(i,e,t)=>n=>{const r=it(n,"BaseURL"),s=pc(e,r),a=$t(i,St(n)),o=ep(n);return s.map(u=>({segmentInfo:$t(t,o),attributes:$t(a,{baseUrl:u})}))},rD=i=>i.reduce((e,t)=>{const n=St(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const r=iD[n.schemeIdUri];if(r){e[r]={attributes:n};const s=it(t,"cenc:pssh")[0];if(s){const a=fc(s);e[r].pssh=a&&Ww(a)}}return e},{}),sD=i=>{if(i.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{let n,r;return r=t,/^CC\d=/.test(t)?[n,r]=t.split("="):/^CC\d$/.test(t)&&(n=t),{channel:n,language:r}});if(i.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{const n={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[r,s=""]=t.split("=");n.channel=r,n.language=t,s.split(",").forEach(a=>{const[o,u]=a.split(":");o==="lang"?n.language=u:o==="er"?n.easyReader=Number(u):o==="war"?n.aspectRatio=Number(u):o==="3D"&&(n["3D"]=Number(u))})}else n.language=t;return n.channel&&(n.channel="SERVICE"+n.channel),n})},aD=i=>Xs(it(i.node,"EventStream").map(e=>{const t=St(e),n=t.schemeIdUri;return it(e,"Event").map(r=>{const s=St(r),a=s.presentationTime||0,o=t.timescale||1,u=s.duration||0,c=a/o+i.attributes.start;return{schemeIdUri:n,value:t.value,id:s.id,start:c,end:c+u/o,messageData:fc(r)||s.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),oD=(i,e,t)=>n=>{const r=St(n),s=pc(e,it(n,"BaseURL")),a=it(n,"Role")[0],o={role:St(a)};let u=$t(i,r,o);const c=it(n,"Accessibility")[0],h=sD(St(c));h&&(u=$t(u,{captionServices:h}));const g=it(n,"Label")[0];if(g&&g.childNodes.length){const A=g.childNodes[0].nodeValue.trim();u=$t(u,{label:A})}const y=rD(it(n,"ContentProtection"));Object.keys(y).length&&(u=$t(u,{contentProtection:y}));const T=ep(n),v=it(n,"Representation"),x=$t(t,T);return Xs(v.map(nD(u,s,x)))},uD=(i,e)=>(t,n)=>{const r=pc(e,it(t.node,"BaseURL")),s=$t(i,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(s.periodDuration=t.attributes.duration);const a=it(t.node,"AdaptationSet"),o=ep(t.node);return Xs(a.map(oD(s,r,o)))},lD=({attributes:i,priorPeriodAttributes:e,mpdType:t})=>typeof i.start=="number"?i.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&t==="static"?0:null,cD=(i,e={})=>{const{manifestUri:t="",NOW:n=Date.now(),clientOffset:r=0}=e,s=it(i,"Period");if(!s.length)throw new Error(Ys.INVALID_NUMBER_OF_PERIOD);const a=it(i,"Location"),o=St(i),u=pc([t],it(i,"BaseURL"));o.type=o.type||"static",o.sourceDuration=o.mediaPresentationDuration||0,o.NOW=n,o.clientOffset=r,a.length&&(o.locations=a.map(fc));const c=[];return s.forEach((h,g)=>{const y=St(h),T=c[g-1];y.start=lD({attributes:y,priorPeriodAttributes:T?T.attributes:null,mpdType:o.type}),c.push({node:h,attributes:y})}),{locations:o.locations,representationInfo:Xs(c.map(uD(o,u))),eventStream:Xs(c.map(aD))}},Pv=i=>{if(i==="")throw new Error(Ys.DASH_EMPTY_MANIFEST);const e=new bA;let t,n;try{t=e.parseFromString(i,"application/xml"),n=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error(Ys.DASH_INVALID_XML);return n},hD=i=>{const e=it(i,"UTCTiming")[0];if(!e)return null;const t=St(e);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(Ys.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},dD=(i,e={})=>{const t=cD(Pv(i),e),n=ZA(t.representationInfo);return HA({dashPlaylists:n,locations:t.locations,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:t.eventStream})},fD=i=>hD(Pv(i));var Rv=Math.pow(2,32),pD=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t;return e.getBigUint64?(t=e.getBigUint64(0),t<Number.MAX_SAFE_INTEGER?Number(t):t):e.getUint32(0)*Rv+e.getUint32(4)},mD={getUint64:pD,MAX_UINT32:Rv},f0=mD.getUint64,gD=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t={version:i[0],flags:new Uint8Array(i.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},n=12;t.version===0?(t.earliestPresentationTime=e.getUint32(n),t.firstOffset=e.getUint32(n+4),n+=8):(t.earliestPresentationTime=f0(i.subarray(n)),t.firstOffset=f0(i.subarray(n+8)),n+=16),n+=2;var r=e.getUint16(n);for(n+=2;r>0;n+=12,r--)t.references.push({referenceType:(i[n]&128)>>>7,referencedSize:e.getUint32(n)&2147483647,subsegmentDuration:e.getUint32(n+4),startsWithSap:!!(i[n+8]&128),sapType:(i[n+8]&112)>>>4,sapDeltaTime:e.getUint32(n+8)&268435455});return t},_D=gD;const yD=mr(_D);var vD=oe([73,68,51]),TD=function(e,t){t===void 0&&(t=0),e=oe(e);var n=e[t+5],r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],s=(n&16)>>4;return s?r+20:r+10},ro=function i(e,t){return t===void 0&&(t=0),e=oe(e),e.length-t<10||!Ze(e,vD,{offset:t})?t:(t+=TD(e,t),i(e,t))},p0=function(e){return typeof e=="string"?Yy(e):e},bD=function(e){return Array.isArray(e)?e.map(function(t){return p0(t)}):[p0(e)]},ED=function i(e,t,n){n===void 0&&(n=!1),t=bD(t),e=oe(e);var r=[];if(!t.length)return r;for(var s=0;s<e.length;){var a=(e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3])>>>0,o=e.subarray(s+4,s+8);if(a===0)break;var u=s+a;if(u>e.length){if(n)break;u=e.length}var c=e.subarray(s+8,u);Ze(o,t[0])&&(t.length===1?r.push(c):r.push.apply(r,i(c,t.slice(1),n))),s=u}return r},Vu={EBML:oe([26,69,223,163]),DocType:oe([66,130]),Segment:oe([24,83,128,103]),SegmentInfo:oe([21,73,169,102]),Tracks:oe([22,84,174,107]),Track:oe([174]),TrackNumber:oe([215]),DefaultDuration:oe([35,227,131]),TrackEntry:oe([174]),TrackType:oe([131]),FlagDefault:oe([136]),CodecID:oe([134]),CodecPrivate:oe([99,162]),VideoTrack:oe([224]),AudioTrack:oe([225]),Cluster:oe([31,67,182,117]),Timestamp:oe([231]),TimestampScale:oe([42,215,177]),BlockGroup:oe([160]),BlockDuration:oe([155]),Block:oe([161]),SimpleBlock:oe([163])},Pd=[128,64,32,16,8,4,2,1],SD=function(e){for(var t=1,n=0;n<Pd.length&&!(e&Pd[n]);n++)t++;return t},Al=function(e,t,n,r){n===void 0&&(n=!0),r===void 0&&(r=!1);var s=SD(e[t]),a=e.subarray(t,t+s);return n&&(a=Array.prototype.slice.call(e,t,t+s),a[0]^=Pd[s-1]),{length:s,value:$w(a,{signed:r}),bytes:a}},m0=function i(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(t){return i(t)}):typeof e=="number"?qw(e):e},xD=function(e){return Array.isArray(e)?e.map(function(t){return m0(t)}):[m0(e)]},CD=function i(e,t,n){if(n>=t.length)return t.length;var r=Al(t,n,!1);if(Ze(e.bytes,r.bytes))return n;var s=Al(t,n+r.length);return i(e,t,n+s.length+s.value+r.length)},g0=function i(e,t){t=xD(t),e=oe(e);var n=[];if(!t.length)return n;for(var r=0;r<e.length;){var s=Al(e,r,!1),a=Al(e,r+s.length),o=r+s.length+a.length;a.value===127&&(a.value=CD(s,e,o),a.value!==e.length&&(a.value-=o));var u=o+a.value>e.length?e.length:o+a.value,c=e.subarray(o,u);Ze(t[0],s.bytes)&&(t.length===1?n.push(c):n=n.concat(i(c,t.slice(1))));var h=s.length+a.length+c.length;r+=h}return n},wD=oe([0,0,0,1]),AD=oe([0,0,1]),DD=oe([0,0,3]),ID=function(e){for(var t=[],n=1;n<e.length-2;)Ze(e.subarray(n,n+3),DD)&&(t.push(n+2),n++),n++;if(t.length===0)return e;var r=e.length-t.length,s=new Uint8Array(r),a=0;for(n=0;n<r;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=e[a];return s},Ov=function(e,t,n,r){r===void 0&&(r=1/0),e=oe(e),n=[].concat(n);for(var s=0,a,o=0;s<e.length&&(o<r||a);){var u=void 0;if(Ze(e.subarray(s),wD)?u=4:Ze(e.subarray(s),AD)&&(u=3),!u){s++;continue}if(o++,a)return ID(e.subarray(a,s));var c=void 0;t==="h264"?c=e[s+u]&31:t==="h265"&&(c=e[s+u]>>1&63),n.indexOf(c)!==-1&&(a=s+u),s+=u+(t==="h264"?1:2)}return e.subarray(0,0)},kD=function(e,t,n){return Ov(e,"h264",t,n)},PD=function(e,t,n){return Ov(e,"h265",t,n)},Zt={webm:oe([119,101,98,109]),matroska:oe([109,97,116,114,111,115,107,97]),flac:oe([102,76,97,67]),ogg:oe([79,103,103,83]),ac3:oe([11,119]),riff:oe([82,73,70,70]),avi:oe([65,86,73]),wav:oe([87,65,86,69]),"3gp":oe([102,116,121,112,51,103]),mp4:oe([102,116,121,112]),fmp4:oe([115,116,121,112]),mov:oe([102,116,121,112,113,116]),moov:oe([109,111,111,118]),moof:oe([109,111,111,102])},Qs={aac:function(e){var t=ro(e);return Ze(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=ro(e);return Ze(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=g0(e,[Vu.EBML,Vu.DocType])[0];return Ze(t,Zt.webm)},mkv:function(e){var t=g0(e,[Vu.EBML,Vu.DocType])[0];return Ze(t,Zt.matroska)},mp4:function(e){if(Qs["3gp"](e)||Qs.mov(e))return!1;if(Ze(e,Zt.mp4,{offset:4})||Ze(e,Zt.fmp4,{offset:4})||Ze(e,Zt.moof,{offset:4})||Ze(e,Zt.moov,{offset:4}))return!0},mov:function(e){return Ze(e,Zt.mov,{offset:4})},"3gp":function(e){return Ze(e,Zt["3gp"],{offset:4})},ac3:function(e){var t=ro(e);return Ze(e,Zt.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var t=0;t+188<e.length&&t<188;){if(e[t]===71&&e[t+188]===71)return!0;t+=1}return!1},flac:function(e){var t=ro(e);return Ze(e,Zt.flac,{offset:t})},ogg:function(e){return Ze(e,Zt.ogg)},avi:function(e){return Ze(e,Zt.riff)&&Ze(e,Zt.avi,{offset:8})},wav:function(e){return Ze(e,Zt.riff)&&Ze(e,Zt.wav,{offset:8})},h264:function(e){return kD(e,7,3).length},h265:function(e){return PD(e,[32,33],3).length}},Rd=Object.keys(Qs).filter(function(i){return i!=="ts"&&i!=="h264"&&i!=="h265"}).concat(["ts","h264","h265"]);Rd.forEach(function(i){var e=Qs[i];Qs[i]=function(t){return e(oe(t))}});var RD=Qs,tp=function(e){e=oe(e);for(var t=0;t<Rd.length;t++){var n=Rd[t];if(RD[n](e))return n}return""},OD=function(e){return ED(e,["moof"]).length>0},ip=9e4,np,rp,mc,sp,Lv,Nv,Mv;np=function(i){return i*ip};rp=function(i,e){return i*e};mc=function(i){return i/ip};sp=function(i,e){return i/e};Lv=function(i,e){return np(sp(i,e))};Nv=function(i,e){return rp(mc(i),e)};Mv=function(i,e,t){return mc(t?i:i-e)};var Dl={ONE_SECOND_IN_TS:ip,secondsToVideoTs:np,secondsToAudioTs:rp,videoTsToSeconds:mc,audioTsToSeconds:sp,audioTsToVideoTs:Lv,videoTsToAudioTs:Nv,metadataTsToSeconds:Mv};/**
 * @license
 * Video.js 8.3.0 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */var Fv="8.3.0";const Rn={},lr=function(i,e){return Rn[i]=Rn[i]||[],e&&(Rn[i]=Rn[i].concat(e)),Rn[i]},LD=function(i,e){lr(i,e)},Bv=function(i,e){const t=lr(i).indexOf(e);return t<=-1?!1:(Rn[i]=Rn[i].slice(),Rn[i].splice(t,1),!0)},ND=function(i,e){lr(i,[].concat(e).map(t=>{const n=(...r)=>(Bv(i,n),t(...r));return n}))},Il={prefixed:!0},ol=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],_0=ol[0];let so;for(let i=0;i<ol.length;i++)if(ol[i][1]in K){so=ol[i];break}if(so){for(let i=0;i<so.length;i++)Il[_0[i]]=so[i];Il.prefixed=so[0]!==_0[0]}let mi=[];const MD=(i,e)=>(t,n,r)=>{const s=e.levels[n],a=new RegExp(`^(${s})$`);if(t!=="log"&&r.unshift(t.toUpperCase()+":"),r.unshift(i+":"),mi){mi.push([].concat(r));const u=mi.length-1e3;mi.splice(0,u>0?u:0)}if(!I.console)return;let o=I.console[t];!o&&t==="debug"&&(o=I.console.info||I.console.log),!(!o||!s||!a.test(t))&&o[Array.isArray(r)?"apply":"call"](I.console,r)};function Uv(i){let e="info",t;const n=function(...r){t("log",e,r)};return t=MD(i,n),n.createLogger=r=>Uv(i+": "+r),n.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:e},n.level=r=>{if(typeof r=="string"){if(!n.levels.hasOwnProperty(r))throw new Error(`"${r}" in not a valid log level`);e=r}return e},n.history=()=>mi?[].concat(mi):[],n.history.filter=r=>(mi||[]).filter(s=>new RegExp(`.*${r}.*`).test(s[0])),n.history.clear=()=>{mi&&(mi.length=0)},n.history.disable=()=>{mi!==null&&(mi.length=0,mi=null)},n.history.enable=()=>{mi===null&&(mi=[])},n.error=(...r)=>t("error",e,r),n.warn=(...r)=>t("warn",e,r),n.debug=(...r)=>t("debug",e,r),n}const Ie=Uv("VIDEOJS"),Vv=Ie.createLogger,FD=Object.prototype.toString,jv=function(i){return En(i)?Object.keys(i):[]};function Ps(i,e){jv(i).forEach(t=>e(i[t],t))}function $v(i,e,t=0){return jv(i).reduce((n,r)=>e(n,i[r],r),t)}function En(i){return!!i&&typeof i=="object"}function Js(i){return En(i)&&FD.call(i)==="[object Object]"&&i.constructor===Object}function Ge(...i){const e={};return i.forEach(t=>{t&&Ps(t,(n,r)=>{if(!Js(n)){e[r]=n;return}Js(e[r])||(e[r]={}),e[r]=Ge(e[r],n)})}),e}function gc(i,e,t,n=!0){const r=a=>Object.defineProperty(i,e,{value:a,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const a=t();return r(a),a}};return n&&(s.set=r),Object.defineProperty(i,e,s)}var BD=Object.freeze({__proto__:null,each:Ps,reduce:$v,isObject:En,isPlain:Js,merge:Ge,defineLazyProperty:gc});let ap=!1,qv=null,Sn=!1,Hv,Gv=!1,Rs=!1,Os=!1,xn=!1,op=null,_c=null,zv=null,kl=!1,yc=!1,Pl=!1,vc=!1;const Po=!!(ma()&&("ontouchstart"in I||I.navigator.maxTouchPoints||I.DocumentTouch&&I.document instanceof I.DocumentTouch)),_s=I.navigator&&I.navigator.userAgentData;_s&&(Sn=_s.platform==="Android",Rs=!!_s.brands.find(i=>i.brand==="Microsoft Edge"),Os=!!_s.brands.find(i=>i.brand==="Chromium"),xn=!Rs&&Os,op=_c=(_s.brands.find(i=>i.brand==="Chromium")||{}).version||null,yc=_s.platform==="Windows");if(!Os){const i=I.navigator&&I.navigator.userAgent||"";ap=/iPod/i.test(i),qv=function(){const e=i.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),Sn=/Android/i.test(i),Hv=function(){const e=i.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),Gv=/Firefox/i.test(i),Rs=/Edg/i.test(i),Os=/Chrome/i.test(i)||/CriOS/i.test(i),xn=!Rs&&Os,op=_c=function(){const e=i.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),zv=function(){const e=/MSIE\s(\d+)\.\d/.exec(i);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(i)&&/rv:11.0/.test(i)&&(t=11),t}(),kl=/Safari/i.test(i)&&!xn&&!Sn&&!Rs,yc=/Windows/i.test(i),Pl=/iPad/i.test(i)||kl&&Po&&!/iPhone/i.test(i),vc=/iPhone/i.test(i)&&!Pl}const ci=vc||Pl||ap,Tc=(kl||ci)&&!xn;var UD=Object.freeze({__proto__:null,get IS_IPOD(){return ap},get IOS_VERSION(){return qv},get IS_ANDROID(){return Sn},get ANDROID_VERSION(){return Hv},get IS_FIREFOX(){return Gv},get IS_EDGE(){return Rs},get IS_CHROMIUM(){return Os},get IS_CHROME(){return xn},get CHROMIUM_VERSION(){return op},get CHROME_VERSION(){return _c},get IE_VERSION(){return zv},get IS_SAFARI(){return kl},get IS_WINDOWS(){return yc},get IS_IPAD(){return Pl},get IS_IPHONE(){return vc},TOUCH_ENABLED:Po,IS_IOS:ci,IS_ANY_SAFARI:Tc});function y0(i){return typeof i=="string"&&!!i.trim()}function VD(i){if(i.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function ma(){return K===I.document}function ga(i){return En(i)&&i.nodeType===1}function Wv(){try{return I.parent!==I.self}catch{return!0}}function Kv(i){return function(e,t){if(!y0(e))return K[i](null);y0(t)&&(t=K.querySelector(t));const n=ga(t)?t:K;return n[i]&&n[i](e)}}function xe(i="div",e={},t={},n){const r=K.createElement(i);return Object.getOwnPropertyNames(e).forEach(function(s){const a=e[s];s==="textContent"?_r(r,a):(r[s]!==a||s==="tabIndex")&&(r[s]=a)}),Object.getOwnPropertyNames(t).forEach(function(s){r.setAttribute(s,t[s])}),n&&up(r,n),r}function _r(i,e){return typeof i.textContent>"u"?i.innerText=e:i.textContent=e,i}function Od(i,e){e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}function fo(i,e){return VD(e),i.classList.contains(e)}function Br(i,...e){return i.classList.add(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i}function bc(i,...e){return i?(i.classList.remove(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i):(Ie.warn("removeClass was called with an element that doesn't exist"),null)}function Xv(i,e,t){return typeof t=="function"&&(t=t(i,e)),typeof t!="boolean"&&(t=void 0),e.split(/\s+/).forEach(n=>i.classList.toggle(n,t)),i}function Yv(i,e){Object.getOwnPropertyNames(e).forEach(function(t){const n=e[t];n===null||typeof n>"u"||n===!1?i.removeAttribute(t):i.setAttribute(t,n===!0?"":n)})}function nr(i){const e={},t=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(i&&i.attributes&&i.attributes.length>0){const n=i.attributes;for(let r=n.length-1;r>=0;r--){const s=n[r].name;let a=n[r].value;(typeof i[s]=="boolean"||t.indexOf(","+s+",")!==-1)&&(a=a!==null),e[s]=a}}return e}function Qv(i,e){return i.getAttribute(e)}function Zs(i,e,t){i.setAttribute(e,t)}function Ec(i,e){i.removeAttribute(e)}function Jv(){K.body.focus(),K.onselectstart=function(){return!1}}function Zv(){K.onselectstart=function(){return!0}}function ea(i){if(i&&i.getBoundingClientRect&&i.parentNode){const e=i.getBoundingClientRect(),t={};return["bottom","height","left","right","top","width"].forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t.height||(t.height=parseFloat(ta(i,"height"))),t.width||(t.width=parseFloat(ta(i,"width"))),t}}function Ro(i){if(!i||i&&!i.offsetParent)return{left:0,top:0,width:0,height:0};const e=i.offsetWidth,t=i.offsetHeight;let n=0,r=0;for(;i.offsetParent&&i!==K[Il.fullscreenElement];)n+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;return{left:n,top:r,width:e,height:t}}function Sc(i,e){const t={x:0,y:0};if(ci){let h=i;for(;h&&h.nodeName.toLowerCase()!=="html";){const g=ta(h,"transform");if(/^matrix/.test(g)){const y=g.slice(7,-1).split(/,\s/).map(Number);t.x+=y[4],t.y+=y[5]}else if(/^matrix3d/.test(g)){const y=g.slice(9,-1).split(/,\s/).map(Number);t.x+=y[12],t.y+=y[13]}h=h.parentNode}}const n={},r=Ro(e.target),s=Ro(i),a=s.width,o=s.height;let u=e.offsetY-(s.top-r.top),c=e.offsetX-(s.left-r.left);return e.changedTouches&&(c=e.changedTouches[0].pageX-s.left,u=e.changedTouches[0].pageY+s.top,ci&&(c-=t.x,u-=t.y)),n.y=1-Math.max(0,Math.min(1,u/o)),n.x=Math.max(0,Math.min(1,c/a)),n}function eT(i){return En(i)&&i.nodeType===3}function xc(i){for(;i.firstChild;)i.removeChild(i.firstChild);return i}function tT(i){return typeof i=="function"&&(i=i()),(Array.isArray(i)?i:[i]).map(e=>{if(typeof e=="function"&&(e=e()),ga(e)||eT(e))return e;if(typeof e=="string"&&/\S/.test(e))return K.createTextNode(e)}).filter(e=>e)}function up(i,e){return tT(e).forEach(t=>i.appendChild(t)),i}function iT(i,e){return up(xc(i),e)}function Oo(i){return i.button===void 0&&i.buttons===void 0||i.button===0&&i.buttons===void 0||i.type==="mouseup"&&i.button===0&&i.buttons===0?!0:!(i.button!==0||i.buttons!==1)}const cr=Kv("querySelector"),nT=Kv("querySelectorAll");function ta(i,e){if(!i||!e)return"";if(typeof I.getComputedStyle=="function"){let t;try{t=I.getComputedStyle(i)}catch{return""}return t?t.getPropertyValue(e)||t[e]:""}return""}var rT=Object.freeze({__proto__:null,isReal:ma,isEl:ga,isInFrame:Wv,createEl:xe,textContent:_r,prependTo:Od,hasClass:fo,addClass:Br,removeClass:bc,toggleClass:Xv,setAttributes:Yv,getAttributes:nr,getAttribute:Qv,setAttribute:Zs,removeAttribute:Ec,blockTextSelection:Jv,unblockTextSelection:Zv,getBoundingClientRect:ea,findPosition:Ro,getPointerPosition:Sc,isTextNode:eT,emptyEl:xc,normalizeContent:tT,appendContent:up,insertContent:iT,isSingleLeftClick:Oo,$:cr,$$:nT,computedStyle:ta});let sT=!1,Ld;const jD=function(){if(Ld.options.autoSetup===!1)return;const i=Array.prototype.slice.call(K.getElementsByTagName("video")),e=Array.prototype.slice.call(K.getElementsByTagName("audio")),t=Array.prototype.slice.call(K.getElementsByTagName("video-js")),n=i.concat(e,t);if(n&&n.length>0)for(let r=0,s=n.length;r<s;r++){const a=n[r];if(a&&a.getAttribute)a.player===void 0&&a.getAttribute("data-setup")!==null&&Ld(a);else{Nd(1);break}}else sT||Nd(1)};function Nd(i,e){ma()&&(e&&(Ld=e),I.setTimeout(jD,i))}function Md(){sT=!0,I.removeEventListener("load",Md)}ma()&&(K.readyState==="complete"?Md():I.addEventListener("load",Md));const aT=function(i){const e=K.createElement("style");return e.className=i,e},oT=function(i,e){i.styleSheet?i.styleSheet.cssText=e:i.textContent=e};var si=new WeakMap;const $D=3;let qD=$D;function Cn(){return qD++}function v0(i,e){if(!si.has(i))return;const t=si.get(i);t.handlers[e].length===0&&(delete t.handlers[e],i.removeEventListener?i.removeEventListener(e,t.dispatcher,!1):i.detachEvent&&i.detachEvent("on"+e,t.dispatcher)),Object.getOwnPropertyNames(t.handlers).length<=0&&(delete t.handlers,delete t.dispatcher,delete t.disabled),Object.getOwnPropertyNames(t).length===0&&si.delete(i)}function lp(i,e,t,n){t.forEach(function(r){i(e,r,n)})}function Cc(i){if(i.fixed_)return i;function e(){return!0}function t(){return!1}if(!i||!i.isPropagationStopped||!i.isImmediatePropagationStopped){const n=i||I.event;i={};for(const r in n)r!=="layerX"&&r!=="layerY"&&r!=="keyLocation"&&r!=="webkitMovementX"&&r!=="webkitMovementY"&&r!=="path"&&(r==="returnValue"&&n.preventDefault||(i[r]=n[r]));if(i.target||(i.target=i.srcElement||K),i.relatedTarget||(i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement),i.preventDefault=function(){n.preventDefault&&n.preventDefault(),i.returnValue=!1,n.returnValue=!1,i.defaultPrevented=!0},i.defaultPrevented=!1,i.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),i.cancelBubble=!0,n.cancelBubble=!0,i.isPropagationStopped=e},i.isPropagationStopped=t,i.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),i.isImmediatePropagationStopped=e,i.stopPropagation()},i.isImmediatePropagationStopped=t,i.clientX!==null&&i.clientX!==void 0){const r=K.documentElement,s=K.body;i.pageX=i.clientX+(r&&r.scrollLeft||s&&s.scrollLeft||0)-(r&&r.clientLeft||s&&s.clientLeft||0),i.pageY=i.clientY+(r&&r.scrollTop||s&&s.scrollTop||0)-(r&&r.clientTop||s&&s.clientTop||0)}i.which=i.charCode||i.keyCode,i.button!==null&&i.button!==void 0&&(i.button=i.button&1?0:i.button&4?1:i.button&2?2:0)}return i.fixed_=!0,i}let ju;const HD=function(){if(typeof ju!="boolean"){ju=!1;try{const i=Object.defineProperty({},"passive",{get(){ju=!0}});I.addEventListener("test",null,i),I.removeEventListener("test",null,i)}catch{}}return ju},GD=["touchstart","touchmove"];function Pi(i,e,t){if(Array.isArray(e))return lp(Pi,i,e,t);si.has(i)||si.set(i,{});const n=si.get(i);if(n.handlers||(n.handlers={}),n.handlers[e]||(n.handlers[e]=[]),t.guid||(t.guid=Cn()),n.handlers[e].push(t),n.dispatcher||(n.disabled=!1,n.dispatcher=function(r,s){if(n.disabled)return;r=Cc(r);const a=n.handlers[r.type];if(a){const o=a.slice(0);for(let u=0,c=o.length;u<c&&!r.isImmediatePropagationStopped();u++)try{o[u].call(i,r,s)}catch(h){Ie.error(h)}}}),n.handlers[e].length===1)if(i.addEventListener){let r=!1;HD()&&GD.indexOf(e)>-1&&(r={passive:!0}),i.addEventListener(e,n.dispatcher,r)}else i.attachEvent&&i.attachEvent("on"+e,n.dispatcher)}function Ht(i,e,t){if(!si.has(i))return;const n=si.get(i);if(!n.handlers)return;if(Array.isArray(e))return lp(Ht,i,e,t);const r=function(a,o){n.handlers[o]=[],v0(a,o)};if(e===void 0){for(const a in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},a)&&r(i,a);return}const s=n.handlers[e];if(s){if(!t){r(i,e);return}if(t.guid)for(let a=0;a<s.length;a++)s[a].guid===t.guid&&s.splice(a--,1);v0(i,e)}}function _a(i,e,t){const n=si.has(i)?si.get(i):{},r=i.parentNode||i.ownerDocument;if(typeof e=="string"?e={type:e,target:i}:e.target||(e.target=i),e=Cc(e),n.dispatcher&&n.dispatcher.call(i,e,t),r&&!e.isPropagationStopped()&&e.bubbles===!0)_a.call(null,r,e,t);else if(!r&&!e.defaultPrevented&&e.target&&e.target[e.type]){si.has(e.target)||si.set(e.target,{});const s=si.get(e.target);e.target[e.type]&&(s.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),s.disabled=!1)}return!e.defaultPrevented}function wc(i,e,t){if(Array.isArray(e))return lp(wc,i,e,t);const n=function(){Ht(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||Cn(),Pi(i,e,n)}function cp(i,e,t){const n=function(){Ht(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||Cn(),Pi(i,e,n)}var zD=Object.freeze({__proto__:null,fixEvent:Cc,on:Pi,off:Ht,trigger:_a,one:wc,any:cp});const ji=30,ze=function(i,e,t){e.guid||(e.guid=Cn());const n=e.bind(i);return n.guid=t?t+"_"+e.guid:e.guid,n},wn=function(i,e){let t=I.performance.now();return function(...r){const s=I.performance.now();s-t>=e&&(i(...r),t=s)}},uT=function(i,e,t,n=I){let r;const s=()=>{n.clearTimeout(r),r=null},a=function(){const o=this,u=arguments;let c=function(){r=null,c=null,t||i.apply(o,u)};!r&&t&&i.apply(o,u),n.clearTimeout(r),r=n.setTimeout(c,e)};return a.cancel=s,a};var WD=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:ji,bind_:ze,throttle:wn,debounce:uT});let Ya;class $i{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Pi(this,e,t),this.addEventListener=n}off(e,t){Ht(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},wc(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},cp(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;typeof e=="string"&&(e={type:t}),e=Cc(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),_a(this,e)}queueTrigger(e){Ya||(Ya=new Map);const t=e.type||e;let n=Ya.get(this);n||(n=new Map,Ya.set(this,n));const r=n.get(t);n.delete(t),I.clearTimeout(r);const s=I.setTimeout(()=>{n.delete(t),n.size===0&&(n=null,Ya.delete(this)),this.trigger(e)},0);n.set(t,s)}}$i.prototype.allowedEvents_={};$i.prototype.addEventListener=$i.prototype.on;$i.prototype.removeEventListener=$i.prototype.off;$i.prototype.dispatchEvent=$i.prototype.trigger;const Ac=i=>typeof i.name=="function"?i.name():typeof i.name=="string"?i.name:i.name_?i.name_:i.constructor&&i.constructor.name?i.constructor.name:typeof i,Fn=i=>i instanceof $i||!!i.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof i[e]=="function"),KD=(i,e)=>{Fn(i)?e():(i.eventedCallbacks||(i.eventedCallbacks=[]),i.eventedCallbacks.push(e))},Fd=i=>typeof i=="string"&&/\S/.test(i)||Array.isArray(i)&&!!i.length,Rl=(i,e,t)=>{if(!i||!i.nodeName&&!Fn(i))throw new Error(`Invalid target for ${Ac(e)}#${t}; must be a DOM node or evented object.`)},lT=(i,e,t)=>{if(!Fd(i))throw new Error(`Invalid event type for ${Ac(e)}#${t}; must be a non-empty string or array.`)},cT=(i,e,t)=>{if(typeof i!="function")throw new Error(`Invalid listener for ${Ac(e)}#${t}; must be a function.`)},Uh=(i,e,t)=>{const n=e.length<3||e[0]===i||e[0]===i.eventBusEl_;let r,s,a;return n?(r=i.eventBusEl_,e.length>=3&&e.shift(),[s,a]=e):[r,s,a]=e,Rl(r,i,t),lT(s,i,t),cT(a,i,t),a=ze(i,a),{isTargetingSelf:n,target:r,type:s,listener:a}},Ar=(i,e,t,n)=>{Rl(i,i,e),i.nodeName?zD[e](i,t,n):i[e](t,n)},XD={on(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=Uh(this,i,"on");if(Ar(t,"on",n,r),!e){const s=()=>this.off(t,n,r);s.guid=r.guid;const a=()=>this.off("dispose",s);a.guid=r.guid,Ar(this,"on","dispose",s),Ar(t,"on","dispose",a)}},one(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=Uh(this,i,"one");if(e)Ar(t,"one",n,r);else{const s=(...a)=>{this.off(t,n,s),r.apply(null,a)};s.guid=r.guid,Ar(t,"one",n,s)}},any(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=Uh(this,i,"any");if(e)Ar(t,"any",n,r);else{const s=(...a)=>{this.off(t,n,s),r.apply(null,a)};s.guid=r.guid,Ar(t,"any",n,s)}},off(i,e,t){if(!i||Fd(i))Ht(this.eventBusEl_,i,e);else{const n=i,r=e;Rl(n,this,"off"),lT(r,this,"off"),cT(t,this,"off"),t=ze(this,t),this.off("dispose",t),n.nodeName?(Ht(n,r,t),Ht(n,"dispose",t)):Fn(n)&&(n.off(r,t),n.off("dispose",t))}},trigger(i,e){Rl(this.eventBusEl_,this,"trigger");const t=i&&typeof i!="string"?i.type:i;if(!Fd(t))throw new Error(`Invalid event type for ${Ac(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return _a(this.eventBusEl_,i,e)}};function hp(i,e={}){const{eventBusKey:t}=e;if(t){if(!i[t].nodeName)throw new Error(`The eventBusKey "${t}" does not refer to an element.`);i.eventBusEl_=i[t]}else i.eventBusEl_=xe("span",{className:"vjs-event-bus"});return Object.assign(i,XD),i.eventedCallbacks&&i.eventedCallbacks.forEach(n=>{n()}),i.on("dispose",()=>{i.off(),[i,i.el_,i.eventBusEl_].forEach(function(n){n&&si.has(n)&&si.delete(n)}),I.setTimeout(()=>{i.eventBusEl_=null},0)}),i}const YD={state:{},setState(i){typeof i=="function"&&(i=i());let e;return Ps(i,(t,n)=>{this.state[n]!==t&&(e=e||{},e[n]={from:this.state[n],to:t}),this.state[n]=t}),e&&Fn(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function hT(i,e){return Object.assign(i,YD),i.state=Object.assign({},i.state,e),typeof i.handleStateChanged=="function"&&Fn(i)&&i.on("statechanged",i.handleStateChanged),i}const po=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toLowerCase())},st=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},dT=function(i,e){return st(i)===st(e)};var QD=Object.freeze({__proto__:null,toLowerCase:po,toTitleCase:st,titleCaseEquals:dT});class j{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Ge({},this.options_),t=this.options_=Ge(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const r=e&&e.id&&e.id()||"no_player";this.id_=`${r}_component_${Cn()}`}this.name_=t.name||null,t.el?this.el_=t.el:t.createEl!==!1&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(r=>this.addClass(r)),["on","off","one","any","trigger"].forEach(r=>{this[r]=void 0}),t.evented!==!1&&(hp(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),hT(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,t.initChildren!==!1&&this.initChildren(),this.ready(n),t.reportTouchActivity!==!1&&this.enableTouchActivity()}on(e,t){}off(e,t){}one(e,t){}any(e,t){}trigger(e){}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return!!this.isDisposed_}player(){return this.player_}options(e){return e?(this.options_=Ge(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return xe(e,t,n)}localize(e,t,n=e){const r=this.player_.language&&this.player_.language(),s=this.player_.languages&&this.player_.languages(),a=s&&s[r],o=r&&r.split("-")[0],u=s&&s[o];let c=n;return a&&a[e]?c=a[e]:u&&u[e]&&(c=u[e]),t&&(c=c.replace(/\{(\d+)\}/g,function(h,g){const y=t[g-1];let T=y;return typeof y>"u"&&(T=h),T})),c}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((n,r)=>n.concat(r),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}addChild(e,t={},n=this.children_.length){let r,s;if(typeof e=="string"){s=st(e);const a=t.componentClass||s;t.name=s;const o=j.getComponent(a);if(!o)throw new Error(`Component ${a} does not exist`);if(typeof o!="function")return null;r=new o(this.player_||this,t)}else r=e;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,typeof r.id=="function"&&(this.childIndex_[r.id()]=r),s=s||r.name&&st(r.name()),s&&(this.childNameIndex_[s]=r,this.childNameIndex_[po(s)]=r),typeof r.el=="function"&&r.el()){let a=null;this.children_[n+1]&&(this.children_[n+1].el_?a=this.children_[n+1].el_:ga(this.children_[n+1])&&(a=this.children_[n+1])),this.contentEl().insertBefore(r.el(),a)}return r}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let r=this.children_.length-1;r>=0;r--)if(this.children_[r]===e){t=!0,this.children_.splice(r,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[st(e.name())]=null,this.childNameIndex_[po(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=a=>{const o=a.name;let u=a.opts;if(t[o]!==void 0&&(u=t[o]),u===!1)return;u===!0&&(u={}),u.playerOptions=this.options_.playerOptions;const c=this.addChild(o,u);c&&(this[o]=c)};let r;const s=j.getComponent("Tech");Array.isArray(e)?r=e:r=Object.keys(e),r.concat(Object.keys(this.options_).filter(function(a){return!r.some(function(o){return typeof o=="string"?a===o:a===o.name})})).map(a=>{let o,u;return typeof a=="string"?(o=a,u=e[o]||this.options_[o]||{}):(o=a.name,u=a),{name:o,opts:u}}).filter(a=>{const o=j.getComponent(a.opts.componentClass||st(a.name));return o&&!s.isTech(o)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}t?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)}$(e,t){return cr(e,t||this.contentEl())}$$(e,t){return nT(e,t||this.contentEl())}hasClass(e){return fo(this.el_,e)}addClass(...e){Br(this.el_,...e)}removeClass(...e){bc(this.el_,...e)}toggleClass(e,t){Xv(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return Qv(this.el_,e)}setAttribute(e,t){Zs(this.el_,e,t)}removeAttribute(e){Ec(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(t!==void 0){(t===null||t!==t)&&(t=0),(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",n||this.trigger("componentresize");return}if(!this.el_)return 0;const r=this.el_.style[e],s=r.indexOf("px");return parseInt(s!==-1?r.slice(0,s):this.el_["offset"+st(e)],10)}currentDimension(e){let t=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(t=ta(this.el_,e),t=parseFloat(t),t===0||isNaN(t)){const n=`offset${st(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(ge.isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const n=10,r=200;let s;this.on("touchstart",function(o){o.touches.length===1&&(t={pageX:o.touches[0].pageX,pageY:o.touches[0].pageY},e=I.performance.now(),s=!0)}),this.on("touchmove",function(o){if(o.touches.length>1)s=!1;else if(t){const u=o.touches[0].pageX-t.pageX,c=o.touches[0].pageY-t.pageY;Math.sqrt(u*u+c*c)>n&&(s=!1)}});const a=function(){s=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",function(o){t=null,s===!0&&I.performance.now()-e<r&&(o.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=ze(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(r){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=ze(this,e),this.clearTimersOnDispose_(),n=I.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),I.clearTimeout(e)),e}setInterval(e,t){e=ze(this,e),this.clearTimersOnDispose_();const n=I.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),I.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var t;return e=ze(this,e),t=I.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){if(this.namedRafs_.has(e))return;this.clearTimersOnDispose_(),t=ze(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),I.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((n,r)=>this[t](r))}),this.clearingTimersOnDispose_=!1}))}static registerComponent(e,t){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=j.getComponent("Tech"),r=n&&n.isTech(t),s=j===t||j.prototype.isPrototypeOf(t.prototype);if(r||!s){let o;throw r?o="techs must be registered using Tech.registerTech()":o="must be a Component subclass",new Error(`Illegal component, "${e}"; ${o}.`)}e=st(e),j.components_||(j.components_={});const a=j.getComponent("Player");if(e==="Player"&&a&&a.players){const o=a.players,u=Object.keys(o);if(o&&u.length>0&&u.map(c=>o[c]).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return j.components_[e]=t,j.components_[po(e)]=t,t}static getComponent(e){if(!(!e||!j.components_))return j.components_[e]}}j.registerComponent("Component",j);function JD(i,e,t){if(typeof e!="number"||e<0||e>t)throw new Error(`Failed to execute '${i}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${t}).`)}function T0(i,e,t,n){return JD(i,n,t.length-1),t[n][e]}function Vh(i){let e;return i===void 0||i.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:i.length,start:T0.bind(null,"start",0,i),end:T0.bind(null,"end",1,i)},I.Symbol&&I.Symbol.iterator&&(e[I.Symbol.iterator]=()=>(i||[]).values()),e}function bn(i,e){return Array.isArray(i)?Vh(i):i===void 0||e===void 0?Vh():Vh([[i,e]])}const fT=function(i,e){i=i<0?0:i;let t=Math.floor(i%60),n=Math.floor(i/60%60),r=Math.floor(i/3600);const s=Math.floor(e/60%60),a=Math.floor(e/3600);return(isNaN(i)||i===1/0)&&(r=n=t="-"),r=r>0||a>0?r+":":"",n=((r||s>=10)&&n<10?"0"+n:n)+":",t=t<10?"0"+t:t,r+n+t};let dp=fT;function pT(i){dp=i}function mT(){dp=fT}function zr(i,e=i){return dp(i,e)}var ZD=Object.freeze({__proto__:null,createTimeRanges:bn,createTimeRange:bn,setFormatTime:pT,resetFormatTime:mT,formatTime:zr});function gT(i,e){let t=0,n,r;if(!e)return 0;(!i||!i.length)&&(i=bn(0,0));for(let s=0;s<i.length;s++)n=i.start(s),r=i.end(s),r>e&&(r=e),t+=r-n;return t/e}function ai(i){if(i instanceof ai)return i;typeof i=="number"?this.code=i:typeof i=="string"?this.message=i:En(i)&&(typeof i.code=="number"&&(this.code=i.code),Object.assign(this,i)),this.message||(this.message=ai.defaultMessages[this.code]||"")}ai.prototype.code=0;ai.prototype.message="";ai.prototype.status=null;ai.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];ai.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(let i=0;i<ai.errorTypes.length;i++)ai[ai.errorTypes[i]]=i,ai.prototype[ai.errorTypes[i]]=i;function mo(i){return i!=null&&typeof i.then=="function"}function fn(i){mo(i)&&i.then(null,e=>{})}const Bd=function(i){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,r)=>(i[n]&&(t[n]=i[n]),t),{cues:i.cues&&Array.prototype.map.call(i.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})},eI=function(i){const e=i.$$("track"),t=Array.prototype.map.call(e,r=>r.track);return Array.prototype.map.call(e,function(r){const s=Bd(r.track);return r.src&&(s.src=r.src),s}).concat(Array.prototype.filter.call(i.textTracks(),function(r){return t.indexOf(r)===-1}).map(Bd))},tI=function(i,e){return i.forEach(function(t){const n=e.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(r=>n.addCue(r))}),e.textTracks()};var b0={textTracksToJson:eI,jsonToTextTracks:tI,trackToJson_:Bd};const jh="vjs-modal-dialog";class ya extends j{constructor(e,t){super(e,t),this.handleKeyDown_=n=>this.handleKeyDown(n),this.close_=n=>this.close(n),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=xe("div",{className:`${jh}-content`},{role:"document"}),this.descEl_=xe("p",{className:`${jh}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),_r(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${jh} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(!this.opened_){const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const r=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=r,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,r=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),iT(t,e),this.trigger("modalfill"),r?n.insertBefore(t,r):n.appendChild(t);const s=this.getChild("closeButton");s&&n.appendChild(s.el_)}empty(){this.trigger("beforemodalempty"),xc(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=K.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(e.stopPropagation(),ge.isEventKey(e,"Escape")&&this.closeable()){e.preventDefault(),this.close();return}if(!ge.isEventKey(e,"Tab"))return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let r;for(let s=0;s<t.length;s++)if(n===t[s]){r=s;break}K.activeElement===this.el_&&(r=0),e.shiftKey&&r===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&r===t.length-1&&(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,t=>(t instanceof I.HTMLAnchorElement||t instanceof I.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof I.HTMLInputElement||t instanceof I.HTMLSelectElement||t instanceof I.HTMLTextAreaElement||t instanceof I.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof I.HTMLIFrameElement||t instanceof I.HTMLObjectElement||t instanceof I.HTMLEmbedElement||t.hasAttribute("tabindex")&&t.getAttribute("tabindex")!==-1||t.hasAttribute("contenteditable"))}}ya.prototype.options_={pauseOnOpen:!0,temporary:!0};j.registerComponent("ModalDialog",ya);class ia extends $i{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},Fn(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const s=this[n];if(s.id===e){t=s;break}}return t}}ia.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const i in ia.prototype.allowedEvents_)ia.prototype["on"+i]=null;const $h=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].enabled=!1)};class iI extends ia{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){$h(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&$h(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,$h(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const qh=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].selected=!1)};class nI extends ia{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){qh(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set(){}})}addTrack(e){e.selected&&qh(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,qh(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class _T extends ia{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class rI{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,r=this.trackElements_.length;n<r;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&typeof this.trackElements_[t].track.off=="function"&&this.trackElements_[t].track.off(),typeof this.trackElements_[t].off=="function"&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class Ol{constructor(e){Ol.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const r=e.length;this.cues_=e,this.length_=e.length;const s=function(a){""+a in this||Object.defineProperty(this,""+a,{get(){return this.cues_[a]}})};if(t<r)for(n=t;n<r;n++)s.call(this,n)}getCueById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const s=this[n];if(s.id===e){t=s;break}}return t}}const sI={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},aI={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},oI={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},E0={disabled:"disabled",hidden:"hidden",showing:"showing"};class fp extends $i{constructor(e={}){super();const t={id:e.id||"vjs_track_"+Cn(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const r in t)Object.defineProperty(this,r,{get(){return t[r]},set(){}});Object.defineProperty(this,"label",{get(){return n},set(r){r!==n&&(n=r,this.trigger("labelchange"))}})}}const pp=function(i){const e=["protocol","hostname","port","pathname","search","hash","host"],t=K.createElement("a");t.href=i;const n={};for(let r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n.protocol==="http:"&&(n.host=n.host.replace(/:80$/,"")),n.protocol==="https:"&&(n.host=n.host.replace(/:443$/,"")),n.protocol||(n.protocol=I.location.protocol),n.host||(n.host=I.location.host),n},yT=function(i){if(!i.match(/^https?:\/\//)){const e=K.createElement("a");e.href=i,i=e.href}return i},mp=function(i){if(typeof i=="string"){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(i);if(t)return t.pop().toLowerCase()}return""},Dc=function(i,e=I.location){const t=pp(i);return(t.protocol===":"?e.protocol:t.protocol)+t.host!==e.protocol+e.host};var uI=Object.freeze({__proto__:null,parseUrl:pp,getAbsoluteURL:yT,getFileExtension:mp,isCrossOrigin:Dc});const S0=function(i,e){const t=new I.WebVTT.Parser(I,I.vttjs,I.WebVTT.StringDecoder()),n=[];t.oncue=function(r){e.addCue(r)},t.onparsingerror=function(r){n.push(r)},t.onflush=function(){e.trigger({type:"loadeddata",target:e})},t.parse(i),n.length>0&&(I.console&&I.console.groupCollapsed&&I.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),n.forEach(r=>Ie.error(r)),I.console&&I.console.groupEnd&&I.console.groupEnd()),t.flush()},x0=function(i,e){const t={uri:i},n=Dc(i);n&&(t.cors=n);const r=e.tech_.crossOrigin()==="use-credentials";r&&(t.withCredentials=r),jy(t,ze(this,function(s,a,o){if(s)return Ie.error(s,a);e.loaded_=!0,typeof I.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],u=>{if(u.type==="vttjserror"){Ie.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return S0(o,e)}):S0(o,e)}))};class Zo extends fp{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=Ge(e,{kind:oI[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=E0[t.mode]||"disabled";const r=t.default;(t.kind==="metadata"||t.kind==="chapters")&&(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const s=new Ol(this.cues_),a=new Ol(this.activeCues_);let o=!1;this.timeupdateHandler=ze(this,function(c={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){c.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,o&&(this.trigger("cuechange"),o=!1),c.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const u=()=>{this.stopTracking()};this.tech_.one("dispose",u),n!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return r},set(){}},mode:{get(){return n},set(c){E0[c]&&n!==c&&(n=c,!this.preload_&&n!=="disabled"&&this.cues.length===0&&x0(this.src,this),this.stopTracking(),n!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?s:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return a;const c=this.tech_.currentTime(),h=[];for(let g=0,y=this.cues.length;g<y;g++){const T=this.cues[g];T.startTime<=c&&T.endTime>=c&&h.push(T)}if(o=!1,h.length!==this.activeCues_.length)o=!0;else for(let g=0;g<h.length;g++)this.activeCues_.indexOf(h[g])===-1&&(o=!0);return this.activeCues_=h,a.setCues_(this.activeCues_),a},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||t.kind!=="subtitles"&&t.kind!=="captions")&&x0(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(I.vttjs&&!(e instanceof I.vttjs.VTTCue)){t=new I.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const r in e)r in t||(t[r]=e[r]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}Zo.prototype.allowedEvents_={cuechange:"cuechange"};class vT extends fp{constructor(e={}){const t=Ge(e,{kind:aI[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get(){return n},set(r){typeof r!="boolean"||r===n||(n=r,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class TT extends fp{constructor(e={}){const t=Ge(e,{kind:sI[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get(){return n},set(r){typeof r!="boolean"||r===n||(n=r,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class $n extends $i{constructor(e={}){super();let t;const n=new Zo(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return n}}}),t=$n.NONE,n.addEventListener("loadeddata",()=>{t=$n.LOADED,this.trigger({type:"load",target:this})})}}$n.prototype.allowedEvents_={load:"load"};$n.NONE=0;$n.LOADING=1;$n.LOADED=2;$n.ERROR=3;const Vi={audio:{ListClass:iI,TrackClass:vT,capitalName:"Audio"},video:{ListClass:nI,TrackClass:TT,capitalName:"Video"},text:{ListClass:_T,TrackClass:Zo,capitalName:"Text"}};Object.keys(Vi).forEach(function(i){Vi[i].getterName=`${i}Tracks`,Vi[i].privateName=`${i}Tracks_`});const na={remoteText:{ListClass:_T,TrackClass:Zo,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:rI,TrackClass:$n,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ni=Object.assign({},Vi,na);na.names=Object.keys(na);Vi.names=Object.keys(Vi);ni.names=[].concat(na.names).concat(Vi.names);function lI(i,e,t,n,r={}){const s=i.textTracks();r.kind=e,t&&(r.label=t),n&&(r.language=n),r.tech=i;const a=new ni.text.TrackClass(r);return s.addTrack(a),a}class ve extends j{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=n=>this.onDurationChange(n),this.trackProgress_=n=>this.trackProgress(n),this.trackCurrentTime_=n=>this.trackCurrentTime(n),this.stopTrackingCurrentTime_=n=>this.stopTrackingCurrentTime(n),this.disposeSourceHandler_=n=>this.disposeSourceHandler(n),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),ni.names.forEach(n=>{const r=ni[n];e&&e[r.getterName]&&(this[r.privateName]=e[r.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(n=>{e[`native${n}Tracks`]===!1&&(this[`featuresNative${n}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new ni.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(ze(this,function(){const t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,t===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return bn(0,0)}bufferedPercent(){return gT(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Vi.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(t=>{const n=this[`${t}Tracks`]()||[];let r=n.length;for(;r--;){const s=n[r];t==="text"&&this.removeRemoteTextTrack(s),n.removeTrack(s)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new ai(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?bn(0,0):bn()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Vi.names.forEach(e=>{const t=Vi[e],n=()=>{this.trigger(`${e}trackchange`)},r=this[t.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),this.on("dispose",()=>{r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!I.WebVTT)if(K.body.contains(this.el())){if(!this.options_["vtt.js"]&&Js(jg)&&Object.keys(jg).length>0){this.trigger("vttjsloaded");return}const e=K.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),I.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=o=>e.addTrack(o.track),r=o=>e.removeTrack(o.track);t.on("addtrack",n),t.on("removetrack",r),this.addWebVttScript_();const s=()=>this.trigger("texttrackchange"),a=()=>{s();for(let o=0;o<e.length;o++){const u=e[o];u.removeEventListener("cuechange",s),u.mode==="showing"&&u.addEventListener("cuechange",s)}};a(),e.addEventListener("change",a),e.addEventListener("addtrack",a),e.addEventListener("removetrack",a),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",r),e.removeEventListener("change",a),e.removeEventListener("addtrack",a),e.removeEventListener("removetrack",a);for(let o=0;o<e.length;o++)e[o].removeEventListener("cuechange",s)})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return lI(this,e,t,n)}createRemoteTextTrack(e){const t=Ge(e,{tech:this});return new na.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return typeof t!="boolean"&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),t===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=Cn();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return ve.canPlayType(e.type)}static isTech(e){return e.prototype instanceof ve||e instanceof ve||e===ve}static registerTech(e,t){if(ve.techs_||(ve.techs_={}),!ve.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!ve.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!ve.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=st(e),ve.techs_[e]=t,ve.techs_[po(e)]=t,e!=="Tech"&&ve.defaultTechOrder_.push(e),t}static getTech(e){if(e){if(ve.techs_&&ve.techs_[e])return ve.techs_[e];if(e=st(e),I&&I.videojs&&I.videojs[e])return Ie.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),I.videojs[e]}}}ni.names.forEach(function(i){const e=ni[i];ve.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}});ve.prototype.featuresVolumeControl=!0;ve.prototype.featuresMuteControl=!0;ve.prototype.featuresFullscreenResize=!1;ve.prototype.featuresPlaybackRate=!1;ve.prototype.featuresProgressEvents=!1;ve.prototype.featuresSourceset=!1;ve.prototype.featuresTimeupdateEvents=!1;ve.prototype.featuresNativeTextTracks=!1;ve.prototype.featuresVideoFrameCallback=!1;ve.withSourceHandlers=function(i){i.registerSourceHandler=function(t,n){let r=i.sourceHandlers;r||(r=i.sourceHandlers=[]),n===void 0&&(n=r.length),r.splice(n,0,t)},i.canPlayType=function(t){const n=i.sourceHandlers||[];let r;for(let s=0;s<n.length;s++)if(r=n[s].canPlayType(t),r)return r;return""},i.selectSourceHandler=function(t,n){const r=i.sourceHandlers||[];let s;for(let a=0;a<r.length;a++)if(s=r[a].canHandleSource(t,n),s)return r[a];return null},i.canPlaySource=function(t,n){const r=i.selectSourceHandler(t,n);return r?r.canHandleSource(t,n):""},["seekable","seeking","duration"].forEach(function(t){const n=this[t];typeof n=="function"&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):n.apply(this,arguments)})},i.prototype),i.prototype.setSource=function(t){let n=i.selectSourceHandler(t,this.options_);n||(i.nativeSourceHandler?n=i.nativeSourceHandler:Ie.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==i.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},i.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};j.registerComponent("Tech",ve);ve.registerTech("Tech",ve);ve.defaultTechOrder_=[];const Ur={},Ud={},Ll={};function cI(i,e){Ur[i]=Ur[i]||[],Ur[i].push(e)}function hI(i,e,t){i.setTimeout(()=>Ir(e,Ur[e.type],t,i),1)}function dI(i,e){i.forEach(t=>t.setTech&&t.setTech(e))}function fI(i,e,t){return i.reduceRight(gp(t),e[t]())}function pI(i,e,t,n){return e[t](i.reduce(gp(t),n))}function C0(i,e,t,n=null){const r="call"+st(t),s=i.reduce(gp(r),n),a=s===Ll,o=a?null:e[t](s);return _I(i,t,o,a),o}const mI={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},gI={setCurrentTime:1,setMuted:1,setVolume:1},w0={play:1,pause:1};function gp(i){return(e,t)=>e===Ll?Ll:t[i]?t[i](e):e}function _I(i,e,t,n){for(let r=i.length-1;r>=0;r--){const s=i[r];s[e]&&s[e](n,t)}}function yI(i){Ud[i.id()]=null}function vI(i,e){const t=Ud[i.id()];let n=null;if(t==null)return n=e(i),Ud[i.id()]=[[e,n]],n;for(let r=0;r<t.length;r++){const[s,a]=t[r];s===e&&(n=a)}return n===null&&(n=e(i),t.push([e,n])),n}function Ir(i={},e=[],t,n,r=[],s=!1){const[a,...o]=e;if(typeof a=="string")Ir(i,Ur[a],t,n,r,s);else if(a){const u=vI(n,a);if(!u.setSource)return r.push(u),Ir(i,o,t,n,r,s);u.setSource(Object.assign({},i),function(c,h){if(c)return Ir(i,o,t,n,r,s);r.push(u),Ir(h,i.type===h.type?o:Ur[h.type],t,n,r,s)})}else o.length?Ir(i,o,t,n,r,s):s?t(i,r):Ir(i,Ur["*"],t,n,r,!0)}const TI={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Nl=function(i=""){const e=mp(i);return TI[e.toLowerCase()]||""},bI=(i,e)=>{if(!e)return"";if(i.cache_.source.src===e&&i.cache_.source.type)return i.cache_.source.type;const t=i.cache_.sources.filter(r=>r.src===e);if(t.length)return t[0].type;const n=i.$$("source");for(let r=0;r<n.length;r++){const s=n[r];if(s.type&&s.src&&s.src===e)return s.type}return Nl(e)},bT=function(i){if(Array.isArray(i)){let e=[];i.forEach(function(t){t=bT(t),Array.isArray(t)?e=e.concat(t):En(t)&&e.push(t)}),i=e}else typeof i=="string"&&i.trim()?i=[A0({src:i})]:En(i)&&typeof i.src=="string"&&i.src&&i.src.trim()?i=[A0(i)]:i=[];return i};function A0(i){if(!i.type){const e=Nl(i.src);e&&(i.type=e)}return i}class EI extends j{constructor(e,t,n){const r=Ge({createEl:!1},t);if(super(e,r,n),!t.playerOptions.sources||t.playerOptions.sources.length===0)for(let s=0,a=t.playerOptions.techOrder;s<a.length;s++){const o=st(a[s]);let u=ve.getTech(o);if(o||(u=j.getComponent(o)),u&&u.isSupported()){e.loadTech_(o);break}}else e.src(t.playerOptions.sources)}}j.registerComponent("MediaLoader",EI);class Ic extends j{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=n=>this.handleMouseOver(n),this.handleMouseOut_=n=>this.handleMouseOut(n),this.handleClick_=n=>this.handleClick(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),e==="button"&&Ie.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const r=xe(e,t,n);return r.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=xe("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(e===void 0)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,_r(this.controlTextEl_,n),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){ge.isEventKey(e,"Space")||ge.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}j.registerComponent("ClickableComponent",Ic);class Vd extends Ic{constructor(e,t){super(e,t),this.update(),this.update_=n=>this.update(n),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return xe("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(xe("picture",{className:"vjs-poster",tabIndex:-1},{},xe("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?fn(this.player_.play()):this.player_.pause())}}Vd.prototype.crossorigin=Vd.prototype.crossOrigin;j.registerComponent("PosterImage",Vd);const Fi="#222",D0="#ccc",SI={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Hh(i,e){let t;if(i.length===4)t=i[1]+i[1]+i[2]+i[2]+i[3]+i[3];else if(i.length===7)t=i.slice(1);else throw new Error("Invalid color code provided, "+i+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+e+")"}function Gh(i,e,t){try{i.style[e]=t}catch{return}}class xI extends j{constructor(e,t,n){super(e,t,n);const r=s=>this.updateDisplay(s);e.on("loadstart",s=>this.toggleDisplay(s)),e.on("texttrackchange",r),e.on("loadedmetadata",s=>this.preselectTrack(s)),e.ready(ze(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",r),e.on("playerresize",r);const s=I.screen.orientation||I,a=I.screen.orientation?"change":"orientationchange";s.addEventListener(a,r),e.on("dispose",()=>s.removeEventListener(a,r));const o=this.options_.playerOptions.tracks||[];for(let u=0;u<o.length;u++)this.player_.addRemoteTextTrack(o[u],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let r,s,a;for(let o=0;o<t.length;o++){const u=t[o];n&&n.enabled&&n.language&&n.language===u.language&&u.kind in e?u.kind===n.kind?a=u:a||(a=u):n&&!n.enabled?(a=null,r=null,s=null):u.default&&(u.kind==="descriptions"&&!r?r=u:u.kind in e&&!s&&(s=u))}a?a.mode="showing":s?s.mode="showing":r&&(r.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof I.WebVTT=="function"&&I.WebVTT.processCues(I,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const a=[];for(let o=0;o<e.length;++o){const u=e[o];u.mode==="showing"&&a.push(u)}this.updateForTrack(a);return}let n=null,r=null,s=e.length;for(;s--;){const a=e[s];a.mode==="showing"&&(a.kind==="descriptions"?n=a:r=a)}r?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(r)):n&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let r=n.length;for(;r--;){const s=n[r];if(!s)continue;const a=s.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&Gh(a.firstChild,"color",Hh(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Gh(a.firstChild,"backgroundColor",Hh(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Gh(a,"backgroundColor",Hh(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&(t.edgeStyle==="dropshadow"?a.firstChild.style.textShadow=`2px 2px 3px ${Fi}, 2px 2px 4px ${Fi}, 2px 2px 5px ${Fi}`:t.edgeStyle==="raised"?a.firstChild.style.textShadow=`1px 1px ${Fi}, 2px 2px ${Fi}, 3px 3px ${Fi}`:t.edgeStyle==="depressed"?a.firstChild.style.textShadow=`1px 1px ${D0}, 0 1px ${D0}, -1px -1px ${Fi}, 0 -1px ${Fi}`:t.edgeStyle==="uniform"&&(a.firstChild.style.textShadow=`0 0 4px ${Fi}, 0 0 4px ${Fi}, 0 0 4px ${Fi}, 0 0 4px ${Fi}`)),t.fontPercent&&t.fontPercent!==1){const o=I.parseFloat(a.style.fontSize);a.style.fontSize=o*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&t.fontFamily!=="default"&&(t.fontFamily==="small-caps"?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=SI[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof I.WebVTT!="function"||e.every(n=>!n.activeCues))return;const t=[];for(let n=0;n<e.length;++n){const r=e[n];for(let s=0;s<r.activeCues.length;++s)t.push(r.activeCues[s])}I.WebVTT.processCues(I,t,this.el_);for(let n=0;n<e.length;++n){const r=e[n];for(let s=0;s<r.activeCues.length;++s){const a=r.activeCues[s].displayState;Br(a,"vjs-text-track-cue","vjs-text-track-cue-"+(r.language?r.language:n)),r.language&&Zs(a,"lang",r.language)}this.player_.textTrackSettings&&this.updateDisplayState(r)}}}j.registerComponent("TextTrackDisplay",xI);class CI extends j{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=xe("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),r=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}j.registerComponent("LoadingSpinner",CI);class ki extends Ic{createEl(e,t={},n={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n);const r=xe(e,t,n);return r.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}addChild(e,t={}){const n=this.constructor.name;return Ie.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),j.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(ge.isEventKey(e,"Space")||ge.isEventKey(e,"Enter")){e.stopPropagation();return}super.handleKeyDown(e)}}j.registerComponent("Button",ki);class ET extends ki{constructor(e,t){super(e,t),this.mouseused_=!1,this.on("mousedown",n=>this.handleMouseDown(n))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){fn(t),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(!r){this.player_.tech(!0).focus();return}const s=()=>r.focus();mo(t)?t.then(s,()=>{}):this.setTimeout(s,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}ET.prototype.controlText_="Play Video";j.registerComponent("BigPlayButton",ET);class wI extends ki{constructor(e,t){super(e,t),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){ge.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}j.registerComponent("CloseButton",wI);class ST extends ki{constructor(e,t={}){super(e,t),t.replay=t.replay===void 0||t.replay,this.on(e,"play",n=>this.handlePlay(n)),this.on(e,"pause",n=>this.handlePause(n)),t.replay&&this.on(e,"ended",n=>this.handleEnded(n))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?fn(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",t=>this.handleSeeked(t))}}ST.prototype.controlText_="Play";j.registerComponent("PlayToggle",ST);class va extends j{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended"],n=>this.updateContent(n)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=xe("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)} `},{role:"presentation"});return t.appendChild(n),this.contentEl_=xe("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}updateTextNode_(e=0){e=zr(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let t=this.textNode_;t&&this.contentEl_.firstChild!==t&&(t=null,Ie.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=K.createTextNode(this.formattedTime_),this.textNode_&&(t?this.contentEl_.replaceChild(this.textNode_,t):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}va.prototype.labelText_="Time";va.prototype.controlText_="Time";j.registerComponent("TimeDisplay",va);class _p extends va{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;this.player_.ended()?t=this.player_.duration():t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}_p.prototype.labelText_="Current Time";_p.prototype.controlText_="Current Time";j.registerComponent("CurrentTimeDisplay",_p);class yp extends va{constructor(e,t){super(e,t);const n=r=>this.updateContent(r);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}yp.prototype.labelText_="Duration";yp.prototype.controlText_="Duration";j.registerComponent("DurationDisplay",yp);class AI extends j{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}}j.registerComponent("TimeDivider",AI);class vp extends va{constructor(e,t){super(e,t),this.on(e,"durationchange",n=>this.updateContent(n))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(xe("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let t;this.player_.ended()?t=0:this.player_.remainingTimeDisplay?t=this.player_.remainingTimeDisplay():t=this.player_.remainingTime(),this.updateTextNode_(t)}}vp.prototype.labelText_="Remaining Time";vp.prototype.controlText_="Remaining Time";j.registerComponent("RemainingTimeDisplay",vp);class DI extends j{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",n=>this.updateShowing(n))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=xe("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(xe("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(K.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}j.registerComponent("LiveDisplay",DI);class xT extends ki{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=n=>this.updateLiveEdgeStatus(n),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=xe("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}xT.prototype.controlText_="Seek to live, currently playing live";j.registerComponent("SeekToLive",xT);function eu(i,e,t){return i=Number(i),Math.min(t,Math.max(e,isNaN(i)?e:i))}var II=Object.freeze({__proto__:null,clamp:eu});let Tp=class extends j{constructor(e,t){super(e,t),this.handleMouseDown_=n=>this.handleMouseDown(n),this.handleMouseUp_=n=>this.handleMouseUp(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.handleClick_=n=>this.handleClick(n),this.handleMouseMove_=n=>this.handleMouseMove(n),this.update_=n=>this.update(n),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!xn&&e.preventDefault(),Jv(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;Zv(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(eu(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=Sc(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){ge.isEventKey(e,"Left")||ge.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):ge.isEventKey(e,"Right")||ge.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}};j.registerComponent("Slider",Tp);const zh=(i,e)=>eu(i/e*100,0,100).toFixed(2)+"%";class kI extends j{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",n=>this.update(n))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=xe("span",{className:"vjs-control-text"}),n=xe("span",{textContent:this.localize("Loaded")}),r=K.createTextNode(": ");return this.percentageEl_=xe("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const t=this.player_.liveTracker,n=this.player_.buffered(),r=t&&t.isLive()?t.seekableEnd():this.player_.duration(),s=this.player_.bufferedEnd(),a=this.partEls_,o=zh(s,r);this.percent_!==o&&(this.el_.style.width=o,_r(this.percentageEl_,o),this.percent_=o);for(let u=0;u<n.length;u++){const c=n.start(u),h=n.end(u);let g=a[u];g||(g=this.el_.appendChild(xe()),a[u]=g),!(g.dataset.start===c&&g.dataset.end===h)&&(g.dataset.start=c,g.dataset.end=h,g.style.left=zh(c,s),g.style.width=zh(h-c,s))}for(let u=a.length;u>n.length;u--)this.el_.removeChild(a[u-1]);a.length=n.length})}}j.registerComponent("LoadProgressBar",kI);class PI extends j{constructor(e,t){super(e,t),this.update=wn(ze(this,this.update),ji)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const r=Ro(this.el_),s=ea(this.player_.el()),a=e.width*t;if(!s||!r)return;const o=e.left-s.left+a,u=e.width-a+(s.right-e.right);let c=r.width/2;o<c?c+=c-o:u<c&&(c=u),c<0?c=0:c>r.width&&(c=r.width),c=Math.round(c),this.el_.style.right=`-${c}px`,this.write(n)}write(e){_r(this.el_,e)}updateTime(e,t,n,r){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let s;const a=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const o=this.player_.liveTracker.liveWindow(),u=o-t*o;s=(u<1?"":"-")+zr(u,o)}else s=zr(n,a);this.update(e,t,s),r&&r()})}}j.registerComponent("TimeTooltip",PI);class bp extends j{constructor(e,t){super(e,t),this.update=wn(ze(this,this.update),ji)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const n=this.getChild("timeTooltip");if(!n)return;const r=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,r)}}bp.prototype.options_={children:[]};!ci&&!Sn&&bp.prototype.options_.children.push("timeTooltip");j.registerComponent("PlayProgressBar",bp);class CT extends j{constructor(e,t){super(e,t),this.update=wn(ze(this,this.update),ji)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left=`${e.width*t}px`})}}CT.prototype.options_={children:["timeTooltip"]};j.registerComponent("MouseTimeDisplay",CT);const $u=5,I0=12;class Ep extends Tp{constructor(e,t){super(e,t),this.setEventHandlers_()}setEventHandlers_(){this.update_=ze(this,this.update),this.update=wn(this.update_,ji),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in K&&"visibilityState"in K&&this.on(K,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){K.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,ji))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(K.visibilityState==="hidden")return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),r=this.player_.liveTracker;let s=this.player_.duration();r&&r.isLive()&&(s=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(t*100).toFixed(2)),this.percent_=t),(this.currentTime_!==n||this.duration_!==s)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[zr(n,s),zr(s,s)],"{1} of {2}")),this.currentTime_=n,this.duration_=s),this.bar&&this.bar.update(ea(this.el()),this.getProgress())}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){Oo(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!Oo(e))return;!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let n;const r=this.calculateDistance(e),s=this.player_.liveTracker;if(!s||!s.isLive())n=r*this.player_.duration(),n===this.player_.duration()&&(n=n-.1);else{if(r>=.99){s.seekToLiveEdge();return}const a=s.seekableStart(),o=s.liveCurrentTime();if(n=a+r*s.liveWindow(),n>=o&&(n=o),n<=a&&(n=a+.1),n===1/0)return}this.userSeek_(n)}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?fn(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+$u)}stepBack(){this.userSeek_(this.player_.currentTime()-$u)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(ge.isEventKey(e,"Space")||ge.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(ge.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(ge.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(ge(e))){e.preventDefault(),e.stopPropagation();const n=(ge.codes[ge(e)]-ge.codes[0])*10/100;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else ge.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-$u*I0)):ge.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+$u*I0)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in K&&"visibilityState"in K&&this.off(K,"visibilitychange",this.toggleVisibility_),super.dispose()}}Ep.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"};!ci&&!Sn&&Ep.prototype.options_.children.splice(1,0,"mouseTimeDisplay");j.registerComponent("SeekBar",Ep);class wT extends j{constructor(e,t){super(e,t),this.handleMouseMove=wn(ze(this,this.handleMouseMove),ji),this.throttledHandleMouseSeek=wn(ze(this,this.handleMouseSeek),ji),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.handleMouseDownHandler_=n=>this.handleMouseDown(n),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),r=t.getChild("mouseTimeDisplay");if(!n&&!r)return;const s=t.el(),a=Ro(s);let o=Sc(s,e).x;o=eu(o,0,1),r&&r.update(a,o),n&&n.update(a,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&fn(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}wT.prototype.options_={children:["seekBar"]};j.registerComponent("ProgressControl",wT);class AT extends ki{constructor(e,t){super(e,t),this.on(e,["enterpictureinpicture","leavepictureinpicture"],n=>this.handlePictureInPictureChange(n)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],n=>this.handlePictureInPictureEnabledChange(n)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>{e.currentType().substring(0,5)==="audio"||e.audioPosterMode()||e.audioOnlyMode()?(e.isInPictureInPicture()&&e.exitPictureInPicture(),this.hide()):this.show()}),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control ${super.buildCSSClass()}`}handlePictureInPictureEnabledChange(){K.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in I?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}}AT.prototype.controlText_="Picture-in-Picture";j.registerComponent("PictureInPictureToggle",AT);class DT extends ki{constructor(e,t){super(e,t),this.on(e,"fullscreenchange",n=>this.handleFullscreenChange(n)),K[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?this.controlText("Exit Fullscreen"):this.controlText("Fullscreen")}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}DT.prototype.controlText_="Fullscreen";j.registerComponent("FullscreenToggle",DT);const RI=function(i,e){e.tech_&&!e.tech_.featuresVolumeControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class OI extends j{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}j.registerComponent("VolumeLevel",OI);class LI extends j{constructor(e,t){super(e,t),this.update=wn(ze(this,this.update),ji)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,r){if(!n){const s=ea(this.el_),a=ea(this.player_.el()),o=e.width*t;if(!a||!s)return;const u=e.left-a.left+o,c=e.width-o+(a.right-e.right);let h=s.width/2;u<h?h+=h-u:c<h&&(h=c),h<0?h=0:h>s.width&&(h=s.width),this.el_.style.right=`-${h}px`}this.write(`${r}%`)}write(e){_r(this.el_,e)}updateVolume(e,t,n,r,s){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,r.toFixed(0)),s&&s()})}}j.registerComponent("VolumeLevelTooltip",LI);class IT extends j{constructor(e,t){super(e,t),this.update=wn(ze(this,this.update),ji)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,r,()=>{n?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}IT.prototype.options_={children:["volumeLevelTooltip"]};j.registerComponent("MouseVolumeLevelDisplay",IT);class kc extends Tp{constructor(e,t){super(e,t),this.on("slideractive",n=>this.updateLastVolume_(n)),this.on(e,"volumechange",n=>this.updateARIAAttributes(n)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){Oo(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),r=ea(n),s=this.vertical();let a=Sc(n,e);a=s?a.y:a.x,a=eu(a,0,1),t.update(r,a,s)}Oo(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}kc.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!ci&&!Sn&&kc.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");kc.prototype.playerEvent="volumechange";j.registerComponent("VolumeBar",kc);class kT extends j{constructor(e,t={}){t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||Js(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),RI(this,e),this.throttledHandleMouseMove=wn(ze(this,this.handleMouseMove),ji),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.on("mousedown",n=>this.handleMouseDown(n)),this.on("touchstart",n=>this.handleMouseDown(n)),this.on("mousemove",n=>this.handleMouseMove(n)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}kT.prototype.options_={children:["volumeBar"]};j.registerComponent("VolumeControl",kT);const NI=function(i,e){e.tech_&&!e.tech_.featuresMuteControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresMuteControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class PT extends ki{constructor(e,t){super(e,t),NI(this,e),this.on(e,["loadstart","volumechange"],n=>this.update(n))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(t===0){const r=n<.1?.1:n;this.player_.volume(r),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;ci&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2),bc(this.el_,[0,1,2,3].reduce((n,r)=>n+`${r?" ":""}vjs-vol-${r}`,"")),Br(this.el_,`vjs-vol-${t}`)}updateControlText_(){const t=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}PT.prototype.controlText_="Mute";j.registerComponent("MuteToggle",PT);class RT extends j{constructor(e,t={}){typeof t.inline<"u"?t.inline=t.inline:t.inline=!0,(typeof t.volumeControl>"u"||Js(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=n=>this.handleKeyPress(n),this.on(e,["loadstart"],n=>this.volumePanelState_(n)),this.on(this.muteToggle,"keyup",n=>this.handleKeyPress(n)),this.on(this.volumeControl,"keyup",n=>this.handleVolumeControlKeyUp(n)),this.on("keydown",n=>this.handleKeyPress(n)),this.on("mouseover",n=>this.handleMouseOver(n)),this.on("mouseout",n=>this.handleMouseOut(n)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){ge.isEventKey(e,"Esc")&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),Pi(K,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),Ht(K,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){ge.isEventKey(e,"Esc")&&this.handleMouseOut()}}RT.prototype.options_={children:["muteToggle","volumeControl"]};j.registerComponent("VolumePanel",RT);class MI extends ki{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()?n.seekableEnd():this.player_.duration();let s;t+this.skipTime<=r?s=t+this.skipTime:s=r,this.player_.currentTime(s)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}j.registerComponent("SkipForward",MI);class OT extends ki{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()&&n.seekableStart();let s;r&&t-this.skipTime<=r?s=r:t>=this.skipTime?s=t-this.skipTime:s=0,this.player_.currentTime(s)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}OT.prototype.controlText_="Skip Backward";j.registerComponent("SkipBackward",OT);class LT extends j{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",n=>this.handleKeyDown(n)),this.boundHandleBlur_=n=>this.handleBlur(n),this.boundHandleTapClick_=n=>this.handleTapClick(n)}addEventListenerForItem(e){e instanceof j&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof j&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=xe(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),Pi(t,"click",function(n){n.preventDefault(),n.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||K.activeElement;if(!this.children().some(n=>n.el()===t)){const n=this.menuButton_;n&&n.buttonPressed_&&t!==n.el().firstChild&&n.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(r=>r.el()===e.target)[0];if(!n)return;n.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){ge.isEventKey(e,"Left")||ge.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(ge.isEventKey(e,"Right")||ge.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}j.registerComponent("Menu",LT);class Sp extends j{constructor(e,t={}){super(e,t),this.menuButton_=new ki(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=ki.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const r=s=>this.handleClick(s);this.handleMenuKeyUp_=s=>this.handleMenuKeyUp(s),this.on(this.menuButton_,"tap",r),this.on(this.menuButton_,"click",r),this.on(this.menuButton_,"keydown",s=>this.handleKeyDown(s)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),Pi(K,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",s=>this.handleMouseLeave(s)),this.on("keydown",s=>this.handleSubmenuKeyDown(s))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new LT(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=xe("li",{className:"vjs-menu-title",textContent:st(this.options_.title),tabIndex:-1}),n=new j(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const t=ki.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),Ht(K,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){ge.isEventKey(e,"Esc")||ge.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),ge.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(ge.isEventKey(e,"Up")||ge.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(ge.isEventKey(e,"Esc")||ge.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(ge.isEventKey(e,"Esc")||ge.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),ge.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),ci&&Wv())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}j.registerComponent("MenuButton",Sp);class xp extends Sp{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const r=ze(this,this.update);n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),n.addEventListener("labelchange",r),this.player_.on("ready",r),this.player_.on("dispose",function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r),n.removeEventListener("labelchange",r)})}}j.registerComponent("TrackButton",xp);const FI=["Tab","Esc","Up","Down","Right","Left"];class tu extends Ic{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const r=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n);return r.replaceChild(xe("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),r.querySelector(".vjs-icon-placeholder")),r}handleKeyDown(e){FI.some(t=>ge.isEventKey(e,t))||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}j.registerComponent("MenuItem",tu);class iu extends tu{constructor(e,t){const n=t.track,r=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected=n.mode==="showing",super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const s=(...o)=>{this.handleTracksChange.apply(this,o)},a=(...o)=>{this.handleSelectedLanguageChange.apply(this,o)};if(e.on(["loadstart","texttrackchange"],s),r.addEventListener("change",s),r.addEventListener("selectedlanguagechange",a),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],s),r.removeEventListener("change",s),r.removeEventListener("selectedlanguagechange",a)}),r.onchange===void 0){let o;this.on(["tap","click"],function(){if(typeof I.Event!="object")try{o=new I.Event("change")}catch{}o||(o=K.createEvent("Event"),o.initEvent("change",!0,!0)),r.dispatchEvent(o)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),!!n)for(let r=0;r<n.length;r++){const s=n[r];this.kinds.indexOf(s.kind)!==-1&&(s===t?s.mode!=="showing"&&(s.mode="showing"):s.mode!=="disabled"&&(s.mode="disabled"))}}handleTracksChange(e){const t=this.track.mode==="showing";t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}j.registerComponent("TextTrackMenuItem",iu);class NT extends iu{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(this.options_.kinds.indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}j.registerComponent("OffTextTrackMenuItem",NT);class Ta extends xp{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=iu){let n;this.label_&&(n=`${this.label_} off`),e.push(new NT(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const r=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let s=0;s<r.length;s++){const a=r[s];if(this.kinds_.indexOf(a.kind)>-1){const o=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});o.addClass(`vjs-${a.kind}-menu-item`),e.push(o)}}return e}}j.registerComponent("TextTrackButton",Ta);class MT extends tu{constructor(e,t){const n=t.track,r=t.cue,s=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=r.text,t.selected=r.startTime<=s&&s<r.endTime,super(e,t),this.track=n,this.cue=r}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}j.registerComponent("ChaptersTrackMenuItem",MT);class Cp extends Ta{constructor(e,t,n){super(e,t,n),this.selectCurrentItem_=()=>{this.items.forEach(r=>{r.selected(this.track_.activeCues[0]===r.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(st(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,r=t.length;n<r;n++){const s=t[n],a=new MT(this.player_,{track:this.track_,cue:s});e.push(a)}return e}}Cp.prototype.kind_="chapters";Cp.prototype.controlText_="Chapters";j.registerComponent("ChaptersButton",Cp);class wp extends Ta{constructor(e,t,n){super(e,t,n);const r=e.textTracks(),s=ze(this,this.handleTracksChange);r.addEventListener("change",s),this.on("dispose",function(){r.removeEventListener("change",s)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(a.kind!==this.kind_&&a.mode==="showing"){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}wp.prototype.kind_="descriptions";wp.prototype.controlText_="Descriptions";j.registerComponent("DescriptionsButton",wp);class Ap extends Ta{constructor(e,t,n){super(e,t,n)}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}Ap.prototype.kind_="subtitles";Ap.prototype.controlText_="Subtitles";j.registerComponent("SubtitlesButton",Ap);class Dp extends iu{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}j.registerComponent("CaptionSettingsMenuItem",Dp);class Ip extends Ta{constructor(e,t,n){super(e,t,n)}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Dp(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}Ip.prototype.kind_="captions";Ip.prototype.controlText_="Captions";j.registerComponent("CaptionsButton",Ip);class FT extends iu{createEl(e,t,n){const r=super.createEl(e,t,n),s=r.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(s.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(xe("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),r}}j.registerComponent("SubsCapsMenuItem",FT);class kp extends Ta{constructor(e,t={}){super(e,t),this.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions"),this.menuButton_.controlText(st(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Dp(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,FT),e}}kp.prototype.kinds_=["captions","subtitles"];kp.prototype.controlText_="Subtitles";j.registerComponent("SubsCapsButton",kp);class BT extends tu{constructor(e,t){const n=t.track,r=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const s=(...a)=>{this.handleTracksChange.apply(this,a)};r.addEventListener("change",s),this.on("dispose",()=>{r.removeEventListener("change",s)})}createEl(e,t,n){const r=super.createEl(e,t,n),s=r.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="main-desc"&&(s.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(xe("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),r}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];r!==this.track&&(r.enabled=r===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}j.registerComponent("AudioTrackMenuItem",BT);class UT extends xp{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t)}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];e.push(new BT(this.player_,{track:r,selectable:!0,multiSelectable:!1}))}return e}}UT.prototype.controlText_="Audio Track";j.registerComponent("AudioTrackButton",UT);class Pp extends tu{constructor(e,t){const n=t.rate,r=parseFloat(n,10);t.label=n,t.selected=r===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=r,this.on(e,"ratechange",s=>this.update(s))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}Pp.prototype.contentElType="button";j.registerComponent("PlaybackRateMenuItem",Pp);class VT extends Sp{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",n=>this.updateVisibility(n)),this.on(e,"ratechange",n=>this.updateLabel(n)),this.on(e,"playbackrateschange",n=>this.handlePlaybackRateschange(n))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=xe("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new Pp(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}VT.prototype.controlText_="Playback Rate";j.registerComponent("PlaybackRateMenuButton",VT);class jT extends j{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}j.registerComponent("Spacer",jT);class BI extends jT{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:" "})}}j.registerComponent("CustomControlSpacer",BI);class Ml extends j{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}Ml.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]};"exitPictureInPicture"in K&&Ml.prototype.options_.children.splice(Ml.prototype.options_.children.length-1,0,"pictureInPictureToggle");j.registerComponent("ControlBar",Ml);class $T extends ya{constructor(e,t){super(e,t),this.on(e,"error",n=>this.open(n))}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}$T.prototype.options_=Object.assign({},ya.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});j.registerComponent("ErrorDisplay",$T);const Wh="vjs-text-track-settings",k0=["#000","Black"],P0=["#00F","Blue"],R0=["#0FF","Cyan"],O0=["#0F0","Green"],L0=["#F0F","Magenta"],N0=["#F00","Red"],M0=["#FFF","White"],F0=["#FF0","Yellow"],Kh=["1","Opaque"],Xh=["0.5","Semi-Transparent"],B0=["0","Transparent"],kr={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[k0,M0,N0,O0,P0,F0,L0,R0]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Kh,Xh,B0]},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[M0,k0,N0,O0,P0,F0,L0,R0]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:i=>i==="1.00"?null:Number(i)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Kh,Xh]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[B0,Xh,Kh]}};kr.windowColor.options=kr.backgroundColor.options;function qT(i,e){if(e&&(i=e(i)),i&&i!=="none")return i}function UI(i,e){const t=i.options[i.options.selectedIndex].value;return qT(t,e)}function VI(i,e,t){if(e){for(let n=0;n<i.options.length;n++)if(qT(i.options[n].value,t)===e){i.selectedIndex=n;break}}}class jI extends ya{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.endDialog=xe("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),t.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.on(this.$(".vjs-done-button"),"click",()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),"click",()=>{this.setDefaults(),this.updateDisplay()}),Ps(kr,n=>{this.on(this.$(n.selector),"change",this.updateDisplay)}),this.options_.persistTextTrackSettings&&this.restoreSettings()}dispose(){this.endDialog=null,super.dispose()}createElSelect_(e,t="",n="label"){const r=kr[e],s=r.id.replace("%s",this.id_),a=[t,s].join(" ").trim();return[`<${n} id="${s}" class="${n==="label"?"vjs-label":""}">`,this.localize(r.label),`</${n}>`,`<select aria-labelledby="${a}">`].concat(r.options.map(o=>{const u=s+"-"+o[1].replace(/\W+/g,"");return[`<option id="${u}" value="${o[0]}" `,`aria-labelledby="${a} ${u}">`,this.localize(o[1]),"</option>"].join("")})).concat("</select>").join("")}createElFgColor_(){const e=`captions-text-legend-${this.id_}`;return['<fieldset class="vjs-fg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text"),"</legend>",'<span class="vjs-text-color">',this.createElSelect_("color",e),"</span>",'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")}createElBgColor_(){const e=`captions-background-${this.id_}`;return['<fieldset class="vjs-bg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text Background"),"</legend>",'<span class="vjs-bg-color">',this.createElSelect_("backgroundColor",e),"</span>",'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")}createElWinColor_(){const e=`captions-window-${this.id_}`;return['<fieldset class="vjs-window vjs-track-setting">',`<legend id="${e}">`,this.localize("Caption Area Background"),"</legend>",'<span class="vjs-window-color">',this.createElSelect_("windowColor",e),"</span>",'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")}createElColors_(){return xe("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})}createElFont_(){return xe("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})}createElControls_(){const e=this.localize("restore all settings to the default values");return xe("div",{className:"vjs-track-settings-controls",innerHTML:[`<button type="button" class="vjs-default-button" title="${e}">`,this.localize("Reset"),`<span class="vjs-control-text"> ${e}</span>`,"</button>",`<button type="button" class="vjs-done-button">${this.localize("Done")}</button>`].join("")})}content(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return $v(kr,(e,t,n)=>{const r=UI(this.$(t.selector),t.parser);return r!==void 0&&(e[n]=r),e},{})}setValues(e){Ps(kr,(t,n)=>{VI(this.$(t.selector),e[n],t.parser)})}setDefaults(){Ps(kr,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(I.localStorage.getItem(Wh))}catch(t){Ie.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?I.localStorage.setItem(Wh,JSON.stringify(e)):I.localStorage.removeItem(Wh)}catch(t){Ie.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}conditionalBlur_(){this.previouslyActiveEl_=null;const e=this.player_.controlBar,t=e&&e.subsCapsButton,n=e&&e.captionsButton;t?t.focus():n&&n.focus()}handleLanguagechange(){this.fill()}}j.registerComponent("TextTrackSettings",jI);class $I extends j{constructor(e,t){let n=t.ResizeObserver||I.ResizeObserver;t.ResizeObserver===null&&(n=!1);const r=Ge({createEl:!n,reportTouchActivity:!1},t);super(e,r),this.ResizeObserver=t.ResizeObserver||I.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=uT(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const s=this.debouncedHandler_;let a=this.unloadListener_=function(){Ht(this,"resize",s),Ht(this,"unload",a),a=null};Pi(this.el_.contentWindow,"unload",a),Pi(this.el_.contentWindow,"resize",s)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}j.registerComponent("ResizeManager",$I);const qI={trackingThreshold:20,liveTolerance:15};class HI extends j{constructor(e,t){const n=Ge(qI,t,{createEl:!1});super(e,n),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=r=>this.handlePlay(r),this.handleFirstTimeupdate_=r=>this.handleFirstTimeupdate(r),this.handleSeeked_=r=>this.handleSeeked(r),this.seekToLiveEdge_=r=>this.seekToLiveEdge(r),this.reset_(),this.on(this.player_,"durationchange",r=>this.handleDurationchange(r)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(I.performance.now().toFixed(4)),n=this.lastTime_===-1?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const r=this.liveCurrentTime(),s=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(r-s)>this.options_.liveTolerance;(!this.timeupdateSeen_||r===1/0)&&(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,ji),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}j.registerComponent("LiveTracker",HI);class GI extends j{constructor(e,t){super(e,t),this.on("statechanged",n=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:xe("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${Cn()}`}),description:xe("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${Cn()}`})},xe("div",{className:"vjs-title-bar"},{},Object.values(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(r=>{const s=this.state[r],a=this.els[r],o=n[r];xc(a),s&&_r(a,s),t&&(t.removeAttribute(o),s&&t.setAttribute(o,a.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}j.registerComponent("TitleBar",GI);const jd=i=>{const e=i.el();if(e.hasAttribute("src"))return i.triggerSourceset(e.src),!0;const t=i.$$("source"),n=[];let r="";if(!t.length)return!1;for(let s=0;s<t.length;s++){const a=t[s].src;a&&n.indexOf(a)===-1&&n.push(a)}return n.length?(n.length===1&&(r=n[0]),i.triggerSourceset(r),!0):!1},zI=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(i){const e=K.createElement(this.nodeName.toLowerCase());e.innerHTML=i;const t=K.createDocumentFragment();for(;e.childNodes.length;)t.appendChild(e.childNodes[0]);return this.innerText="",I.Element.prototype.appendChild.call(this,t),this.innerHTML}}),HT=(i,e)=>{let t={};for(let n=0;n<i.length&&(t=Object.getOwnPropertyDescriptor(i[n],e),!(t&&t.set&&t.get));n++);return t.enumerable=!0,t.configurable=!0,t},WI=i=>HT([i.el(),I.HTMLMediaElement.prototype,I.Element.prototype,zI],"innerHTML"),U0=function(i){const e=i.el();if(e.resetSourceWatch_)return;const t={},n=WI(i),r=s=>(...a)=>{const o=s.apply(e,a);return jd(i),o};["append","appendChild","insertAdjacentHTML"].forEach(s=>{e[s]&&(t[s]=e[s],e[s]=r(t[s]))}),Object.defineProperty(e,"innerHTML",Ge(n,{set:r(n.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(t).forEach(s=>{e[s]=t[s]}),Object.defineProperty(e,"innerHTML",n)},i.one("sourceset",e.resetSourceWatch_)},KI=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?yT(I.Element.prototype.getAttribute.call(this,"src")):""},set(i){return I.Element.prototype.setAttribute.call(this,"src",i),i}}),XI=i=>HT([i.el(),I.HTMLMediaElement.prototype,KI],"src"),YI=function(i){if(!i.featuresSourceset)return;const e=i.el();if(e.resetSourceset_)return;const t=XI(i),n=e.setAttribute,r=e.load;Object.defineProperty(e,"src",Ge(t,{set:s=>{const a=t.set.call(e,s);return i.triggerSourceset(e.src),a}})),e.setAttribute=(s,a)=>{const o=n.call(e,s,a);return/src/i.test(s)&&i.triggerSourceset(e.src),o},e.load=()=>{const s=r.call(e);return jd(i)||(i.triggerSourceset(""),U0(i)),s},e.currentSrc?i.triggerSourceset(e.currentSrc):jd(i)||U0(i),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=r,e.setAttribute=n,Object.defineProperty(e,"src",t),e.resetSourceWatch_&&e.resetSourceWatch_()}};class te extends ve{constructor(e,t){super(e,t);const n=e.source;let r=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",n&&(this.el_.currentSrc!==n.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const s=this.el_.childNodes;let a=s.length;const o=[];for(;a--;){const u=s[a];u.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(u),this.remoteTextTracks().addTrack(u.track),this.textTracks().addTrack(u.track),!r&&!this.el_.hasAttribute("crossorigin")&&Dc(u.src)&&(r=!0)):o.push(u))}for(let u=0;u<o.length;u++)this.el_.removeChild(o[u])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&r&&Ie.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(Po||vc)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),te.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){YI(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let s=0;s<e.length;s++){const a=e[s];a.kind==="metadata"&&t.push({track:a,storedMode:a.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const r=()=>{for(let s=0;s<t.length;s++){const a=t[s];a.track.mode==="disabled"&&a.track.mode!==a.storedMode&&(a.track.mode=a.storedMode)}e.removeEventListener("change",r)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",r),e.addEventListener("change",r)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",r)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(r=>{this.el()[`${n}Tracks`].removeEventListener(r,this[`${n}TracksListeners_`][r])}),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=Vi[e],n=this.el()[t.getterName],r=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const s={change:o=>{const u={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(u),e==="text"&&this[na.remoteText.getterName]().trigger(u)},addtrack(o){r.addTrack(o.track)},removetrack(o){r.removeTrack(o.track)}},a=function(){const o=[];for(let u=0;u<r.length;u++){let c=!1;for(let h=0;h<n.length;h++)if(n[h]===r[u]){c=!0;break}c||o.push(r[u])}for(;o.length;)r.removeTrack(o.shift())};this[t.getterName+"Listeners_"]=s,Object.keys(s).forEach(o=>{const u=s[o];n.addEventListener(o,u),this.on("dispose",c=>n.removeEventListener(o,u))}),this.on("loadstart",a),this.on("dispose",o=>this.off("loadstart",a))}proxyNativeTracks_(){Vi.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const n=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(n,e),te.disposeMediaElement(e),e=n}else{e=K.createElement("video");const n=this.options_.tag&&nr(this.options_.tag),r=Ge({},n);(!Po||this.options_.nativeControlsForTouch!==!0)&&delete r.controls,Yv(e,Object.assign(r,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&Zs(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const r=t[n],s=this.options_[r];typeof s<"u"&&(s?Zs(e,r,r):Ec(e,r),e[r]=s)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let n=!1;const r=function(){n=!0};this.on("loadstart",r);const s=function(){n||this.trigger("loadstart")};this.on("loadedmetadata",s),this.ready(function(){this.off("loadstart",r),this.off("loadedmetadata",s),n||this.trigger("loadstart")});return}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(n){this.trigger(n)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&Tc?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){Ie(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&Sn&&xn&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)fn(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}reset(){te.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=K.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)(e===t[n]||e===t[n].track)&&this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),I.performance&&(e.creationTime=I.performance.now()),e}}gc(te,"TEST_VID",function(){if(!ma())return;const i=K.createElement("video"),e=K.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",i.appendChild(e),i});te.isSupported=function(){try{te.TEST_VID.volume=.5}catch{return!1}return!!(te.TEST_VID&&te.TEST_VID.canPlayType)};te.canPlayType=function(i){return te.TEST_VID.canPlayType(i)};te.canPlaySource=function(i,e){return te.canPlayType(i.type)};te.canControlVolume=function(){try{const i=te.TEST_VID.volume;te.TEST_VID.volume=i/2+.1;const e=i!==te.TEST_VID.volume;return e&&ci?(I.setTimeout(()=>{te&&te.prototype&&(te.prototype.featuresVolumeControl=i!==te.TEST_VID.volume)}),!1):e}catch{return!1}};te.canMuteVolume=function(){try{const i=te.TEST_VID.muted;return te.TEST_VID.muted=!i,te.TEST_VID.muted?Zs(te.TEST_VID,"muted","muted"):Ec(te.TEST_VID,"muted","muted"),i!==te.TEST_VID.muted}catch{return!1}};te.canControlPlaybackRate=function(){if(Sn&&xn&&_c<58)return!1;try{const i=te.TEST_VID.playbackRate;return te.TEST_VID.playbackRate=i/2+.1,i!==te.TEST_VID.playbackRate}catch{return!1}};te.canOverrideAttributes=function(){try{const i=()=>{};Object.defineProperty(K.createElement("video"),"src",{get:i,set:i}),Object.defineProperty(K.createElement("audio"),"src",{get:i,set:i}),Object.defineProperty(K.createElement("video"),"innerHTML",{get:i,set:i}),Object.defineProperty(K.createElement("audio"),"innerHTML",{get:i,set:i})}catch{return!1}return!0};te.supportsNativeTextTracks=function(){return Tc||ci&&xn};te.supportsNativeVideoTracks=function(){return!!(te.TEST_VID&&te.TEST_VID.videoTracks)};te.supportsNativeAudioTracks=function(){return!!(te.TEST_VID&&te.TEST_VID.audioTracks)};te.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([i,e]){gc(te.prototype,i,()=>te[e](),!0)});te.prototype.featuresVolumeControl=te.canControlVolume();te.prototype.movingMediaElementInDOM=!ci;te.prototype.featuresFullscreenResize=!0;te.prototype.featuresProgressEvents=!0;te.prototype.featuresTimeupdateEvents=!0;te.prototype.featuresVideoFrameCallback=!!(te.TEST_VID&&te.TEST_VID.requestVideoFrameCallback);te.disposeMediaElement=function(i){if(i){for(i.parentNode&&i.parentNode.removeChild(i);i.hasChildNodes();)i.removeChild(i.firstChild);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()}};te.resetMediaElement=function(i){if(!i)return;const e=i.querySelectorAll("source");let t=e.length;for(;t--;)i.removeChild(e[t]);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(i){te.prototype[i]=function(){return this.el_[i]||this.el_.hasAttribute(i)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(i){te.prototype["set"+st(i)]=function(e){this.el_[i]=e,e?this.el_.setAttribute(i,i):this.el_.removeAttribute(i)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(i){te.prototype[i]=function(){return this.el_[i]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(i){te.prototype["set"+st(i)]=function(e){this.el_[i]=e}});["pause","load","play"].forEach(function(i){te.prototype[i]=function(){return this.el_[i]()}});ve.withSourceHandlers(te);te.nativeSourceHandler={};te.nativeSourceHandler.canPlayType=function(i){try{return te.TEST_VID.canPlayType(i)}catch{return""}};te.nativeSourceHandler.canHandleSource=function(i,e){if(i.type)return te.nativeSourceHandler.canPlayType(i.type);if(i.src){const t=mp(i.src);return te.nativeSourceHandler.canPlayType(`video/${t}`)}return""};te.nativeSourceHandler.handleSource=function(i,e,t){e.setSrc(i.src)};te.nativeSourceHandler.dispose=function(){};te.registerSourceHandler(te.nativeSourceHandler);ve.registerTech("Html5",te);const GT=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Yh={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},$d=["tiny","xsmall","small","medium","large","xlarge","huge"],ul={};$d.forEach(i=>{const e=i.charAt(0)==="x"?`x-${i.substring(1)}`:i;ul[i]=`vjs-layout-${e}`});const QI={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};let _t=class bs extends j{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${Cn()}`,t=Object.assign(bs.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const a=e.closest("[lang]");a&&(t.language=a.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=a=>this.documentFullscreenChange_(a),this.boundFullWindowOnEscKey_=a=>this.fullWindowOnEscKey(a),this.boundUpdateStyleEl_=a=>this.updateStyleEl_(a),this.boundApplyInitTime_=a=>this.applyInitTime_(a),this.boundUpdateCurrentBreakpoint_=a=>this.updateCurrentBreakpoint_(a),this.boundHandleTechClick_=a=>this.handleTechClick_(a),this.boundHandleTechDoubleClick_=a=>this.handleTechDoubleClick_(a),this.boundHandleTechTouchStart_=a=>this.handleTechTouchStart_(a),this.boundHandleTechTouchMove_=a=>this.handleTechTouchMove_(a),this.boundHandleTechTouchEnd_=a=>this.handleTechTouchEnd_(a),this.boundHandleTechTap_=a=>this.handleTechTap_(a),this.isFullscreen_=!1,this.log=Vv(this.id_),this.fsApi_=Il,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&nr(e),this.language(this.options_.language),t.languages){const a={};Object.getOwnPropertyNames(t.languages).forEach(function(o){a[o.toLowerCase()]=t.languages[o]}),this.languages_=a}else this.languages_=bs.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(a=>{if(typeof this[a]!="function")throw new Error(`plugin "${a}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),hp(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(Pi(K,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=Ge(this.options_);t.plugins&&Object.keys(t.plugins).forEach(a=>{this[a](t.plugins[a])}),t.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(t.playbackRates),this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),Po&&this.addClass("vjs-touch-enabled"),ci||this.addClass("vjs-workinghover"),bs.players[this.id_]=this;const s=Fv.split(".")[0];this.addClass(`vjs-v${s}`),this.userActive(!0),this.reportUserActivity(),this.one("play",a=>this.listenForUserActivity_(a)),this.on("keydown",a=>this.handleKeyDown(a)),this.on("languagechange",a=>this.handleLanguagechange(a)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),Ht(K,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Ht(K,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),bs.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),yI(this),ni.names.forEach(e=>{const t=ni[e],n=this[t.getterName]();n&&n.off&&n.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,t,n=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const r=this.tag.tagName.toLowerCase()==="video-js";n?t=this.el_=e.parentNode:r||(t=this.el_=super.createEl("div"));const s=nr(e);if(r){for(t=this.el_=e,e=this.tag=K.createElement("video");t.children.length;)e.appendChild(t.firstChild);fo(t,"video-js")||Br(t,"video-js"),t.appendChild(e),n=this.playerElIngest_=t,Object.keys(t).forEach(o=>{try{e[o]=t[o]}catch{}})}if(e.setAttribute("tabindex","-1"),s.tabindex="-1",xn&&yc&&(e.setAttribute("role","application"),s.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(o){r&&o==="class"||t.setAttribute(o,s[o]),r&&e.setAttribute(o,s[o])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused"),I.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=aT("vjs-styles-dimensions");const o=cr(".vjs-styles-defaults"),u=cr("head");u.insertBefore(this.styleEl_,o?o.nextSibling:u.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const a=e.getElementsByTagName("a");for(let o=0;o<a.length;o++){const u=a.item(o);Br(u,"vjs-hidden"),u.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!n&&e.parentNode.insertBefore(t,e),Od(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){Ie.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(t===void 0)return this[n]||0;if(t===""||t==="auto"){this[n]=void 0,this.updateStyleEl_();return}const r=parseFloat(t);if(isNaN(r)){Ie.error(`Improper value "${t}" supplied for for ${e}`);return}this[n]=r,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,Fn(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),KD(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(I.VIDEOJS_NO_DYNAMIC_STYLE===!0){const o=typeof this.width_=="number"?this.width_:this.options_.width,u=typeof this.height_=="number"?this.height_:this.options_.height,c=this.tech_&&this.tech_.el();c&&(o>=0&&(c.width=o),u>=0&&(c.height=u));return}let e,t,n,r;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?n=this.aspectRatio_:this.videoWidth()>0?n=this.videoWidth()+":"+this.videoHeight():n="16:9";const s=n.split(":"),a=s[1]/s[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/a:e=this.videoWidth()||300,this.height_!==void 0?t=this.height_:t=e*a,/^[^a-zA-Z]/.test(this.id())?r="dimensions-"+this.id():r=this.id()+"-dimensions",this.addClass(r),oT(this.styleEl_,`
      .${r} {
        width: ${e}px;
        height: ${t}px;
      }

      .${r}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${a*100}%;
      }
    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=st(e),r=e.charAt(0).toLowerCase()+e.slice(1);n!=="Html5"&&this.tag&&(ve.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let s=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(s=!1);const a={source:t,autoplay:s,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${r}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};ni.names.forEach(u=>{const c=ni[u];a[c.getterName]=this[c.privateName]}),Object.assign(a,this.options_[n]),Object.assign(a,this.options_[r]),Object.assign(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);const o=ve.getTech(e);if(!o)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new o(a),this.tech_.ready(ze(this,this.handleTechReady_),!0),b0.jsonToTextTracks(this.textTracksJson_||[],this.tech_),GT.forEach(u=>{this.on(this.tech_,u,c=>this[`handleTech${st(u)}_`](c))}),Object.keys(Yh).forEach(u=>{this.on(this.tech_,u,c=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${Yh[u]}_`].bind(this),event:c});return}this[`handleTech${Yh[u]}_`](c)})}),this.on(this.tech_,"loadstart",u=>this.handleTechLoadStart_(u)),this.on(this.tech_,"sourceset",u=>this.handleTechSourceset_(u)),this.on(this.tech_,"waiting",u=>this.handleTechWaiting_(u)),this.on(this.tech_,"ended",u=>this.handleTechEnded_(u)),this.on(this.tech_,"seeking",u=>this.handleTechSeeking_(u)),this.on(this.tech_,"play",u=>this.handleTechPlay_(u)),this.on(this.tech_,"pause",u=>this.handleTechPause_(u)),this.on(this.tech_,"durationchange",u=>this.handleTechDurationChange_(u)),this.on(this.tech_,"fullscreenchange",(u,c)=>this.handleTechFullscreenChange_(u,c)),this.on(this.tech_,"fullscreenerror",(u,c)=>this.handleTechFullscreenError_(u,c)),this.on(this.tech_,"enterpictureinpicture",u=>this.handleTechEnterPictureInPicture_(u)),this.on(this.tech_,"leavepictureinpicture",u=>this.handleTechLeavePictureInPicture_(u)),this.on(this.tech_,"error",u=>this.handleTechError_(u)),this.on(this.tech_,"posterchange",u=>this.handleTechPosterChange_(u)),this.on(this.tech_,"textdata",u=>this.handleTechTextData_(u)),this.on(this.tech_,"ratechange",u=>this.handleTechRateChange_(u)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(n!=="Html5"||!this.tag)&&Od(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){ni.names.forEach(e=>{const t=ni[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=b0.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&Ie.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const t=()=>{const r=this.muted();this.muted(!0);const s=()=>{this.muted(r)};this.playTerminatedQueue_.push(s);const a=this.play();if(mo(a))return a.catch(o=>{throw s(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${o||""}`)})};let n;if(e==="any"&&!this.muted()?(n=this.play(),mo(n)&&(n=n.catch(t))):e==="muted"&&!this.muted()?n=t():n=this.play(),!!mo(n))return n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let t=e,n="";typeof t!="string"&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=bI(this,t)),this.cache_.source=Ge({},e,{src:t,type:n});const r=this.cache_.sources.filter(u=>u.src&&u.src===t),s=[],a=this.$$("source"),o=[];for(let u=0;u<a.length;u++){const c=nr(a[u]);s.push(c),c.src&&c.src===t&&o.push(c.src)}o.length&&!r.length?this.cache_.sources=s:r.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=s=>this.updateSourceCaches_(s);const n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(t=()=>{}),t(r),e.src||this.tech_.any(["sourceset","loadstart"],s=>{if(s.type==="sourceset")return;const a=this.techGet("currentSrc");this.lastSource_.tech=a,this.updateSourceCaches_(a)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?fn(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),n=>n.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let r=K[this.fsApi_.fullscreenElement]===n;!r&&n.matches?r=n.matches(":"+this.fsApi_.fullscreen):!r&&n.msMatchesSelector&&(r=n.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in gI)return pI(this.middleware_,this.tech_,e,t);if(e in w0)return C0(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(n){throw Ie(n),n}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in mI)return fI(this.middleware_,this.tech_,e);if(e in w0)return C0(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw this.tech_[e]===void 0?(Ie(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t):t.name==="TypeError"?(Ie(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t):(Ie(t),t)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=fn){this.playCallbacks_.push(e);const t=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),n=!!(Tc||ci);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t){this.waitToPlay_=a=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!t&&n&&this.load();return}const r=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),r===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(r)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(n){n(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||bn(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(typeof e<"u"){if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0;return}return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=bn(0,0)),e}bufferedPercent(){return gT(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;if(e!==void 0){t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),t>0&&this.lastVolume_(t);return}return t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const t=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,r)=>{function s(){t.off("fullscreenerror",o),t.off("fullscreenchange",a)}function a(){s(),n()}function o(c,h){s(),r(h)}t.one("fullscreenchange",a),t.one("fullscreenerror",o);const u=t.requestFullscreenHelper_(e);u&&(u.then(s,s),u.then(n,r))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(t=e)),this.fsApi_.requestFullscreen){const n=this.el_[this.fsApi_.requestFullscreen](t);return n&&n.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),n}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function r(){e.off("fullscreenerror",a),e.off("fullscreenchange",s)}function s(){r(),t()}function a(u,c){r(),n(c)}e.one("fullscreenchange",s),e.one("fullscreenerror",a);const o=e.exitFullscreenHelper_();o&&(o.then(r,r),o.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=K[this.fsApi_.exitFullscreen]();return e&&fn(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=K.documentElement.style.overflow,Pi(K,"keydown",this.boundFullWindowOnEscKey_),K.documentElement.style.overflow="hidden",Br(K.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){ge.isEventKey(e,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,Ht(K,"keydown",this.boundFullWindowOnEscKey_),K.documentElement.style.overflow=this.docOrigOverflow,bc(K.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&I.documentPictureInPicture){const e=K.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(xe("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),I.documentPictureInPicture.requestWindow({initialAspectRatio:this.videoWidth()/this.videoHeight(),copyStyleSheets:!0}).then(t=>(this.el_.parentNode.insertBefore(e,this.el_),t.document.body.append(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger("enterpictureinpicture"),t.addEventListener("unload",n=>{const r=n.target.querySelector(".video-js");e.replaceWith(r),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in K&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if(I.documentPictureInPicture&&I.documentPictureInPicture.window)return I.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in K)return K.exitPictureInPicture()}handleKeyDown(e){const{userActions:t}=this.options_;!t||!t.hotkeys||(r=>{const s=r.tagName.toLowerCase();if(r.isContentEditable)return!0;const a=["button","checkbox","hidden","radio","reset","submit"];return s==="input"?a.indexOf(r.type)===-1:["textarea"].indexOf(s)!==-1})(this.el_.ownerDocument.activeElement)||(typeof t.hotkeys=="function"?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=a=>ge.isEventKey(a,"f"),muteKey:r=a=>ge.isEventKey(a,"m"),playPauseKey:s=a=>ge.isEventKey(a,"k")||ge.isEventKey(a,"Space")}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const a=j.getComponent("FullscreenToggle");K[this.fsApi_.fullscreenEnabled]!==!1&&a.prototype.handleClick.call(this,e)}else r.call(this,e)?(e.preventDefault(),e.stopPropagation(),j.getComponent("MuteToggle").prototype.handleClick.call(this,e)):s.call(this,e)&&(e.preventDefault(),e.stopPropagation(),j.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let n=0,r=this.options_.techOrder;n<r.length;n++){const s=r[n];let a=ve.getTech(s);if(a||(a=j.getComponent(s)),!a){Ie.error(`The "${s}" tech is undefined. Skipped browser support check for that tech.`);continue}if(a.isSupported()&&(t=a.canPlayType(e),t))return t}return""}selectSource(e){const t=this.options_.techOrder.map(o=>[o,ve.getTech(o)]).filter(([o,u])=>u?u.isSupported():(Ie.error(`The "${o}" tech is undefined. Skipped browser support check for that tech.`),!1)),n=function(o,u,c){let h;return o.some(g=>u.some(y=>{if(h=c(g,y),h)return!0})),h};let r;const s=o=>(u,c)=>o(c,u),a=([o,u],c)=>{if(u.canPlaySource(c,this.options_[o.toLowerCase()]))return{source:c,tech:o}};return this.options_.sourceOrder?r=n(e,t,s(a)):r=n(t,e,a),r||!1}handleSrc_(e,t){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=bT(e);if(!n.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),hI(this,n[0],(r,s)=>{if(this.middleware_=s,t||(this.cache_.sources=n),this.updateSourceCaches_(r),this.src_(r)){if(n.length>1)return this.handleSrc_(n.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}dI(s,this.tech_)}),n.length>1){const r=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},s=()=>{this.off("error",r)};this.one("error",r),this.one("playing",s),this.resetRetryOnError_=()=>{this.off("error",r),this.off("playing",s)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return t?dT(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}load(){this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();fn(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Fn(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:r}=this.controlBar||{},{seekBar:s}=n||{};e&&e.updateContent(),t&&t.updateContent(),r&&r.updateContent(),s&&(s.update(),s.loadProgressBar&&s.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return Object.keys(e).length!==0&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let t;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),t=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return e!==void 0?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(lr("beforeerror").forEach(t=>{const n=t(this,e);if(!(En(n)&&!Array.isArray(n)||typeof n=="string"||typeof n=="number"||n===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=n}),this.options_.suppressNotSupportedError&&e&&e.code===4){const t=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),this.one("loadstart",function(){this.off(["click","touchstart"],t)});return}if(e===null){this.error_=e,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new ai(e),this.addClass("vjs-error"),Ie.error(`(CODE:${this.error_.code} ${ai.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),lr("error").forEach(t=>t(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const r=ze(this,this.reportUserActivity),s=function(h){(h.screenX!==t||h.screenY!==n)&&(t=h.screenX,n=h.screenY,r())},a=function(){r(),this.clearInterval(e),e=this.setInterval(r,250)},o=function(h){r(),this.clearInterval(e)};this.on("mousedown",a),this.on("mousemove",s),this.on("mouseup",o),this.on("mouseleave",o);const u=this.getChild("controlBar");u&&!ci&&!Sn&&(u.on("mouseenter",function(h){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),u.on("mouseleave",function(h){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",r),this.on("keyup",r);let c;this.setInterval(function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(c);const h=this.options_.inactivityTimeout;h<=0||(c=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},h))},250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(r=>{r!==t&&r.el_&&!r.hasClass("vjs-hidden")&&(r.hide(),this.audioOnlyCache_.hiddenChildren.push(r))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const t=[];return this.isInPictureInPicture()&&t.push(this.exitPictureInPicture()),this.isFullscreen()&&t.push(this.exitFullscreen()),this.audioPosterMode()&&t.push(this.audioPosterMode(!1)),Promise.all(t).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Fn(this)&&this.trigger("languagechange"))}languages(){return Ge(bs.prototype.options_.languages,this.languages_)}toJSON(){const e=Ge(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let r=t[n];r=Ge(r),r.player=void 0,e.tracks[n]=r}return e}createModal(e,t){t=t||{},t.content=e||"";const n=new ya(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<$d.length;n++){const r=$d[n],s=this.breakpoints_[r];if(t<=s){if(e===r)return;e&&this.removeClass(ul[e]),this.addClass(ul[r]),this.breakpoint_=r;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},QI,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=!!e;const t=this.responsive_;if(e!==t)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return ul[this.breakpoint_]||""}loadMedia(e,t){if(!e||typeof e!="object")return;this.reset(),this.cache_.media=Ge(e);const{artist:n,artwork:r,description:s,poster:a,src:o,textTracks:u,title:c}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:Nl(a)}]),o&&this.src(o),a&&this.poster(a),Array.isArray(u)&&u.forEach(h=>this.addRemoteTextTrack(h,!1)),this.titleBar&&this.titleBar.update({title:c,description:s||n||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),n=Array.prototype.map.call(this.remoteTextTracks(),s=>({kind:s.kind,label:s.label,language:s.language,src:s.src})),r={src:t,textTracks:n};return e&&(r.poster=e,r.artwork=[{src:r.poster,type:Nl(r.poster)}]),r}return Ge(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=nr(e),r=n["data-setup"];if(fo(e,"vjs-fill")&&(n.fill=!0),fo(e,"vjs-fluid")&&(n.fluid=!0),r!==null){const[s,a]=LC(r||"{}");s&&Ie.error(s),Object.assign(n,a)}if(Object.assign(t,n),e.hasChildNodes()){const s=e.childNodes;for(let a=0,o=s.length;a<o;a++){const u=s[a],c=u.nodeName.toLowerCase();c==="source"?t.sources.push(nr(u)):c==="track"&&t.tracks.push(nr(u))}}return t}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(t=>typeof t=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}};ni.names.forEach(function(i){const e=ni[i];_t.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}});_t.prototype.crossorigin=_t.prototype.crossOrigin;_t.players={};const Qa=I.navigator;_t.prototype.options_={techOrder:ve.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Qa&&(Qa.languages&&Qa.languages[0]||Qa.userLanguage||Qa.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1};["ended","seeking","seekable","networkState","readyState"].forEach(function(i){_t.prototype[i]=function(){return this.techGet_(i)}});GT.forEach(function(i){_t.prototype[`handleTech${st(i)}_`]=function(){return this.trigger(i)}});j.registerComponent("Player",_t);const Fl="plugin",Ls="activePlugins_",Cs={},Bl=i=>Cs.hasOwnProperty(i),ll=i=>Bl(i)?Cs[i]:void 0,zT=(i,e)=>{i[Ls]=i[Ls]||{},i[Ls][e]=!0},Ul=(i,e,t)=>{const n=(t?"before":"")+"pluginsetup";i.trigger(n,e),i.trigger(n+":"+e.name,e)},JI=function(i,e){const t=function(){Ul(this,{name:i,plugin:e,instance:null},!0);const n=e.apply(this,arguments);return zT(this,i),Ul(this,{name:i,plugin:e,instance:n}),n};return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},V0=(i,e)=>(e.prototype.name=i,function(...t){Ul(this,{name:i,plugin:e,instance:null},!0);const n=new e(this,...t);return this[i]=()=>n,Ul(this,n.getEventHash()),n});class Ti{constructor(e){if(this.constructor===Ti)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),hp(this),delete this.trigger,hT(this,this.constructor.defaultState),zT(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return _a(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[Ls][e]=!1,this.player=this.state=null,t[e]=V0(e,Cs[e])}static isBasic(e){const t=typeof e=="string"?ll(e):e;return typeof t=="function"&&!Ti.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(Bl(e))Ie.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(_t.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof t!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return Cs[e]=t,e!==Fl&&(Ti.isBasic(t)?_t.prototype[e]=JI(e,t):_t.prototype[e]=V0(e,t)),t}static deregisterPlugin(e){if(e===Fl)throw new Error("Cannot de-register base plugin.");Bl(e)&&(delete Cs[e],delete _t.prototype[e])}static getPlugins(e=Object.keys(Cs)){let t;return e.forEach(n=>{const r=ll(n);r&&(t=t||{},t[n]=r)}),t}static getPluginVersion(e){const t=ll(e);return t&&t.VERSION||""}}Ti.getPlugin=ll;Ti.BASE_PLUGIN_NAME=Fl;Ti.registerPlugin(Fl,Ti);_t.prototype.usingPlugin=function(i){return!!this[Ls]&&this[Ls][i]===!0};_t.prototype.hasPlugin=function(i){return!!Bl(i)};function ZI(i,e){let t=!1;return function(...n){return t||Ie.warn(i),t=!0,e.apply(this,n)}}function Zi(i,e,t,n){return ZI(`${e} is deprecated and will be removed in ${i}.0; please use ${t} instead.`,n)}const WT=i=>i.indexOf("#")===0?i.slice(1):i;function F(i,e,t){let n=F.getPlayer(i);if(n)return e&&Ie.warn(`Player "${i}" is already initialised. Options will not be applied.`),t&&n.ready(t),n;const r=typeof i=="string"?cr("#"+WT(i)):i;if(!ga(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!r.ownerDocument.defaultView||!r.ownerDocument.body.contains(r))&&Ie.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(r.parentNode&&r.parentNode.hasAttribute("data-vjs-player")?r.parentNode:r).cloneNode(!0)),lr("beforesetup").forEach(a=>{const o=a(r,Ge(e));if(!En(o)||Array.isArray(o)){Ie.error("please return an object in beforesetup hooks");return}e=Ge(e,o)});const s=j.getComponent("Player");return n=new s(r,e,t),lr("setup").forEach(a=>a(n)),n}F.hooks_=Rn;F.hooks=lr;F.hook=LD;F.hookOnce=ND;F.removeHook=Bv;if(I.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&ma()){let i=cr(".vjs-styles-defaults");if(!i){i=aT("vjs-styles-defaults");const e=cr("head");e&&e.insertBefore(i,e.firstChild),oT(i,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}Nd(1,F);F.VERSION=Fv;F.options=_t.prototype.options_;F.getPlayers=()=>_t.players;F.getPlayer=i=>{const e=_t.players;let t;if(typeof i=="string"){const n=WT(i),r=e[n];if(r)return r;t=cr("#"+n)}else t=i;if(ga(t)){const{player:n,playerId:r}=t;if(n||e[r])return n||e[r]}};F.getAllPlayers=()=>Object.keys(_t.players).map(i=>_t.players[i]).filter(Boolean);F.players=_t.players;F.getComponent=j.getComponent;F.registerComponent=(i,e)=>{ve.isTech(e)&&Ie.warn(`The ${i} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),j.registerComponent.call(j,i,e)};F.getTech=ve.getTech;F.registerTech=ve.registerTech;F.use=cI;Object.defineProperty(F,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(F.middleware,"TERMINATOR",{value:Ll,writeable:!1,enumerable:!0});F.browser=UD;F.obj=BD;F.mergeOptions=Zi(9,"videojs.mergeOptions","videojs.obj.merge",Ge);F.defineLazyProperty=Zi(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",gc);F.bind=Zi(9,"videojs.bind","native Function.prototype.bind",ze);F.registerPlugin=Ti.registerPlugin;F.deregisterPlugin=Ti.deregisterPlugin;F.plugin=(i,e)=>(Ie.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Ti.registerPlugin(i,e));F.getPlugins=Ti.getPlugins;F.getPlugin=Ti.getPlugin;F.getPluginVersion=Ti.getPluginVersion;F.addLanguage=function(i,e){return i=(""+i).toLowerCase(),F.options.languages=Ge(F.options.languages,{[i]:e}),F.options.languages[i]};F.log=Ie;F.createLogger=Vv;F.time=ZD;F.createTimeRange=Zi(9,"videojs.createTimeRange","videojs.time.createTimeRanges",bn);F.createTimeRanges=Zi(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",bn);F.formatTime=Zi(9,"videojs.formatTime","videojs.time.formatTime",zr);F.setFormatTime=Zi(9,"videojs.setFormatTime","videojs.time.setFormatTime",pT);F.resetFormatTime=Zi(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",mT);F.parseUrl=Zi(9,"videojs.parseUrl","videojs.url.parseUrl",pp);F.isCrossOrigin=Zi(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Dc);F.EventTarget=$i;F.any=cp;F.on=Pi;F.one=wc;F.off=Ht;F.trigger=_a;F.xhr=jy;F.TextTrack=Zo;F.AudioTrack=vT;F.VideoTrack=TT;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(i=>{F[i]=function(){return Ie.warn(`videojs.${i}() is deprecated; use videojs.dom.${i}() instead`),rT[i].apply(null,arguments)}});F.computedStyle=Zi(9,"videojs.computedStyle","videojs.dom.computedStyle",ta);F.dom=rT;F.fn=WD;F.num=II;F.str=QD;F.url=uI;/*! @name videojs-contrib-quality-levels @version 3.0.0 @license Apache-2.0 */class ek{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get(){return t.enabled_()},set(n){t.enabled_(n)}}),t}}class Vl extends F.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new ek(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const r=this[t];if(r.id===e)return r}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}Vl.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const i in Vl.prototype.allowedEvents_)Vl.prototype["on"+i]=null;var KT="3.0.0";const tk=F.registerPlugin||F.plugin,ik=function(i,e){const t=i.qualityLevels,n=new Vl,r=function(){n.dispose(),i.qualityLevels=t,i.off("dispose",r)};return i.on("dispose",r),i.qualityLevels=()=>n,i.qualityLevels.VERSION=KT,n},XT=function(i){return ik(this,F.mergeOptions({},i))};tk("qualityLevels",XT);XT.VERSION=KT;/*! @name @videojs/http-streaming @version 3.0.2 @license Apache-2.0 */const Ki=xw,jl=(i,e)=>e&&e.responseURL&&i!==e.responseURL?e.responseURL:i,en=i=>F.log.debug?F.log.debug.bind(F,"VHS:",`${i} >`):function(){};function We(...i){const e=F.obj||F;return(e.merge||e.mergeOptions).apply(e,i)}function qt(...i){const e=F.time||F;return(e.createTimeRanges||e.createTimeRanges).apply(e,i)}const hr=1/30,pn=hr*3,YT=function(i,e){const t=[];let n;if(i&&i.length)for(n=0;n<i.length;n++)e(i.start(n),i.end(n))&&t.push([i.start(n),i.end(n)]);return qt(t)},ws=function(i,e){return YT(i,function(t,n){return t-pn<=e&&n+pn>=e})},qu=function(i,e){return YT(i,function(t){return t-hr>=e})},nk=function(i){if(i.length<2)return qt();const e=[];for(let t=1;t<i.length;t++){const n=i.end(t-1),r=i.start(t);e.push([n,r])}return qt(e)},rk=function(i,e){let t=null,n=null,r=0;const s=[],a=[];if(!i||!i.length||!e||!e.length)return qt();let o=i.length;for(;o--;)s.push({time:i.start(o),type:"start"}),s.push({time:i.end(o),type:"end"});for(o=e.length;o--;)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});for(s.sort(function(u,c){return u.time-c.time}),o=0;o<s.length;o++)s[o].type==="start"?(r++,r===2&&(t=s[o].time)):s[o].type==="end"&&(r--,r===1&&(n=s[o].time)),t!==null&&n!==null&&(a.push([t,n]),t=null,n=null);return qt(a)},QT=i=>{const e=[];if(!i||!i.length)return"";for(let t=0;t<i.length;t++)e.push(i.start(t)+" => "+i.end(t));return e.join(", ")},sk=function(i,e,t=1){return((i.length?i.end(i.length-1):0)-e)/t},Or=i=>{const e=[];for(let t=0;t<i.length;t++)e.push({start:i.start(t),end:i.end(t)});return e},ak=function(i,e){if(i===e)return!1;if(!i&&e||!e&&i||i.length!==e.length)return!0;for(let t=0;t<i.length;t++)if(i.start(t)!==e.start(t)||i.end(t)!==e.end(t))return!0;return!1},j0=function(i){if(!(!i||!i.length||!i.end))return i.end(i.length-1)},Rp=function(i,e){let t=0;if(!i||!i.length)return t;for(let n=0;n<i.length;n++){const r=i.start(n),s=i.end(n);if(!(e>s)){if(e>r&&e<=s){t+=s-e;continue}t+=s-r}}return t},Op=(i,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(n){t+=n.duration}),(e.preloadHints||[]).forEach(function(n){n.type==="PART"&&(t+=i.partTargetDuration)}),t},qd=i=>(i.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(r,s){e.push({duration:r.duration,segmentIndex:n,partIndex:s,part:r,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),JT=i=>{const e=i.segments&&i.segments.length&&i.segments[i.segments.length-1];return e&&e.parts||[]},ZT=({preloadSegment:i})=>{if(!i)return;const{parts:e,preloadHints:t}=i;let n=(t||[]).reduce((r,s)=>r+(s.type==="PART"?1:0),0);return n+=e&&e.length?e.length:0,n},eb=(i,e)=>{if(e.endList)return 0;if(i&&i.suggestedPresentationDelay)return i.suggestedPresentationDelay;const t=JT(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},ok=function(i,e){let t=0,n=e-i.mediaSequence,r=i.segments[n];if(r){if(typeof r.start<"u")return{result:r.start,precise:!0};if(typeof r.end<"u")return{result:r.end-r.duration,precise:!0}}for(;n--;){if(r=i.segments[n],typeof r.end<"u")return{result:t+r.end,precise:!0};if(t+=Op(i,r),typeof r.start<"u")return{result:t+r.start,precise:!0}}return{result:t,precise:!1}},uk=function(i,e){let t=0,n,r=e-i.mediaSequence;for(;r<i.segments.length;r++){if(n=i.segments[r],typeof n.start<"u")return{result:n.start-t,precise:!0};if(t+=Op(i,n),typeof n.end<"u")return{result:n.end-t,precise:!0}}return{result:-1,precise:!1}},tb=function(i,e,t){if(typeof e>"u"&&(e=i.mediaSequence+i.segments.length),e<i.mediaSequence)return 0;const n=ok(i,e);if(n.precise)return n.result;const r=uk(i,e);return r.precise?r.result:n.result+t},ib=function(i,e,t){if(!i)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(i.totalDuration)return i.totalDuration;if(!i.endList)return I.Infinity}return tb(i,e,t)},go=function({defaultDuration:i,durationList:e,startIndex:t,endIndex:n}){let r=0;if(t>n&&([t,n]=[n,t]),t<0){for(let s=t;s<Math.min(0,n);s++)r+=i;t=0}for(let s=t;s<n;s++)r+=e[s].duration;return r},nb=function(i,e,t,n){if(!i||!i.segments)return null;if(i.endList)return ib(i);if(e===null)return null;e=e||0;let r=tb(i,i.mediaSequence+i.segments.length,e);return t&&(n=typeof n=="number"?n:eb(null,i),r-=n),Math.max(0,r)},lk=function(i,e,t){const r=e||0,s=nb(i,e,!0,t);return s===null?qt():qt(r,s)},ck=function({playlist:i,currentTime:e,startingSegmentIndex:t,startingPartIndex:n,startTime:r,exactManifestTimings:s}){let a=e-r;const o=qd(i);let u=0;for(let c=0;c<o.length;c++){const h=o[c];if(t===h.segmentIndex&&!(typeof n=="number"&&typeof h.partIndex=="number"&&n!==h.partIndex)){u=c;break}}if(a<0){if(u>0)for(let c=u-1;c>=0;c--){const h=o[c];if(a+=h.duration,s){if(a<0)continue}else if(a+hr<=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:r-go({defaultDuration:i.targetDuration,durationList:o,startIndex:u,endIndex:c})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e}}if(u<0){for(let c=u;c<0;c++)if(a-=i.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e};u=0}for(let c=u;c<o.length;c++){const h=o[c];if(a-=h.duration,s){if(a>0)continue}else if(a-hr>=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:r+go({defaultDuration:i.targetDuration,durationList:o,startIndex:u,endIndex:c})}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:e}},rb=function(i){return i.excludeUntil&&i.excludeUntil>Date.now()},Lp=function(i){return i.excludeUntil&&i.excludeUntil===1/0},Pc=function(i){const e=rb(i);return!i.disabled&&!e},hk=function(i){return i.disabled},dk=function(i){for(let e=0;e<i.segments.length;e++)if(i.segments[e].key)return!0;return!1},sb=function(i,e){return e.attributes&&e.attributes[i]},fk=function(i,e,t,n=0){return sb("BANDWIDTH",t)?(i*t.attributes.BANDWIDTH-n*8)/e:NaN},Hd=(i,e)=>{if(i.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return i.playlists.filter(n=>Pc(n)?(n.attributes.BANDWIDTH||0)<t:!1).length===0},Np=(i,e)=>!i&&!e||!i&&e||i&&!e?!1:!!(i===e||i.id&&e.id&&i.id===e.id||i.resolvedUri&&e.resolvedUri&&i.resolvedUri===e.resolvedUri||i.uri&&e.uri&&i.uri===e.uri),$0=function(i,e){const t=i&&i.mediaGroups&&i.mediaGroups.AUDIO||{};let n=!1;for(const r in t){for(const s in t[r])if(n=e(t[r][s]),n)break;if(n)break}return!!n},nu=i=>{if(!i||!i.playlists||!i.playlists.length)return $0(i,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<i.playlists.length;e++){const t=i.playlists[e],n=t.attributes&&t.attributes.CODECS;if(!(n&&n.split(",").every(s=>Wy(s))||$0(i,s=>Np(t,s))))return!1}return!0};var vi={liveEdgeDelay:eb,duration:ib,seekable:lk,getMediaInfoForTime:ck,isEnabled:Pc,isDisabled:hk,isExcluded:rb,isIncompatible:Lp,playlistEnd:nb,isAes:dk,hasAttribute:sb,estimateSegmentRequestTime:fk,isLowestEnabledRendition:Hd,isAudioOnly:nu,playlistMatch:Np,segmentDurationWithParts:Op};const{log:ab}=F,Mp=(i,e)=>`${i}-${e}`,pk=(i,e,t)=>`placeholder-uri-${i}-${e}-${t}`,mk=({onwarn:i,oninfo:e,manifestString:t,customTagParsers:n=[],customTagMappers:r=[],llhls:s})=>{const a=new Rw;i&&a.on("warn",i),e&&a.on("info",e),n.forEach(c=>a.addParser(c)),r.forEach(c=>a.addTagMapper(c)),a.push(t),a.end();const o=a.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(c){o.hasOwnProperty(c)&&delete o[c]}),o.segments&&o.segments.forEach(function(c){["parts","preloadHints"].forEach(function(h){c.hasOwnProperty(h)&&delete c[h]})})),!o.targetDuration){let c=10;o.segments&&o.segments.length&&(c=o.segments.reduce((h,g)=>Math.max(h,g.duration),0)),i&&i(`manifest has no targetDuration defaulting to ${c}`),o.targetDuration=c}const u=JT(o);if(u.length&&!o.partTargetDuration){const c=u.reduce((h,g)=>Math.max(h,g.duration),0);i&&(i(`manifest has no partTargetDuration defaulting to ${c}`),ab.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=c}return o},ba=(i,e)=>{i.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(i.mediaGroups[t])for(const n in i.mediaGroups[t])for(const r in i.mediaGroups[t][n]){const s=i.mediaGroups[t][n][r];e(s,t,n,r)}})},ob=({playlist:i,uri:e,id:t})=>{i.id=t,i.playlistErrors_=0,e&&(i.uri=e),i.attributes=i.attributes||{}},gk=i=>{let e=i.playlists.length;for(;e--;){const t=i.playlists[e];ob({playlist:t,id:Mp(e,t.uri)}),t.resolvedUri=Ki(i.uri,t.uri),i.playlists[t.id]=t,i.playlists[t.uri]=t,t.attributes.BANDWIDTH||ab.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},_k=i=>{ba(i,e=>{e.uri&&(e.resolvedUri=Ki(i.uri,e.uri))})},yk=(i,e)=>{const t=Mp(0,e),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:I.location.href,resolvedUri:I.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return n.playlists[t]=n.playlists[0],n.playlists[e]=n.playlists[0],n},ub=(i,e,t=pk)=>{i.uri=e;for(let r=0;r<i.playlists.length;r++)if(!i.playlists[r].uri){const s=`placeholder-uri-${r}`;i.playlists[r].uri=s}const n=nu(i);ba(i,(r,s,a,o)=>{if(!r.playlists||!r.playlists.length){if(n&&s==="AUDIO"&&!r.uri)for(let u=0;u<i.playlists.length;u++){const c=i.playlists[u];if(c.attributes&&c.attributes.AUDIO&&c.attributes.AUDIO===a)return}r.playlists=[Bn({},r)]}r.playlists.forEach(function(u,c){const h=t(s,a,o,u),g=Mp(c,h);u.uri?u.resolvedUri=u.resolvedUri||Ki(i.uri,u.uri):(u.uri=c===0?h:g,u.resolvedUri=u.uri),u.id=u.id||g,u.attributes=u.attributes||{},i.playlists[u.id]=u,i.playlists[u.uri]=u})}),gk(i),_k(i)},{EventTarget:vk}=F,Tk=(i,e)=>{if(e.endList||!e.serverControl)return i;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:n}=e;let r=e.mediaSequence+e.segments.length;if(n){const s=n.parts||[],a=ZT(e)-1;a>-1&&a!==s.length-1&&(t._HLS_part=a),(a>-1||s.length)&&r--}t._HLS_msn=r}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const n=new I.URL(i);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(r){t.hasOwnProperty(r)&&n.searchParams.set(r,t[r])}),i=n.toString()}return i},bk=(i,e)=>{if(!i)return e;const t=We(i,e);if(i.preloadHints&&!e.preloadHints&&delete t.preloadHints,i.parts&&!e.parts)delete t.parts;else if(i.parts&&e.parts)for(let n=0;n<e.parts.length;n++)i.parts&&i.parts[n]&&(t.parts[n]=We(i.parts[n],e.parts[n]));return!i.skipped&&e.skipped&&(t.skipped=!1),i.preload&&!e.preload&&(t.preload=!1),t},Ek=(i,e,t)=>{const n=i.slice(),r=e.slice();t=t||0;const s=[];let a;for(let o=0;o<r.length;o++){const u=n[o+t],c=r[o];u?(a=u.map||a,s.push(bk(u,c))):(a&&!c.map&&(c.map=a),s.push(c))}return s},lb=(i,e)=>{!i.resolvedUri&&i.uri&&(i.resolvedUri=Ki(e,i.uri)),i.key&&!i.key.resolvedUri&&(i.key.resolvedUri=Ki(e,i.key.uri)),i.map&&!i.map.resolvedUri&&(i.map.resolvedUri=Ki(e,i.map.uri)),i.map&&i.map.key&&!i.map.key.resolvedUri&&(i.map.key.resolvedUri=Ki(e,i.map.key.uri)),i.parts&&i.parts.length&&i.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=Ki(e,t.uri))}),i.preloadHints&&i.preloadHints.length&&i.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=Ki(e,t.uri))})},cb=function(i){const e=i.segments||[],t=i.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let n=0;n<t.preloadHints.length;n++)if(t.preloadHints[n].type==="MAP")return e}t.duration=i.targetDuration,t.preload=!0,e.push(t)}return e},hb=(i,e)=>i===e||i.segments&&e.segments&&i.segments.length===e.segments.length&&i.endList===e.endList&&i.mediaSequence===e.mediaSequence&&i.preloadSegment===e.preloadSegment,Gd=(i,e,t=hb)=>{const n=We(i,{}),r=n.playlists[e.id];if(!r||t(r,e))return null;e.segments=cb(e);const s=We(r,e);if(s.preloadSegment&&!e.preloadSegment&&delete s.preloadSegment,r.segments){if(e.skip){e.segments=e.segments||[];for(let a=0;a<e.skip.skippedSegments;a++)e.segments.unshift({skipped:!0})}s.segments=Ek(r.segments,e.segments,e.mediaSequence-r.mediaSequence)}s.segments.forEach(a=>{lb(a,s.resolvedUri)});for(let a=0;a<n.playlists.length;a++)n.playlists[a].id===e.id&&(n.playlists[a]=s);return n.playlists[e.id]=s,n.playlists[e.uri]=s,ba(i,(a,o,u,c)=>{if(a.playlists)for(let h=0;h<a.playlists.length;h++)e.id===a.playlists[h].id&&(a.playlists[h]=s)}),n},zd=(i,e)=>{const t=i.segments||[],n=t[t.length-1],r=n&&n.parts&&n.parts[n.parts.length-1],s=r&&r.duration||n&&n.duration;return e&&s?s*1e3:(i.partTargetDuration||i.targetDuration||10)*500};class As extends vk{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=en("PlaylistLoader");const{withCredentials:r=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=r;const s=t.options_;this.customTagParsers=s&&s.customTagParsers||[],this.customTagMappers=s&&s.customTagMappers||[],this.llhls=s&&s.llhls,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=Ki(this.main.uri,e.uri);this.llhls&&(t=Tk(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials},(n,r)=>{if(this.request){if(n)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,n){const{uri:r,id:s}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[s],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}parseManifest_({url:e,manifestString:t}){return mk({onwarn:({message:n})=>this.logger_(`m3u8-parser warn for ${e}: ${n}`),oninfo:({message:n})=>this.logger_(`m3u8-parser info for ${e}: ${n}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:r}){this.request=null,this.state="HAVE_METADATA";const s=t||this.parseManifest_({url:n,manifestString:e});s.lastRequest=Date.now(),ob({playlist:s,uri:n,id:r});const a=Gd(this.main,s);this.targetDuration=s.partTargetDuration||s.targetDuration,this.pendingMedia_=null,a?(this.main=a,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(zd(this.media(),!!a)),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),I.clearTimeout(this.mediaUpdateTimeout),I.clearTimeout(this.finalRenditionTimeout),this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(I.clearTimeout(this.finalRenditionTimeout),t){const a=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=I.setTimeout(this.media.bind(this,e,!1),a);return}const n=this.state,r=!this.media_||e.id!==this.media_.id,s=this.main.playlists[e.id];if(s&&s.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,r&&(this.trigger("mediachanging"),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(zd(e,!0)),!!r){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},(a,o)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=jl(e.resolvedUri,o),a)return this.playlistRequestError(this.request,e,n);this.haveMetadata({playlistString:o.responseText,url:e.uri,id:e.id}),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}}pause(){this.mediaUpdateTimeout&&(I.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(I.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const n=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=I.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},n);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(I.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=I.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=I.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},(e,t)=>{if(!this.request)return;if(this.request=null,e)return this.error={status:t.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:t.responseText,code:2},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.src=jl(this.src,t);const n=this.parseManifest_({manifestString:t.responseText,url:this.src});this.setupInitialPlaylist(n)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,ub(this.main,this.srcUri()),e.playlists.forEach(n=>{n.segments=cb(n),n.segments.forEach(r=>{lb(r,n.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||I.location.href;this.main=yk(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}}const{xhr:Sk}=F,Wd=function(i,e,t,n){const r=i.responseType==="arraybuffer"?i.response:i.responseText;!e&&r&&(i.responseTime=Date.now(),i.roundTripTime=i.responseTime-i.requestTime,i.bytesReceived=r.byteLength||r.length,i.bandwidth||(i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3))),t.headers&&(i.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(i.timedout=!0),!e&&!i.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(i&&(r||i.responseText)))),n(e,i)},db=function(){const i=function e(t,n){t=We({timeout:45e3},t);const r=e.beforeRequest||F.Vhs.xhr.beforeRequest;if(r&&typeof r=="function"){const u=r(t);u&&(t=u)}const a=(F.Vhs.xhr.original===!0?Sk:F.Vhs.xhr)(t,function(u,c){return Wd(a,u,c,n)}),o=a.abort;return a.abort=function(){return a.aborted=!0,o.apply(a,arguments)},a.uri=t.uri,a.requestTime=Date.now(),a};return i.original=!0,i},xk=function(i){let e;const t=i.offset;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=I.BigInt(i.offset)+I.BigInt(i.length)-I.BigInt(1):e=i.offset+i.length-1,"bytes="+t+"-"+e},Kd=function(i){const e={};return i.byterange&&(e.Range=xk(i.byterange)),e},Ck=function(i,e){return i.start(e)+"-"+i.end(e)},wk=function(i,e){const t=i.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},Ak=function(i){return i>=32&&i<126?String.fromCharCode(i):"."},fb=function(i){const e={};return Object.keys(i).forEach(t=>{const n=i[t];Xy(n)?e[t]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[t]=n}),e},$l=function(i){const e=i.byterange||{length:1/0,offset:0};return[e.length,e.offset,i.resolvedUri].join(",")},pb=function(i){return i.resolvedUri},mb=i=>{const e=Array.prototype.slice.call(i),t=16;let n="",r,s;for(let a=0;a<e.length/t;a++)r=e.slice(a*t,a*t+t).map(wk).join(""),s=e.slice(a*t,a*t+t).map(Ak).join(""),n+=r+" "+s+`
`;return n},Dk=({bytes:i})=>mb(i),Ik=i=>{let e="",t;for(t=0;t<i.length;t++)e+=Ck(i,t)+" ";return e};var kk=Object.freeze({__proto__:null,createTransferableMessage:fb,initSegmentId:$l,segmentKeyId:pb,hexDump:mb,tagDump:Dk,textRanges:Ik});const gb=.25,Pk=(i,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,r=e.videoTimingInfo.transmuxedPresentationStart+t,s=i-r;return new Date(e.dateTimeObject.getTime()+s*1e3)},Rk=i=>i.transmuxedPresentationEnd-i.transmuxedPresentationStart-i.transmuxerPrependedSeconds,Ok=(i,e)=>{let t;try{t=new Date(i)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let n=e.segments[0];if(t<n.dateTimeObject)return null;for(let u=0;u<e.segments.length-1;u++){n=e.segments[u];const c=e.segments[u+1].dateTimeObject;if(t<c)break}const r=e.segments[e.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?Rk(r.videoTimingInfo):r.duration+r.duration*gb,o=new Date(s.getTime()+a*1e3);return t>o?null:(t>s&&(n=r),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:vi.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},Lk=(i,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,n;for(let s=0;s<e.segments.length&&(n=e.segments[s],t=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:t+n.duration,!(i<=t));s++);const r=e.segments[e.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<i)return null;if(i>t){if(i>t+r.duration*gb)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:t-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},Nk=(i,e)=>{let t,n;try{t=new Date(i),n=new Date(e)}catch{}const r=t.getTime();return(n.getTime()-r)/1e3},Mk=i=>{if(!i.segments||i.segments.length===0)return!1;for(let e=0;e<i.segments.length;e++)if(!i.segments[e].dateTimeObject)return!1;return!0},Fk=({playlist:i,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!i||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const n=Lk(e,i);if(!n)return t({message:"valid programTime was not found"});if(n.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const r={mediaSeconds:e},s=Pk(e,n.segment);return s&&(r.programDateTime=s.toISOString()),t(null,r)},_b=({programTime:i,playlist:e,retryCount:t=2,seekTo:n,pauseAfterSeek:r=!0,tech:s,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(typeof i>"u"||!e||!n)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!s.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!Mk(e))return a({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const o=Ok(i,e);if(!o)return a({message:`${i} was not found in the stream`});const u=o.segment,c=Nk(u.dateTimeObject,i);if(o.type==="estimate"){if(t===0)return a({message:`${i} is not buffered yet. Try again`});n(o.estimatedStart+c),s.one("seeked",()=>{_b({programTime:i,playlist:e,retryCount:t-1,seekTo:n,pauseAfterSeek:r,tech:s,callback:a})});return}const h=u.start+c,g=()=>a(null,s.currentTime());s.one("seeked",g),r&&s.pause(),n(h)},Qh=(i,e)=>{if(i.readyState===4)return e()},Bk=(i,e,t)=>{let n=[],r,s=!1;const a=function(h,g,y,T){return g.abort(),s=!0,t(h,g,y,T)},o=function(h,g){if(s)return;if(h)return a(h,g,"",n);const y=g.responseText.substring(n&&n.byteLength||0,g.responseText.length);if(n=Hw(n,Yy(y,!0)),r=r||ro(n),n.length<10||r&&n.length<r+2)return Qh(g,()=>a(h,g,"",n));const T=tp(n);return T==="ts"&&n.length<188?Qh(g,()=>a(h,g,"",n)):!T&&n.length<376?Qh(g,()=>a(h,g,"",n)):a(null,g,T,n)},c=e({uri:i,beforeSend(h){h.overrideMimeType("text/plain; charset=x-user-defined"),h.addEventListener("progress",function({total:g,loaded:y}){return Wd(h,null,{statusCode:h.status},o)})}},function(h,g){return Wd(c,h,g,o)});return c},{EventTarget:Uk}=F,q0=function(i,e){if(!hb(i,e)||i.sidx&&e.sidx&&(i.sidx.offset!==e.sidx.offset||i.sidx.length!==e.sidx.length))return!1;if(!i.sidx&&e.sidx||i.sidx&&!e.sidx||i.segments&&!e.segments||!i.segments&&e.segments)return!1;if(!i.segments&&!e.segments)return!0;for(let t=0;t<i.segments.length;t++){const n=i.segments[t],r=e.segments[t];if(n.uri!==r.uri)return!1;if(!n.byterange&&!r.byterange)continue;const s=n.byterange,a=r.byterange;if(s&&!a||!s&&a||s.offset!==a.offset||s.length!==a.length)return!1}return!0},Vk=(i,e,t,n)=>{const r=n.attributes.NAME||t;return`placeholder-uri-${i}-${e}-${r}`},jk=({mainXml:i,srcUrl:e,clientOffset:t,sidxMapping:n,previousManifest:r})=>{const s=dD(i,{manifestUri:e,clientOffset:t,sidxMapping:n,previousManifest:r});return ub(s,e,Vk),s},$k=(i,e)=>{ba(i,(t,n,r,s)=>{s in e.mediaGroups[n][r]||delete i.mediaGroups[n][r][s]})},qk=(i,e,t)=>{let n=!0,r=We(i,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let s=0;s<e.playlists.length;s++){const a=e.playlists[s];if(a.sidx){const u=dc(a.sidx);t&&t[u]&&t[u].sidx&&Jf(a,t[u].sidx,a.sidx.resolvedUri)}const o=Gd(r,a,q0);o&&(r=o,n=!1)}return ba(e,(s,a,o,u)=>{if(s.playlists&&s.playlists.length){const c=s.playlists[0].id,h=Gd(r,s.playlists[0],q0);h&&(r=h,u in r.mediaGroups[a][o]||(r.mediaGroups[a][o][u]=s),r.mediaGroups[a][o][u].playlists[0]=r.playlists[c],n=!1)}}),$k(r,e),e.minimumUpdatePeriod!==i.minimumUpdatePeriod&&(n=!1),n?null:r},Hk=(i,e)=>(!i.map&&!e.map||!!(i.map&&e.map&&i.map.byterange.offset===e.map.byterange.offset&&i.map.byterange.length===e.map.byterange.length))&&i.uri===e.uri&&i.byterange.offset===e.byterange.offset&&i.byterange.length===e.byterange.length,H0=(i,e)=>{const t={};for(const n in i){const s=i[n].sidx;if(s){const a=dc(s);if(!e[a])break;const o=e[a].sidxInfo;Hk(o,s)&&(t[a]=e[a])}}return t},Gk=(i,e)=>{let n=H0(i.playlists,e);return ba(i,(r,s,a,o)=>{if(r.playlists&&r.playlists.length){const u=r.playlists;n=We(n,H0(u,e))}}),n};class Xd extends Uk{constructor(e,t,n={},r){super(),this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:s=!1}=n;if(this.vhs_=t,this.withCredentials=s,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=en("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}requestErrored_(e,t,n){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2},n&&(this.state=n),this.trigger("error"),!0}addSidxSegments_(e,t,n){const r=e.sidx&&dc(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r]){this.mediaRequest_=I.setTimeout(()=>n(!1),0);return}const s=jl(e.sidx.resolvedUri),a=(o,u)=>{if(this.requestErrored_(o,u,t))return;const c=this.mainPlaylistLoader_.sidxMapping_;let h;try{h=yD(oe(u.response).subarray(8))}catch(g){this.requestErrored_(g,u,t);return}return c[r]={sidxInfo:e.sidx,sidx:h},Jf(e,h,e.sidx.resolvedUri),n(!0)};this.request=Bk(s,this.vhs_.xhr,(o,u,c,h)=>{if(o)return a(o,u);if(!c||c!=="mp4")return a({status:u.status,message:`Unsupported ${c||"unknown"} container type for sidx segment at URL: ${s}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},u);const{offset:g,length:y}=e.sidx.byterange;if(h.length>=y+g)return a(o,{response:h.subarray(g,g+y),status:u.status,uri:u.uri});this.request=this.vhs_.xhr({uri:s,responseType:"arraybuffer",headers:Kd({byterange:e.sidx.byterange})},a)})}dispose(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},I.clearTimeout(this.minimumUpdatePeriodTimeout_),I.clearTimeout(this.mediaRequest_),I.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,n&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,r=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),I.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(I.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){I.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const n=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=I.setTimeout(()=>this.load(),n);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){this.mediaRequest_=I.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},(t,n)=>{if(this.requestErrored_(t,n)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}const r=n.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?this.mainLoaded_=Date.parse(n.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=jl(this.mainPlaylistLoader_.srcUrl,n),r){this.handleMain_(),this.syncClientServerClock_(()=>e(n,r));return}return e(n,r)})}syncClientServerClock_(e){const t=fD(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Ki(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials},(n,r)=>{if(!this.request)return;if(n)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();let s;t.method==="HEAD"?!r.responseHeaders||!r.responseHeaders.date?s=this.mainLoaded_:s=Date.parse(r.responseHeaders.date):s=Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=s-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main;let t=jk({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(t=qk(e,t,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=t||e;const n=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];return n&&n!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=n),(!e||t&&t.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),!!t}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(I.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=I.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=Gk(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,n=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const r=()=>{this.media().endList||(this.mediaUpdateTimeout=I.setTimeout(()=>{this.trigger("mediaupdatetimeout"),r()},zd(this.media(),!!n)))};r()}this.trigger("loadedplaylist")}}var xt={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const zk=i=>{const e=new Uint8Array(new ArrayBuffer(i.length));for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer},yb=function(i){return i.on=i.addEventListener,i.off=i.removeEventListener,i},Wk=function(i){try{return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(i),URL.createObjectURL(t.getBlob())}},vb=function(i){return function(){const e=Wk(i),t=yb(new Worker(e));t.objURL=e;const n=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),n.call(this)},t}},Tb=function(i){return`var browserWorkerPolyFill = ${yb.toString()};
browserWorkerPolyFill(self);
`+i},bb=function(i){return i.toString().replace(/^function.+?{/,"").slice(0,-1)},Kk=Tb(bb(function(){var i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var l={};this.on=function(d,p){l[d]||(l[d]=[]),l[d]=l[d].concat(p)},this.off=function(d,p){var f;return l[d]?(f=l[d].indexOf(p),l[d]=l[d].slice(),l[d].splice(f,1),f>-1):!1},this.trigger=function(d){var p,f,m,_;if(p=l[d],!!p)if(arguments.length===2)for(m=p.length,f=0;f<m;++f)p[f].call(this,arguments[1]);else{for(_=[],f=arguments.length,f=1;f<arguments.length;++f)_.push(arguments[f]);for(m=p.length,f=0;f<m;++f)p[f].apply(this,_)}},this.dispose=function(){l={}}}};e.prototype.pipe=function(l){return this.on("data",function(d){l.push(d)}),this.on("done",function(d){l.flush(d)}),this.on("partialdone",function(d){l.partialFlush(d)}),this.on("endedtimeline",function(d){l.endTimeline(d)}),this.on("reset",function(d){l.reset(d)}),l},e.prototype.push=function(l){this.trigger("data",l)},e.prototype.flush=function(l){this.trigger("done",l)},e.prototype.partialFlush=function(l){this.trigger("partialdone",l)},e.prototype.endTimeline=function(l){this.trigger("endedtimeline",l)},e.prototype.reset=function(l){this.trigger("reset",l)};var t=e,n=Math.pow(2,32),r=function(l){var d=new DataView(l.buffer,l.byteOffset,l.byteLength),p;return d.getBigUint64?(p=d.getBigUint64(0),p<Number.MAX_SAFE_INTEGER?Number(p):p):d.getUint32(0)*n+d.getUint32(4)},s={getUint64:r,MAX_UINT32:n},a=s.MAX_UINT32,o,u,c,h,g,y,T,v,x,A,D,P,M,O,R,$,V,ie,Z,he,_e,me,X,Ae,rt,Ce,$e,tt,Nt,bt,kt,hi,tn,Qn,Oi,nn;(function(){var l;if(X={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(l in X)X.hasOwnProperty(l)&&(X[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)]);Ae=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Ce=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),rt=new Uint8Array([0,0,0,1]),$e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),tt=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),Nt={video:$e,audio:tt},hi=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),kt=new Uint8Array([0,0,0,0,0,0,0,0]),tn=new Uint8Array([0,0,0,0,0,0,0,0]),Qn=tn,Oi=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),nn=tn,bt=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),o=function(l){var d=[],p=0,f,m,_;for(f=1;f<arguments.length;f++)d.push(arguments[f]);for(f=d.length;f--;)p+=d[f].byteLength;for(m=new Uint8Array(p+8),_=new DataView(m.buffer,m.byteOffset,m.byteLength),_.setUint32(0,m.byteLength),m.set(l,4),f=0,p=8;f<d.length;f++)m.set(d[f],p),p+=d[f].byteLength;return m},u=function(){return o(X.dinf,o(X.dref,hi))},c=function(l){return o(X.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,l.audioobjecttype<<3|l.samplingfrequencyindex>>>1,l.samplingfrequencyindex<<7|l.channelcount<<3,6,1,2]))},h=function(){return o(X.ftyp,Ae,rt,Ae,Ce)},$=function(l){return o(X.hdlr,Nt[l])},g=function(l){return o(X.mdat,l)},R=function(l){var d=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,l.duration>>>24&255,l.duration>>>16&255,l.duration>>>8&255,l.duration&255,85,196,0,0]);return l.samplerate&&(d[12]=l.samplerate>>>24&255,d[13]=l.samplerate>>>16&255,d[14]=l.samplerate>>>8&255,d[15]=l.samplerate&255),o(X.mdhd,d)},O=function(l){return o(X.mdia,R(l),$(l.type),T(l))},y=function(l){return o(X.mfhd,new Uint8Array([0,0,0,0,(l&4278190080)>>24,(l&16711680)>>16,(l&65280)>>8,l&255]))},T=function(l){return o(X.minf,l.type==="video"?o(X.vmhd,bt):o(X.smhd,kt),u(),ie(l))},v=function(l,d){for(var p=[],f=d.length;f--;)p[f]=he(d[f]);return o.apply(null,[X.moof,y(l)].concat(p))},x=function(l){for(var d=l.length,p=[];d--;)p[d]=P(l[d]);return o.apply(null,[X.moov,D(4294967295)].concat(p).concat(A(l)))},A=function(l){for(var d=l.length,p=[];d--;)p[d]=_e(l[d]);return o.apply(null,[X.mvex].concat(p))},D=function(l){var d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(l&4278190080)>>24,(l&16711680)>>16,(l&65280)>>8,l&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o(X.mvhd,d)},V=function(l){var d=l.samples||[],p=new Uint8Array(4+d.length),f,m;for(m=0;m<d.length;m++)f=d[m].flags,p[m+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return o(X.sdtp,p)},ie=function(l){return o(X.stbl,Z(l),o(X.stts,nn),o(X.stsc,Qn),o(X.stsz,Oi),o(X.stco,tn))},function(){var l,d;Z=function(p){return o(X.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),p.type==="video"?l(p):d(p))},l=function(p){var f=p.sps||[],m=p.pps||[],_=[],b=[],S,w;for(S=0;S<f.length;S++)_.push((f[S].byteLength&65280)>>>8),_.push(f[S].byteLength&255),_=_.concat(Array.prototype.slice.call(f[S]));for(S=0;S<m.length;S++)b.push((m[S].byteLength&65280)>>>8),b.push(m[S].byteLength&255),b=b.concat(Array.prototype.slice.call(m[S]));if(w=[X.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(p.width&65280)>>8,p.width&255,(p.height&65280)>>8,p.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o(X.avcC,new Uint8Array([1,p.profileIdc,p.profileCompatibility,p.levelIdc,255].concat([f.length],_,[m.length],b))),o(X.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],p.sarRatio){var k=p.sarRatio[0],L=p.sarRatio[1];w.push(o(X.pasp,new Uint8Array([(k&4278190080)>>24,(k&16711680)>>16,(k&65280)>>8,k&255,(L&4278190080)>>24,(L&16711680)>>16,(L&65280)>>8,L&255])))}return o.apply(null,w)},d=function(p){return o(X.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(p.channelcount&65280)>>8,p.channelcount&255,(p.samplesize&65280)>>8,p.samplesize&255,0,0,0,0,(p.samplerate&65280)>>8,p.samplerate&255,0,0]),c(p))}}(),M=function(l){var d=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(l.id&4278190080)>>24,(l.id&16711680)>>16,(l.id&65280)>>8,l.id&255,0,0,0,0,(l.duration&4278190080)>>24,(l.duration&16711680)>>16,(l.duration&65280)>>8,l.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(l.width&65280)>>8,l.width&255,0,0,(l.height&65280)>>8,l.height&255,0,0]);return o(X.tkhd,d)},he=function(l){var d,p,f,m,_,b,S;return d=o(X.tfhd,new Uint8Array([0,0,0,58,(l.id&4278190080)>>24,(l.id&16711680)>>16,(l.id&65280)>>8,l.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),b=Math.floor(l.baseMediaDecodeTime/a),S=Math.floor(l.baseMediaDecodeTime%a),p=o(X.tfdt,new Uint8Array([1,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,b&255,S>>>24&255,S>>>16&255,S>>>8&255,S&255])),_=32+20+8+16+8+8,l.type==="audio"?(f=me(l,_),o(X.traf,d,p,f)):(m=V(l),f=me(l,m.length+_),o(X.traf,d,p,f,m))},P=function(l){return l.duration=l.duration||4294967295,o(X.trak,M(l),O(l))},_e=function(l){var d=new Uint8Array([0,0,0,0,(l.id&4278190080)>>24,(l.id&16711680)>>16,(l.id&65280)>>8,l.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return l.type!=="video"&&(d[d.length-1]=0),o(X.trex,d)},function(){var l,d,p;p=function(f,m){var _=0,b=0,S=0,w=0;return f.length&&(f[0].duration!==void 0&&(_=1),f[0].size!==void 0&&(b=2),f[0].flags!==void 0&&(S=4),f[0].compositionTimeOffset!==void 0&&(w=8)),[0,0,_|b|S|w,1,(f.length&4278190080)>>>24,(f.length&16711680)>>>16,(f.length&65280)>>>8,f.length&255,(m&4278190080)>>>24,(m&16711680)>>>16,(m&65280)>>>8,m&255]},d=function(f,m){var _,b,S,w,k,L;for(w=f.samples||[],m+=8+12+16*w.length,S=p(w,m),b=new Uint8Array(S.length+w.length*16),b.set(S),_=S.length,L=0;L<w.length;L++)k=w[L],b[_++]=(k.duration&4278190080)>>>24,b[_++]=(k.duration&16711680)>>>16,b[_++]=(k.duration&65280)>>>8,b[_++]=k.duration&255,b[_++]=(k.size&4278190080)>>>24,b[_++]=(k.size&16711680)>>>16,b[_++]=(k.size&65280)>>>8,b[_++]=k.size&255,b[_++]=k.flags.isLeading<<2|k.flags.dependsOn,b[_++]=k.flags.isDependedOn<<6|k.flags.hasRedundancy<<4|k.flags.paddingValue<<1|k.flags.isNonSyncSample,b[_++]=k.flags.degradationPriority&61440,b[_++]=k.flags.degradationPriority&15,b[_++]=(k.compositionTimeOffset&4278190080)>>>24,b[_++]=(k.compositionTimeOffset&16711680)>>>16,b[_++]=(k.compositionTimeOffset&65280)>>>8,b[_++]=k.compositionTimeOffset&255;return o(X.trun,b)},l=function(f,m){var _,b,S,w,k,L;for(w=f.samples||[],m+=8+12+8*w.length,S=p(w,m),_=new Uint8Array(S.length+w.length*8),_.set(S),b=S.length,L=0;L<w.length;L++)k=w[L],_[b++]=(k.duration&4278190080)>>>24,_[b++]=(k.duration&16711680)>>>16,_[b++]=(k.duration&65280)>>>8,_[b++]=k.duration&255,_[b++]=(k.size&4278190080)>>>24,_[b++]=(k.size&16711680)>>>16,_[b++]=(k.size&65280)>>>8,_[b++]=k.size&255;return o(X.trun,_)},me=function(f,m){return f.type==="audio"?l(f,m):d(f,m)}}();var rn={ftyp:h,mdat:g,moof:v,moov:x,initSegment:function(l){var d=h(),p=x(l),f;return f=new Uint8Array(d.byteLength+p.byteLength),f.set(d),f.set(p,d.byteLength),f}},Si=function(l){var d,p,f=[],m=[];for(m.byteLength=0,m.nalCount=0,m.duration=0,f.byteLength=0,d=0;d<l.length;d++)p=l[d],p.nalUnitType==="access_unit_delimiter_rbsp"?(f.length&&(f.duration=p.dts-f.dts,m.byteLength+=f.byteLength,m.nalCount+=f.length,m.duration+=f.duration,m.push(f)),f=[p],f.byteLength=p.data.byteLength,f.pts=p.pts,f.dts=p.dts):(p.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(f.keyFrame=!0),f.duration=p.dts-f.dts,f.byteLength+=p.data.byteLength,f.push(p));return m.length&&(!f.duration||f.duration<=0)&&(f.duration=m[m.length-1].duration),m.byteLength+=f.byteLength,m.nalCount+=f.length,m.duration+=f.duration,m.push(f),m},Q=function(l){var d,p,f=[],m=[];for(f.byteLength=0,f.nalCount=0,f.duration=0,f.pts=l[0].pts,f.dts=l[0].dts,m.byteLength=0,m.nalCount=0,m.duration=0,m.pts=l[0].pts,m.dts=l[0].dts,d=0;d<l.length;d++)p=l[d],p.keyFrame?(f.length&&(m.push(f),m.byteLength+=f.byteLength,m.nalCount+=f.nalCount,m.duration+=f.duration),f=[p],f.nalCount=p.length,f.byteLength=p.byteLength,f.pts=p.pts,f.dts=p.dts,f.duration=p.duration):(f.duration+=p.duration,f.nalCount+=p.length,f.byteLength+=p.byteLength,f.push(p));return m.length&&f.duration<=0&&(f.duration=m[m.length-1].duration),m.byteLength+=f.byteLength,m.nalCount+=f.nalCount,m.duration+=f.duration,m.push(f),m},de=function(l){var d;return!l[0][0].keyFrame&&l.length>1&&(d=l.shift(),l.byteLength-=d.byteLength,l.nalCount-=d.nalCount,l[0][0].dts=d.dts,l[0][0].pts=d.pts,l[0][0].duration+=d.duration),l},Ke=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},Xe=function(l,d){var p=Ke();return p.dataOffset=d,p.compositionTimeOffset=l.pts-l.dts,p.duration=l.duration,p.size=4*l.length,p.size+=l.byteLength,l.keyFrame&&(p.flags.dependsOn=2,p.flags.isNonSyncSample=0),p},di=function(l,d){var p,f,m,_,b,S=d||0,w=[];for(p=0;p<l.length;p++)for(_=l[p],f=0;f<_.length;f++)b=_[f],m=Xe(b,S),S+=m.size,w.push(m);return w},dt=function(l){var d,p,f,m,_,b,S=0,w=l.byteLength,k=l.nalCount,L=w+4*k,B=new Uint8Array(L),J=new DataView(B.buffer);for(d=0;d<l.length;d++)for(m=l[d],p=0;p<m.length;p++)for(_=m[p],f=0;f<_.length;f++)b=_[f],J.setUint32(S,b.data.byteLength),S+=4,B.set(b.data,S),S+=b.data.byteLength;return B},Tr=function(l,d){var p,f=d||0,m=[];return p=Xe(l,f),m.push(p),m},Jn=function(l){var d,p,f=0,m=l.byteLength,_=l.length,b=m+4*_,S=new Uint8Array(b),w=new DataView(S.buffer);for(d=0;d<l.length;d++)p=l[d],w.setUint32(f,p.data.byteLength),f+=4,S.set(p.data,f),f+=p.data.byteLength;return S},Yt={groupNalsIntoFrames:Si,groupFramesIntoGops:Q,extendFirstKeyFrame:de,generateSampleTable:di,concatenateNalData:dt,generateSampleTableForFrame:Tr,concatenateNalDataForFrame:Jn},xi=[33,16,5,32,164,27],qi=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],z=function(l){for(var d=[];l--;)d.push(0);return d},ot=function(l){return Object.keys(l).reduce(function(d,p){return d[p]=new Uint8Array(l[p].reduce(function(f,m){return f.concat(m)},[])),d},{})},fi,Zn=function(){if(!fi){var l={96e3:[xi,[227,64],z(154),[56]],88200:[xi,[231],z(170),[56]],64e3:[xi,[248,192],z(240),[56]],48e3:[xi,[255,192],z(268),[55,148,128],z(54),[112]],44100:[xi,[255,192],z(268),[55,163,128],z(84),[112]],32e3:[xi,[255,192],z(268),[55,234],z(226),[112]],24e3:[xi,[255,192],z(268),[55,255,128],z(268),[111,112],z(126),[224]],16e3:[xi,[255,192],z(268),[55,255,128],z(268),[111,255],z(269),[223,108],z(195),[1,192]],12e3:[qi,z(268),[3,127,248],z(268),[6,255,240],z(268),[13,255,224],z(268),[27,253,128],z(259),[56]],11025:[qi,z(268),[3,127,248],z(268),[6,255,240],z(268),[13,255,224],z(268),[27,255,192],z(268),[55,175,128],z(108),[112]],8e3:[qi,z(268),[3,121,16],z(47),[7]]};fi=ot(l)}return fi},Dn=9e4,Hi,Da,br,Ia,ka,yu,vu;Hi=function(l){return l*Dn},Da=function(l,d){return l*d},br=function(l){return l/Dn},Ia=function(l,d){return l/d},ka=function(l,d){return Hi(Ia(l,d))},yu=function(l,d){return Da(br(l),d)},vu=function(l,d,p){return br(p?l:l-d)};var qe={ONE_SECOND_IN_TS:Dn,secondsToVideoTs:Hi,secondsToAudioTs:Da,videoTsToSeconds:br,audioTsToSeconds:Ia,audioTsToVideoTs:ka,videoTsToAudioTs:yu,metadataTsToSeconds:vu},sh=Zn,es=qe,Ye=function(l){var d,p,f=0;for(d=0;d<l.length;d++)p=l[d],f+=p.data.byteLength;return f},Pa=function(l,d,p,f){var m,_=0,b=0,S=0,w=0,k,L,B;if(d.length&&(m=es.audioTsToVideoTs(l.baseMediaDecodeTime,l.samplerate),_=Math.ceil(es.ONE_SECOND_IN_TS/(l.samplerate/1024)),p&&f&&(b=m-Math.max(p,f),S=Math.floor(b/_),w=S*_),!(S<1||w>es.ONE_SECOND_IN_TS/2))){for(k=sh()[l.samplerate],k||(k=d[0].data),L=0;L<S;L++)B=d[0],d.splice(0,0,{data:k,dts:B.dts-_,pts:B.pts-_});return l.baseMediaDecodeTime-=Math.floor(es.videoTsToAudioTs(w,l.samplerate)),w}},Ra=function(l,d,p){return d.minSegmentDts>=p?l:(d.minSegmentDts=1/0,l.filter(function(f){return f.dts>=p?(d.minSegmentDts=Math.min(d.minSegmentDts,f.dts),d.minSegmentPts=d.minSegmentDts,!0):!1}))},ah=function(l){var d,p,f=[];for(d=0;d<l.length;d++)p=l[d],f.push({size:p.data.byteLength,duration:1024});return f},ts=function(l){var d,p,f=0,m=new Uint8Array(Ye(l));for(d=0;d<l.length;d++)p=l[d],m.set(p.data,f),f+=p.data.byteLength;return m},Oa={prefixWithSilence:Pa,trimAdtsFramesByEarliestDts:Ra,generateSampleTable:ah,concatenateFrameData:ts},Gi=qe.ONE_SECOND_IN_TS,oh=function(l,d){typeof d.pts=="number"&&(l.timelineStartInfo.pts===void 0&&(l.timelineStartInfo.pts=d.pts),l.minSegmentPts===void 0?l.minSegmentPts=d.pts:l.minSegmentPts=Math.min(l.minSegmentPts,d.pts),l.maxSegmentPts===void 0?l.maxSegmentPts=d.pts:l.maxSegmentPts=Math.max(l.maxSegmentPts,d.pts)),typeof d.dts=="number"&&(l.timelineStartInfo.dts===void 0&&(l.timelineStartInfo.dts=d.dts),l.minSegmentDts===void 0?l.minSegmentDts=d.dts:l.minSegmentDts=Math.min(l.minSegmentDts,d.dts),l.maxSegmentDts===void 0?l.maxSegmentDts=d.dts:l.maxSegmentDts=Math.max(l.maxSegmentDts,d.dts))},uh=function(l){delete l.minSegmentDts,delete l.maxSegmentDts,delete l.minSegmentPts,delete l.maxSegmentPts},E=function(l,d){var p,f,m=l.minSegmentDts;return d||(m-=l.timelineStartInfo.dts),p=l.timelineStartInfo.baseMediaDecodeTime,p+=m,p=Math.max(0,p),l.type==="audio"&&(f=l.samplerate/Gi,p*=f,p=Math.floor(p)),p},C={clearDtsInfo:uh,calculateTrackBaseMediaDecodeTime:E,collectDtsInfo:oh},N=4,U=128,W=function(l){for(var d=0,p={payloadType:-1,payloadSize:0},f=0,m=0;d<l.byteLength&&l[d]!==U;){for(;l[d]===255;)f+=255,d++;for(f+=l[d++];l[d]===255;)m+=255,d++;if(m+=l[d++],!p.payload&&f===N){var _=String.fromCharCode(l[d+3],l[d+4],l[d+5],l[d+6]);if(_==="GA94"){p.payloadType=f,p.payloadSize=m,p.payload=l.subarray(d,d+m);break}else p.payload=void 0}d+=m,f=0,m=0}return p},ee=function(l){return l.payload[0]!==181||(l.payload[1]<<8|l.payload[2])!==49||String.fromCharCode(l.payload[3],l.payload[4],l.payload[5],l.payload[6])!=="GA94"||l.payload[7]!==3?null:l.payload.subarray(8,l.payload.length-1)},ye=function(l,d){var p=[],f,m,_,b;if(!(d[0]&64))return p;for(m=d[0]&31,f=0;f<m;f++)_=f*3,b={type:d[_+2]&3,pts:l},d[_+2]&4&&(b.ccData=d[_+3]<<8|d[_+4],p.push(b));return p},se=function(l){for(var d=l.byteLength,p=[],f=1,m,_;f<d-2;)l[f]===0&&l[f+1]===0&&l[f+2]===3?(p.push(f+2),f+=2):f++;if(p.length===0)return l;m=d-p.length,_=new Uint8Array(m);var b=0;for(f=0;f<m;b++,f++)b===p[0]&&(b++,p.shift()),_[f]=l[b];return _},Se={parseSei:W,parseUserData:ee,parseCaptionPackets:ye,discardEmulationPreventionBytes:se,USER_DATA_REGISTERED_ITU_T_T35:N},ne=t,ue=Se,be=function(l){l=l||{},be.prototype.init.call(this),this.parse708captions_=typeof l.parse708captions=="boolean"?l.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new He(0,0),new He(0,1),new He(1,0),new He(1,1)],this.parse708captions_&&(this.cc708Stream_=new Oe({captionServices:l.captionServices})),this.reset(),this.ccStreams_.forEach(function(d){d.on("data",this.trigger.bind(this,"data")),d.on("partialdone",this.trigger.bind(this,"partialdone")),d.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};be.prototype=new ne,be.prototype.push=function(l){var d,p,f;if(l.nalUnitType==="sei_rbsp"&&(d=ue.parseSei(l.escapedRBSP),!!d.payload&&d.payloadType===ue.USER_DATA_REGISTERED_ITU_T_T35&&(p=ue.parseUserData(d),!!p))){if(l.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(l.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}f=ue.parseCaptionPackets(l.pts,p),this.captionPackets_=this.captionPackets_.concat(f),this.latestDts_!==l.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=l.dts}},be.prototype.flushCCStreams=function(l){this.ccStreams_.forEach(function(d){return l==="flush"?d.flush():d.partialFlush()},this)},be.prototype.flushStream=function(l){if(!this.captionPackets_.length){this.flushCCStreams(l);return}this.captionPackets_.forEach(function(d,p){d.presortIndex=p}),this.captionPackets_.sort(function(d,p){return d.pts===p.pts?d.presortIndex-p.presortIndex:d.pts-p.pts}),this.captionPackets_.forEach(function(d){d.type<2?this.dispatchCea608Packet(d):this.dispatchCea708Packet(d)},this),this.captionPackets_.length=0,this.flushCCStreams(l)},be.prototype.flush=function(){return this.flushStream("flush")},be.prototype.partialFlush=function(){return this.flushStream("partialFlush")},be.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(l){l.reset()})},be.prototype.dispatchCea608Packet=function(l){this.setsTextOrXDSActive(l)?this.activeCea608Channel_[l.type]=null:this.setsChannel1Active(l)?this.activeCea608Channel_[l.type]=0:this.setsChannel2Active(l)&&(this.activeCea608Channel_[l.type]=1),this.activeCea608Channel_[l.type]!==null&&this.ccStreams_[(l.type<<1)+this.activeCea608Channel_[l.type]].push(l)},be.prototype.setsChannel1Active=function(l){return(l.ccData&30720)===4096},be.prototype.setsChannel2Active=function(l){return(l.ccData&30720)===6144},be.prototype.setsTextOrXDSActive=function(l){return(l.ccData&28928)===256||(l.ccData&30974)===4138||(l.ccData&30974)===6186},be.prototype.dispatchCea708Packet=function(l){this.parse708captions_&&this.cc708Stream_.push(l)};var Li={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Qt=function(l){var d=Li[l]||l;return l&4096&&l===d?"":String.fromCharCode(d)},sn=function(l){return 32<=l&&l<=127||160<=l&&l<=255},Mt=function(l){this.windowNum=l,this.reset()};Mt.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Mt.prototype.getText=function(){return this.rows.join(`
`)},Mt.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Mt.prototype.newLine=function(l){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(l),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Mt.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Mt.prototype.addText=function(l){this.rows[this.rowIdx]+=l},Mt.prototype.backspace=function(){if(!this.isEmpty()){var l=this.rows[this.rowIdx];this.rows[this.rowIdx]=l.substr(0,l.length-1)}};var is=function(l,d,p){this.serviceNum=l,this.text="",this.currentWindow=new Mt(-1),this.windows=[],this.stream=p,typeof d=="string"&&this.createTextDecoder(d)};is.prototype.init=function(l,d){this.startPts=l;for(var p=0;p<8;p++)this.windows[p]=new Mt(p),typeof d=="function"&&(this.windows[p].beforeRowOverflow=d)},is.prototype.setCurrentWindow=function(l){this.currentWindow=this.windows[l]},is.prototype.createTextDecoder=function(l){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(l)}catch(d){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+l+" encoding. "+d})}};var Oe=function(l){l=l||{},Oe.prototype.init.call(this);var d=this,p=l.captionServices||{},f={},m;Object.keys(p).forEach(_=>{m=p[_],/^SERVICE/.test(_)&&(f[_]=m.encoding)}),this.serviceEncodings=f,this.current708Packet=null,this.services={},this.push=function(_){_.type===3?(d.new708Packet(),d.add708Bytes(_)):(d.current708Packet===null&&d.new708Packet(),d.add708Bytes(_))}};Oe.prototype=new ne,Oe.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Oe.prototype.add708Bytes=function(l){var d=l.ccData,p=d>>>8,f=d&255;this.current708Packet.ptsVals.push(l.pts),this.current708Packet.data.push(p),this.current708Packet.data.push(f)},Oe.prototype.push708Packet=function(){var l=this.current708Packet,d=l.data,p=null,f=null,m=0,_=d[m++];for(l.seq=_>>6,l.sizeCode=_&63;m<d.length;m++)_=d[m++],p=_>>5,f=_&31,p===7&&f>0&&(_=d[m++],p=_),this.pushServiceBlock(p,m,f),f>0&&(m+=f-1)},Oe.prototype.pushServiceBlock=function(l,d,p){var f,m=d,_=this.current708Packet.data,b=this.services[l];for(b||(b=this.initService(l,m));m<d+p&&m<_.length;m++)f=_[m],sn(f)?m=this.handleText(m,b):f===24?m=this.multiByteCharacter(m,b):f===16?m=this.extendedCommands(m,b):128<=f&&f<=135?m=this.setCurrentWindow(m,b):152<=f&&f<=159?m=this.defineWindow(m,b):f===136?m=this.clearWindows(m,b):f===140?m=this.deleteWindows(m,b):f===137?m=this.displayWindows(m,b):f===138?m=this.hideWindows(m,b):f===139?m=this.toggleWindows(m,b):f===151?m=this.setWindowAttributes(m,b):f===144?m=this.setPenAttributes(m,b):f===145?m=this.setPenColor(m,b):f===146?m=this.setPenLocation(m,b):f===143?b=this.reset(m,b):f===8?b.currentWindow.backspace():f===12?b.currentWindow.clearText():f===13?b.currentWindow.pendingNewLine=!0:f===14?b.currentWindow.clearText():f===141&&m++},Oe.prototype.extendedCommands=function(l,d){var p=this.current708Packet.data,f=p[++l];return sn(f)&&(l=this.handleText(l,d,{isExtended:!0})),l},Oe.prototype.getPts=function(l){return this.current708Packet.ptsVals[Math.floor(l/2)]},Oe.prototype.initService=function(l,d){var f="SERVICE"+l,p=this,f,m;return f in this.serviceEncodings&&(m=this.serviceEncodings[f]),this.services[l]=new is(l,m,p),this.services[l].init(this.getPts(d),function(_){p.flushDisplayed(_,p.services[l])}),this.services[l]},Oe.prototype.handleText=function(l,d,p){var f=p&&p.isExtended,m=p&&p.isMultiByte,_=this.current708Packet.data,b=f?4096:0,S=_[l],w=_[l+1],k=d.currentWindow,L,B;return d.textDecoder_&&!f?(m?(B=[S,w],l++):B=[S],L=d.textDecoder_.decode(new Uint8Array(B))):L=Qt(b|S),k.pendingNewLine&&!k.isEmpty()&&k.newLine(this.getPts(l)),k.pendingNewLine=!1,k.addText(L),l},Oe.prototype.multiByteCharacter=function(l,d){var p=this.current708Packet.data,f=p[l+1],m=p[l+2];return sn(f)&&sn(m)&&(l=this.handleText(++l,d,{isMultiByte:!0})),l},Oe.prototype.setCurrentWindow=function(l,d){var p=this.current708Packet.data,f=p[l],m=f&7;return d.setCurrentWindow(m),l},Oe.prototype.defineWindow=function(l,d){var p=this.current708Packet.data,f=p[l],m=f&7;d.setCurrentWindow(m);var _=d.currentWindow;return f=p[++l],_.visible=(f&32)>>5,_.rowLock=(f&16)>>4,_.columnLock=(f&8)>>3,_.priority=f&7,f=p[++l],_.relativePositioning=(f&128)>>7,_.anchorVertical=f&127,f=p[++l],_.anchorHorizontal=f,f=p[++l],_.anchorPoint=(f&240)>>4,_.rowCount=f&15,f=p[++l],_.columnCount=f&63,f=p[++l],_.windowStyle=(f&56)>>3,_.penStyle=f&7,_.virtualRowCount=_.rowCount+1,l},Oe.prototype.setWindowAttributes=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.winAttr;return f=p[++l],m.fillOpacity=(f&192)>>6,m.fillRed=(f&48)>>4,m.fillGreen=(f&12)>>2,m.fillBlue=f&3,f=p[++l],m.borderType=(f&192)>>6,m.borderRed=(f&48)>>4,m.borderGreen=(f&12)>>2,m.borderBlue=f&3,f=p[++l],m.borderType+=(f&128)>>5,m.wordWrap=(f&64)>>6,m.printDirection=(f&48)>>4,m.scrollDirection=(f&12)>>2,m.justify=f&3,f=p[++l],m.effectSpeed=(f&240)>>4,m.effectDirection=(f&12)>>2,m.displayEffect=f&3,l},Oe.prototype.flushDisplayed=function(l,d){for(var p=[],f=0;f<8;f++)d.windows[f].visible&&!d.windows[f].isEmpty()&&p.push(d.windows[f].getText());d.endPts=l,d.text=p.join(`

`),this.pushCaption(d),d.startPts=l},Oe.prototype.pushCaption=function(l){l.text!==""&&(this.trigger("data",{startPts:l.startPts,endPts:l.endPts,text:l.text,stream:"cc708_"+l.serviceNum}),l.text="",l.startPts=l.endPts)},Oe.prototype.displayWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&(d.windows[_].visible=1);return l},Oe.prototype.hideWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&(d.windows[_].visible=0);return l},Oe.prototype.toggleWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&(d.windows[_].visible^=1);return l},Oe.prototype.clearWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&d.windows[_].clearText();return l},Oe.prototype.deleteWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&d.windows[_].reset();return l},Oe.prototype.setPenAttributes=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.penAttr;return f=p[++l],m.textTag=(f&240)>>4,m.offset=(f&12)>>2,m.penSize=f&3,f=p[++l],m.italics=(f&128)>>7,m.underline=(f&64)>>6,m.edgeType=(f&56)>>3,m.fontStyle=f&7,l},Oe.prototype.setPenColor=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.penColor;return f=p[++l],m.fgOpacity=(f&192)>>6,m.fgRed=(f&48)>>4,m.fgGreen=(f&12)>>2,m.fgBlue=f&3,f=p[++l],m.bgOpacity=(f&192)>>6,m.bgRed=(f&48)>>4,m.bgGreen=(f&12)>>2,m.bgBlue=f&3,f=p[++l],m.edgeRed=(f&48)>>4,m.edgeGreen=(f&12)>>2,m.edgeBlue=f&3,l},Oe.prototype.setPenLocation=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.penLoc;return d.currentWindow.pendingNewLine=!0,f=p[++l],m.row=f&15,f=p[++l],m.column=f&63,l},Oe.prototype.reset=function(l,d){var p=this.getPts(l);return this.flushDisplayed(p,d),this.initService(d.serviceNum,l)};var lh={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ns=function(l){return l===null?"":(l=lh[l]||l,String.fromCharCode(l))},rs=14,ch=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],In=function(){for(var l=[],d=rs+1;d--;)l.push("");return l},He=function(l,d){He.prototype.init.call(this),this.field_=l||0,this.dataChannel_=d||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(p){var f,m,_,b,S;if(f=p.ccData&32639,f===this.lastControlCode_){this.lastControlCode_=null;return}if((f&61440)===4096?this.lastControlCode_=f:f!==this.PADDING_&&(this.lastControlCode_=null),_=f>>>8,b=f&255,f!==this.PADDING_)if(f===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(f===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(p.pts),this.flushDisplayed(p.pts),m=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=m,this.startPts_=p.pts;else if(f===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(p.pts);else if(f===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(p.pts);else if(f===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(p.pts);else if(f===this.CARRIAGE_RETURN_)this.clearFormatting(p.pts),this.flushDisplayed(p.pts),this.shiftRowsUp_(),this.startPts_=p.pts;else if(f===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(f===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(p.pts),this.displayed_=In();else if(f===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=In();else if(f===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(p.pts),this.displayed_=In()),this.mode_="paintOn",this.startPts_=p.pts;else if(this.isSpecialCharacter(_,b))_=(_&3)<<8,S=ns(_|b),this[this.mode_](p.pts,S),this.column_++;else if(this.isExtCharacter(_,b))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),_=(_&3)<<8,S=ns(_|b),this[this.mode_](p.pts,S),this.column_++;else if(this.isMidRowCode(_,b))this.clearFormatting(p.pts),this[this.mode_](p.pts," "),this.column_++,(b&14)===14&&this.addFormatting(p.pts,["i"]),(b&1)===1&&this.addFormatting(p.pts,["u"]);else if(this.isOffsetControlCode(_,b))this.column_+=b&3;else if(this.isPAC(_,b)){var w=ch.indexOf(f&7968);this.mode_==="rollUp"&&(w-this.rollUpRows_+1<0&&(w=this.rollUpRows_-1),this.setRollUp(p.pts,w)),w!==this.row_&&(this.clearFormatting(p.pts),this.row_=w),b&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(p.pts,["u"]),(f&16)===16&&(this.column_=((f&14)>>1)*4),this.isColorPAC(b)&&(b&14)===14&&this.addFormatting(p.pts,["i"])}else this.isNormalChar(_)&&(b===0&&(b=null),S=ns(_),S+=ns(b),this[this.mode_](p.pts,S),this.column_+=S.length)}};He.prototype=new ne,He.prototype.flushDisplayed=function(l){var d=this.displayed_.map(function(p,f){try{return p.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+f+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");d.length&&this.trigger("data",{startPts:this.startPts_,endPts:l,text:d,stream:this.name_})},He.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=In(),this.nonDisplayed_=In(),this.lastControlCode_=null,this.column_=0,this.row_=rs,this.rollUpRows_=2,this.formatting_=[]},He.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},He.prototype.isSpecialCharacter=function(l,d){return l===this.EXT_&&d>=48&&d<=63},He.prototype.isExtCharacter=function(l,d){return(l===this.EXT_+1||l===this.EXT_+2)&&d>=32&&d<=63},He.prototype.isMidRowCode=function(l,d){return l===this.EXT_&&d>=32&&d<=47},He.prototype.isOffsetControlCode=function(l,d){return l===this.OFFSET_&&d>=33&&d<=35},He.prototype.isPAC=function(l,d){return l>=this.BASE_&&l<this.BASE_+8&&d>=64&&d<=127},He.prototype.isColorPAC=function(l){return l>=64&&l<=79||l>=96&&l<=127},He.prototype.isNormalChar=function(l){return l>=32&&l<=127},He.prototype.setRollUp=function(l,d){if(this.mode_!=="rollUp"&&(this.row_=rs,this.mode_="rollUp",this.flushDisplayed(l),this.nonDisplayed_=In(),this.displayed_=In()),d!==void 0&&d!==this.row_)for(var p=0;p<this.rollUpRows_;p++)this.displayed_[d-p]=this.displayed_[this.row_-p],this.displayed_[this.row_-p]="";d===void 0&&(d=this.row_),this.topRow_=d-this.rollUpRows_+1},He.prototype.addFormatting=function(l,d){this.formatting_=this.formatting_.concat(d);var p=d.reduce(function(f,m){return f+"<"+m+">"},"");this[this.mode_](l,p)},He.prototype.clearFormatting=function(l){if(this.formatting_.length){var d=this.formatting_.reverse().reduce(function(p,f){return p+"</"+f+">"},"");this.formatting_=[],this[this.mode_](l,d)}},He.prototype.popOn=function(l,d){var p=this.nonDisplayed_[this.row_];p+=d,this.nonDisplayed_[this.row_]=p},He.prototype.rollUp=function(l,d){var p=this.displayed_[this.row_];p+=d,this.displayed_[this.row_]=p},He.prototype.shiftRowsUp_=function(){var l;for(l=0;l<this.topRow_;l++)this.displayed_[l]="";for(l=this.row_+1;l<rs+1;l++)this.displayed_[l]="";for(l=this.topRow_;l<this.row_;l++)this.displayed_[l]=this.displayed_[l+1];this.displayed_[this.row_]=""},He.prototype.paintOn=function(l,d){var p=this.displayed_[this.row_];p+=d,this.displayed_[this.row_]=p};var Tu={CaptionStream:be,Cea608Stream:He,Cea708Stream:Oe},ss={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},i1=t,n1=8589934592,r1=4294967296,Mm="shared",hh=function(l,d){var p=1;for(l>d&&(p=-1);Math.abs(d-l)>r1;)l+=p*n1;return l},dh=function(l){var d,p;dh.prototype.init.call(this),this.type_=l||Mm,this.push=function(f){this.type_!==Mm&&f.type!==this.type_||(p===void 0&&(p=f.dts),f.dts=hh(f.dts,p),f.pts=hh(f.pts,p),d=f.dts,this.trigger("data",f))},this.flush=function(){p=d,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){p=void 0,d=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};dh.prototype=new i1;var Fm={TimestampRolloverStream:dh,handleRollover:hh},s1=(l,d,p)=>{if(!l)return-1;for(var f=p;f<l.length;f++)if(l[f]===d)return f;return-1},a1={typedArrayIndexOf:s1},bu=a1.typedArrayIndexOf,Eu={Iso88591:0,Utf16:1,Utf16be:2,Utf8:3},Bm=function(l,d,p){var f,m="";for(f=d;f<p;f++)m+="%"+("00"+l[f].toString(16)).slice(-2);return m},La=function(l,d,p){return decodeURIComponent(Bm(l,d,p))},Na=function(l,d,p){return unescape(Bm(l,d,p))},Ma=function(l){return l[0]<<21|l[1]<<14|l[2]<<7|l[3]},Fa={APIC:function(l){var d=1,p,f,m="-->";l.data[0]===Eu.Utf8&&(p=bu(l.data,0,d),!(p<0)&&(l.mimeType=Na(l.data,d,p),d=p+1,l.pictureType=l.data[d],d++,f=bu(l.data,0,d),!(f<0)&&(l.description=La(l.data,d,f),d=f+1,l.mimeType===m?l.url=Na(l.data,d,l.data.length):l.pictureData=l.data.subarray(d,l.data.length))))},"T*":function(l){l.data[0]===Eu.Utf8&&(l.value=La(l.data,1,l.data.length).replace(/\0*$/,""),l.values=l.value.split("\0"))},TXXX:function(l){var d;l.data[0]===Eu.Utf8&&(d=bu(l.data,0,1),d!==-1&&(l.description=La(l.data,1,d),l.value=La(l.data,d+1,l.data.length).replace(/\0*$/,""),l.data=l.value))},"W*":function(l){l.url=Na(l.data,0,l.data.length).replace(/\0.*$/,"")},WXXX:function(l){var d;l.data[0]===Eu.Utf8&&(d=bu(l.data,0,1),d!==-1&&(l.description=La(l.data,1,d),l.url=Na(l.data,d+1,l.data.length).replace(/\0.*$/,"")))},PRIV:function(l){var d;for(d=0;d<l.data.length;d++)if(l.data[d]===0){l.owner=Na(l.data,0,d);break}l.privateData=l.data.subarray(d+1),l.data=l.privateData}},o1=function(l){var d,p,f=10,m=0,_=[];if(!(l.length<10||l[0]!=="I".charCodeAt(0)||l[1]!=="D".charCodeAt(0)||l[2]!=="3".charCodeAt(0))){m=Ma(l.subarray(6,10)),m+=10;var b=l[5]&64;b&&(f+=4,f+=Ma(l.subarray(10,14)),m-=Ma(l.subarray(16,20)));do{if(d=Ma(l.subarray(f+4,f+8)),d<1)break;p=String.fromCharCode(l[f],l[f+1],l[f+2],l[f+3]);var S={id:p,data:l.subarray(f+10,f+d+10)};S.key=S.id,Fa[S.id]?Fa[S.id](S):S.id[0]==="T"?Fa["T*"](S):S.id[0]==="W"&&Fa["W*"](S),_.push(S),f+=10,f+=d}while(f<m);return _}},Um={parseId3Frames:o1,parseSyncSafeInteger:Ma,frameParsers:Fa},u1=t,l1=ss,er=Um,Su;Su=function(l){var d={descriptor:l&&l.descriptor},p=0,f=[],m=0,_;if(Su.prototype.init.call(this),this.dispatchType=l1.METADATA_STREAM_TYPE.toString(16),d.descriptor)for(_=0;_<d.descriptor.length;_++)this.dispatchType+=("00"+d.descriptor[_].toString(16)).slice(-2);this.push=function(b){var S,w,k,L,B,J;if(b.type==="timed-metadata"){if(b.dataAlignmentIndicator&&(m=0,f.length=0),f.length===0&&(b.data.length<10||b.data[0]!=="I".charCodeAt(0)||b.data[1]!=="D".charCodeAt(0)||b.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(f.push(b),m+=b.data.byteLength,f.length===1&&(p=er.parseSyncSafeInteger(b.data.subarray(6,10)),p+=10),!(m<p)){for(S={data:new Uint8Array(p),frames:[],pts:f[0].pts,dts:f[0].dts},B=0;B<p;)S.data.set(f[0].data.subarray(0,p-B),B),B+=f[0].data.byteLength,m-=f[0].data.byteLength,f.shift();w=10,S.data[5]&64&&(w+=4,w+=er.parseSyncSafeInteger(S.data.subarray(10,14)),p-=er.parseSyncSafeInteger(S.data.subarray(16,20)));do{if(k=er.parseSyncSafeInteger(S.data.subarray(w+4,w+8)),k<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(J=String.fromCharCode(S.data[w],S.data[w+1],S.data[w+2],S.data[w+3]),L={id:J,data:S.data.subarray(w+10,w+k+10)},L.key=L.id,er.frameParsers[L.id]?er.frameParsers[L.id](L):L.id[0]==="T"?er.frameParsers["T*"](L):L.id[0]==="W"&&er.frameParsers["W*"](L),L.owner==="com.apple.streaming.transportStreamTimestamp"){var q=L.data,le=(q[3]&1)<<30|q[4]<<22|q[5]<<14|q[6]<<6|q[7]>>>2;le*=4,le+=q[7]&3,L.timeStamp=le,S.pts===void 0&&S.dts===void 0&&(S.pts=L.timeStamp,S.dts=L.timeStamp),this.trigger("timestamp",L)}S.frames.push(L),w+=10,w+=k}while(w<p);this.trigger("data",S)}}}},Su.prototype=new u1;var c1=Su,fh=t,ph=Tu,zi=ss,h1=Fm.TimestampRolloverStream,xu,Ba,Cu,as=188,mh=71;xu=function(){var l=new Uint8Array(as),d=0;xu.prototype.init.call(this),this.push=function(p){var f=0,m=as,_;for(d?(_=new Uint8Array(p.byteLength+d),_.set(l.subarray(0,d)),_.set(p,d),d=0):_=p;m<_.byteLength;){if(_[f]===mh&&_[m]===mh){this.trigger("data",_.subarray(f,m)),f+=as,m+=as;continue}f++,m++}f<_.byteLength&&(l.set(_.subarray(f),0),d=_.byteLength-f)},this.flush=function(){d===as&&l[0]===mh&&(this.trigger("data",l),d=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){d=0,this.trigger("reset")}},xu.prototype=new fh,Ba=function(){var l,d,p,f;Ba.prototype.init.call(this),f=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,l=function(m,_){var b=0;_.payloadUnitStartIndicator&&(b+=m[b]+1),_.type==="pat"?d(m.subarray(b),_):p(m.subarray(b),_)},d=function(m,_){_.section_number=m[7],_.last_section_number=m[8],f.pmtPid=(m[10]&31)<<8|m[11],_.pmtPid=f.pmtPid},p=function(m,_){var b,S,w,k;if(m[5]&1){for(f.programMapTable={video:null,audio:null,"timed-metadata":{}},b=(m[1]&15)<<8|m[2],S=3+b-4,w=(m[10]&15)<<8|m[11],k=12+w;k<S;){var L=m[k],B=(m[k+1]&31)<<8|m[k+2];L===zi.H264_STREAM_TYPE&&f.programMapTable.video===null?f.programMapTable.video=B:L===zi.ADTS_STREAM_TYPE&&f.programMapTable.audio===null?f.programMapTable.audio=B:L===zi.METADATA_STREAM_TYPE&&(f.programMapTable["timed-metadata"][B]=L),k+=((m[k+3]&15)<<8|m[k+4])+5}_.programMapTable=f.programMapTable}},this.push=function(m){var _={},b=4;if(_.payloadUnitStartIndicator=!!(m[1]&64),_.pid=m[1]&31,_.pid<<=8,_.pid|=m[2],(m[3]&48)>>>4>1&&(b+=m[b]+1),_.pid===0)_.type="pat",l(m.subarray(b),_),this.trigger("data",_);else if(_.pid===this.pmtPid)for(_.type="pmt",l(m.subarray(b),_),this.trigger("data",_);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([m,b,_]):this.processPes_(m,b,_)},this.processPes_=function(m,_,b){b.pid===this.programMapTable.video?b.streamType=zi.H264_STREAM_TYPE:b.pid===this.programMapTable.audio?b.streamType=zi.ADTS_STREAM_TYPE:b.streamType=this.programMapTable["timed-metadata"][b.pid],b.type="pes",b.data=m.subarray(_),this.trigger("data",b)}},Ba.prototype=new fh,Ba.STREAM_TYPES={h264:27,adts:15},Cu=function(){var l=this,d=!1,p={data:[],size:0},f={data:[],size:0},m={data:[],size:0},_,b=function(w,k){var L;const B=w[0]<<16|w[1]<<8|w[2];k.data=new Uint8Array,B===1&&(k.packetLength=6+(w[4]<<8|w[5]),k.dataAlignmentIndicator=(w[6]&4)!==0,L=w[7],L&192&&(k.pts=(w[9]&14)<<27|(w[10]&255)<<20|(w[11]&254)<<12|(w[12]&255)<<5|(w[13]&254)>>>3,k.pts*=4,k.pts+=(w[13]&6)>>>1,k.dts=k.pts,L&64&&(k.dts=(w[14]&14)<<27|(w[15]&255)<<20|(w[16]&254)<<12|(w[17]&255)<<5|(w[18]&254)>>>3,k.dts*=4,k.dts+=(w[18]&6)>>>1)),k.data=w.subarray(9+w[8]))},S=function(w,k,L){var B=new Uint8Array(w.size),J={type:k},q=0,le=0,fe=!1,yt;if(!(!w.data.length||w.size<9)){for(J.trackId=w.data[0].pid,q=0;q<w.data.length;q++)yt=w.data[q],B.set(yt.data,le),le+=yt.data.byteLength;b(B,J),fe=k==="video"||J.packetLength<=w.size,(L||fe)&&(w.size=0,w.data.length=0),fe&&l.trigger("data",J)}};Cu.prototype.init.call(this),this.push=function(w){({pat:function(){},pes:function(){var k,L;switch(w.streamType){case zi.H264_STREAM_TYPE:k=p,L="video";break;case zi.ADTS_STREAM_TYPE:k=f,L="audio";break;case zi.METADATA_STREAM_TYPE:k=m,L="timed-metadata";break;default:return}w.payloadUnitStartIndicator&&S(k,L,!0),k.data.push(w),k.size+=w.data.byteLength},pmt:function(){var k={type:"metadata",tracks:[]};_=w.programMapTable,_.video!==null&&k.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.video,codec:"avc",type:"video"}),_.audio!==null&&k.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.audio,codec:"adts",type:"audio"}),d=!0,l.trigger("data",k)}})[w.type]()},this.reset=function(){p.size=0,p.data.length=0,f.size=0,f.data.length=0,this.trigger("reset")},this.flushStreams_=function(){S(p,"video"),S(f,"audio"),S(m,"timed-metadata")},this.flush=function(){if(!d&&_){var w={type:"metadata",tracks:[]};_.video!==null&&w.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.video,codec:"avc",type:"video"}),_.audio!==null&&w.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.audio,codec:"adts",type:"audio"}),l.trigger("data",w)}d=!1,this.flushStreams_(),this.trigger("done")}},Cu.prototype=new fh;var Vm={PAT_PID:0,MP2T_PACKET_LENGTH:as,TransportPacketStream:xu,TransportParseStream:Ba,ElementaryStream:Cu,TimestampRolloverStream:h1,CaptionStream:ph.CaptionStream,Cea608Stream:ph.Cea608Stream,Cea708Stream:ph.Cea708Stream,MetadataStream:c1};for(var gh in zi)zi.hasOwnProperty(gh)&&(Vm[gh]=zi[gh]);var d1=Vm,f1=t,p1=qe.ONE_SECOND_IN_TS,wu,jm=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];wu=function(l){var d,p=0;wu.prototype.init.call(this),this.skipWarn_=function(f,m){this.trigger("log",{level:"warn",message:`adts skiping bytes ${f} to ${m} in frame ${p} outside syncword`})},this.push=function(f){var m=0,_,b,S,w,k;if(l||(p=0),f.type==="audio"){d&&d.length?(S=d,d=new Uint8Array(S.byteLength+f.data.byteLength),d.set(S),d.set(f.data,S.byteLength)):d=f.data;for(var L;m+7<d.length;){if(d[m]!==255||(d[m+1]&246)!==240){typeof L!="number"&&(L=m),m++;continue}if(typeof L=="number"&&(this.skipWarn_(L,m),L=null),b=(~d[m+1]&1)*2,_=(d[m+3]&3)<<11|d[m+4]<<3|(d[m+5]&224)>>5,w=((d[m+6]&3)+1)*1024,k=w*p1/jm[(d[m+2]&60)>>>2],d.byteLength-m<_)break;this.trigger("data",{pts:f.pts+p*k,dts:f.dts+p*k,sampleCount:w,audioobjecttype:(d[m+2]>>>6&3)+1,channelcount:(d[m+2]&1)<<2|(d[m+3]&192)>>>6,samplerate:jm[(d[m+2]&60)>>>2],samplingfrequencyindex:(d[m+2]&60)>>>2,samplesize:16,data:d.subarray(m+7+b,m+_)}),p++,m+=_}typeof L=="number"&&(this.skipWarn_(L,m),L=null),d=d.subarray(m)}},this.flush=function(){p=0,this.trigger("done")},this.reset=function(){d=void 0,this.trigger("reset")},this.endTimeline=function(){d=void 0,this.trigger("endedtimeline")}},wu.prototype=new f1;var m1=wu,$m;$m=function(l){var d=l.byteLength,p=0,f=0;this.length=function(){return 8*d},this.bitsAvailable=function(){return 8*d+f},this.loadWord=function(){var m=l.byteLength-d,_=new Uint8Array(4),b=Math.min(4,d);if(b===0)throw new Error("no bytes available");_.set(l.subarray(m,m+b)),p=new DataView(_.buffer).getUint32(0),f=b*8,d-=b},this.skipBits=function(m){var _;f>m?(p<<=m,f-=m):(m-=f,_=Math.floor(m/8),m-=_*8,d-=_,this.loadWord(),p<<=m,f-=m)},this.readBits=function(m){var _=Math.min(f,m),b=p>>>32-_;return f-=_,f>0?p<<=_:d>0&&this.loadWord(),_=m-_,_>0?b<<_|this.readBits(_):b},this.skipLeadingZeros=function(){var m;for(m=0;m<f;++m)if(p&2147483648>>>m)return p<<=m,f-=m,m;return this.loadWord(),m+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var m=this.skipLeadingZeros();return this.readBits(m+1)-1},this.readExpGolomb=function(){var m=this.readUnsignedExpGolomb();return 1&m?1+m>>>1:-1*(m>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var g1=$m,qm=t,_1=g1,Au,Ua,Hm;Ua=function(){var l=0,d,p;Ua.prototype.init.call(this),this.push=function(f){var m;p?(m=new Uint8Array(p.byteLength+f.data.byteLength),m.set(p),m.set(f.data,p.byteLength),p=m):p=f.data;for(var _=p.byteLength;l<_-3;l++)if(p[l+2]===1){d=l+5;break}for(;d<_;)switch(p[d]){case 0:if(p[d-1]!==0){d+=2;break}else if(p[d-2]!==0){d++;break}l+3!==d-2&&this.trigger("data",p.subarray(l+3,d-2));do d++;while(p[d]!==1&&d<_);l=d-2,d+=3;break;case 1:if(p[d-1]!==0||p[d-2]!==0){d+=3;break}this.trigger("data",p.subarray(l+3,d-2)),l=d-2,d+=3;break;default:d+=3;break}p=p.subarray(l),d-=l,l=0},this.reset=function(){p=null,l=0,this.trigger("reset")},this.flush=function(){p&&p.byteLength>3&&this.trigger("data",p.subarray(l+3)),p=null,l=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Ua.prototype=new qm,Hm={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Au=function(){var l=new Ua,d,p,f,m,_,b,S;Au.prototype.init.call(this),d=this,this.push=function(w){w.type==="video"&&(p=w.trackId,f=w.pts,m=w.dts,l.push(w))},l.on("data",function(w){var k={trackId:p,pts:f,dts:m,data:w,nalUnitTypeCode:w[0]&31};switch(k.nalUnitTypeCode){case 5:k.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:k.nalUnitType="sei_rbsp",k.escapedRBSP=_(w.subarray(1));break;case 7:k.nalUnitType="seq_parameter_set_rbsp",k.escapedRBSP=_(w.subarray(1)),k.config=b(k.escapedRBSP);break;case 8:k.nalUnitType="pic_parameter_set_rbsp";break;case 9:k.nalUnitType="access_unit_delimiter_rbsp";break}d.trigger("data",k)}),l.on("done",function(){d.trigger("done")}),l.on("partialdone",function(){d.trigger("partialdone")}),l.on("reset",function(){d.trigger("reset")}),l.on("endedtimeline",function(){d.trigger("endedtimeline")}),this.flush=function(){l.flush()},this.partialFlush=function(){l.partialFlush()},this.reset=function(){l.reset()},this.endTimeline=function(){l.endTimeline()},S=function(w,k){var L=8,B=8,J,q;for(J=0;J<w;J++)B!==0&&(q=k.readExpGolomb(),B=(L+q+256)%256),L=B===0?L:B},_=function(w){for(var k=w.byteLength,L=[],B=1,J,q;B<k-2;)w[B]===0&&w[B+1]===0&&w[B+2]===3?(L.push(B+2),B+=2):B++;if(L.length===0)return w;J=k-L.length,q=new Uint8Array(J);var le=0;for(B=0;B<J;le++,B++)le===L[0]&&(le++,L.shift()),q[B]=w[le];return q},b=function(w){var k=0,L=0,B=0,J=0,q,le,fe,yt,Ni,xr,vg,Tg,bg,wh,Eg,lt=[1,1],Sg,Cr;if(q=new _1(w),le=q.readUnsignedByte(),yt=q.readUnsignedByte(),fe=q.readUnsignedByte(),q.skipUnsignedExpGolomb(),Hm[le]&&(Ni=q.readUnsignedExpGolomb(),Ni===3&&q.skipBits(1),q.skipUnsignedExpGolomb(),q.skipUnsignedExpGolomb(),q.skipBits(1),q.readBoolean()))for(Eg=Ni!==3?8:12,Cr=0;Cr<Eg;Cr++)q.readBoolean()&&(Cr<6?S(16,q):S(64,q));if(q.skipUnsignedExpGolomb(),xr=q.readUnsignedExpGolomb(),xr===0)q.readUnsignedExpGolomb();else if(xr===1)for(q.skipBits(1),q.skipExpGolomb(),q.skipExpGolomb(),vg=q.readUnsignedExpGolomb(),Cr=0;Cr<vg;Cr++)q.skipExpGolomb();if(q.skipUnsignedExpGolomb(),q.skipBits(1),Tg=q.readUnsignedExpGolomb(),bg=q.readUnsignedExpGolomb(),wh=q.readBits(1),wh===0&&q.skipBits(1),q.skipBits(1),q.readBoolean()&&(k=q.readUnsignedExpGolomb(),L=q.readUnsignedExpGolomb(),B=q.readUnsignedExpGolomb(),J=q.readUnsignedExpGolomb()),q.readBoolean()&&q.readBoolean()){switch(Sg=q.readUnsignedByte(),Sg){case 1:lt=[1,1];break;case 2:lt=[12,11];break;case 3:lt=[10,11];break;case 4:lt=[16,11];break;case 5:lt=[40,33];break;case 6:lt=[24,11];break;case 7:lt=[20,11];break;case 8:lt=[32,11];break;case 9:lt=[80,33];break;case 10:lt=[18,11];break;case 11:lt=[15,11];break;case 12:lt=[64,33];break;case 13:lt=[160,99];break;case 14:lt=[4,3];break;case 15:lt=[3,2];break;case 16:lt=[2,1];break;case 255:{lt=[q.readUnsignedByte()<<8|q.readUnsignedByte(),q.readUnsignedByte()<<8|q.readUnsignedByte()];break}}lt&&lt[0]/lt[1]}return{profileIdc:le,levelIdc:fe,profileCompatibility:yt,width:(Tg+1)*16-k*2-L*2,height:(2-wh)*(bg+1)*16-B*2-J*2,sarRatio:lt}}},Au.prototype=new qm;var y1={H264Stream:Au,NalByteStream:Ua},v1=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Gm=function(l,d){var p=l[d+6]<<21|l[d+7]<<14|l[d+8]<<7|l[d+9],f=l[d+5],m=(f&16)>>4;return p=p>=0?p:0,m?p+20:p+10},zm=function(l,d){return l.length-d<10||l[d]!=="I".charCodeAt(0)||l[d+1]!=="D".charCodeAt(0)||l[d+2]!=="3".charCodeAt(0)?d:(d+=Gm(l,d),zm(l,d))},T1=function(l){var d=zm(l,0);return l.length>=d+2&&(l[d]&255)===255&&(l[d+1]&240)===240&&(l[d+1]&22)===16},Wm=function(l){return l[0]<<21|l[1]<<14|l[2]<<7|l[3]},b1=function(l,d,p){var f,m="";for(f=d;f<p;f++)m+="%"+("00"+l[f].toString(16)).slice(-2);return m},E1=function(l,d,p){return unescape(b1(l,d,p))},S1=function(l,d){var p=(l[d+5]&224)>>5,f=l[d+4]<<3,m=l[d+3]&6144;return m|f|p},x1=function(l,d){return l[d]==="I".charCodeAt(0)&&l[d+1]==="D".charCodeAt(0)&&l[d+2]==="3".charCodeAt(0)?"timed-metadata":l[d]&!0&&(l[d+1]&240)===240?"audio":null},C1=function(l){for(var d=0;d+5<l.length;){if(l[d]!==255||(l[d+1]&246)!==240){d++;continue}return v1[(l[d+2]&60)>>>2]}return null},w1=function(l){var d,p,f,m;d=10,l[5]&64&&(d+=4,d+=Wm(l.subarray(10,14)));do{if(p=Wm(l.subarray(d+4,d+8)),p<1)return null;if(m=String.fromCharCode(l[d],l[d+1],l[d+2],l[d+3]),m==="PRIV"){f=l.subarray(d+10,d+p+10);for(var _=0;_<f.byteLength;_++)if(f[_]===0){var b=E1(f,0,_);if(b==="com.apple.streaming.transportStreamTimestamp"){var S=f.subarray(_+1),w=(S[3]&1)<<30|S[4]<<22|S[5]<<14|S[6]<<6|S[7]>>>2;return w*=4,w+=S[7]&3,w}break}}d+=10,d+=p}while(d<l.byteLength);return null},_h={isLikelyAacData:T1,parseId3TagSize:Gm,parseAdtsSize:S1,parseType:x1,parseSampleRate:C1,parseAacTimestamp:w1},A1=t,Km=_h,Du;Du=function(){var l=new Uint8Array,d=0;Du.prototype.init.call(this),this.setTimestamp=function(p){d=p},this.push=function(p){var f=0,m=0,_,b,S,w;for(l.length?(w=l.length,l=new Uint8Array(p.byteLength+w),l.set(l.subarray(0,w)),l.set(p,w)):l=p;l.length-m>=3;){if(l[m]==="I".charCodeAt(0)&&l[m+1]==="D".charCodeAt(0)&&l[m+2]==="3".charCodeAt(0)){if(l.length-m<10||(f=Km.parseId3TagSize(l,m),m+f>l.length))break;b={type:"timed-metadata",data:l.subarray(m,m+f)},this.trigger("data",b),m+=f;continue}else if((l[m]&255)===255&&(l[m+1]&240)===240){if(l.length-m<7||(f=Km.parseAdtsSize(l,m),m+f>l.length))break;S={type:"audio",data:l.subarray(m,m+f),pts:d,dts:d},this.trigger("data",S),m+=f;continue}m++}_=l.length-m,_>0?l=l.subarray(m):l=new Uint8Array},this.reset=function(){l=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){l=new Uint8Array,this.trigger("endedtimeline")}},Du.prototype=new A1;var D1=Du,I1=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],k1=I1,P1=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],R1=P1,Iu=t,Va=rn,ja=Yt,ku=Oa,Wi=C,kn=d1,Pu=qe,Xm=m1,O1=y1.H264Stream,L1=D1,N1=_h.isLikelyAacData,M1=qe.ONE_SECOND_IN_TS,yh=k1,vh=R1,$a,os,Ru,Er,F1=function(l,d){d.stream=l,this.trigger("log",d)},Ym=function(l,d){for(var p=Object.keys(d),f=0;f<p.length;f++){var m=p[f];m==="headOfPipeline"||!d[m].on||d[m].on("log",F1.bind(l,m))}},Qm=function(l,d){var p;if(l.length!==d.length)return!1;for(p=0;p<l.length;p++)if(l[p]!==d[p])return!1;return!0},Th=function(l,d,p,f,m,_){var b=p-d,S=f-d,w=m-p;return{start:{dts:l,pts:l+b},end:{dts:l+S,pts:l+w},prependedContentDuration:_,baseMediaDecodeTime:l}};os=function(l,d){var p=[],f,m=0,_=0,b=1/0;d=d||{},f=d.firstSequenceNumber||0,os.prototype.init.call(this),this.push=function(S){Wi.collectDtsInfo(l,S),l&&yh.forEach(function(w){l[w]=S[w]}),p.push(S)},this.setEarliestDts=function(S){m=S},this.setVideoBaseMediaDecodeTime=function(S){b=S},this.setAudioAppendStart=function(S){_=S},this.flush=function(){var S,w,k,L,B,J,q;if(p.length===0){this.trigger("done","AudioSegmentStream");return}S=ku.trimAdtsFramesByEarliestDts(p,l,m),l.baseMediaDecodeTime=Wi.calculateTrackBaseMediaDecodeTime(l,d.keepOriginalTimestamps),q=ku.prefixWithSilence(l,S,_,b),l.samples=ku.generateSampleTable(S),k=Va.mdat(ku.concatenateFrameData(S)),p=[],w=Va.moof(f,[l]),L=new Uint8Array(w.byteLength+k.byteLength),f++,L.set(w),L.set(k,w.byteLength),Wi.clearDtsInfo(l),B=Math.ceil(M1*1024/l.samplerate),S.length&&(J=S.length*B,this.trigger("segmentTimingInfo",Th(Pu.audioTsToVideoTs(l.baseMediaDecodeTime,l.samplerate),S[0].dts,S[0].pts,S[0].dts+J,S[0].pts+J,q||0)),this.trigger("timingInfo",{start:S[0].pts,end:S[0].pts+J})),this.trigger("data",{track:l,boxes:L}),this.trigger("done","AudioSegmentStream")},this.reset=function(){Wi.clearDtsInfo(l),p=[],this.trigger("reset")}},os.prototype=new Iu,$a=function(l,d){var p,f=[],m=[],_,b;d=d||{},p=d.firstSequenceNumber||0,$a.prototype.init.call(this),delete l.minPTS,this.gopCache_=[],this.push=function(S){Wi.collectDtsInfo(l,S),S.nalUnitType==="seq_parameter_set_rbsp"&&!_&&(_=S.config,l.sps=[S.data],vh.forEach(function(w){l[w]=_[w]},this)),S.nalUnitType==="pic_parameter_set_rbsp"&&!b&&(b=S.data,l.pps=[S.data]),f.push(S)},this.flush=function(){for(var S,w,k,L,B,J,q=0,le,fe;f.length&&f[0].nalUnitType!=="access_unit_delimiter_rbsp";)f.shift();if(f.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(S=ja.groupNalsIntoFrames(f),k=ja.groupFramesIntoGops(S),k[0][0].keyFrame||(w=this.getGopForFusion_(f[0],l),w?(q=w.duration,k.unshift(w),k.byteLength+=w.byteLength,k.nalCount+=w.nalCount,k.pts=w.pts,k.dts=w.dts,k.duration+=w.duration):k=ja.extendFirstKeyFrame(k)),m.length){var yt;if(d.alignGopsAtEnd?yt=this.alignGopsAtEnd_(k):yt=this.alignGopsAtStart_(k),!yt){this.gopCache_.unshift({gop:k.pop(),pps:l.pps,sps:l.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),f=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}Wi.clearDtsInfo(l),k=yt}Wi.collectDtsInfo(l,k),l.samples=ja.generateSampleTable(k),B=Va.mdat(ja.concatenateNalData(k)),l.baseMediaDecodeTime=Wi.calculateTrackBaseMediaDecodeTime(l,d.keepOriginalTimestamps),this.trigger("processedGopsInfo",k.map(function(Ni){return{pts:Ni.pts,dts:Ni.dts,byteLength:Ni.byteLength}})),le=k[0],fe=k[k.length-1],this.trigger("segmentTimingInfo",Th(l.baseMediaDecodeTime,le.dts,le.pts,fe.dts+fe.duration,fe.pts+fe.duration,q)),this.trigger("timingInfo",{start:k[0].pts,end:k[k.length-1].pts+k[k.length-1].duration}),this.gopCache_.unshift({gop:k.pop(),pps:l.pps,sps:l.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),f=[],this.trigger("baseMediaDecodeTime",l.baseMediaDecodeTime),this.trigger("timelineStartInfo",l.timelineStartInfo),L=Va.moof(p,[l]),J=new Uint8Array(L.byteLength+B.byteLength),p++,J.set(L),J.set(B,L.byteLength),this.trigger("data",{track:l,boxes:J}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),f=[],this.gopCache_.length=0,m.length=0,this.trigger("reset")},this.resetStream_=function(){Wi.clearDtsInfo(l),_=void 0,b=void 0},this.getGopForFusion_=function(S){var w=45e3,k=1e4,L=1/0,B,J,q,le,fe;for(fe=0;fe<this.gopCache_.length;fe++)le=this.gopCache_[fe],q=le.gop,!(!(l.pps&&Qm(l.pps[0],le.pps[0]))||!(l.sps&&Qm(l.sps[0],le.sps[0])))&&(q.dts<l.timelineStartInfo.dts||(B=S.dts-q.dts-q.duration,B>=-k&&B<=w&&(!J||L>B)&&(J=le,L=B)));return J?J.gop:null},this.alignGopsAtStart_=function(S){var w,k,L,B,J,q,le,fe;for(J=S.byteLength,q=S.nalCount,le=S.duration,w=k=0;w<m.length&&k<S.length&&(L=m[w],B=S[k],L.pts!==B.pts);){if(B.pts>L.pts){w++;continue}k++,J-=B.byteLength,q-=B.nalCount,le-=B.duration}return k===0?S:k===S.length?null:(fe=S.slice(k),fe.byteLength=J,fe.duration=le,fe.nalCount=q,fe.pts=fe[0].pts,fe.dts=fe[0].dts,fe)},this.alignGopsAtEnd_=function(S){var w,k,L,B,J,q;for(w=m.length-1,k=S.length-1,J=null,q=!1;w>=0&&k>=0;){if(L=m[w],B=S[k],L.pts===B.pts){q=!0;break}if(L.pts>B.pts){w--;continue}w===m.length-1&&(J=k),k--}if(!q&&J===null)return null;var le;if(q?le=k:le=J,le===0)return S;var fe=S.slice(le),yt=fe.reduce(function(Ni,xr){return Ni.byteLength+=xr.byteLength,Ni.duration+=xr.duration,Ni.nalCount+=xr.nalCount,Ni},{byteLength:0,duration:0,nalCount:0});return fe.byteLength=yt.byteLength,fe.duration=yt.duration,fe.nalCount=yt.nalCount,fe.pts=fe[0].pts,fe.dts=fe[0].dts,fe},this.alignGopsWith=function(S){m=S}},$a.prototype=new Iu,Er=function(l,d){this.numberOfTracks=0,this.metadataStream=d,l=l||{},typeof l.remux<"u"?this.remuxTracks=!!l.remux:this.remuxTracks=!0,typeof l.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=l.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Er.prototype.init.call(this),this.push=function(p){if(p.text)return this.pendingCaptions.push(p);if(p.frames)return this.pendingMetadata.push(p);this.pendingTracks.push(p.track),this.pendingBytes+=p.boxes.byteLength,p.track.type==="video"&&(this.videoTrack=p.track,this.pendingBoxes.push(p.boxes)),p.track.type==="audio"&&(this.audioTrack=p.track,this.pendingBoxes.unshift(p.boxes))}},Er.prototype=new Iu,Er.prototype.flush=function(l){var d=0,p={captions:[],captionStreams:{},metadata:[],info:{}},f,m,_,b=0,S;if(this.pendingTracks.length<this.numberOfTracks){if(l!=="VideoSegmentStream"&&l!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(b=this.videoTrack.timelineStartInfo.pts,vh.forEach(function(w){p.info[w]=this.videoTrack[w]},this)):this.audioTrack&&(b=this.audioTrack.timelineStartInfo.pts,yh.forEach(function(w){p.info[w]=this.audioTrack[w]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?p.type=this.pendingTracks[0].type:p.type="combined",this.emittedTracks+=this.pendingTracks.length,_=Va.initSegment(this.pendingTracks),p.initSegment=new Uint8Array(_.byteLength),p.initSegment.set(_),p.data=new Uint8Array(this.pendingBytes),S=0;S<this.pendingBoxes.length;S++)p.data.set(this.pendingBoxes[S],d),d+=this.pendingBoxes[S].byteLength;for(S=0;S<this.pendingCaptions.length;S++)f=this.pendingCaptions[S],f.startTime=Pu.metadataTsToSeconds(f.startPts,b,this.keepOriginalTimestamps),f.endTime=Pu.metadataTsToSeconds(f.endPts,b,this.keepOriginalTimestamps),p.captionStreams[f.stream]=!0,p.captions.push(f);for(S=0;S<this.pendingMetadata.length;S++)m=this.pendingMetadata[S],m.cueTime=Pu.metadataTsToSeconds(m.pts,b,this.keepOriginalTimestamps),p.metadata.push(m);for(p.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",p),S=0;S<p.captions.length;S++)f=p.captions[S],this.trigger("caption",f);for(S=0;S<p.metadata.length;S++)m=p.metadata[S],this.trigger("id3Frame",m)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Er.prototype.setRemux=function(l){this.remuxTracks=l},Ru=function(l){var d=this,p=!0,f,m;Ru.prototype.init.call(this),l=l||{},this.baseMediaDecodeTime=l.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var _={};this.transmuxPipeline_=_,_.type="aac",_.metadataStream=new kn.MetadataStream,_.aacStream=new L1,_.audioTimestampRolloverStream=new kn.TimestampRolloverStream("audio"),_.timedMetadataTimestampRolloverStream=new kn.TimestampRolloverStream("timed-metadata"),_.adtsStream=new Xm,_.coalesceStream=new Er(l,_.metadataStream),_.headOfPipeline=_.aacStream,_.aacStream.pipe(_.audioTimestampRolloverStream).pipe(_.adtsStream),_.aacStream.pipe(_.timedMetadataTimestampRolloverStream).pipe(_.metadataStream).pipe(_.coalesceStream),_.metadataStream.on("timestamp",function(b){_.aacStream.setTimestamp(b.timeStamp)}),_.aacStream.on("data",function(b){b.type!=="timed-metadata"&&b.type!=="audio"||_.audioSegmentStream||(m=m||{timelineStartInfo:{baseMediaDecodeTime:d.baseMediaDecodeTime},codec:"adts",type:"audio"},_.coalesceStream.numberOfTracks++,_.audioSegmentStream=new os(m,l),_.audioSegmentStream.on("log",d.getLogTrigger_("audioSegmentStream")),_.audioSegmentStream.on("timingInfo",d.trigger.bind(d,"audioTimingInfo")),_.adtsStream.pipe(_.audioSegmentStream).pipe(_.coalesceStream),d.trigger("trackinfo",{hasAudio:!!m,hasVideo:!!f}))}),_.coalesceStream.on("data",this.trigger.bind(this,"data")),_.coalesceStream.on("done",this.trigger.bind(this,"done")),Ym(this,_)},this.setupTsPipeline=function(){var _={};this.transmuxPipeline_=_,_.type="ts",_.metadataStream=new kn.MetadataStream,_.packetStream=new kn.TransportPacketStream,_.parseStream=new kn.TransportParseStream,_.elementaryStream=new kn.ElementaryStream,_.timestampRolloverStream=new kn.TimestampRolloverStream,_.adtsStream=new Xm,_.h264Stream=new O1,_.captionStream=new kn.CaptionStream(l),_.coalesceStream=new Er(l,_.metadataStream),_.headOfPipeline=_.packetStream,_.packetStream.pipe(_.parseStream).pipe(_.elementaryStream).pipe(_.timestampRolloverStream),_.timestampRolloverStream.pipe(_.h264Stream),_.timestampRolloverStream.pipe(_.adtsStream),_.timestampRolloverStream.pipe(_.metadataStream).pipe(_.coalesceStream),_.h264Stream.pipe(_.captionStream).pipe(_.coalesceStream),_.elementaryStream.on("data",function(b){var S;if(b.type==="metadata"){for(S=b.tracks.length;S--;)!f&&b.tracks[S].type==="video"?(f=b.tracks[S],f.timelineStartInfo.baseMediaDecodeTime=d.baseMediaDecodeTime):!m&&b.tracks[S].type==="audio"&&(m=b.tracks[S],m.timelineStartInfo.baseMediaDecodeTime=d.baseMediaDecodeTime);f&&!_.videoSegmentStream&&(_.coalesceStream.numberOfTracks++,_.videoSegmentStream=new $a(f,l),_.videoSegmentStream.on("log",d.getLogTrigger_("videoSegmentStream")),_.videoSegmentStream.on("timelineStartInfo",function(w){m&&!l.keepOriginalTimestamps&&(m.timelineStartInfo=w,_.audioSegmentStream.setEarliestDts(w.dts-d.baseMediaDecodeTime))}),_.videoSegmentStream.on("processedGopsInfo",d.trigger.bind(d,"gopInfo")),_.videoSegmentStream.on("segmentTimingInfo",d.trigger.bind(d,"videoSegmentTimingInfo")),_.videoSegmentStream.on("baseMediaDecodeTime",function(w){m&&_.audioSegmentStream.setVideoBaseMediaDecodeTime(w)}),_.videoSegmentStream.on("timingInfo",d.trigger.bind(d,"videoTimingInfo")),_.h264Stream.pipe(_.videoSegmentStream).pipe(_.coalesceStream)),m&&!_.audioSegmentStream&&(_.coalesceStream.numberOfTracks++,_.audioSegmentStream=new os(m,l),_.audioSegmentStream.on("log",d.getLogTrigger_("audioSegmentStream")),_.audioSegmentStream.on("timingInfo",d.trigger.bind(d,"audioTimingInfo")),_.audioSegmentStream.on("segmentTimingInfo",d.trigger.bind(d,"audioSegmentTimingInfo")),_.adtsStream.pipe(_.audioSegmentStream).pipe(_.coalesceStream)),d.trigger("trackinfo",{hasAudio:!!m,hasVideo:!!f})}}),_.coalesceStream.on("data",this.trigger.bind(this,"data")),_.coalesceStream.on("id3Frame",function(b){b.dispatchType=_.metadataStream.dispatchType,d.trigger("id3Frame",b)}),_.coalesceStream.on("caption",this.trigger.bind(this,"caption")),_.coalesceStream.on("done",this.trigger.bind(this,"done")),Ym(this,_)},this.setBaseMediaDecodeTime=function(_){var b=this.transmuxPipeline_;l.keepOriginalTimestamps||(this.baseMediaDecodeTime=_),m&&(m.timelineStartInfo.dts=void 0,m.timelineStartInfo.pts=void 0,Wi.clearDtsInfo(m),b.audioTimestampRolloverStream&&b.audioTimestampRolloverStream.discontinuity()),f&&(b.videoSegmentStream&&(b.videoSegmentStream.gopCache_=[]),f.timelineStartInfo.dts=void 0,f.timelineStartInfo.pts=void 0,Wi.clearDtsInfo(f),b.captionStream.reset()),b.timestampRolloverStream&&b.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(_){m&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(_)},this.setRemux=function(_){var b=this.transmuxPipeline_;l.remux=_,b&&b.coalesceStream&&b.coalesceStream.setRemux(_)},this.alignGopsWith=function(_){f&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(_)},this.getLogTrigger_=function(_){var b=this;return function(S){S.stream=_,b.trigger("log",S)}},this.push=function(_){if(p){var b=N1(_);b&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!b&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),p=!1}this.transmuxPipeline_.headOfPipeline.push(_)},this.flush=function(){p=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Ru.prototype=new Iu;var B1={Transmuxer:Ru,VideoSegmentStream:$a,AudioSegmentStream:os,AUDIO_PROPERTIES:yh,VIDEO_PROPERTIES:vh,generateSegmentTimingInfo:Th},U1=function(l){return l>>>0},V1=function(l){return("00"+l.toString(16)).slice(-2)},Ou={toUnsigned:U1,toHexString:V1},j1=function(l){var d="";return d+=String.fromCharCode(l[0]),d+=String.fromCharCode(l[1]),d+=String.fromCharCode(l[2]),d+=String.fromCharCode(l[3]),d},Jm=j1,$1=Ou.toUnsigned,q1=Jm,Zm=function(l,d){var p=[],f,m,_,b,S;if(!d.length)return null;for(f=0;f<l.byteLength;)m=$1(l[f]<<24|l[f+1]<<16|l[f+2]<<8|l[f+3]),_=q1(l.subarray(f+4,f+8)),b=m>1?f+m:l.byteLength,_===d[0]&&(d.length===1?p.push(l.subarray(f+8,b)):(S=Zm(l.subarray(f+8,b),d.slice(1)),S.length&&(p=p.concat(S)))),f=b;return p},eg=Zm,H1=Ou.toUnsigned,G1=s.getUint64,z1=function(l){var d={version:l[0],flags:new Uint8Array(l.subarray(1,4))};return d.version===1?d.baseMediaDecodeTime=G1(l.subarray(4)):d.baseMediaDecodeTime=H1(l[4]<<24|l[5]<<16|l[6]<<8|l[7]),d},tg=z1,W1=function(l){return{isLeading:(l[0]&12)>>>2,dependsOn:l[0]&3,isDependedOn:(l[1]&192)>>>6,hasRedundancy:(l[1]&48)>>>4,paddingValue:(l[1]&14)>>>1,isNonSyncSample:l[1]&1,degradationPriority:l[2]<<8|l[3]}},K1=W1,ig=K1,X1=function(l){var d={version:l[0],flags:new Uint8Array(l.subarray(1,4)),samples:[]},p=new DataView(l.buffer,l.byteOffset,l.byteLength),f=d.flags[2]&1,m=d.flags[2]&4,_=d.flags[1]&1,b=d.flags[1]&2,S=d.flags[1]&4,w=d.flags[1]&8,k=p.getUint32(4),L=8,B;for(f&&(d.dataOffset=p.getInt32(L),L+=4),m&&k&&(B={flags:ig(l.subarray(L,L+4))},L+=4,_&&(B.duration=p.getUint32(L),L+=4),b&&(B.size=p.getUint32(L),L+=4),w&&(d.version===1?B.compositionTimeOffset=p.getInt32(L):B.compositionTimeOffset=p.getUint32(L),L+=4),d.samples.push(B),k--);k--;)B={},_&&(B.duration=p.getUint32(L),L+=4),b&&(B.size=p.getUint32(L),L+=4),S&&(B.flags=ig(l.subarray(L,L+4)),L+=4),w&&(d.version===1?B.compositionTimeOffset=p.getInt32(L):B.compositionTimeOffset=p.getUint32(L),L+=4),d.samples.push(B);return d},ng=X1,Y1=function(l){var d=new DataView(l.buffer,l.byteOffset,l.byteLength),p={version:l[0],flags:new Uint8Array(l.subarray(1,4)),trackId:d.getUint32(4)},f=p.flags[2]&1,m=p.flags[2]&2,_=p.flags[2]&8,b=p.flags[2]&16,S=p.flags[2]&32,w=p.flags[0]&65536,k=p.flags[0]&131072,L;return L=8,f&&(L+=4,p.baseDataOffset=d.getUint32(12),L+=4),m&&(p.sampleDescriptionIndex=d.getUint32(L),L+=4),_&&(p.defaultSampleDuration=d.getUint32(L),L+=4),b&&(p.defaultSampleSize=d.getUint32(L),L+=4),S&&(p.defaultSampleFlags=d.getUint32(L)),w&&(p.durationIsEmpty=!0),!f&&k&&(p.baseDataOffsetIsMoof=!0),p},rg=Y1,qa;typeof window<"u"?qa=window:typeof i<"u"?qa=i:typeof self<"u"?qa=self:qa={};var sg=qa,Q1=Se.discardEmulationPreventionBytes,J1=Tu.CaptionStream,Ha=eg,Z1=tg,eS=ng,tS=rg,ag=sg,iS=function(l,d){for(var p=l,f=0;f<d.length;f++){var m=d[f];if(p<m.size)return m;p-=m.size}return null},nS=function(l,d,p){var f=new DataView(l.buffer,l.byteOffset,l.byteLength),m={logs:[],seiNals:[]},_,b,S,w;for(b=0;b+4<l.length;b+=S)if(S=f.getUint32(b),b+=4,!(S<=0))switch(l[b]&31){case 6:var k=l.subarray(b+1,b+1+S),L=iS(b,d);if(_={nalUnitType:"sei_rbsp",size:S,data:k,escapedRBSP:Q1(k),trackId:p},L)_.pts=L.pts,_.dts=L.dts,w=L;else if(w)_.pts=w.pts,_.dts=w.dts;else{m.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+b+" for trackId "+p+". See mux.js#223."});break}m.seiNals.push(_);break}return m},rS=function(l,d,p){var f=d,m=p.defaultSampleDuration||0,_=p.defaultSampleSize||0,b=p.trackId,S=[];return l.forEach(function(w){var k=eS(w),L=k.samples;L.forEach(function(B){B.duration===void 0&&(B.duration=m),B.size===void 0&&(B.size=_),B.trackId=b,B.dts=f,B.compositionTimeOffset===void 0&&(B.compositionTimeOffset=0),typeof f=="bigint"?(B.pts=f+ag.BigInt(B.compositionTimeOffset),f+=ag.BigInt(B.duration)):(B.pts=f+B.compositionTimeOffset,f+=B.duration)}),S=S.concat(L)}),S},sS=function(l,d){var p=Ha(l,["moof","traf"]),f=Ha(l,["mdat"]),m={},_=[];return f.forEach(function(b,S){var w=p[S];_.push({mdat:b,traf:w})}),_.forEach(function(b){var S=b.mdat,w=b.traf,k=Ha(w,["tfhd"]),L=tS(k[0]),B=L.trackId,J=Ha(w,["tfdt"]),q=J.length>0?Z1(J[0]).baseMediaDecodeTime:0,le=Ha(w,["trun"]),fe,yt;d===B&&le.length>0&&(fe=rS(le,q,L),yt=nS(S,fe,B),m[B]||(m[B]={seiNals:[],logs:[]}),m[B].seiNals=m[B].seiNals.concat(yt.seiNals),m[B].logs=m[B].logs.concat(yt.logs))}),m},aS=function(l,d,p){var f;if(d===null)return null;f=sS(l,d);var m=f[d]||{};return{seiNals:m.seiNals,logs:m.logs,timescale:p}},oS=function(){var l=!1,d,p,f,m,_,b;this.isInitialized=function(){return l},this.init=function(S){d=new J1,l=!0,b=S?S.isPartial:!1,d.on("data",function(w){w.startTime=w.startPts/m,w.endTime=w.endPts/m,_.captions.push(w),_.captionStreams[w.stream]=!0}),d.on("log",function(w){_.logs.push(w)})},this.isNewInit=function(S,w){return S&&S.length===0||w&&typeof w=="object"&&Object.keys(w).length===0?!1:f!==S[0]||m!==w[f]},this.parse=function(S,w,k){var L;if(this.isInitialized()){if(!w||!k)return null;if(this.isNewInit(w,k))f=w[0],m=k[f];else if(f===null||!m)return p.push(S),null}else return null;for(;p.length>0;){var B=p.shift();this.parse(B,w,k)}return L=aS(S,f,m),L&&L.logs&&(_.logs=_.logs.concat(L.logs)),L===null||!L.seiNals?_.logs.length?{logs:_.logs,captions:[],captionStreams:[]}:null:(this.pushNals(L.seiNals),this.flushStream(),_)},this.pushNals=function(S){if(!this.isInitialized()||!S||S.length===0)return null;S.forEach(function(w){d.push(w)})},this.flushStream=function(){if(!this.isInitialized())return null;b?d.partialFlush():d.flush()},this.clearParsedCaptions=function(){_.captions=[],_.captionStreams={},_.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;d.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){p=[],f=null,m=null,_?this.clearParsedCaptions():_={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},uS=oS,lS=function(l){for(var d=0,p=String.fromCharCode(l[d]),f="";p!=="\0";)f+=p,d++,p=String.fromCharCode(l[d]);return f+=p,f},cS={uint8ToCString:lS},Lu=cS.uint8ToCString,hS=s.getUint64,dS=function(l){var d=4,p=l[0],f,m,_,b,S,w,k,L;if(p===0){f=Lu(l.subarray(d)),d+=f.length,m=Lu(l.subarray(d)),d+=m.length;var B=new DataView(l.buffer);_=B.getUint32(d),d+=4,S=B.getUint32(d),d+=4,w=B.getUint32(d),d+=4,k=B.getUint32(d),d+=4}else if(p===1){var B=new DataView(l.buffer);_=B.getUint32(d),d+=4,b=hS(l.subarray(d)),d+=8,w=B.getUint32(d),d+=4,k=B.getUint32(d),d+=4,f=Lu(l.subarray(d)),d+=f.length,m=Lu(l.subarray(d)),d+=m.length}L=new Uint8Array(l.subarray(d,l.byteLength));var J={scheme_id_uri:f,value:m,timescale:_||1,presentation_time:b,presentation_time_delta:S,event_duration:w,id:k,message_data:L};return pS(p,J)?J:void 0},fS=function(l,d,p,f){return l||l===0?l/d:f+p/d},pS=function(l,d){var p=d.scheme_id_uri!=="\0",f=l===0&&og(d.presentation_time_delta)&&p,m=l===1&&og(d.presentation_time)&&p;return!(l>1)&&f||m},og=function(l){return l!==void 0||l!==null},mS={parseEmsgBox:dS,scaleTime:fS},Nu=Ou.toUnsigned,Ga=Ou.toHexString,ut=eg,us=Jm,bh=mS,gS=rg,_S=ng,yS=tg,vS=s.getUint64,ug,lg,cg,hg,dg,Eh,fg,Sh=sg,TS=Um.parseId3Frames;ug=function(l){var d={},p=ut(l,["moov","trak"]);return p.reduce(function(f,m){var _,b,S,w,k;return _=ut(m,["tkhd"])[0],!_||(b=_[0],S=b===0?12:20,w=Nu(_[S]<<24|_[S+1]<<16|_[S+2]<<8|_[S+3]),k=ut(m,["mdia","mdhd"])[0],!k)?null:(b=k[0],S=b===0?12:20,f[w]=Nu(k[S]<<24|k[S+1]<<16|k[S+2]<<8|k[S+3]),f)},d)},lg=function(l,d){var p;p=ut(d,["moof","traf"]);var f=p.reduce(function(m,_){var b=ut(_,["tfhd"])[0],S=Nu(b[4]<<24|b[5]<<16|b[6]<<8|b[7]),w=l[S]||9e4,k=ut(_,["tfdt"])[0],L=new DataView(k.buffer,k.byteOffset,k.byteLength),B;k[0]===1?B=vS(k.subarray(4,12)):B=L.getUint32(4);let J;return typeof B=="bigint"?J=B/Sh.BigInt(w):typeof B=="number"&&!isNaN(B)&&(J=B/w),J<Number.MAX_SAFE_INTEGER&&(J=Number(J)),J<m&&(m=J),m},1/0);return typeof f=="bigint"||isFinite(f)?f:0},cg=function(l,d){var p=ut(d,["moof","traf"]),f=0,m=0,_;if(p&&p.length){var b=ut(p[0],["tfhd"])[0],S=ut(p[0],["trun"])[0],w=ut(p[0],["tfdt"])[0];if(b){var k=gS(b);_=k.trackId}if(w){var L=yS(w);f=L.baseMediaDecodeTime}if(S){var B=_S(S);B.samples&&B.samples.length&&(m=B.samples[0].compositionTimeOffset||0)}}var J=l[_]||9e4;typeof f=="bigint"&&(m=Sh.BigInt(m),J=Sh.BigInt(J));var q=(f+m)/J;return typeof q=="bigint"&&q<Number.MAX_SAFE_INTEGER&&(q=Number(q)),q},hg=function(l){var d=ut(l,["moov","trak"]),p=[];return d.forEach(function(f){var m=ut(f,["mdia","hdlr"]),_=ut(f,["tkhd"]);m.forEach(function(b,S){var w=us(b.subarray(8,12)),k=_[S],L,B,J;w==="vide"&&(L=new DataView(k.buffer,k.byteOffset,k.byteLength),B=L.getUint8(0),J=B===0?L.getUint32(12):L.getUint32(20),p.push(J))})}),p},Eh=function(l){var d=l[0],p=d===0?12:20;return Nu(l[p]<<24|l[p+1]<<16|l[p+2]<<8|l[p+3])},dg=function(l){var d=ut(l,["moov","trak"]),p=[];return d.forEach(function(f){var m={},_=ut(f,["tkhd"])[0],b,S;_&&(b=new DataView(_.buffer,_.byteOffset,_.byteLength),S=b.getUint8(0),m.id=S===0?b.getUint32(12):b.getUint32(20));var w=ut(f,["mdia","hdlr"])[0];if(w){var k=us(w.subarray(8,12));k==="vide"?m.type="video":k==="soun"?m.type="audio":m.type=k}var L=ut(f,["mdia","minf","stbl","stsd"])[0];if(L){var B=L.subarray(8);m.codec=us(B.subarray(4,8));var J=ut(B,[m.codec])[0],q,le;J&&(/^[asm]vc[1-9]$/i.test(m.codec)?(q=J.subarray(78),le=us(q.subarray(4,8)),le==="avcC"&&q.length>11?(m.codec+=".",m.codec+=Ga(q[9]),m.codec+=Ga(q[10]),m.codec+=Ga(q[11])):m.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(m.codec)?(q=J.subarray(28),le=us(q.subarray(4,8)),le==="esds"&&q.length>20&&q[19]!==0?(m.codec+="."+Ga(q[19]),m.codec+="."+Ga(q[20]>>>2&63).replace(/^0/,"")):m.codec="mp4a.40.2"):m.codec=m.codec.toLowerCase())}var fe=ut(f,["mdia","mdhd"])[0];fe&&(m.timescale=Eh(fe)),p.push(m)}),p},fg=function(l,d=0){var p=ut(l,["emsg"]);return p.map(f=>{var m=bh.parseEmsgBox(new Uint8Array(f)),_=TS(m.message_data);return{cueTime:bh.scaleTime(m.presentation_time,m.timescale,m.presentation_time_delta,d),duration:bh.scaleTime(m.event_duration,m.timescale),frames:_}})};var pg={findBox:ut,parseType:us,timescale:ug,startTime:lg,compositionStartTime:cg,videoTrackIds:hg,tracks:dg,getTimescaleFromMediaHeader:Eh,getEmsgID3:fg},xh=ss,mg=function(l){var d=l[1]&31;return d<<=8,d|=l[2],d},Mu=function(l){return!!(l[1]&64)},Fu=function(l){var d=0;return(l[3]&48)>>>4>1&&(d+=l[4]+1),d},bS=function(l,d){var p=mg(l);return p===0?"pat":p===d?"pmt":d?"pes":null},ES=function(l){var d=Mu(l),p=4+Fu(l);return d&&(p+=l[p]+1),(l[p+10]&31)<<8|l[p+11]},SS=function(l){var d={},p=Mu(l),f=4+Fu(l);if(p&&(f+=l[f]+1),!!(l[f+5]&1)){var m,_,b;m=(l[f+1]&15)<<8|l[f+2],_=3+m-4,b=(l[f+10]&15)<<8|l[f+11];for(var S=12+b;S<_;){var w=f+S;d[(l[w+1]&31)<<8|l[w+2]]=l[w],S+=((l[w+3]&15)<<8|l[w+4])+5}return d}},xS=function(l,d){var p=mg(l),f=d[p];switch(f){case xh.H264_STREAM_TYPE:return"video";case xh.ADTS_STREAM_TYPE:return"audio";case xh.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},CS=function(l){var d=Mu(l);if(!d)return null;var p=4+Fu(l);if(p>=l.byteLength)return null;var f=null,m;return m=l[p+7],m&192&&(f={},f.pts=(l[p+9]&14)<<27|(l[p+10]&255)<<20|(l[p+11]&254)<<12|(l[p+12]&255)<<5|(l[p+13]&254)>>>3,f.pts*=4,f.pts+=(l[p+13]&6)>>>1,f.dts=f.pts,m&64&&(f.dts=(l[p+14]&14)<<27|(l[p+15]&255)<<20|(l[p+16]&254)<<12|(l[p+17]&255)<<5|(l[p+18]&254)>>>3,f.dts*=4,f.dts+=(l[p+18]&6)>>>1)),f},Ch=function(l){switch(l){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},wS=function(l){for(var d=4+Fu(l),p=l.subarray(d),f=0,m=0,_=!1,b;m<p.byteLength-3;m++)if(p[m+2]===1){f=m+5;break}for(;f<p.byteLength;)switch(p[f]){case 0:if(p[f-1]!==0){f+=2;break}else if(p[f-2]!==0){f++;break}m+3!==f-2&&(b=Ch(p[m+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(_=!0));do f++;while(p[f]!==1&&f<p.length);m=f-2,f+=3;break;case 1:if(p[f-1]!==0||p[f-2]!==0){f+=3;break}b=Ch(p[m+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(_=!0),m=f-2,f+=3;break;default:f+=3;break}return p=p.subarray(m),f-=m,m=0,p&&p.byteLength>3&&(b=Ch(p[m+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(_=!0)),_},AS={parseType:bS,parsePat:ES,parsePmt:SS,parsePayloadUnitStartIndicator:Mu,parsePesType:xS,parsePesTime:CS,videoPacketContainsKeyFrame:wS},gg=ss,ls=Fm.handleRollover,Be={};Be.ts=AS,Be.aac=_h;var Sr=qe.ONE_SECOND_IN_TS,Jt=188,an=71,DS=function(l,d){for(var p=0,f=Jt,m,_;f<l.byteLength;){if(l[p]===an&&l[f]===an){switch(m=l.subarray(p,f),_=Be.ts.parseType(m,d.pid),_){case"pat":d.pid=Be.ts.parsePat(m);break;case"pmt":var b=Be.ts.parsePmt(m);d.table=d.table||{},Object.keys(b).forEach(function(S){d.table[S]=b[S]});break}p+=Jt,f+=Jt;continue}p++,f++}},_g=function(l,d,p){for(var f=0,m=Jt,_,b,S,w,k,L=!1;m<=l.byteLength;){if(l[f]===an&&(l[m]===an||m===l.byteLength)){switch(_=l.subarray(f,m),b=Be.ts.parseType(_,d.pid),b){case"pes":S=Be.ts.parsePesType(_,d.table),w=Be.ts.parsePayloadUnitStartIndicator(_),S==="audio"&&w&&(k=Be.ts.parsePesTime(_),k&&(k.type="audio",p.audio.push(k),L=!0));break}if(L)break;f+=Jt,m+=Jt;continue}f++,m++}for(m=l.byteLength,f=m-Jt,L=!1;f>=0;){if(l[f]===an&&(l[m]===an||m===l.byteLength)){switch(_=l.subarray(f,m),b=Be.ts.parseType(_,d.pid),b){case"pes":S=Be.ts.parsePesType(_,d.table),w=Be.ts.parsePayloadUnitStartIndicator(_),S==="audio"&&w&&(k=Be.ts.parsePesTime(_),k&&(k.type="audio",p.audio.push(k),L=!0));break}if(L)break;f-=Jt,m-=Jt;continue}f--,m--}},IS=function(l,d,p){for(var f=0,m=Jt,_,b,S,w,k,L,B,J,q=!1,le={data:[],size:0};m<l.byteLength;){if(l[f]===an&&l[m]===an){switch(_=l.subarray(f,m),b=Be.ts.parseType(_,d.pid),b){case"pes":if(S=Be.ts.parsePesType(_,d.table),w=Be.ts.parsePayloadUnitStartIndicator(_),S==="video"&&(w&&!q&&(k=Be.ts.parsePesTime(_),k&&(k.type="video",p.video.push(k),q=!0)),!p.firstKeyFrame)){if(w&&le.size!==0){for(L=new Uint8Array(le.size),B=0;le.data.length;)J=le.data.shift(),L.set(J,B),B+=J.byteLength;if(Be.ts.videoPacketContainsKeyFrame(L)){var fe=Be.ts.parsePesTime(L);fe?(p.firstKeyFrame=fe,p.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}le.size=0}le.data.push(_),le.size+=_.byteLength}break}if(q&&p.firstKeyFrame)break;f+=Jt,m+=Jt;continue}f++,m++}for(m=l.byteLength,f=m-Jt,q=!1;f>=0;){if(l[f]===an&&l[m]===an){switch(_=l.subarray(f,m),b=Be.ts.parseType(_,d.pid),b){case"pes":S=Be.ts.parsePesType(_,d.table),w=Be.ts.parsePayloadUnitStartIndicator(_),S==="video"&&w&&(k=Be.ts.parsePesTime(_),k&&(k.type="video",p.video.push(k),q=!0));break}if(q)break;f-=Jt,m-=Jt;continue}f--,m--}},kS=function(l,d){if(l.audio&&l.audio.length){var p=d;(typeof p>"u"||isNaN(p))&&(p=l.audio[0].dts),l.audio.forEach(function(_){_.dts=ls(_.dts,p),_.pts=ls(_.pts,p),_.dtsTime=_.dts/Sr,_.ptsTime=_.pts/Sr})}if(l.video&&l.video.length){var f=d;if((typeof f>"u"||isNaN(f))&&(f=l.video[0].dts),l.video.forEach(function(_){_.dts=ls(_.dts,f),_.pts=ls(_.pts,f),_.dtsTime=_.dts/Sr,_.ptsTime=_.pts/Sr}),l.firstKeyFrame){var m=l.firstKeyFrame;m.dts=ls(m.dts,f),m.pts=ls(m.pts,f),m.dtsTime=m.dts/Sr,m.ptsTime=m.pts/Sr}}},PS=function(l){for(var d=!1,p=0,f=null,m=null,_=0,b=0,S;l.length-b>=3;){var w=Be.aac.parseType(l,b);switch(w){case"timed-metadata":if(l.length-b<10){d=!0;break}if(_=Be.aac.parseId3TagSize(l,b),_>l.length){d=!0;break}m===null&&(S=l.subarray(b,b+_),m=Be.aac.parseAacTimestamp(S)),b+=_;break;case"audio":if(l.length-b<7){d=!0;break}if(_=Be.aac.parseAdtsSize(l,b),_>l.length){d=!0;break}f===null&&(S=l.subarray(b,b+_),f=Be.aac.parseSampleRate(S)),p++,b+=_;break;default:b++;break}if(d)return null}if(f===null||m===null)return null;var k=Sr/f,L={audio:[{type:"audio",dts:m,pts:m},{type:"audio",dts:m+p*1024*k,pts:m+p*1024*k}]};return L},RS=function(l){var d={pid:null,table:null},p={};DS(l,d);for(var f in d.table)if(d.table.hasOwnProperty(f)){var m=d.table[f];switch(m){case gg.H264_STREAM_TYPE:p.video=[],IS(l,d,p),p.video.length===0&&delete p.video;break;case gg.ADTS_STREAM_TYPE:p.audio=[],_g(l,d,p),p.audio.length===0&&delete p.audio;break}}return p},OS=function(l,d){var p=Be.aac.isLikelyAacData(l),f;return p?f=PS(l):f=RS(l),!f||!f.audio&&!f.video?null:(kS(f,d),f)},LS={inspect:OS,parseAudioPes_:_g};const NS=function(l,d){d.on("data",function(p){const f=p.initSegment;p.initSegment={data:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength};const m=p.data;p.data=m.buffer,l.postMessage({action:"data",segment:p,byteOffset:m.byteOffset,byteLength:m.byteLength},[p.data])}),d.on("done",function(p){l.postMessage({action:"done"})}),d.on("gopInfo",function(p){l.postMessage({action:"gopInfo",gopInfo:p})}),d.on("videoSegmentTimingInfo",function(p){const f={start:{decode:qe.videoTsToSeconds(p.start.dts),presentation:qe.videoTsToSeconds(p.start.pts)},end:{decode:qe.videoTsToSeconds(p.end.dts),presentation:qe.videoTsToSeconds(p.end.pts)},baseMediaDecodeTime:qe.videoTsToSeconds(p.baseMediaDecodeTime)};p.prependedContentDuration&&(f.prependedContentDuration=qe.videoTsToSeconds(p.prependedContentDuration)),l.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:f})}),d.on("audioSegmentTimingInfo",function(p){const f={start:{decode:qe.videoTsToSeconds(p.start.dts),presentation:qe.videoTsToSeconds(p.start.pts)},end:{decode:qe.videoTsToSeconds(p.end.dts),presentation:qe.videoTsToSeconds(p.end.pts)},baseMediaDecodeTime:qe.videoTsToSeconds(p.baseMediaDecodeTime)};p.prependedContentDuration&&(f.prependedContentDuration=qe.videoTsToSeconds(p.prependedContentDuration)),l.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:f})}),d.on("id3Frame",function(p){l.postMessage({action:"id3Frame",id3Frame:p})}),d.on("caption",function(p){l.postMessage({action:"caption",caption:p})}),d.on("trackinfo",function(p){l.postMessage({action:"trackinfo",trackInfo:p})}),d.on("audioTimingInfo",function(p){l.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:qe.videoTsToSeconds(p.start),end:qe.videoTsToSeconds(p.end)}})}),d.on("videoTimingInfo",function(p){l.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:qe.videoTsToSeconds(p.start),end:qe.videoTsToSeconds(p.end)}})}),d.on("log",function(p){l.postMessage({action:"log",log:p})})};class yg{constructor(d,p){this.options=p||{},this.self=d,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new B1.Transmuxer(this.options),NS(this.self,this.transmuxer)}pushMp4Captions(d){this.captionParser||(this.captionParser=new uS,this.captionParser.init());const p=new Uint8Array(d.data,d.byteOffset,d.byteLength),f=this.captionParser.parse(p,d.trackIds,d.timescales);this.self.postMessage({action:"mp4Captions",captions:f&&f.captions||[],logs:f&&f.logs||[],data:p.buffer},[p.buffer])}probeMp4StartTime({timescales:d,data:p}){const f=pg.startTime(d,p);this.self.postMessage({action:"probeMp4StartTime",startTime:f,data:p},[p.buffer])}probeMp4Tracks({data:d}){const p=pg.tracks(d);this.self.postMessage({action:"probeMp4Tracks",tracks:p,data:d},[d.buffer])}probeTs({data:d,baseStartTime:p}){const f=typeof p=="number"&&!isNaN(p)?p*qe.ONE_SECOND_IN_TS:void 0,m=LS.inspect(d,f);let _=null;m&&(_={hasVideo:m.video&&m.video.length===2||!1,hasAudio:m.audio&&m.audio.length===2||!1},_.hasVideo&&(_.videoStart=m.video[0].ptsTime),_.hasAudio&&(_.audioStart=m.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:_,data:d},[d.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(d){const p=new Uint8Array(d.data,d.byteOffset,d.byteLength);this.transmuxer.push(p)}reset(){this.transmuxer.reset()}setTimestampOffset(d){const p=d.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(qe.secondsToVideoTs(p)))}setAudioAppendStart(d){this.transmuxer.setAudioAppendStart(Math.ceil(qe.secondsToVideoTs(d.appendStart)))}setRemux(d){this.transmuxer.setRemux(d.remux)}flush(d){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(d){this.transmuxer.alignGopsWith(d.gopsToAlignWith.slice())}}self.onmessage=function(l){if(l.data.action==="init"&&l.data.options){this.messageHandlers=new yg(self,l.data.options);return}this.messageHandlers||(this.messageHandlers=new yg(self)),l.data&&l.data.action&&l.data.action!=="init"&&this.messageHandlers[l.data.action]&&this.messageHandlers[l.data.action](l.data)}}));var Xk=vb(Kk);const Yk=(i,e,t)=>{const{type:n,initSegment:r,captions:s,captionStreams:a,metadata:o,videoFrameDtsTime:u,videoFramePtsTime:c}=i.data.segment;e.buffer.push({captions:s,captionStreams:a,metadata:o});const h=i.data.segment.boxes||{data:i.data.segment.data},g={type:n,data:new Uint8Array(h.data,h.data.byteOffset,h.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};typeof u<"u"&&(g.videoFrameDtsTime=u),typeof c<"u"&&(g.videoFramePtsTime=c),t(g)},Qk=({transmuxedData:i,callback:e})=>{i.buffer=[],e(i)},Jk=(i,e)=>{e.gopInfo=i.data.gopInfo},Eb=i=>{const{transmuxer:e,bytes:t,audioAppendStart:n,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:o,onAudioTimingInfo:u,onVideoTimingInfo:c,onVideoSegmentTimingInfo:h,onAudioSegmentTimingInfo:g,onId3:y,onCaptions:T,onDone:v,onEndedTimeline:x,onTransmuxerLog:A,isEndOfTimeline:D}=i,P={buffer:[]};let M=D;const O=R=>{e.currentTransmux===i&&(R.data.action==="data"&&Yk(R,P,a),R.data.action==="trackinfo"&&o(R.data.trackInfo),R.data.action==="gopInfo"&&Jk(R,P),R.data.action==="audioTimingInfo"&&u(R.data.audioTimingInfo),R.data.action==="videoTimingInfo"&&c(R.data.videoTimingInfo),R.data.action==="videoSegmentTimingInfo"&&h(R.data.videoSegmentTimingInfo),R.data.action==="audioSegmentTimingInfo"&&g(R.data.audioSegmentTimingInfo),R.data.action==="id3Frame"&&y([R.data.id3Frame],R.data.id3Frame.dispatchType),R.data.action==="caption"&&T(R.data.caption),R.data.action==="endedtimeline"&&(M=!1,x()),R.data.action==="log"&&A(R.data.log),R.data.type==="transmuxed"&&(M||(e.onmessage=null,Qk({transmuxedData:P,callback:v}),Sb(e))))};if(e.onmessage=O,n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),typeof s<"u"&&e.postMessage({action:"setRemux",remux:s}),t.byteLength){const R=t instanceof ArrayBuffer?t:t.buffer,$=t instanceof ArrayBuffer?0:t.byteOffset;e.postMessage({action:"push",data:R,byteOffset:$,byteLength:t.byteLength},[R])}D&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},Sb=i=>{i.currentTransmux=null,i.transmuxQueue.length&&(i.currentTransmux=i.transmuxQueue.shift(),typeof i.currentTransmux=="function"?i.currentTransmux():Eb(i.currentTransmux))},G0=(i,e)=>{i.postMessage({action:e}),Sb(i)},xb=(i,e)=>{if(!e.currentTransmux){e.currentTransmux=i,G0(e,i);return}e.transmuxQueue.push(G0.bind(null,e,i))},Zk=i=>{xb("reset",i)},eP=i=>{xb("endTimeline",i)},Cb=i=>{if(!i.transmuxer.currentTransmux){i.transmuxer.currentTransmux=i,Eb(i);return}i.transmuxer.transmuxQueue.push(i)},tP=i=>{const e=new Xk;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:i}),e};var Jh={reset:Zk,endTimeline:eP,transmux:Cb,createTransmuxer:tP};const ql=function(i){const e=i.transmuxer,t=i.endAction||i.action,n=i.callback,r=Bn({},i,{endAction:null,transmuxer:null,callback:null}),s=a=>{a.data.action===t&&(e.removeEventListener("message",s),a.data.data&&(a.data.data=new Uint8Array(a.data.data,i.byteOffset||0,i.byteLength||a.data.data.byteLength),i.data&&(i.data=a.data.data)),n(a.data))};if(e.addEventListener("message",s),i.data){const a=i.data instanceof ArrayBuffer;r.byteOffset=a?0:i.data.byteOffset,r.byteLength=i.data.byteLength;const o=[a?i.data:i.data.buffer];e.postMessage(r,o)}else e.postMessage(r)},mn={FAILURE:2,TIMEOUT:-101,ABORTED:-102},Yd=i=>{i.forEach(e=>{e.abort()})},iP=i=>({bandwidth:i.bandwidth,bytesReceived:i.bytesReceived||0,roundTripTime:i.roundTripTime||0}),nP=i=>{const e=i.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return n.bytesReceived=i.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},Fp=(i,e)=>e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:mn.TIMEOUT,xhr:e}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:mn.ABORTED,xhr:e}:i?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:mn.FAILURE,xhr:e}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:mn.FAILURE,xhr:e}:null,z0=(i,e,t)=>(n,r)=>{const s=r.response,a=Fp(n,r);if(a)return t(a,i);if(s.byteLength!==16)return t({status:r.status,message:"Invalid HLS key at URL: "+r.uri,code:mn.FAILURE,xhr:r},i);const o=new DataView(s),u=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);for(let c=0;c<e.length;c++)e[c].bytes=u;return t(null,i)},wb=(i,e)=>{const t=tp(i.map.bytes);if(t!=="mp4"){const n=i.map.resolvedUri||i.map.uri;return e({internal:!0,message:`Found unsupported ${t||"unknown"} container for initialization segment at URL: ${n}`,code:mn.FAILURE})}ql({action:"probeMp4Tracks",data:i.map.bytes,transmuxer:i.transmuxer,callback:({tracks:n,data:r})=>(i.map.bytes=r,n.forEach(function(s){i.map.tracks=i.map.tracks||{},!i.map.tracks[s.type]&&(i.map.tracks[s.type]=s,typeof s.id=="number"&&s.timescale&&(i.map.timescales=i.map.timescales||{},i.map.timescales[s.id]=s.timescale))}),e(null))})},rP=({segment:i,finishProcessingFn:e})=>(t,n)=>{const r=Fp(t,n);if(r)return e(r,i);const s=new Uint8Array(n.response);if(i.map.key)return i.map.encryptedBytes=s,e(null,i);i.map.bytes=s,wb(i,function(a){if(a)return a.xhr=n,a.status=n.status,e(a,i);e(null,i)})},sP=({segment:i,finishProcessingFn:e,responseType:t})=>(n,r)=>{const s=Fp(n,r);if(s)return e(s,i);const a=t==="arraybuffer"||!r.responseText?r.response:zk(r.responseText.substring(i.lastReachedChar||0));return i.stats=iP(r),i.key?i.encryptedBytes=new Uint8Array(a):i.bytes=new Uint8Array(a),e(null,i)},aP=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{const T=i.map&&i.map.tracks||{},v=!!(T.audio&&T.video);let x=n.bind(null,i,"audio","start");const A=n.bind(null,i,"audio","end");let D=n.bind(null,i,"video","start");const P=n.bind(null,i,"video","end"),M=()=>Cb({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,remux:v,onData:O=>{O.type=O.type==="combined"?"video":O.type,h(i,O)},onTrackInfo:O=>{t&&(v&&(O.isMuxed=!0),t(i,O))},onAudioTimingInfo:O=>{x&&typeof O.start<"u"&&(x(O.start),x=null),A&&typeof O.end<"u"&&A(O.end)},onVideoTimingInfo:O=>{D&&typeof O.start<"u"&&(D(O.start),D=null),P&&typeof O.end<"u"&&P(O.end)},onVideoSegmentTimingInfo:O=>{r(O)},onAudioSegmentTimingInfo:O=>{s(O)},onId3:(O,R)=>{a(i,O,R)},onCaptions:O=>{o(i,[O])},isEndOfTimeline:u,onEndedTimeline:()=>{c()},onTransmuxerLog:y,onDone:O=>{g&&(O.type=O.type==="combined"?"video":O.type,g(null,i,O))}});ql({action:"probeTs",transmuxer:i.transmuxer,data:e,baseStartTime:i.baseStartTime,callback:O=>{i.bytes=e=O.data;const R=O.result;R&&(t(i,{hasAudio:R.hasAudio,hasVideo:R.hasVideo,isMuxed:v}),t=null,R.hasAudio&&!v&&x(R.audioStart),R.hasVideo&&D(R.videoStart),x=null,D=null),M()}})},Ab=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{let T=new Uint8Array(e);if(OD(T)){i.isFmp4=!0;const{tracks:v}=i.map,x={isFmp4:!0,hasVideo:!!v.video,hasAudio:!!v.audio};v.audio&&v.audio.codec&&v.audio.codec!=="enca"&&(x.audioCodec=v.audio.codec),v.video&&v.video.codec&&v.video.codec!=="encv"&&(x.videoCodec=v.video.codec),v.video&&v.audio&&(x.isMuxed=!0),t(i,x);const A=D=>{h(i,{data:T,type:x.hasAudio&&!x.isMuxed?"audio":"video"}),D&&D.length&&o(i,D),g(null,i,{})};ql({action:"probeMp4StartTime",timescales:i.map.timescales,data:T,transmuxer:i.transmuxer,callback:({data:D,startTime:P})=>{if(e=D.buffer,i.bytes=T=D,x.hasAudio&&!x.isMuxed&&n(i,"audio","start",P),x.hasVideo&&n(i,"video","start",P),!v.video||!D.byteLength||!i.transmuxer){A();return}ql({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:i.transmuxer,data:T,timescales:i.map.timescales,trackIds:[v.video.id],callback:M=>{e=M.data.buffer,i.bytes=T=M.data,M.logs.forEach(function(O){y(We(O,{stream:"mp4CaptionParser"}))}),A(M.captions)}})}});return}if(!i.transmuxer){g(null,i,{});return}if(typeof i.container>"u"&&(i.container=tp(T)),i.container!=="ts"&&i.container!=="aac"){t(i,{hasAudio:!1,hasVideo:!1}),g(null,i,{});return}aP({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})},Db=function({id:i,key:e,encryptedBytes:t,decryptionWorker:n},r){const s=o=>{if(o.data.source===i){n.removeEventListener("message",s);const u=o.data.decrypted;r(new Uint8Array(u.bytes,u.byteOffset,u.byteLength))}};n.addEventListener("message",s);let a;e.bytes.slice?a=e.bytes.slice():a=new Uint32Array(Array.prototype.slice.call(e.bytes)),n.postMessage(fb({source:i,encrypted:t,key:a,iv:e.iv}),[t.buffer,a.buffer])},oP=({decryptionWorker:i,segment:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{Db({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:i},T=>{e.bytes=T,Ab({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})})},uP=({activeXhrs:i,decryptionWorker:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{let T=0,v=!1;return(x,A)=>{if(!v){if(x)return v=!0,Yd(i),g(x,A);if(T+=1,T===i.length){const D=function(){if(A.encryptedBytes)return oP({decryptionWorker:e,segment:A,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y});Ab({segment:A,bytes:A.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})};if(A.endOfAllRequests=Date.now(),A.map&&A.map.encryptedBytes&&!A.map.bytes)return Db({decryptionWorker:e,id:A.requestId+"-init",encryptedBytes:A.map.encryptedBytes,key:A.map.key},P=>{A.map.bytes=P,wb(A,M=>{if(M)return Yd(i),g(M,A);D()})});D()}}}},lP=({loadendState:i,abortFn:e})=>t=>{t.target.aborted&&e&&!i.calledAbortFn&&(e(),i.calledAbortFn=!0)},cP=({segment:i,progressFn:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h})=>g=>{if(!g.target.aborted)return i.stats=We(i.stats,nP(g)),!i.stats.firstBytesReceivedAt&&i.stats.bytesReceived&&(i.stats.firstBytesReceivedAt=Date.now()),e(g,i)},hP=({xhr:i,xhrOptions:e,decryptionWorker:t,segment:n,abortFn:r,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:g,isEndOfTimeline:y,endedTimelineFn:T,dataFn:v,doneFn:x,onTransmuxerLog:A})=>{const D=[],P=uP({activeXhrs:D,decryptionWorker:t,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:g,isEndOfTimeline:y,endedTimelineFn:T,dataFn:v,doneFn:x,onTransmuxerLog:A});if(n.key&&!n.key.bytes){const V=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&V.push(n.map.key);const ie=We(e,{uri:n.key.resolvedUri,responseType:"arraybuffer"}),Z=z0(n,V,P),he=i(ie,Z);D.push(he)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const _e=We(e,{uri:n.map.key.resolvedUri,responseType:"arraybuffer"}),me=z0(n,[n.map.key],P),X=i(_e,me);D.push(X)}const ie=We(e,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:Kd(n.map)}),Z=rP({segment:n,finishProcessingFn:P}),he=i(ie,Z);D.push(he)}const M=We(e,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:Kd(n)}),O=sP({segment:n,finishProcessingFn:P,responseType:M.responseType}),R=i(M,O);R.addEventListener("progress",cP({segment:n,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:g,isEndOfTimeline:y,endedTimelineFn:T,dataFn:v})),D.push(R);const $={};return D.forEach(V=>{V.addEventListener("loadend",lP({loadendState:$,abortFn:r}))}),()=>Yd(D)},dP=en("CodecUtils"),fP=function(i){const e=i.attributes||{};if(e.CODECS)return ln(e.CODECS)},Ib=(i,e)=>{const t=e.attributes||{};return i&&i.mediaGroups&&i.mediaGroups.AUDIO&&t.AUDIO&&i.mediaGroups.AUDIO[t.AUDIO]},pP=(i,e)=>{if(!Ib(i,e))return!0;const t=e.attributes||{},n=i.mediaGroups.AUDIO[t.AUDIO];for(const r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1},Hl=function(i){const e={};return i.forEach(({mediaType:t,type:n,details:r})=>{e[t]=e[t]||[],e[t].push(zy(`${n}${r}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){dP(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},W0=function(i){let e=0;return i.audio&&e++,i.video&&e++,e},_o=function(i,e){const t=e.attributes||{},n=Hl(fP(e)||[]);if(Ib(i,e)&&!n.audio&&!pP(i,e)){const r=Hl(Lw(i,t.AUDIO)||[]);r.audio&&(n.audio=r.audio)}return n},Hu=en("PlaylistSelector"),K0=function(i){if(!i||!i.playlist)return;const e=i.playlist;return JSON.stringify({id:e.id,bandwidth:i.bandwidth,width:i.width,height:i.height,codecs:e.attributes&&e.attributes.CODECS||""})},Gl=function(i,e){if(!i)return"";const t=I.getComputedStyle(i);return t?t[e]:""},Ns=function(i,e){const t=i.slice();i.sort(function(n,r){const s=e(n,r);return s===0?t.indexOf(n)-t.indexOf(r):s})},Bp=function(i,e){let t,n;return i.attributes.BANDWIDTH&&(t=i.attributes.BANDWIDTH),t=t||I.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||I.Number.MAX_VALUE,t-n},mP=function(i,e){let t,n;return i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(t=i.attributes.RESOLUTION.width),t=t||I.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||I.Number.MAX_VALUE,t===n&&i.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?i.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-n};let kb=function(i,e,t,n,r,s){if(!i)return;const a={bandwidth:e,width:t,height:n,limitRenditionByPlayerDimensions:r};let o=i.playlists;vi.isAudioOnly(i)&&(o=s.getAudioTrackPlaylists_(),a.audioOnly=!0);let u=o.map(R=>{let $;const V=R.attributes&&R.attributes.RESOLUTION&&R.attributes.RESOLUTION.width,ie=R.attributes&&R.attributes.RESOLUTION&&R.attributes.RESOLUTION.height;return $=R.attributes&&R.attributes.BANDWIDTH,$=$||I.Number.MAX_VALUE,{bandwidth:$,width:V,height:ie,playlist:R}});Ns(u,(R,$)=>R.bandwidth-$.bandwidth),u=u.filter(R=>!vi.isIncompatible(R.playlist));let c=u.filter(R=>vi.isEnabled(R.playlist));c.length||(c=u.filter(R=>!vi.isDisabled(R.playlist)));const h=c.filter(R=>R.bandwidth*xt.BANDWIDTH_VARIANCE<e);let g=h[h.length-1];const y=h.filter(R=>R.bandwidth===g.bandwidth)[0];if(r===!1){const R=y||c[0]||u[0];if(R&&R.playlist){let $="sortedPlaylistReps";return y&&($="bandwidthBestRep"),c[0]&&($="enabledPlaylistReps"),Hu(`choosing ${K0(R)} using ${$} with options`,a),R.playlist}return Hu("could not choose a playlist with options",a),null}const T=h.filter(R=>R.width&&R.height);Ns(T,(R,$)=>R.width-$.width);const v=T.filter(R=>R.width===t&&R.height===n);g=v[v.length-1];const x=v.filter(R=>R.bandwidth===g.bandwidth)[0];let A,D,P;x||(A=T.filter(R=>R.width>t||R.height>n),D=A.filter(R=>R.width===A[0].width&&R.height===A[0].height),g=D[D.length-1],P=D.filter(R=>R.bandwidth===g.bandwidth)[0]);let M;if(s.leastPixelDiffSelector){const R=T.map($=>($.pixelDiff=Math.abs($.width-t)+Math.abs($.height-n),$));Ns(R,($,V)=>$.pixelDiff===V.pixelDiff?V.bandwidth-$.bandwidth:$.pixelDiff-V.pixelDiff),M=R[0]}const O=M||P||x||y||c[0]||u[0];if(O&&O.playlist){let R="sortedPlaylistReps";return M?R="leastPixelDiffRep":P?R="resolutionPlusOneRep":x?R="resolutionBestRep":y?R="bandwidthBestRep":c[0]&&(R="enabledPlaylistReps"),Hu(`choosing ${K0(O)} using ${R} with options`,a),O.playlist}return Hu("could not choose a playlist with options",a),null};const X0=function(){const i=this.useDevicePixelRatio&&I.devicePixelRatio||1;return kb(this.playlists.main,this.systemBandwidth,parseInt(Gl(this.tech_.el(),"width"),10)*i,parseInt(Gl(this.tech_.el(),"height"),10)*i,this.limitRenditionByPlayerDimensions,this.playlistController_)},gP=function(i){let e=-1,t=-1;if(i<0||i>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){const n=this.useDevicePixelRatio&&I.devicePixelRatio||1;return e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=i*this.systemBandwidth+(1-i)*e,t=this.systemBandwidth),kb(this.playlists.main,e,parseInt(Gl(this.tech_.el(),"width"),10)*n,parseInt(Gl(this.tech_.el(),"height"),10)*n,this.limitRenditionByPlayerDimensions,this.playlistController_)}},_P=function(i){const{main:e,currentTime:t,bandwidth:n,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:o,syncController:u}=i,c=e.playlists.filter(v=>!vi.isIncompatible(v));let h=c.filter(vi.isEnabled);h.length||(h=c.filter(v=>!vi.isDisabled(v)));const y=h.filter(vi.hasAttribute.bind(null,"BANDWIDTH")).map(v=>{const A=u.getSyncPoint(v,r,o,t)?1:2,P=vi.estimateSegmentRequestTime(s,n,v)*A-a;return{playlist:v,rebufferingImpact:P}}),T=y.filter(v=>v.rebufferingImpact<=0);return Ns(T,(v,x)=>Bp(x.playlist,v.playlist)),T.length?T[0]:(Ns(y,(v,x)=>v.rebufferingImpact-x.rebufferingImpact),y[0]||null)},yP=function(){const i=this.playlists.main.playlists.filter(vi.isEnabled);return Ns(i,(t,n)=>Bp(t,n)),i.filter(t=>!!_o(this.playlists.main,t).video)[0]||null},vP=i=>{let e=0,t;return i.bytes&&(t=new Uint8Array(i.bytes),i.segments.forEach(n=>{t.set(n,e),e+=n.byteLength})),t},TP=function(i,e,t){if(!i[t]){e.trigger({type:"usage",name:"vhs-608"});let n=t;/^cc708_/.test(t)&&(n="SERVICE"+t.split("_")[1]);const r=e.textTracks().getTrackById(n);if(r)i[t]=r;else{const s=e.options_.vhs&&e.options_.vhs.captionServices||{};let a=t,o=t,u=!1;const c=s[n];c&&(a=c.label,o=c.language,u=c.default),i[t]=e.addRemoteTextTrack({kind:"captions",id:n,default:u,label:a,language:o},!1).track}}},bP=function({inbandTextTracks:i,captionArray:e,timestampOffset:t}){if(!e)return;const n=I.WebKitDataCue||I.VTTCue;e.forEach(r=>{const s=r.stream;i[s].addCue(new n(r.startTime+t,r.endTime+t,r.text))})},EP=function(i){Object.defineProperties(i.frame,{id:{get(){return F.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),i.value.key}},value:{get(){return F.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),i.value.data}},privateData:{get(){return F.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),i.value.data}}})},SP=({inbandTextTracks:i,metadataArray:e,timestampOffset:t,videoDuration:n})=>{if(!e)return;const r=I.WebKitDataCue||I.VTTCue,s=i.metadataTrack_;if(!s||(e.forEach(h=>{const g=h.cueTime+t;typeof g!="number"||I.isNaN(g)||g<0||!(g<1/0)||h.frames.forEach(y=>{const T=new r(g,g,y.value||y.url||y.data||"");T.frame=y,T.value=y,EP(T),s.addCue(T)})}),!s.cues||!s.cues.length))return;const a=s.cues,o=[];for(let h=0;h<a.length;h++)a[h]&&o.push(a[h]);const u=o.reduce((h,g)=>{const y=h[g.startTime]||[];return y.push(g),h[g.startTime]=y,h},{}),c=Object.keys(u).sort((h,g)=>Number(h)-Number(g));c.forEach((h,g)=>{const y=u[h],T=Number(c[g+1])||n;y.forEach(v=>{v.endTime=T})})},xP=(i,e,t)=>{i.metadataTrack_||(i.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,i.metadataTrack_.inBandMetadataTrackDispatchType=e)},ao=function(i,e,t){let n,r;if(t&&t.cues)for(n=t.cues.length;n--;)r=t.cues[n],r.startTime>=i&&r.endTime<=e&&t.removeCue(r)},CP=function(i){const e=i.cues;if(e)for(let t=0;t<e.length;t++){const n=[];let r=0;for(let s=0;s<e.length;s++)e[t].startTime===e[s].startTime&&e[t].endTime===e[s].endTime&&e[t].text===e[s].text&&(r++,r>1&&n.push(e[s]));n.length&&n.forEach(s=>i.removeCue(s))}},wP=(i,e,t)=>{if(typeof e>"u"||e===null||!i.length)return[];const n=Math.ceil((e-t+3)*Dl.ONE_SECOND_IN_TS);let r;for(r=0;r<i.length&&!(i[r].pts>n);r++);return i.slice(r)},AP=(i,e,t)=>{if(!e.length)return i;if(t)return e.slice();const n=e[0].pts;let r=0;for(r;r<i.length&&!(i[r].pts>=n);r++);return i.slice(0,r).concat(e)},DP=(i,e,t,n)=>{const r=Math.ceil((e-n)*Dl.ONE_SECOND_IN_TS),s=Math.ceil((t-n)*Dl.ONE_SECOND_IN_TS),a=i.slice();let o=i.length;for(;o--&&!(i[o].pts<=s););if(o===-1)return a;let u=o+1;for(;u--&&!(i[u].pts<=r););return u=Math.max(u,0),a.splice(u,o-u+1),a},IP=function(i,e){if(!i&&!e||!i&&e||i&&!e)return!1;if(i===e)return!0;const t=Object.keys(i).sort(),n=Object.keys(e).sort();if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(s!==n[r]||i[s]!==e[s])return!1}return!0},Pb=22,kP=function(i,e,t){e=e||[];const n=[];let r=0;for(let s=0;s<e.length;s++){const a=e[s];if(i===a.timeline&&(n.push(s),r+=a.duration,r>t))return s}return n.length===0?0:n[n.length-1]},Ja=1,PP=500,Y0=i=>typeof i=="number"&&isFinite(i),Gu=1/60,RP=(i,e,t)=>i!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,OP=(i,e,t)=>{let n=e-xt.BACK_BUFFER_LENGTH;i.length&&(n=Math.max(n,i.start(0)));const r=e-t;return Math.min(r,n)},ys=i=>{const{startOfSegment:e,duration:t,segment:n,part:r,playlist:{mediaSequence:s,id:a,segments:o=[]},mediaIndex:u,partIndex:c,timeline:h}=i,g=o.length-1;let y="mediaIndex/partIndex increment";i.getMediaInfoForTime?y=`getMediaInfoForTime (${i.getMediaInfoForTime})`:i.isSyncRequest&&(y="getSyncSegmentCandidate (isSyncRequest)"),i.independent&&(y+=` with independent ${i.independent}`);const T=typeof c=="number",v=i.segment.uri?"segment":"pre-segment",x=T?ZT({preloadSegment:n})-1:0;return`${v} [${s+u}/${s+g}]`+(T?` part [${c}/${x}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(T?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${h}] selected by [${y}] playlist [${a}]`},Q0=i=>`${i}TimingInfo`,LP=({segmentTimeline:i,currentTimeline:e,startOfSegment:t,buffered:n,overrideCheck:r})=>!r&&i===e?null:i<e?t:n.length?n.end(n.length-1):t,J0=({timelineChangeController:i,currentTimeline:e,segmentTimeline:t,loaderType:n,audioDisabled:r})=>{if(e===t)return!1;if(n==="audio"){const s=i.lastTimelineChange({type:"main"});return!s||s.to!==t}if(n==="main"&&r){const s=i.pendingTimelineChange({type:"audio"});return!(s&&s.to===t)}return!1},NP=i=>{let e=0;return["video","audio"].forEach(function(t){const n=i[`${t}TimingInfo`];if(!n)return;const{start:r,end:s}=n;let a;typeof r=="bigint"||typeof s=="bigint"?a=I.BigInt(s)-I.BigInt(r):typeof r=="number"&&typeof s=="number"&&(a=s-r),typeof a<"u"&&a>e&&(e=a)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},Z0=({segmentDuration:i,maxDuration:e})=>i?Math.round(i)>e+hr:!1,MP=(i,e)=>{if(e!=="hls")return null;const t=NP({audioTimingInfo:i.audioTimingInfo,videoTimingInfo:i.videoTimingInfo});if(!t)return null;const n=i.playlist.targetDuration,r=Z0({segmentDuration:t,maxDuration:n*2}),s=Z0({segmentDuration:t,maxDuration:n}),a=`Segment with index ${i.mediaIndex} from playlist ${i.playlist.id} has a duration of ${t} when the reported duration is ${i.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||s?{severity:r?"warn":"info",message:a}:null};class Qd extends F.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=F.browser.IE_VERSION>=11,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=en(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(n){n!==this.state_&&(this.logger_(`${this.state_} -> ${n}`),this.state_=n,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",()=>{this.hasEnoughInfoToLoad_()&&this.processLoadQueue_(),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})}createTransmuxer_(){return Jh.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&I.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,I.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&Jh.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return qt();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:n,isMuxed:r}=e;if(n&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=$l(e);let r=this.initSegments_[n];return t&&!r&&e.bytes&&(this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const n=pb(e);let r=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[n]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const s={resolvedUri:(r||e).resolvedUri};return r&&(s.bytes=r.bytes),s}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;const n=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let s=null;if(n&&(n.id?s=n.id:n.uri&&(s=n.uri)),this.logger_(`playlist update [${s} => ${e.id||e.uri}]`),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){this.mediaIndex!==null&&(e.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const a=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${a}]`),this.mediaIndex!==null)if(this.mediaIndex-=a,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const o=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!o.parts||!o.parts.length||!o.parts[this.partIndex])){const u=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=u}}r&&(r.mediaIndex-=a,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(I.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.resyncLoader()}resyncLoader(){this.transmuxer_&&Jh.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=()=>{},r=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let s=1;const a=()=>{s--,s===0&&n()};(r||!this.audioDisabled_)&&(s++,this.sourceUpdater_.removeAudio(e,t,a)),(r||this.loaderType_==="main")&&(this.gopBuffer_=DP(this.gopBuffer_,e,t,this.timeMapping_),s++,this.sourceUpdater_.removeVideo(e,t,a));for(const o in this.inbandTextTracks_)ao(e,t,this.inbandTextTracks_[o]);ao(e,t,this.segmentMetadataTrack_),a()}monitorBuffer_(){this.checkBufferTimeout_&&I.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=I.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&I.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=I.setTimeout(this.monitorBufferTick_.bind(this),PP)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();e&&(typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const r=typeof e=="number"&&t.segments[e],s=e+1===t.segments.length,a=!r||!r.parts||n+1===r.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&s&&a}chooseNextRequest_(){const e=this.buffered_(),t=j0(e)||0,n=Rp(e,this.currentTime_()),r=!this.hasPlayed_()&&n>=1,s=n>=this.goalBufferLength_(),a=this.playlist_.segments;if(!a.length||r||s)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());const o={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(o.isSyncRequest)o.mediaIndex=kP(this.currentTimeline_,a,t);else if(this.mediaIndex!==null){const g=a[this.mediaIndex],y=typeof this.partIndex=="number"?this.partIndex:-1;o.startOfSegment=g.end?g.end:t,g.parts&&g.parts[y+1]?(o.mediaIndex=this.mediaIndex,o.partIndex=y+1):o.mediaIndex=this.mediaIndex+1}else{const{segmentIndex:g,startTime:y,partIndex:T}=vi.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?t:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});o.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${t}`:`currentTime ${this.currentTime_()}`,o.mediaIndex=g,o.startOfSegment=y,o.partIndex=T}const u=a[o.mediaIndex];let c=u&&typeof o.partIndex=="number"&&u.parts&&u.parts[o.partIndex];if(!u||typeof o.partIndex=="number"&&!c)return null;if(typeof o.partIndex!="number"&&u.parts&&(o.partIndex=0,c=u.parts[0]),!n&&c&&!c.independent)if(o.partIndex===0){const g=a[o.mediaIndex-1],y=g.parts&&g.parts.length&&g.parts[g.parts.length-1];y&&y.independent&&(o.mediaIndex-=1,o.partIndex=g.parts.length-1,o.independent="previous segment")}else u.parts[o.partIndex-1].independent&&(o.partIndex-=1,o.independent="previous part");const h=this.mediaSource_&&this.mediaSource_.readyState==="ended";return o.mediaIndex>=a.length-1&&h&&!this.seeking_()?null:this.generateSegmentInfo_(o)}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:r,startOfSegment:s,isSyncRequest:a,partIndex:o,forceTimestampOffset:u,getMediaInfoForTime:c}=e,h=n.segments[r],g=typeof o=="number"&&h.parts[o],y={requestId:"segment-loader-"+Math.random(),uri:g&&g.resolvedUri||h.resolvedUri,mediaIndex:r,partIndex:g?o:null,isSyncRequest:a,startOfSegment:s,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:h.timeline,duration:g&&g.duration||h.duration,segment:h,part:g,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:c,independent:t},T=typeof u<"u"?u:this.isPendingTimestampOffset_;y.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:h.timeline,currentTimeline:this.currentTimeline_,startOfSegment:s,buffered:this.buffered_(),overrideCheck:T});const v=j0(this.sourceUpdater_.audioBuffered());return typeof v=="number"&&(y.audioAppendStart=v-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(y.gopsToAlignWith=wP(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),y}timestampOffsetForSegment_(e){return LP(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,s=vi.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),a=sk(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(s<=a)return;const o=_P({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!o)return;const c=s-a-o.rebufferingImpact;let h=.5;a<=hr&&(h=1),!(!o.playlist||o.playlist.uri===this.playlist_.uri||c<h)&&(this.bandwidth=o.playlist.attributes.BANDWIDTH*xt.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${ys(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},IP(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_())))}handleTimingInfo_(e,t,n,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const s=this.pendingSegment_,a=Q0(t);s[a]=s[a]||{},s[a][n]=r,this.logger_(`timinginfo: ${t} - ${n} - ${r}`),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const r=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),s={};t.forEach(a=>{s[a.stream]=s[a.stream]||{startTime:1/0,captions:[],endTime:0};const o=s[a.stream];o.startTime=Math.min(o.startTime,a.startTime+r),o.endTime=Math.max(o.endTime,a.endTime+r),o.captions.push(a)}),Object.keys(s).forEach(a=>{const{startTime:o,endTime:u,captions:c}=s[a],h=this.inbandTextTracks_;this.logger_(`adding cues from ${o} -> ${u} for ${a}`),TP(h,this.vhs_.tech_,a),ao(o,u,h[a]),bP({captionArray:c,inbandTextTracks:h,timestampOffset:r})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n));return}const s=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();xP(this.inbandTextTracks_,n,this.vhs_.tech_),SP({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:s,videoDuration:this.duration_()})}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!J0({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:r,isMuxed:s}=t;return!(r&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!s&&!e.audioTimingInfo||J0({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){this.callQueue_.push(this.handleData_.bind(this,e,t));return}const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[Q0(t.type)].start;else{const r=this.getCurrentMediaInfo_(),s=this.loaderType_==="main"&&r&&r.hasVideo;let a;s&&(a=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:s,firstVideoFrameTimeForData:a,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:this.loaderType_==="main"});const r=this.chooseNextRequest_();if(r.mediaIndex!==n.mediaIndex||r.partIndex!==n.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:r}){if(n){const s=$l(n);if(this.activeInitSegmentId_===s)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=s}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},r){const s=this.sourceUpdater_.audioBuffered(),a=this.sourceUpdater_.videoBuffered();s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Or(s).join(", ")),a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Or(a).join(", "));const o=s.length?s.start(0):0,u=s.length?s.end(s.length-1):0,c=a.length?a.start(0):0,h=a.length?a.end(a.length-1):0;if(u-o<=Ja&&h-c<=Ja){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${Or(s).join(", ")}, video buffer: ${Or(a).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const y=this.currentTime_()-Ja;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${y}`),this.remove(0,y,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${Ja}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=I.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},Ja*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},r){if(r){if(r.code===Pb){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error(`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:r,bytes:s}){if(!s){const a=[r];let o=r.byteLength;n&&(a.unshift(n),o+=n.byteLength),s=vP({bytes:o,segments:a})}this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:s},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:s}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,s=`${e}TimingInfo`;r[s]||(r[s]={}),r[s].transmuxerPrependedSeconds=n.prependedContentDuration||0,r[s].transmuxedPresentationStart=n.start.presentation,r[s].transmuxedDecodeStart=n.start.decode,r[s].transmuxedPresentationEnd=n.end.presentation,r[s].transmuxedDecodeEnd=n.end.decode,r[s].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:r}=t;if(!r||!r.byteLength||n==="audio"&&this.audioDisabled_)return;const s=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:s,data:r})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){this.loadQueue_.push(()=>{const t=Bn({},e,{forceTimestampOffset:!0});Bn(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=this.mediaIndex!==null,s=e.timeline!==this.currentTimeline_&&e.timeline>0,a=n||r&&s;this.logger_(`Requesting ${ys(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=hP({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:o,level:u,stream:c})=>{this.logger_(`${ys(e)} logged from transmuxer stream ${c} as a ${u}: ${o}`)}})}trimBackBuffer_(e){const t=OP(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,r={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},s=e.playlist.segments[e.mediaIndex-1];if(s&&s.timeline===t.timeline&&(s.videoTimingInfo?r.baseStartTime=s.videoTimingInfo.transmuxedDecodeEnd:s.audioTimingInfo&&(r.baseStartTime=s.audioTimingInfo.transmuxedDecodeEnd)),t.key){const a=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);r.key=this.segmentKey(t.key),r.key.iv=a}return t.map&&(r.map=this.initSegmentForMap(t.map)),r}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<Gu){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${Gu}`);return}this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===mn.ABORTED)return;if(this.pause(),e.code===mn.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=AP(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:s,useVideoTimingInfo:a,videoTimingInfo:o,audioTimingInfo:u}){if(typeof e<"u")return e;if(!a)return u.start;const c=t.segments[n-1];return n===0||!c||typeof c.start>"u"||c.end!==r+s?r:o.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:n,hasVideo:r,isMuxed:s}=t,a=this.loaderType_==="main"&&r,o=!this.audioDisabled_&&n&&!s;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}a&&e.waitingOnAppends++,o&&e.waitingOnAppends++,a&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),o&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=RP(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),r=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;r&&(e.timingInfo.end=typeof r.end=="number"?r.end:r.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=MP(e,this.sourceType_);if(t&&(t.severity==="warn"?F.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${ys(e)}`);return}this.logger_(`Appended ${ys(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,r=e.part,s=n.end&&this.currentTime_()-n.end>e.playlist.targetDuration*3,a=r&&r.end&&this.currentTime_()-r.end>e.playlist.partTargetDuration*3;if(s||a){this.logger_(`bad ${s?"segment":"part"} ${ys(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<Gu){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${Gu}`);return}const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,r=t.end;if(!Y0(n)||!Y0(r))return;ao(n,r,this.segmentMetadataTrack_);const s=I.WebKitDataCue||I.VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:r},o=JSON.stringify(a),u=new s(n,r,o);u.value=a,this.segmentMetadataTrack_.addCue(u)}}function On(){}const Rb=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},FP=["video","audio"],Jd=(i,e)=>{const t=e[`${i}Buffer`];return t&&t.updating||e.queuePending[i]},BP=(i,e)=>{for(let t=0;t<e.length;t++){const n=e[t];if(n.type==="mediaSource")return null;if(n.type===i)return t}return null},Ms=(i,e)=>{if(e.queue.length===0)return;let t=0,n=e.queue[t];if(n.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),Ms("audio",e),Ms("video",e));return}if(i!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||Jd(i,e))){if(n.type!==i){if(t=BP(i,e.queue),t===null)return;n=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[i]=n,n.action(i,e),!n.doneFn){e.queuePending[i]=null,Ms(i,e);return}}},Ob=(i,e)=>{const t=e[`${i}Buffer`],n=Rb(i);t&&(t.removeEventListener("updateend",e[`on${n}UpdateEnd_`]),t.removeEventListener("error",e[`on${n}Error_`]),e.codecs[i]=null,e[`${i}Buffer`]=null)},cn=(i,e)=>i&&e&&Array.prototype.indexOf.call(i.sourceBuffers,e)!==-1,Ci={appendBuffer:(i,e,t)=>(n,r)=>{const s=r[`${n}Buffer`];if(cn(r.mediaSource,s)){r.logger_(`Appending segment ${e.mediaIndex}'s ${i.length} bytes to ${n}Buffer`);try{s.appendBuffer(i)}catch(a){r.logger_(`Error with code ${a.code} `+(a.code===Pb?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${n}Buffer`),r.queuePending[n]=null,t(a)}}},remove:(i,e)=>(t,n)=>{const r=n[`${t}Buffer`];if(cn(n.mediaSource,r)){n.logger_(`Removing ${i} to ${e} from ${t}Buffer`);try{r.remove(i,e)}catch{n.logger_(`Remove ${i} to ${e} from ${t}Buffer failed`)}}},timestampOffset:i=>(e,t)=>{const n=t[`${e}Buffer`];cn(t.mediaSource,n)&&(t.logger_(`Setting ${e}timestampOffset to ${i}`),n.timestampOffset=i)},callback:i=>(e,t)=>{i()},endOfStream:i=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${i||""})`);try{e.mediaSource.endOfStream(i)}catch(t){F.log.warn("Failed to call media source endOfStream",t)}}},duration:i=>e=>{e.logger_(`Setting mediaSource duration to ${i}`);try{e.mediaSource.duration=i}catch(t){F.log.warn("Failed to set media source duration",t)}},abort:()=>(i,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${i}Buffer`];if(cn(e.mediaSource,t)){e.logger_(`calling abort on ${i}Buffer`);try{t.abort()}catch(n){F.log.warn(`Failed to abort on ${i}Buffer`,n)}}},addSourceBuffer:(i,e)=>t=>{const n=Rb(i),r=wo(e);t.logger_(`Adding ${i}Buffer with codec ${e} to mediaSource`);const s=t.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",t[`on${n}UpdateEnd_`]),s.addEventListener("error",t[`on${n}Error_`]),t.codecs[i]=e,t[`${i}Buffer`]=s},removeSourceBuffer:i=>e=>{const t=e[`${i}Buffer`];if(Ob(i,e),!!cn(e.mediaSource,t)){e.logger_(`Removing ${i}Buffer with codec ${e.codecs[i]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(n){F.log.warn(`Failed to removeSourceBuffer ${i}Buffer`,n)}}},changeType:i=>(e,t)=>{const n=t[`${e}Buffer`],r=wo(i);cn(t.mediaSource,n)&&t.codecs[e]!==i&&(t.logger_(`changing ${e}Buffer codec from ${t.codecs[e]} to ${i}`),n.changeType(r),t.codecs[e]=i)}},wi=({type:i,sourceUpdater:e,action:t,doneFn:n,name:r})=>{e.queue.push({type:i,action:t,doneFn:n,name:r}),Ms(i,e)},e_=(i,e)=>t=>{if(e.queuePending[i]){const n=e.queuePending[i].doneFn;e.queuePending[i]=null,n&&n(e[`${i}Error_`])}Ms(i,e)};class Lb extends F.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>Ms("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=en("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=e_("video",this),this.onAudioUpdateEnd_=e_("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){wi({type:"mediaSource",sourceUpdater:this,action:Ci.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){wi({type:e,sourceUpdater:this,action:Ci.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){F.log.error("removeSourceBuffer is not supported!");return}wi({type:"mediaSource",sourceUpdater:this,action:Ci.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!F.browser.IE_VERSION&&!F.browser.IS_FIREFOX&&I.MediaSource&&I.MediaSource.prototype&&typeof I.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return I.SourceBuffer&&I.SourceBuffer.prototype&&typeof I.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){F.log.error("changeType is not supported!");return}wi({type:e,sourceUpdater:this,action:Ci.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:r,bytes:s}=e;if(this.processedAppend_=!0,r==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${s.length} until video append`);return}const a=t;if(wi({type:r,sourceUpdater:this,action:Ci.appendBuffer(s,n||{mediaIndex:-1},a),doneFn:t,name:"appendBuffer"}),r==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const o=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${o.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,o.forEach(u=>{this.appendBuffer.apply(this,u)})}}audioBuffered(){return cn(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:qt()}videoBuffered(){return cn(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:qt()}buffered(){const e=cn(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=cn(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():rk(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=On){wi({type:"mediaSource",sourceUpdater:this,action:Ci.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=On){typeof e!="string"&&(e=void 0),wi({type:"mediaSource",sourceUpdater:this,action:Ci.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=On){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){n();return}wi({type:"audio",sourceUpdater:this,action:Ci.remove(e,t),doneFn:n,name:"remove"})}removeVideo(e,t,n=On){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){n();return}wi({type:"video",sourceUpdater:this,action:Ci.remove(e,t),doneFn:n,name:"remove"})}updating(){return!!(Jd("audio",this)||Jd("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(wi({type:"audio",sourceUpdater:this,action:Ci.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset!==e&&(wi({type:"video",sourceUpdater:this,action:Ci.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&wi({type:"audio",sourceUpdater:this,action:Ci.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&wi({type:"video",sourceUpdater:this,action:Ci.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),FP.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>Ob(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const t_=i=>decodeURIComponent(escape(String.fromCharCode.apply(null,i))),i_=new Uint8Array(`

`.split("").map(i=>i.charCodeAt(0)));class UP extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class VP extends Qd{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.loaderType_="subtitle",this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}createTransmuxer_(){return null}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return qt();const e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return qt([[t,n]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=$l(e);let r=this.initSegments_[n];if(t&&!r&&e.bytes){const s=i_.byteLength+e.bytes.byteLength,a=new Uint8Array(s);a.set(e.bytes),a.set(i_,e.bytes.byteLength),this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){ao(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===mn.TIMEOUT&&this.handleTimeout_(),e.code===mn.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const s=r.segment;if(s.map&&(s.map.bytes=t.map.bytes),r.bytes=t.bytes,typeof I.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));return}s.requested=!0;try{this.parseVTTCues_(r)}catch(a){this.stopForError({message:a.message});return}if(this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,r.cues.forEach(a=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new I.VTTCue(a.startTime,a.endTime,a.text):a)}),CP(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(){}updateTimingInfoEnd_(){}parseVTTCues_(e){let t,n=!1;if(typeof I.WebVTT!="function")throw new UP;typeof I.TextDecoder=="function"?t=new I.TextDecoder("utf8"):(t=I.WebVTT.StringDecoder(),n=!0);const r=new I.WebVTT.Parser(I,I.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=a=>{e.timestampmap=a},r.onparsingerror=a=>{F.log.warn("Error encountered when parsing cues: "+a.message)},e.segment.map){let a=e.segment.map.bytes;n&&(a=t_(a)),r.parse(a)}let s=e.bytes;n&&(s=t_(s)),r.parse(s),r.flush()}updateTimeMapping_(e,t,n){const r=e.segment;if(!t)return;if(!e.cues.length){r.empty=!0;return}const s=e.timestampmap,a=s.MPEGTS/Dl.ONE_SECOND_IN_TS-s.LOCAL+t.mapping;if(e.cues.forEach(o=>{o.startTime+=a,o.endTime+=a}),!n.syncInfo){const o=e.cues[0].startTime,u=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(o,u-r.duration)}}}}const jP=function(i,e){const t=i.cues;for(let n=0;n<t.length;n++){const r=t[n];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null},$P=function(i,e,t=0){if(!i.segments)return;let n=t,r;for(let s=0;s<i.segments.length;s++){const a=i.segments[s];if(r||(r=jP(e,n+a.duration/2)),r){if("cueIn"in a){r.endTime=n,r.adEndTime=n,n+=a.duration,r=null;continue}if(n<r.endTime){n+=a.duration;continue}r.endTime+=a.duration}else if("cueOut"in a&&(r=new I.VTTCue(n,n+a.duration,a.cueOut),r.adStartTime=n,r.adEndTime=n+parseFloat(a.cueOut),e.addCue(r)),"cueOutCont"in a){const[o,u]=a.cueOutCont.split("/").map(parseFloat);r=new I.VTTCue(n,n+a.duration,""),r.adStartTime=n-o,r.adEndTime=r.adStartTime+u,e.addCue(r)}n+=a.duration}},qP=86400,n_=[{name:"VOD",run:(i,e,t,n,r)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"ProgramDateTime",run:(i,e,t,n,r)=>{if(!Object.keys(i.timelineToDatetimeMappings).length)return null;let s=null,a=null;const o=qd(e);r=r||0;for(let u=0;u<o.length;u++){const c=e.endList||r===0?u:o.length-(u+1),h=o[c],g=h.segment,y=i.timelineToDatetimeMappings[g.timeline];if(!y||!g.dateTimeObject)continue;let v=g.dateTimeObject.getTime()/1e3+y;if(g.parts&&typeof h.partIndex=="number")for(let A=0;A<h.partIndex;A++)v+=g.parts[A].duration;const x=Math.abs(r-v);if(a!==null&&(x===0||a<x))break;a=x,s={time:v,segmentIndex:h.segmentIndex,partIndex:h.partIndex}}return s}},{name:"Segment",run:(i,e,t,n,r)=>{let s=null,a=null;r=r||0;const o=qd(e);for(let u=0;u<o.length;u++){const c=e.endList||r===0?u:o.length-(u+1),h=o[c],g=h.segment,y=h.part&&h.part.start||g&&g.start;if(g.timeline===n&&typeof y<"u"){const T=Math.abs(r-y);if(a!==null&&a<T)break;(!s||a===null||a>=T)&&(a=T,s={time:y,segmentIndex:h.segmentIndex,partIndex:h.partIndex})}}return s}},{name:"Discontinuity",run:(i,e,t,n,r)=>{let s=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length){let a=null;for(let o=0;o<e.discontinuityStarts.length;o++){const u=e.discontinuityStarts[o],c=e.discontinuitySequence+o+1,h=i.discontinuities[c];if(h){const g=Math.abs(r-h.time);if(a!==null&&a<g)break;(!s||a===null||a>=g)&&(a=g,s={time:h.time,segmentIndex:u,partIndex:null})}}}return s}},{name:"Playlist",run:(i,e,t,n,r)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class HP extends F.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={},this.logger_=en("SyncController")}getSyncPoint(e,t,n,r){const s=this.runStrategies_(e,t,n,r);return s.length?this.selectSyncPoint_(s,{key:"time",value:r}):null}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+go({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,r){const s=[];for(let a=0;a<n_.length;a++){const o=n_[a],u=o.run(this,e,t,n,r);u&&(u.strategy=o.name,s.push({strategy:o.name,syncPoint:u}))}return s}selectSyncPoint_(e,t){let n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),s=e[0].strategy;for(let a=1;a<e.length;a++){const o=Math.abs(e[a].syncPoint[t.key]-t.value);o<r&&(r=o,n=e[a].syncPoint,s=e[a].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${s}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+(typeof n.partIndex=="number"?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>qP){F.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);return}for(let r=n-1;r>=0;r--){const s=e.segments[r];if(s&&typeof s.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+r,time:s.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const s=r.dateTimeObject;r.discontinuity&&t&&s&&(this.timelineToDatetimeMappings[r.timeline]=-(s.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const r=e.segment,s=e.part;let a=this.timelines[e.timeline],o,u;if(typeof e.timestampOffset=="number")a={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=a,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${a.time}] [mapping: ${a.mapping}]`)),o=e.startOfSegment,u=t.end+a.mapping;else if(a)o=t.start+a.mapping,u=t.end+a.mapping;else return!1;return s&&(s.start=o,s.end=u),(!r.start||o<r.start)&&(r.start=o),r.end=u,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const s=t.discontinuityStarts[r],a=t.discontinuitySequence+r+1,o=s-e.mediaIndex,u=Math.abs(o);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>u){let c;o<0?c=n.start-go({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:s}):c=n.end+go({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:s}),this.discontinuities[a]={time:c,accuracy:u}}}}dispose(){this.trigger("dispose"),this.off()}}class GP extends F.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e],this.trigger("timelinechange")),this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const zP=Tb(bb(function(){var i=function(){function x(){this.listeners={}}var A=x.prototype;return A.on=function(P,M){this.listeners[P]||(this.listeners[P]=[]),this.listeners[P].push(M)},A.off=function(P,M){if(!this.listeners[P])return!1;var O=this.listeners[P].indexOf(M);return this.listeners[P]=this.listeners[P].slice(0),this.listeners[P].splice(O,1),O>-1},A.trigger=function(P){var M=this.listeners[P];if(M)if(arguments.length===2)for(var O=M.length,R=0;R<O;++R)M[R].call(this,arguments[1]);else for(var $=Array.prototype.slice.call(arguments,1),V=M.length,ie=0;ie<V;++ie)M[ie].apply(this,$)},A.dispose=function(){this.listeners={}},A.pipe=function(P){this.on("data",function(M){P.push(M)})},x}();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function e(x){return x.subarray(0,x.byteLength-x[x.byteLength-1])}/*! @name aes-decrypter @version 4.0.1 @license Apache-2.0 */const t=function(){const x=[[[],[],[],[],[]],[[],[],[],[],[]]],A=x[0],D=x[1],P=A[4],M=D[4];let O,R,$;const V=[],ie=[];let Z,he,_e,me,X,Ae;for(O=0;O<256;O++)ie[(V[O]=O<<1^(O>>7)*283)^O]=O;for(R=$=0;!P[R];R^=Z||1,$=ie[$]||1)for(me=$^$<<1^$<<2^$<<3^$<<4,me=me>>8^me&255^99,P[R]=me,M[me]=R,_e=V[he=V[Z=V[R]]],Ae=_e*16843009^he*65537^Z*257^R*16843008,X=V[me]*257^me*16843008,O=0;O<4;O++)A[O][R]=X=X<<24^X>>>8,D[O][me]=Ae=Ae<<24^Ae>>>8;for(O=0;O<5;O++)A[O]=A[O].slice(0),D[O]=D[O].slice(0);return x};let n=null;class r{constructor(A){n||(n=t()),this._tables=[[n[0][0].slice(),n[0][1].slice(),n[0][2].slice(),n[0][3].slice(),n[0][4].slice()],[n[1][0].slice(),n[1][1].slice(),n[1][2].slice(),n[1][3].slice(),n[1][4].slice()]];let D,P,M;const O=this._tables[0][4],R=this._tables[1],$=A.length;let V=1;if($!==4&&$!==6&&$!==8)throw new Error("Invalid aes key size");const ie=A.slice(0),Z=[];for(this._key=[ie,Z],D=$;D<4*$+28;D++)M=ie[D-1],(D%$===0||$===8&&D%$===4)&&(M=O[M>>>24]<<24^O[M>>16&255]<<16^O[M>>8&255]<<8^O[M&255],D%$===0&&(M=M<<8^M>>>24^V<<24,V=V<<1^(V>>7)*283)),ie[D]=ie[D-$]^M;for(P=0;D;P++,D--)M=ie[P&3?D:D-4],D<=4||P<4?Z[P]=M:Z[P]=R[0][O[M>>>24]]^R[1][O[M>>16&255]]^R[2][O[M>>8&255]]^R[3][O[M&255]]}decrypt(A,D,P,M,O,R){const $=this._key[1];let V=A^$[0],ie=M^$[1],Z=P^$[2],he=D^$[3],_e,me,X;const Ae=$.length/4-2;let rt,Ce=4;const $e=this._tables[1],tt=$e[0],Nt=$e[1],bt=$e[2],kt=$e[3],hi=$e[4];for(rt=0;rt<Ae;rt++)_e=tt[V>>>24]^Nt[ie>>16&255]^bt[Z>>8&255]^kt[he&255]^$[Ce],me=tt[ie>>>24]^Nt[Z>>16&255]^bt[he>>8&255]^kt[V&255]^$[Ce+1],X=tt[Z>>>24]^Nt[he>>16&255]^bt[V>>8&255]^kt[ie&255]^$[Ce+2],he=tt[he>>>24]^Nt[V>>16&255]^bt[ie>>8&255]^kt[Z&255]^$[Ce+3],Ce+=4,V=_e,ie=me,Z=X;for(rt=0;rt<4;rt++)O[(3&-rt)+R]=hi[V>>>24]<<24^hi[ie>>16&255]<<16^hi[Z>>8&255]<<8^hi[he&255]^$[Ce++],_e=V,V=ie,ie=Z,Z=he,he=_e}}class s extends i{constructor(){super(i),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(A){this.jobs.push(A),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const a=function(x){return x<<24|(x&65280)<<8|(x&16711680)>>8|x>>>24},o=function(x,A,D){const P=new Int32Array(x.buffer,x.byteOffset,x.byteLength>>2),M=new r(Array.prototype.slice.call(A)),O=new Uint8Array(x.byteLength),R=new Int32Array(O.buffer);let $,V,ie,Z,he,_e,me,X,Ae;for($=D[0],V=D[1],ie=D[2],Z=D[3],Ae=0;Ae<P.length;Ae+=4)he=a(P[Ae]),_e=a(P[Ae+1]),me=a(P[Ae+2]),X=a(P[Ae+3]),M.decrypt(he,_e,me,X,R,Ae),R[Ae]=a(R[Ae]^$),R[Ae+1]=a(R[Ae+1]^V),R[Ae+2]=a(R[Ae+2]^ie),R[Ae+3]=a(R[Ae+3]^Z),$=he,V=_e,ie=me,Z=X;return O};class u{constructor(A,D,P,M){const O=u.STEP,R=new Int32Array(A.buffer),$=new Uint8Array(A.byteLength);let V=0;for(this.asyncStream_=new s,this.asyncStream_.push(this.decryptChunk_(R.subarray(V,V+O),D,P,$)),V=O;V<R.length;V+=O)P=new Uint32Array([a(R[V-4]),a(R[V-3]),a(R[V-2]),a(R[V-1])]),this.asyncStream_.push(this.decryptChunk_(R.subarray(V,V+O),D,P,$));this.asyncStream_.push(function(){M(null,e($))})}static get STEP(){return 32e3}decryptChunk_(A,D,P,M){return function(){const O=o(A,D,P);M.set(O,A.byteOffset)}}}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h;typeof window<"u"?h=window:typeof c<"u"?h=c:typeof self<"u"?h=self:h={};var g=h,y=function(A){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(A):A&&A.buffer instanceof ArrayBuffer},T=g.BigInt||Number;T("0x1"),T("0x100"),T("0x10000"),T("0x1000000"),T("0x100000000"),T("0x10000000000"),T("0x1000000000000"),T("0x100000000000000"),T("0x10000000000000000"),function(){var x=new Uint16Array([65484]),A=new Uint8Array(x.buffer,x.byteOffset,x.byteLength);return A[0]===255?"big":A[0]===204?"little":"unknown"}();const v=function(x){const A={};return Object.keys(x).forEach(D=>{const P=x[D];y(P)?A[D]={bytes:P.buffer,byteOffset:P.byteOffset,byteLength:P.byteLength}:A[D]=P}),A};self.onmessage=function(x){const A=x.data,D=new Uint8Array(A.encrypted.bytes,A.encrypted.byteOffset,A.encrypted.byteLength),P=new Uint32Array(A.key.bytes,A.key.byteOffset,A.key.byteLength/4),M=new Uint32Array(A.iv.bytes,A.iv.byteOffset,A.iv.byteLength/4);new u(D,P,M,function(O,R){self.postMessage(v({source:A.source,decrypted:R}),[R.buffer])})}}));var WP=vb(zP);const KP=i=>{let e=i.default?"main":"alternative";return i.characteristics&&i.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},zl=(i,e)=>{i.abort(),i.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},Zd=(i,e)=>{e.activePlaylistLoader=i,i.load()},XP=(i,e)=>()=>{const{segmentLoaders:{[i]:t,main:n},mediaTypes:{[i]:r}}=e,s=r.activeTrack(),a=r.getActiveGroup(),o=r.activePlaylistLoader,u=r.lastGroup_;if(!(a&&u&&a.id===u.id)&&(r.lastGroup_=a,r.lastTrack_=s,zl(t,r),!(!a||a.isMainPlaylist))){if(!a.playlistLoader){o&&n.resetEverything();return}t.resyncLoader(),Zd(a.playlistLoader,r)}},YP=(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;n.lastGroup_=null,t.abort(),t.pause()},QP=(i,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[i]:n,main:r},mediaTypes:{[i]:s}}=e,a=s.activeTrack(),o=s.getActiveGroup(),u=s.activePlaylistLoader,c=s.lastTrack_;if(!(c&&a&&c.id===a.id)&&(s.lastGroup_=o,s.lastTrack_=a,zl(n,s),!!o)){if(o.isMainPlaylist){if(!a||!c||a.id===c.id)return;const h=e.vhs.playlistController_,g=h.selectPlaylist();if(h.media()===g)return;s.logger_(`track change. Switching main audio from ${c.id} to ${a.id}`),t.pause(),r.resetEverything(),h.fastQualityChange_(g);return}if(i==="AUDIO"){if(!o.playlistLoader){r.setAudio(!0),r.resetEverything();return}n.setAudio(!0),r.setAudio(!1)}if(u===o.playlistLoader){Zd(o.playlistLoader,s);return}n.track&&n.track(a),n.resetEverything(),Zd(o.playlistLoader,s)}},Wl={AUDIO:(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n},excludePlaylist:r}=e;zl(t,n);const s=n.activeTrack(),a=n.activeGroup(),o=(a.filter(c=>c.default)[0]||a[0]).id,u=n.tracks[o];if(s===u){r({error:{message:"Problem encountered loading the default audio track."}});return}F.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const c in n.tracks)n.tracks[c].enabled=n.tracks[c]===u;n.onTrackChanged()},SUBTITLES:(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;F.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),zl(t,n);const r=n.activeTrack();r&&(r.mode="disabled"),n.onTrackChanged()}},r_={AUDIO:(i,e,t)=>{if(!e)return;const{tech:n,requestOptions:r,segmentLoaders:{[i]:s}}=t;e.on("loadedmetadata",()=>{const a=e.media();s.playlist(a,r),(!n.paused()||a.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",Wl[i](i,t))},SUBTITLES:(i,e,t)=>{const{tech:n,requestOptions:r,segmentLoaders:{[i]:s},mediaTypes:{[i]:a}}=t;e.on("loadedmetadata",()=>{const o=e.media();s.playlist(o,r),s.track(a.activeTrack()),(!n.paused()||o.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",Wl[i](i,t))}},JP={AUDIO:(i,e)=>{const{vhs:t,sourceType:n,segmentLoaders:{[i]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[i]:{groups:o,tracks:u,logger_:c}},mainPlaylistLoader:h}=e,g=nu(h.main);(!a[i]||Object.keys(a[i]).length===0)&&(a[i]={main:{default:{default:!0}}},g&&(a[i].main.default.playlists=h.main.playlists));for(const y in a[i]){o[y]||(o[y]=[]);for(const T in a[i][y]){let v=a[i][y][T],x;if(g?(c(`AUDIO group '${y}' label '${T}' is a main playlist`),v.isMainPlaylist=!0,x=null):n==="vhs-json"&&v.playlists?x=new As(v.playlists[0],t,s):v.resolvedUri?x=new As(v.resolvedUri,t,s):v.playlists&&n==="dash"?x=new Xd(v.playlists[0],t,s,h):x=null,v=We({id:T,playlistLoader:x},v),r_[i](i,v.playlistLoader,e),o[y].push(v),typeof u[T]>"u"){const A=new F.AudioTrack({id:T,kind:KP(v),enabled:!1,language:v.language,default:v.default,label:T});u[T]=A}}}r.on("error",Wl[i](i,e))},SUBTITLES:(i,e)=>{const{tech:t,vhs:n,sourceType:r,segmentLoaders:{[i]:s},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[i]:{groups:u,tracks:c}},mainPlaylistLoader:h}=e;for(const g in o[i]){u[g]||(u[g]=[]);for(const y in o[i][g]){if(o[i][g][y].forced)continue;let T=o[i][g][y],v;if(r==="hls")v=new As(T.resolvedUri,n,a);else if(r==="dash"){if(!T.playlists.filter(A=>A.excludeUntil!==1/0).length)return;v=new Xd(T.playlists[0],n,a,h)}else r==="vhs-json"&&(v=new As(T.playlists?T.playlists[0]:T.resolvedUri,n,a));if(T=We({id:y,playlistLoader:v},T),r_[i](i,T.playlistLoader,e),u[g].push(T),typeof c[y]>"u"){const x=t.addRemoteTextTrack({id:y,kind:"subtitles",default:T.default&&T.autoselect,language:T.language,label:y},!1).track;c[y]=x}}}s.on("error",Wl[i](i,e))},"CLOSED-CAPTIONS":(i,e)=>{const{tech:t,main:{mediaGroups:n},mediaTypes:{[i]:{groups:r,tracks:s}}}=e;for(const a in n[i]){r[a]||(r[a]=[]);for(const o in n[i][a]){const u=n[i][a][o];if(!/^(?:CC|SERVICE)/.test(u.instreamId))continue;const c=t.options_.vhs&&t.options_.vhs.captionServices||{};let h={label:o,language:u.language,instreamId:u.instreamId,default:u.default&&u.autoselect};if(c[h.instreamId]&&(h=We(h,c[h.instreamId])),h.default===void 0&&delete h.default,r[a].push(We({id:o},u)),typeof s[o]>"u"){const g=t.addRemoteTextTrack({id:h.instreamId,kind:"captions",default:h.default,language:h.language,label:h.label},!1).track;s[o]=g}}}}},Nb=(i,e)=>{for(let t=0;t<i.length;t++)if(Np(e,i[t])||i[t].playlists&&Nb(i[t].playlists,e))return!0;return!1},ZP=(i,e)=>t=>{const{mainPlaylistLoader:n,mediaTypes:{[i]:{groups:r}}}=e,s=n.media();if(!s)return null;let a=null;s.attributes[i]&&(a=r[s.attributes[i]]);const o=Object.keys(r);if(!a)if(i==="AUDIO"&&o.length>1&&nu(e.main))for(let u=0;u<o.length;u++){const c=r[o[u]];if(Nb(c,s)){a=c;break}}else r.main?a=r.main:o.length===1&&(a=r[o[0]]);return typeof t>"u"?a:t===null||!a?null:a.filter(u=>u.id===t.id)[0]||null},eR={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].enabled)return t[n];return null},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].mode==="showing"||t[n].mode==="hidden")return t[n];return null}},tR=(i,{mediaTypes:e})=>()=>{const t=e[i].activeTrack();return t?e[i].activeGroup(t):null},iR=i=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(c=>{JP[c](c,i)});const{mediaTypes:e,mainPlaylistLoader:t,tech:n,vhs:r,segmentLoaders:{["AUDIO"]:s,main:a}}=i;["AUDIO","SUBTITLES"].forEach(c=>{e[c].activeGroup=ZP(c,i),e[c].activeTrack=eR[c](c,i),e[c].onGroupChanged=XP(c,i),e[c].onGroupChanging=YP(c,i),e[c].onTrackChanged=QP(c,i),e[c].getActiveGroup=tR(c,i)});const o=e.AUDIO.activeGroup();if(o){const c=(o.filter(g=>g.default)[0]||o[0]).id;e.AUDIO.tracks[c].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(c=>e[c].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(c=>e[c].onGroupChanging())});const u=()=>{e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",u),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),r.on("dispose",()=>{n.audioTracks().removeEventListener("change",u),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const c in e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[c])},nR=()=>{const i={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{i[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:On,activeTrack:On,getActiveGroup:On,onGroupChanged:On,onTrackChanged:On,lastTrack_:null,logger_:en(`MediaGroups[${e}]`)}}),i},rR=60*2;let Pn;const sR=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],aR=function(i){return this.audioSegmentLoader_[i]+this.mainSegmentLoader_[i]},oR=function({currentPlaylist:i,buffered:e,currentTime:t,nextPlaylist:n,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:a,bufferBasedABR:o,log:u}){if(!n)return F.log.warn("We received no playlist to switch to. Please check your stream."),!1;const c=`allowing switch ${i&&i.id||"null"} -> ${n.id}`;if(!i)return u(`${c} as current playlist is not set`),!0;if(n.id===i.id)return!1;const h=!!ws(e,t).length;if(!i.endList)return!h&&typeof i.partTargetDuration=="number"?(u(`not ${c} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(u(`${c} as current playlist is live`),!0);const g=Rp(e,t),y=o?xt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:xt.MAX_BUFFER_LOW_WATER_LINE;if(a<y)return u(`${c} as duration < max low water line (${a} < ${y})`),!0;const T=n.attributes.BANDWIDTH,v=i.attributes.BANDWIDTH;if(T<v&&(!o||g<s)){let x=`${c} as next bandwidth < current bandwidth (${T} < ${v})`;return o&&(x+=` and forwardBuffer < bufferHighWaterLine (${g} < ${s})`),u(x),!0}if((!o||T>v)&&g>=r){let x=`${c} as forwardBuffer >= bufferLowWaterLine (${g} >= ${r})`;return o&&(x+=` and next bandwidth > current bandwidth (${T} > ${v})`),u(x),!0}return u(`not ${c} as no switching criteria met`),!1};class uR extends F.EventTarget{constructor(e){super();const{src:t,withCredentials:n,tech:r,bandwidth:s,externVhs:a,useCueTags:o,playlistExclusionDuration:u,enableLowInitialPlaylist:c,sourceType:h,cacheEncryptionKeys:g,bufferBasedABR:y,leastPixelDiffSelector:T,captionServices:v}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:x}=e;(x===null||typeof x>"u")&&(x=1/0),Pn=a,this.bufferBasedABR=!!y,this.leastPixelDiffSelector=!!T,this.withCredentials=n,this.tech_=r,this.vhs_=r.vhs,this.sourceType_=h,this.useCueTags_=o,this.playlistExclusionDuration=u,this.maxPlaylistRetries=x,this.enableLowInitialPlaylist=c,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:x,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=nR(),this.mediaSource=new I.MediaSource,this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.seekable_=qt(),this.hasPlayed_=!1,this.syncController_=new HP(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=new WP,this.sourceUpdater_=new Lb(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new GP;const A={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:v,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:g,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings};this.mainPlaylistLoader_=this.sourceType_==="dash"?new Xd(t,this.vhs_,this.requestOptions_):new As(t,this.vhs_,this.requestOptions_),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new Qd(We(A,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new Qd(We(A,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new VP(We(A,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((P,M)=>{function O(){r.off("vttjserror",R),P()}function R(){r.off("vttjsloaded",O),M()}r.one("vttjsloaded",O),r.one("vttjserror",R),r.addWebVttScript_()})}),e),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),sR.forEach(P=>{this[P+"_"]=aR.bind(this,P)}),this.logger_=en("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const D=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(D,()=>{const P=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-P,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const r=this.media(),s=r&&(r.id||r.uri),a=e.id||e.uri;s&&s!==a&&(this.logger_(`switch media ${s} -> ${a} from ${t}`),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})),this.mainPlaylistLoader_.media(e,n)}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=I.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(I.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,r=Object.keys(n);let s;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)s=this.mediaTypes_.AUDIO.activeTrack();else{const o=n.main||r.length&&n[r[0]];for(const u in o)if(o[u].default){s={label:u};break}}if(!s)return t;const a=[];for(const o in n)if(n[o][s.label]){const u=n[o][s.label];if(u.playlists&&u.playlists.length)a.push.apply(a,u.playlists);else if(u.uri)a.push(u);else if(e.playlists.length)for(let c=0;c<e.playlists.length;c++){const h=e.playlists[c];h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===o&&a.push(h)}}return a.length?a:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=e.targetDuration*1.5*1e3;Hd(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),iR({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){this.excludeUnsupportedVariants_();let t;if(this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t)||(this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=e.targetDuration*1.5*1e3;Hd(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if(e.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let r=!0;const s=Object.keys(n.AUDIO);for(const a in n.AUDIO)for(const o in n.AUDIO[a])n.AUDIO[a][o].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Pn.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),s.length&&Object.keys(n.AUDIO[s[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),r=this.bufferLowWaterLine(),s=this.bufferHighWaterLine(),a=this.tech_.buffered();return oR({buffered:a,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const t=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",t=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:rR}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const t=this.getCodecsOrExclude_();t&&this.sourceUpdater_.addOrChangeSourceBuffers(t)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}fastQualityChange_(e=this.selectPlaylist()){if(e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything(()=>{F.browser.IE_VERSION||F.browser.IS_EDGE?this.tech_.setCurrentTime(this.tech_.currentTime()+.04):this.tech_.setCurrentTime(this.tech_.currentTime())})}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList){const t=this.seekable();if(!t.length)return!1;if(F.browser.IE_VERSION&&this.tech_.readyState()===0)return this.tech_.one("loadedmetadata",()=>{this.trigger("firstplay"),this.tech_.setCurrentTime(t.end(0)),this.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(t.end(0))}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(n===null)return!1;const r=Pn.Playlist.playlistEnd(e,n),s=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return r-s<=pn;const o=a.end(a.length-1);return o-s<=pn&&r-o<=pn}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,s=r.filter(Pc),a=s.length===1&&s[0]===e;if(r.length===1&&n!==1/0)return F.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(a);if(a){let T=!1;r.forEach(v=>{if(v===e)return;const x=v.excludeUntil;typeof x<"u"&&x!==1/0&&(T=!0,delete v.excludeUntil)}),T&&(F.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let o;e.playlistErrors_>this.maxPlaylistRetries?o=1/0:o=Date.now()+n*1e3,e.excludeUntil=o,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const u=this.selectPlaylist();if(!u){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const c=t.internal?this.logger_:F.log.warn,h=t.message?" "+t.message:"";c(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${h} Switching to playlist ${u.id}.`),u.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),u.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const g=u.targetDuration/2*1e3||5*1e3,y=typeof u.lastRequest=="number"&&Date.now()-u.lastRequest<=g;return this.switchMedia_(u,"exclude",a||y)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],r=e==="all";(r||e==="main")&&n.push(this.mainPlaylistLoader_);const s=[];(r||e==="audio")&&s.push("AUDIO"),(r||e==="subtitle")&&(s.push("CLOSED-CAPTIONS"),s.push("SUBTITLES")),s.forEach(a=>{const o=this.mediaTypes_[a]&&this.mediaTypes_[a].activePlaylistLoader;o&&n.push(o)}),["main","audio","subtitle"].forEach(a=>{const o=this[`${a}SegmentLoader_`];o&&(e===a||e==="all")&&n.push(o)}),n.forEach(a=>t.forEach(o=>{typeof a[o]=="function"&&a[o]()}))}setCurrentTime(e){const t=ws(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Pn.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}onSyncInfoUpdate_(){let e;if(!this.mainPlaylistLoader_)return;let t=this.mainPlaylistLoader_.media();if(!t)return;let n=this.syncController_.getExpiredTime(t,this.duration());if(n===null)return;const r=this.mainPlaylistLoader_.main,s=Pn.Playlist.seekable(t,n,Pn.Playlist.liveEdgeDelay(r,t));if(s.length===0||this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),n=this.syncController_.getExpiredTime(t,this.duration()),n===null||(e=Pn.Playlist.seekable(t,n,Pn.Playlist.liveEdgeDelay(r,t)),e.length===0)))return;let a,o;this.seekable_&&this.seekable_.length&&(a=this.seekable_.end(0),o=this.seekable_.start(0)),e?e.start(0)>s.end(0)||s.start(0)>e.end(0)?this.seekable_=s:this.seekable_=qt([[e.start(0)>s.start(0)?e.start(0):s.start(0),e.end(0)<s.end(0)?e.end(0):s.end(0)]]):this.seekable_=s,!(this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===a&&this.seekable_.start(0)===o)&&(this.logger_(`seekable updated [${QT(this.seekable_)}]`),this.tech_.trigger("seekablechanged"))}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const r=this.seekable();if(!r.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<r.end(r.length-1))&&this.sourceUpdater_.setDuration(r.end(r.length-1));return}const t=this.tech_.buffered();let n=Pn.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(r=>{r.playlistLoader&&r.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=_o(this.main(),t),r={},s=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=n.video||e.main.videoCodec||Mw),e.main.isMuxed&&(r.video+=`,${n.audio||e.main.audioCodec||Hg}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||s)&&(r.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||Hg,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const a=(c,h)=>c?al(h):Mh(h),o={};let u;if(["video","audio"].forEach(function(c){if(r.hasOwnProperty(c)&&!a(e[c].isFmp4,r[c])){const h=e[c].isFmp4?"browser":"muxer";o[h]=o[h]||[],o[h].push(r[c]),c==="audio"&&(u=h)}}),s&&u&&t.attributes.AUDIO){const c=t.attributes.AUDIO;this.main().playlists.forEach(h=>{(h.attributes&&h.attributes.AUDIO)===c&&h!==t&&(h.excludeUntil=1/0)}),this.logger_(`excluding audio group ${c} as ${u} does not support codec(s): "${r.audio}"`)}if(Object.keys(o).length){const c=Object.keys(o).reduce((h,g)=>(h&&(h+=", "),h+=`${g} does not support codec(s): "${o[g].join(",")}"`,h),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:c},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const c=[];if(["video","audio"].forEach(h=>{const g=(ln(this.sourceUpdater_.codecs[h]||"")[0]||{}).type,y=(ln(r[h]||"")[0]||{}).type;g&&y&&g.toLowerCase()!==y.toLowerCase()&&c.push(`"${this.sourceUpdater_.codecs[h]}" -> "${r[h]}"`)}),c.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${c.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return r}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const r=e[n];if(t.indexOf(r.id)!==-1)return;t.push(r.id);const s=_o(this.main,r),a=[];s.audio&&!Mh(s.audio)&&!al(s.audio)&&a.push(`audio codec ${s.audio}`),s.video&&!Mh(s.video)&&!al(s.video)&&a.push(`video codec ${s.video}`),s.text&&s.text==="stpp.ttml.im1t"&&a.push(`text codec ${s.text}`),a.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${a.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,r=Hl(ln(e)),s=W0(r),a=r.video&&ln(r.video)[0]||null,o=r.audio&&ln(r.audio)[0]||null;Object.keys(n).forEach(u=>{const c=n[u];if(t.indexOf(c.id)!==-1||c.excludeUntil===1/0)return;t.push(c.id);const h=[],g=_o(this.mainPlaylistLoader_.main,c),y=W0(g);if(!(!g.audio&&!g.video)){if(y!==s&&h.push(`codec count "${y}" !== "${s}"`),!this.sourceUpdater_.canChangeType()){const T=g.video&&ln(g.video)[0]||null,v=g.audio&&ln(g.audio)[0]||null;T&&a&&T.type.toLowerCase()!==a.type.toLowerCase()&&h.push(`video codec "${T.type}" !== "${a.type}"`),v&&o&&v.type.toLowerCase()!==o.type.toLowerCase()&&h.push(`audio codec "${v.type}" !== "${o.type}"`)}h.length&&(c.excludeUntil=1/0,this.logger_(`excluding ${c.id}: ${h.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),$P(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=xt.GOAL_BUFFER_LENGTH,n=xt.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,xt.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=xt.BUFFER_LOW_WATER_LINE,n=xt.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,xt.MAX_BUFFER_LOW_WATER_LINE),s=Math.max(t,xt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?s:r)}bufferHighWaterLine(){return xt.BUFFER_HIGH_WATER_LINE}}const lR=(i,e,t)=>n=>{const r=i.main.playlists[e],s=Lp(r),a=Pc(r);return typeof n>"u"?a:(n?delete r.disabled:r.disabled=!0,n!==a&&!s&&(t(),n?i.trigger("renditionenabled"):i.trigger("renditiondisabled")),n)};class cR{constructor(e,t,n){const{playlistController_:r}=e,s=r.fastQualityChange_.bind(r);if(t.attributes){const a=t.attributes.RESOLUTION;this.width=a&&a.width,this.height=a&&a.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=_o(r.main(),t),this.playlist=t,this.id=n,this.enabled=lR(e.playlists,t.id,s)}}const hR=function(i){i.representations=()=>{const e=i.playlistController_.main(),t=nu(e)?i.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(n=>!Lp(n)).map((n,r)=>new cR(i,n,n.id)):[]}},s_=["seeking","seeked","pause","playing","error"];class dR{constructor(e){this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=en("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),s=()=>this.resetTimeUpdate_(),a=this.playlistController_,o=["main","subtitle","audio"],u={};o.forEach(h=>{u[h]={reset:()=>this.resetSegmentDownloads_(h),updateend:()=>this.checkSegmentDownloads_(h)},a[`${h}SegmentLoader_`].on("appendsdone",u[h].updateend),a[`${h}SegmentLoader_`].on("playlistupdate",u[h].reset),this.tech_.on(["seeked","seeking"],u[h].reset)});const c=h=>{["main","audio"].forEach(g=>{a[`${g}SegmentLoader_`][h]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),c("off"))},this.clearSeekingAppendCheck_=()=>c("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),c("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(s_,s),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(s_,s),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach(h=>{a[`${h}SegmentLoader_`].off("appendsdone",u[h].updateend),a[`${h}SegmentLoader_`].off("playlistupdate",u[h].reset),this.tech_.off(["seeked","seeking"],u[h].reset)}),this.checkCurrentTimeTimeout_&&I.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&I.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=I.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],r=n.buffered_(),s=ak(this[`${e}Buffered_`],r);if(this[`${e}Buffered_`]=r,s){this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:Or(r)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+pn>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),n=this.tech_.currentTime(),r=this.afterSeekableWindow_(t,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let s;if(r&&(s=t.end(t.length-1)),this.beforeSeekableWindow_(t,n)){const v=t.start(0);s=v+(v===t.end(0)?0:pn)}if(typeof s<"u")return this.logger_(`Trying to seek outside of seekable at time ${n} with seekable range ${QT(t)}. Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0;const a=this.playlistController_.sourceUpdater_,o=this.tech_.buffered(),u=a.audioBuffer?a.audioBuffered():null,c=a.videoBuffer?a.videoBuffered():null,h=this.media(),g=h.partTargetDuration?h.partTargetDuration:(h.targetDuration-hr)*2,y=[u,c];for(let v=0;v<y.length;v++){if(!y[v])continue;if(Rp(y[v],n)<g)return!1}const T=qu(o,n);return T.length===0?!1:(s=T.start(0)+pn,this.logger_(`Buffered region starts (${T.start(0)})  just beyond seek point (${n}). Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=ws(t,e);if(n.length&&e+3<=n.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const o=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${o}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(o),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=qu(r,t);return a.length>0?(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,n,r=!1){if(!e.length)return!1;let s=e.end(e.length-1)+pn;return!n.endList&&r&&(s=e.end(e.length-1)+n.targetDuration*3),t>s}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let r;if(e.length&&t.length){const s=ws(e,n-3),a=ws(e,n),o=ws(t,n);o.length&&!a.length&&s.length&&(r={start:s.end(0),end:o.end(0)})}else qu(e,n).length||(r=this.gapFromVideoUnderflow_(e,n));return r?(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${n}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),r=qu(t,n);this.resetTimeUpdate_(),!(r.length===0||n!==e)&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+hr),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}))}gapFromVideoUnderflow_(e,t){const n=nk(e);for(let r=0;r<n.length;r++){const s=n.start(r),a=n.end(r);if(t-s<4&&t-s>2)return{start:s,end:a}}return null}}const fR={errorInterval:30,getSource(i){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return i(t)}},Mb=function(i,e){let t=0,n=0;const r=We(fR,e);i.ready(()=>{i.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){n&&i.currentTime(n)},a=function(h){h!=null&&(n=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",s),i.src(h),i.trigger({type:"usage",name:"vhs-error-reload"}),i.play())},o=function(){if(Date.now()-t<r.errorInterval*1e3){i.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!r.getSource||typeof r.getSource!="function"){F.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),r.getSource.call(i,a)},u=function(){i.off("loadedmetadata",s),i.off("error",o),i.off("dispose",u)},c=function(h){u(),Mb(i,h)};i.on("error",o),i.on("dispose",u),i.reloadSourceOnError=c},pR=function(i){Mb(this,i)};var Fb="3.0.2",mR="6.3.0",gR="1.0.1",_R="6.0.0",yR="4.0.1";const ui={PlaylistLoader:As,Playlist:vi,utils:kk,STANDARD_PLAYLIST_SELECTOR:X0,INITIAL_PLAYLIST_SELECTOR:yP,lastBandwidthSelector:X0,movingAverageBandwidthSelector:gP,comparePlaylistBandwidth:Bp,comparePlaylistResolution:mP,xhr:db()};Object.keys(xt).forEach(i=>{Object.defineProperty(ui,i,{get(){return F.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),xt[i]},set(e){if(F.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){F.log.warn(`value of Vhs.${i} must be greater than or equal to 0`);return}xt[i]=e}})});const Bb="videojs-vhs",Ub=function(i,e){const t=e.media();let n=-1;for(let r=0;r<i.length;r++)if(i[r].id===t.id){n=r;break}i.selectedIndex_=n,i.trigger({selectedIndex:n,type:"change"})},vR=function(i,e){e.representations().forEach(t=>{i.addQualityLevel(t)}),Ub(i,e.playlists)};ui.canPlaySource=function(){return F.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const TR=(i,e,t)=>{if(!i)return i;let n={};e&&e.attributes&&e.attributes.CODECS&&(n=Hl(ln(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(n.audio=t.attributes.CODECS);const r=wo(n.video),s=wo(n.audio),a={};for(const o in i)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),e.contentProtection&&e.contentProtection[o]&&e.contentProtection[o].pssh&&(a[o].pssh=e.contentProtection[o].pssh),typeof i[o]=="string"&&(a[o].url=i[o]);return We(i,a)},bR=(i,e)=>i.reduce((t,n)=>{if(!n.contentProtection)return t;const r=e.reduce((s,a)=>{const o=n.contentProtection[a];return o&&o.pssh&&(s[a]={pssh:o.pssh}),s},{});return Object.keys(r).length&&t.push(r),t},[]),ER=({player:i,sourceKeySystems:e,audioMedia:t,mainPlaylists:n})=>{if(!i.eme.initializeMediaKeys)return Promise.resolve();const r=t?n.concat([t]):n,s=bR(r,Object.keys(e)),a=[],o=[];return s.forEach(u=>{o.push(new Promise((c,h)=>{i.tech_.one("keysessioncreated",c)})),a.push(new Promise((c,h)=>{i.eme.initializeMediaKeys({keySystems:u},g=>{if(g){h(g);return}c()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},SR=({player:i,sourceKeySystems:e,media:t,audioMedia:n})=>{const r=TR(e,t,n);return r?(i.currentSource().keySystems=r,r&&!i.eme?(F.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},Vb=()=>{if(!I.localStorage)return null;const i=I.localStorage.getItem(Bb);if(!i)return null;try{return JSON.parse(i)}catch{return null}},xR=i=>{if(!I.localStorage)return!1;let e=Vb();e=e?We(e,i):i;try{I.localStorage.setItem(Bb,JSON.stringify(e))}catch{return!1}return e},CR=i=>i.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(i.substring(i.indexOf(",")+1)):i;ui.supportsNativeHls=function(){if(!K||!K.createElement)return!1;const i=K.createElement("video");return F.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(i.canPlayType(t))}):!1}();ui.supportsNativeDash=function(){return!K||!K.createElement||!F.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(K.createElement("video").canPlayType("application/dash+xml"))}();ui.supportsTypeNatively=i=>i==="hls"?ui.supportsNativeHls:i==="dash"?ui.supportsNativeDash:!1;ui.isSupported=function(){return F.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const wR=F.getComponent("Component");class jb extends wR{constructor(e,t,n){if(super(t,n.vhs),typeof n.initialBandwidth=="number"&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=en("VhsHandler"),t.options_&&t.options_.playerId){const r=F.getPlayer(t.options_.playerId);this.player_=r}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(K,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],r=>{const s=K.fullscreenElement||K.webkitFullscreenElement||K.mozFullScreenElement||K.msFullscreenElement;s&&s.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(){if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=5*60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const e=Vb();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=xt.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===xt.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(e=>{typeof this.source_[e]<"u"&&(this.options_[e]=this.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=CR(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=ui,this.options_.sourceType=Ky(t),this.options_.seekTo=s=>{this.tech_.setCurrentTime(s)},this.playlistController_=new uR(this.options_);const n=We({liveRangeSafeTimeDelta:pn},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new dR(n),this.playlistController_.on("error",()=>{const s=F.players[this.tech_.options_.playerId];let a=this.playlistController_.error;typeof a=="object"&&!a.code?a.code=3:typeof a=="string"&&(a={message:a,code:3}),s.error(a)});const r=this.options_.bufferBasedABR?ui.movingAverageBandwidthSelector(.55):ui.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=ui.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(s){this.playlistController_.selectPlaylist=s.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(s){this.playlistController_.mainSegmentLoader_.throughput.rate=s,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let s=this.playlistController_.mainSegmentLoader_.bandwidth;const a=I.navigator.connection||I.navigator.mozConnection||I.navigator.webkitConnection,o=1e7;if(this.options_.useNetworkInformationApi&&a){const u=a.downlink*1e3*1e3;u>=o&&s>=o?s=Math.max(s,u):s=u}return s},set(s){this.playlistController_.mainSegmentLoader_.bandwidth=s,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const s=1/(this.bandwidth||1);let a;return this.throughput>0?a=1/this.throughput:a=0,Math.floor(1/(s+a))},set(){F.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>Or(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>Or(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&xR({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{hR(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=I.URL.createObjectURL(this.playlistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),ER({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=SR({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",n=>{if(n.status!=="output-restricted")return;const r=this.playlistController_.main();if(!r||!r.playlists)return;const s=[];r.playlists.forEach(a=>{a&&a.attributes&&a.attributes.RESOLUTION&&a.attributes.RESOLUTION.height>=720&&(!a.excludeUntil||a.excludeUntil<1/0)&&(a.excludeUntil=1/0,s.push(a))}),s.length&&(F.log.warn('DRM keystatus changed to "output-restricted." Removing the following HD playlists that will most likely fail to play and clearing the buffer. This may be due to HDCP restrictions on the stream and the capabilities of the current device.',...s),this.playlistController_.fastQualityChange_())}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),F.browser.IE_VERSION===11||!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=F.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{vR(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{Ub(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":Fb,"mux.js":mR,"mpd-parser":gR,"m3u8-parser":_R,"aes-decrypter":yR}}version(){return this.constructor.version()}canChangeType(){return Lb.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&I.URL.revokeObjectURL&&(I.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return Fk({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,r=2){return _b({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}}const Kl={name:"videojs-http-streaming",VERSION:Fb,canHandleSource(i,e={}){const t=We(F.options,e);return Kl.canPlayType(i.type,t)},handleSource(i,e,t={}){const n=We(F.options,t);return e.vhs=new jb(i,e,n),e.vhs.xhr=db(),e.vhs.src(i.src,i.type),e.vhs},canPlayType(i,e){const t=Ky(i);if(!t)return"";const n=Kl.getOverrideNative(e);return!ui.supportsTypeNatively(t)||n?"maybe":""},getOverrideNative(i={}){const{vhs:e={}}=i,t=!(F.browser.IS_ANY_SAFARI||F.browser.IS_IOS),{overrideNative:n=t}=e;return n}},AR=()=>al("avc1.4d400d,mp4a.40.2");AR()&&F.getTech("Html5").registerSourceHandler(Kl,0);F.VhsHandler=jb;F.VhsSourceHandler=Kl;F.Vhs=ui;F.use||F.registerComponent("Vhs",ui);F.options.vhs=F.options.vhs||{};(!F.getPlugin||!F.getPlugin("reloadSourceOnError"))&&F.registerPlugin("reloadSourceOnError",pR);function a_(i,e,t){const n=i.slice();return n[20]=e[t],n[22]=t,n}function o_(i){let e,t,n;return{c(){e=Fe("div"),we(e,"style",t="flex : "+i[20]),we(e,"class",n="h-full "+(i[22]%2==(i[1]?0:1)?"bg-green-500":"bg-gray-300"))},m(r,s){Dt(r,e,s)},p(r,s){s&1&&t!==(t="flex : "+r[20])&&we(e,"style",t),s&2&&n!==(n="h-full "+(r[22]%2==(r[1]?0:1)?"bg-green-500":"bg-gray-300"))&&we(e,"class",n)},d(r){r&&Tt(e)}}}function DR(i){let e,t,n=i[6].toLocaleTimeString()+"",r,s,a,o,u,c,h=i[0],g=[];for(let y=0;y<h.length;y+=1)g[y]=o_(a_(i,h,y));return{c(){e=Fe("div"),t=Fe("div"),r=qr(n),s=pi(),a=Fe("div"),o=pi();for(let y=0;y<g.length;y+=1)g[y].c();we(t,"class","h-full w-100 bg-gray-500 text-white rounded-md p-1 absolute pointer-events-none"),we(t,"id","cursor"),tr(t,"left",i[4].x+"px"),tr(t,"top",i[4].y+"px"),tr(t,"visibility",i[7]),we(a,"class","h-full w-1 absolute bg-blue-500"),tr(a,"left",i[5]+"px"),we(e,"class","flex h-full relative flex-1"),we(e,"id","container")},m(y,T){Dt(y,e,T),De(e,t),De(t,r),i[15](t),De(e,s),De(e,a),De(e,o);for(let v=0;v<g.length;v+=1)g[v]&&g[v].m(e,null);i[16](e),u||(c=[Xi(e,"mousemove",i[8]),Xi(e,"click",i[9]),Xi(e,"mouseenter",i[17]),Xi(e,"mouseleave",i[18]),Xi(e,"keydown",IR)],u=!0)},p(y,[T]){if(T&64&&n!==(n=y[6].toLocaleTimeString()+"")&&_d(r,n),T&16&&tr(t,"left",y[4].x+"px"),T&16&&tr(t,"top",y[4].y+"px"),T&128&&tr(t,"visibility",y[7]),T&32&&tr(a,"left",y[5]+"px"),T&3){h=y[0];let v;for(v=0;v<h.length;v+=1){const x=a_(y,h,v);g[v]?g[v].p(x,T):(g[v]=o_(x),g[v].c(),g[v].m(e,null))}for(;v<g.length;v+=1)g[v].d(1);g.length=h.length}},i:et,o:et,d(y){y&&Tt(e),i[15](null),Ty(g,y),i[16](null),u=!1,Yr(c)}}}const IR=()=>{};function kR(i,e,t){let{sessions:n}=e,{intervals:r}=e,{flag:s}=e,{now:a}=e,{t0:o}=e,{t1:u}=e,{setDate:c}=e,h,g,y={x:0,y:0},T=0,v=new Date,x="hidden";function A(V){const ie=h.getBoundingClientRect(),Z=ie.right-ie.left,he=ie.bottom-ie.top,_e=V.clientX-ie.left;D(_e,he);const me=u.getTime()-o.getTime(),X=_e/Z;t(6,v=new Date(o.getTime()+X*me))}function D(V,ie){const Z=g.getBoundingClientRect(),he=Z.right-Z.left;t(4,y={x:V-he/2,y:-ie})}function P(){c(v)}function M(V){Bt[V?"unshift":"push"](()=>{g=V,t(3,g)})}function O(V){Bt[V?"unshift":"push"](()=>{h=V,t(2,h)})}const R=()=>t(7,x="visible"),$=()=>t(7,x="hidden");return i.$$set=V=>{"sessions"in V&&t(10,n=V.sessions),"intervals"in V&&t(0,r=V.intervals),"flag"in V&&t(1,s=V.flag),"now"in V&&t(11,a=V.now),"t0"in V&&t(12,o=V.t0),"t1"in V&&t(13,u=V.t1),"setDate"in V&&t(14,c=V.setDate)},i.$$.update=()=>{if(i.$$.dirty&14340&&a!=null&&h!=null){const V=h.getBoundingClientRect(),ie=V.right-V.left,Z=u.getTime()-o.getTime(),he=(a.getTime()-o.getTime())/Z;t(5,T=he*ie)}},[r,s,h,g,y,T,v,x,A,P,n,a,o,u,c,M,O,R,$]}class PR extends Kn{constructor(e){super(),Wn(this,e,kR,DR,zn,{sessions:10,intervals:0,flag:1,now:11,t0:12,t1:13,setDate:14})}}class RR{constructor(e,t,n){cs(this,"id");cs(this,"time");cs(this,"segments");this.id=e,this.time=t,this.segments=n}get end(){return new Date(this.time.getTime()+this.duration*1e3)}get duration(){return this.segments.map(e=>e.duration).reduce((e,t)=>e+t,0)}}var OR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Y,Up=Up||{},pe=OR||self;function Rc(i){var e=typeof i;return e=e!="object"?e:i?Array.isArray(i)?"array":e:"null",e=="array"||e=="object"&&typeof i.length=="number"}function ru(i){var e=typeof i;return e=="object"&&i!=null||e=="function"}function LR(i){return Object.prototype.hasOwnProperty.call(i,Zh)&&i[Zh]||(i[Zh]=++NR)}var Zh="closure_uid_"+(1e9*Math.random()>>>0),NR=0;function MR(i,e,t){return i.call.apply(i.bind,arguments)}function FR(i,e,t){if(!i)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),i.apply(e,r)}}return function(){return i.apply(e,arguments)}}function Gt(i,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Gt=MR:Gt=FR,Gt.apply(null,arguments)}function zu(i,e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=t.slice();return n.push.apply(n,arguments),i.apply(this,n)}}function It(i,e){function t(){}t.prototype=e.prototype,i.$=e.prototype,i.prototype=new t,i.prototype.constructor=i,i.ac=function(n,r,s){for(var a=Array(arguments.length-2),o=2;o<arguments.length;o++)a[o-2]=arguments[o];return e.prototype[r].apply(n,a)}}function yr(){this.s=this.s,this.o=this.o}var BR=0;yr.prototype.s=!1;yr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),BR!=0)&&LR(this)};yr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const $b=Array.prototype.indexOf?function(i,e){return Array.prototype.indexOf.call(i,e,void 0)}:function(i,e){if(typeof i=="string")return typeof e!="string"||e.length!=1?-1:i.indexOf(e,0);for(let t=0;t<i.length;t++)if(t in i&&i[t]===e)return t;return-1};function Vp(i){const e=i.length;if(0<e){const t=Array(e);for(let n=0;n<e;n++)t[n]=i[n];return t}return[]}function u_(i,e){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Rc(n)){const r=i.length||0,s=n.length||0;i.length=r+s;for(let a=0;a<s;a++)i[r+a]=n[a]}else i.push(n)}}function zt(i,e){this.type=i,this.g=this.target=e,this.defaultPrevented=!1}zt.prototype.h=function(){this.defaultPrevented=!0};var UR=function(){if(!pe.addEventListener||!Object.defineProperty)return!1;var i=!1,e=Object.defineProperty({},"passive",{get:function(){i=!0}});try{pe.addEventListener("test",()=>{},e),pe.removeEventListener("test",()=>{},e)}catch{}return i}();function Lo(i){return/^[\s\xa0]*$/.test(i)}function Oc(){var i=pe.navigator;return i&&(i=i.userAgent)?i:""}function hn(i){return Oc().indexOf(i)!=-1}function jp(i){return jp[" "](i),i}jp[" "]=function(){};function VR(i,e){var t=RO;return Object.prototype.hasOwnProperty.call(t,i)?t[i]:t[i]=e(i)}var jR=hn("Opera"),ra=hn("Trident")||hn("MSIE"),qb=hn("Edge"),ef=qb||ra,Hb=hn("Gecko")&&!(Oc().toLowerCase().indexOf("webkit")!=-1&&!hn("Edge"))&&!(hn("Trident")||hn("MSIE"))&&!hn("Edge"),$R=Oc().toLowerCase().indexOf("webkit")!=-1&&!hn("Edge");function Gb(){var i=pe.document;return i?i.documentMode:void 0}var tf;e:{var ed="",td=function(){var i=Oc();if(Hb)return/rv:([^\);]+)(\)|;)/.exec(i);if(qb)return/Edge\/([\d\.]+)/.exec(i);if(ra)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(i);if($R)return/WebKit\/(\S+)/.exec(i);if(jR)return/(?:Version)[ \/]?(\S+)/.exec(i)}();if(td&&(ed=td?td[1]:""),ra){var id=Gb();if(id!=null&&id>parseFloat(ed)){tf=String(id);break e}}tf=ed}var nf;if(pe.document&&ra){var l_=Gb();nf=l_||parseInt(tf,10)||void 0}else nf=void 0;var qR=nf;function No(i,e){if(zt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var t=this.type=i.type,n=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=e,e=i.relatedTarget){if(Hb){e:{try{jp(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else t=="mouseover"?e=i.fromElement:t=="mouseout"&&(e=i.toElement);this.relatedTarget=e,n?(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:HR[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&No.$.h.call(this)}}It(No,zt);var HR={2:"touch",3:"pen",4:"mouse"};No.prototype.h=function(){No.$.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var su="closure_listenable_"+(1e6*Math.random()|0),GR=0;function zR(i,e,t,n,r){this.listener=i,this.proxy=null,this.src=e,this.type=t,this.capture=!!n,this.la=r,this.key=++GR,this.fa=this.ia=!1}function Lc(i){i.fa=!0,i.listener=null,i.proxy=null,i.src=null,i.la=null}function $p(i,e,t){for(const n in i)e.call(t,i[n],n,i)}function WR(i,e){for(const t in i)e.call(void 0,i[t],t,i)}function zb(i){const e={};for(const t in i)e[t]=i[t];return e}const c_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wb(i,e){let t,n;for(let r=1;r<arguments.length;r++){n=arguments[r];for(t in n)i[t]=n[t];for(let s=0;s<c_.length;s++)t=c_[s],Object.prototype.hasOwnProperty.call(n,t)&&(i[t]=n[t])}}function Nc(i){this.src=i,this.g={},this.h=0}Nc.prototype.add=function(i,e,t,n,r){var s=i.toString();i=this.g[s],i||(i=this.g[s]=[],this.h++);var a=sf(i,e,n,r);return-1<a?(e=i[a],t||(e.ia=!1)):(e=new zR(e,this.src,s,!!n,r),e.ia=t,i.push(e)),e};function rf(i,e){var t=e.type;if(t in i.g){var n=i.g[t],r=$b(n,e),s;(s=0<=r)&&Array.prototype.splice.call(n,r,1),s&&(Lc(e),i.g[t].length==0&&(delete i.g[t],i.h--))}}function sf(i,e,t,n){for(var r=0;r<i.length;++r){var s=i[r];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==n)return r}return-1}var qp="closure_lm_"+(1e6*Math.random()|0),nd={};function Kb(i,e,t,n,r){if(n&&n.once)return Yb(i,e,t,n,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Kb(i,e[s],t,n,r);return null}return t=zp(t),i&&i[su]?i.O(e,t,ru(n)?!!n.capture:!!n,r):Xb(i,e,t,!1,n,r)}function Xb(i,e,t,n,r,s){if(!e)throw Error("Invalid event type");var a=ru(r)?!!r.capture:!!r,o=Gp(i);if(o||(i[qp]=o=new Nc(i)),t=o.add(e,t,n,a,s),t.proxy)return t;if(n=KR(),t.proxy=n,n.src=i,n.listener=t,i.addEventListener)UR||(r=a),r===void 0&&(r=!1),i.addEventListener(e.toString(),n,r);else if(i.attachEvent)i.attachEvent(Jb(e.toString()),n);else if(i.addListener&&i.removeListener)i.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return t}function KR(){function i(t){return e.call(i.src,i.listener,t)}const e=XR;return i}function Yb(i,e,t,n,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Yb(i,e[s],t,n,r);return null}return t=zp(t),i&&i[su]?i.P(e,t,ru(n)?!!n.capture:!!n,r):Xb(i,e,t,!0,n,r)}function Qb(i,e,t,n,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)Qb(i,e[s],t,n,r);else n=ru(n)?!!n.capture:!!n,t=zp(t),i&&i[su]?(i=i.i,e=String(e).toString(),e in i.g&&(s=i.g[e],t=sf(s,t,n,r),-1<t&&(Lc(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete i.g[e],i.h--)))):i&&(i=Gp(i))&&(e=i.g[e.toString()],i=-1,e&&(i=sf(e,t,n,r)),(t=-1<i?e[i]:null)&&Hp(t))}function Hp(i){if(typeof i!="number"&&i&&!i.fa){var e=i.src;if(e&&e[su])rf(e.i,i);else{var t=i.type,n=i.proxy;e.removeEventListener?e.removeEventListener(t,n,i.capture):e.detachEvent?e.detachEvent(Jb(t),n):e.addListener&&e.removeListener&&e.removeListener(n),(t=Gp(e))?(rf(t,i),t.h==0&&(t.src=null,e[qp]=null)):Lc(i)}}}function Jb(i){return i in nd?nd[i]:nd[i]="on"+i}function XR(i,e){if(i.fa)i=!0;else{e=new No(e,this);var t=i.listener,n=i.la||i.src;i.ia&&Hp(i),i=t.call(n,e)}return i}function Gp(i){return i=i[qp],i instanceof Nc?i:null}var rd="__closure_events_fn_"+(1e9*Math.random()>>>0);function zp(i){return typeof i=="function"?i:(i[rd]||(i[rd]=function(e){return i.handleEvent(e)}),i[rd])}function At(){yr.call(this),this.i=new Nc(this),this.S=this,this.J=null}It(At,yr);At.prototype[su]=!0;At.prototype.removeEventListener=function(i,e,t,n){Qb(this,i,e,t,n)};function Lt(i,e){var t,n=i.J;if(n)for(t=[];n;n=n.J)t.push(n);if(i=i.S,n=e.type||e,typeof e=="string")e=new zt(e,i);else if(e instanceof zt)e.target=e.target||i;else{var r=e;e=new zt(n,i),Wb(e,r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];r=Wu(a,n,!0,e)&&r}if(a=e.g=i,r=Wu(a,n,!0,e)&&r,r=Wu(a,n,!1,e)&&r,t)for(s=0;s<t.length;s++)a=e.g=t[s],r=Wu(a,n,!1,e)&&r}At.prototype.N=function(){if(At.$.N.call(this),this.i){var i=this.i,e;for(e in i.g){for(var t=i.g[e],n=0;n<t.length;n++)Lc(t[n]);delete i.g[e],i.h--}}this.J=null};At.prototype.O=function(i,e,t,n){return this.i.add(String(i),e,!1,t,n)};At.prototype.P=function(i,e,t,n){return this.i.add(String(i),e,!0,t,n)};function Wu(i,e,t,n){if(e=i.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var o=a.listener,u=a.la||a.src;a.ia&&rf(i.i,a),r=o.call(u,n)!==!1&&r}}return r&&!n.defaultPrevented}var Wp=pe.JSON.stringify;class YR{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function QR(){var i=Kp;let e=null;return i.g&&(e=i.g,i.g=i.g.next,i.g||(i.h=null),e.next=null),e}class JR{constructor(){this.h=this.g=null}add(e,t){const n=Zb.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var Zb=new YR(()=>new ZR,i=>i.reset());class ZR{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function eO(i){var e=1;i=i.split(":");const t=[];for(;0<e&&i.length;)t.push(i.shift()),e--;return i.length&&t.push(i.join(":")),t}function tO(i){pe.setTimeout(()=>{throw i},0)}let Mo,Fo=!1,Kp=new JR,eE=()=>{const i=pe.Promise.resolve(void 0);Mo=()=>{i.then(iO)}};var iO=()=>{for(var i;i=QR();){try{i.h.call(i.g)}catch(t){tO(t)}var e=Zb;e.j(i),100>e.h&&(e.h++,i.next=e.g,e.g=i)}Fo=!1};function Mc(i,e){At.call(this),this.h=i||1,this.g=e||pe,this.j=Gt(this.qb,this),this.l=Date.now()}It(Mc,At);Y=Mc.prototype;Y.ga=!1;Y.T=null;Y.qb=function(){if(this.ga){var i=Date.now()-this.l;0<i&&i<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-i):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Lt(this,"tick"),this.ga&&(Xp(this),this.start()))}};Y.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Xp(i){i.ga=!1,i.T&&(i.g.clearTimeout(i.T),i.T=null)}Y.N=function(){Mc.$.N.call(this),Xp(this),delete this.g};function Yp(i,e,t){if(typeof i=="function")t&&(i=Gt(i,t));else if(i&&typeof i.handleEvent=="function")i=Gt(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:pe.setTimeout(i,e||0)}function tE(i){i.g=Yp(()=>{i.g=null,i.i&&(i.i=!1,tE(i))},i.j);const e=i.h;i.h=null,i.m.apply(null,e)}class nO extends yr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:tE(this)}N(){super.N(),this.g&&(pe.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bo(i){yr.call(this),this.h=i,this.g={}}It(Bo,yr);var h_=[];function iE(i,e,t,n){Array.isArray(t)||(t&&(h_[0]=t.toString()),t=h_);for(var r=0;r<t.length;r++){var s=Kb(e,t[r],n||i.handleEvent,!1,i.h||i);if(!s)break;i.g[s.key]=s}}function nE(i){$p(i.g,function(e,t){this.g.hasOwnProperty(t)&&Hp(e)},i),i.g={}}Bo.prototype.N=function(){Bo.$.N.call(this),nE(this)};Bo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Fc(){this.g=!0}Fc.prototype.Ea=function(){this.g=!1};function rO(i,e,t,n,r,s){i.info(function(){if(i.g)if(s)for(var a="",o=s.split("&"),u=0;u<o.length;u++){var c=o[u].split("=");if(1<c.length){var h=c[0];c=c[1];var g=h.split("_");a=2<=g.length&&g[1]=="type"?a+(h+"="+c+"&"):a+(h+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+e+`
`+t+`
`+a})}function sO(i,e,t,n,r,s,a){i.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+e+`
`+t+`
`+s+" "+a})}function Ds(i,e,t,n){i.info(function(){return"XMLHTTP TEXT ("+e+"): "+oO(i,t)+(n?" "+n:"")})}function aO(i,e){i.info(function(){return"TIMEOUT: "+e})}Fc.prototype.info=function(){};function oO(i,e){if(!i.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(i=0;i<t.length;i++)if(Array.isArray(t[i])){var n=t[i];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var a=1;a<r.length;a++)r[a]=""}}}}return Wp(t)}catch{return e}}var Jr={},d_=null;function Bc(){return d_=d_||new At}Jr.Ta="serverreachability";function rE(i){zt.call(this,Jr.Ta,i)}It(rE,zt);function Uo(i){const e=Bc();Lt(e,new rE(e))}Jr.STAT_EVENT="statevent";function sE(i,e){zt.call(this,Jr.STAT_EVENT,i),this.stat=e}It(sE,zt);function li(i){const e=Bc();Lt(e,new sE(e,i))}Jr.Ua="timingevent";function aE(i,e){zt.call(this,Jr.Ua,i),this.size=e}It(aE,zt);function au(i,e){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return pe.setTimeout(function(){i()},e)}var Uc={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},oE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Qp(){}Qp.prototype.h=null;function f_(i){return i.h||(i.h=i.i())}function uE(){}var ou={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Jp(){zt.call(this,"d")}It(Jp,zt);function Zp(){zt.call(this,"c")}It(Zp,zt);var af;function Vc(){}It(Vc,Qp);Vc.prototype.g=function(){return new XMLHttpRequest};Vc.prototype.i=function(){return{}};af=new Vc;function uu(i,e,t,n){this.l=i,this.j=e,this.m=t,this.W=n||1,this.U=new Bo(this),this.P=uO,i=ef?125:void 0,this.V=new Mc(i),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new lE}function lE(){this.i=null,this.g="",this.h=!1}var uO=45e3,of={},Xl={};Y=uu.prototype;Y.setTimeout=function(i){this.P=i};function uf(i,e,t){i.L=1,i.v=$c(qn(e)),i.s=t,i.S=!0,cE(i,null)}function cE(i,e){i.G=Date.now(),lu(i),i.A=qn(i.v);var t=i.A,n=i.W;Array.isArray(n)||(n=[String(n)]),yE(t.i,"t",n),i.C=0,t=i.l.J,i.h=new lE,i.g=UE(i.l,t?e:null,!i.s),0<i.O&&(i.M=new nO(Gt(i.Pa,i,i.g),i.O)),iE(i.U,i.g,"readystatechange",i.nb),e=i.I?zb(i.I):{},i.s?(i.u||(i.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",i.g.ha(i.A,i.u,i.s,e)):(i.u="GET",i.g.ha(i.A,i.u,null,e)),Uo(),rO(i.j,i.u,i.A,i.m,i.W,i.s)}Y.nb=function(i){i=i.target;const e=this.M;e&&gn(i)==3?e.l():this.Pa(i)};Y.Pa=function(i){try{if(i==this.g)e:{const h=gn(this.g);var e=this.g.Ia();const g=this.g.da();if(!(3>h)&&(h!=3||ef||this.g&&(this.h.h||this.g.ja()||__(this.g)))){this.J||h!=4||e==7||(e==8||0>=g?Uo(3):Uo(2)),jc(this);var t=this.g.da();this.ca=t;t:if(hE(this)){var n=__(this.g);i="";var r=n.length,s=gn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Lr(this),yo(this);var a="";break t}this.h.i=new pe.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,i+=this.h.i.decode(n[e],{stream:s&&e==r-1});n.splice(0,r),this.h.g+=i,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=t==200,sO(this.j,this.u,this.A,this.m,this.W,h,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,u=this.g;if((o=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Lo(o)){var c=o;break t}}c=null}if(t=c)Ds(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,lf(this,t);else{this.i=!1,this.o=3,li(12),Lr(this),yo(this);break e}}this.S?(dE(this,h,a),ef&&this.i&&h==3&&(iE(this.U,this.V,"tick",this.mb),this.V.start())):(Ds(this.j,this.m,a,null),lf(this,a)),h==4&&Lr(this),this.i&&!this.J&&(h==4?NE(this.l,this):(this.i=!1,lu(this)))}else IO(this.g),t==400&&0<a.indexOf("Unknown SID")?(this.o=3,li(12)):(this.o=0,li(13)),Lr(this),yo(this)}}}catch{}finally{}};function hE(i){return i.g?i.u=="GET"&&i.L!=2&&i.l.Ha:!1}function dE(i,e,t){let n=!0,r;for(;!i.J&&i.C<t.length;)if(r=lO(i,t),r==Xl){e==4&&(i.o=4,li(14),n=!1),Ds(i.j,i.m,null,"[Incomplete Response]");break}else if(r==of){i.o=4,li(15),Ds(i.j,i.m,t,"[Invalid Chunk]"),n=!1;break}else Ds(i.j,i.m,r,null),lf(i,r);hE(i)&&r!=Xl&&r!=of&&(i.h.g="",i.C=0),e!=4||t.length!=0||i.h.h||(i.o=1,li(16),n=!1),i.i=i.i&&n,n?0<t.length&&!i.ba&&(i.ba=!0,e=i.l,e.g==i&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),sm(e),e.M=!0,li(11))):(Ds(i.j,i.m,t,"[Invalid Chunked Response]"),Lr(i),yo(i))}Y.mb=function(){if(this.g){var i=gn(this.g),e=this.g.ja();this.C<e.length&&(jc(this),dE(this,i,e),this.i&&i!=4&&lu(this))}};function lO(i,e){var t=i.C,n=e.indexOf(`
`,t);return n==-1?Xl:(t=Number(e.substring(t,n)),isNaN(t)?of:(n+=1,n+t>e.length?Xl:(e=e.slice(n,n+t),i.C=n+t,e)))}Y.cancel=function(){this.J=!0,Lr(this)};function lu(i){i.Y=Date.now()+i.P,fE(i,i.P)}function fE(i,e){if(i.B!=null)throw Error("WatchDog timer not null");i.B=au(Gt(i.lb,i),e)}function jc(i){i.B&&(pe.clearTimeout(i.B),i.B=null)}Y.lb=function(){this.B=null;const i=Date.now();0<=i-this.Y?(aO(this.j,this.A),this.L!=2&&(Uo(),li(17)),Lr(this),this.o=2,yo(this)):fE(this,this.Y-i)};function yo(i){i.l.H==0||i.J||NE(i.l,i)}function Lr(i){jc(i);var e=i.M;e&&typeof e.sa=="function"&&e.sa(),i.M=null,Xp(i.V),nE(i.U),i.g&&(e=i.g,i.g=null,e.abort(),e.sa())}function lf(i,e){try{var t=i.l;if(t.H!=0&&(t.g==i||cf(t.i,i))){if(!i.K&&cf(t.i,i)&&t.H==3){try{var n=t.Ja.g.parse(e)}catch{n=null}if(Array.isArray(n)&&n.length==3){var r=n;if(r[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<i.G)Jl(t),Gc(t);else break e;rm(t),li(18)}}else t.Fa=r[1],0<t.Fa-t.V&&37500>r[2]&&t.G&&t.A==0&&!t.v&&(t.v=au(Gt(t.ib,t),6e3));if(1>=bE(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Nr(t,11)}else if((i.K||t.g==i)&&Jl(t),!Lo(e))for(r=t.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];const h=c[3];h!=null&&(t.ra=h,t.l.info("VER="+t.ra));const g=c[4];g!=null&&(t.Ga=g,t.l.info("SVER="+t.Ga));const y=c[5];y!=null&&typeof y=="number"&&0<y&&(n=1.5*y,t.L=n,t.l.info("backChannelRequestTimeoutMs_="+n)),n=t;const T=i.g;if(T){const v=T.g?T.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(v){var s=n.i;s.g||v.indexOf("spdy")==-1&&v.indexOf("quic")==-1&&v.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(em(s,s.h),s.h=null))}if(n.F){const x=T.g?T.g.getResponseHeader("X-HTTP-Session-Id"):null;x&&(n.Da=x,Je(n.I,n.F,x))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-i.G,t.l.info("Handshake RTT: "+t.S+"ms")),n=t;var a=i;if(n.wa=BE(n,n.J?n.pa:null,n.Y),a.K){EE(n.i,a);var o=a,u=n.L;u&&o.setTimeout(u),o.B&&(jc(o),lu(o)),n.g=a}else OE(n);0<t.j.length&&zc(t)}else c[0]!="stop"&&c[0]!="close"||Nr(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Nr(t,7):nm(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Uo(4)}catch{}}function cO(i){if(i.Z&&typeof i.Z=="function")return i.Z();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(Rc(i)){for(var e=[],t=i.length,n=0;n<t;n++)e.push(i[n]);return e}e=[],t=0;for(n in i)e[t++]=i[n];return e}function hO(i){if(i.ta&&typeof i.ta=="function")return i.ta();if(!i.Z||typeof i.Z!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(Rc(i)||typeof i=="string"){var e=[];i=i.length;for(var t=0;t<i;t++)e.push(t);return e}e=[],t=0;for(const n in i)e[t++]=n;return e}}}function pE(i,e){if(i.forEach&&typeof i.forEach=="function")i.forEach(e,void 0);else if(Rc(i)||typeof i=="string")Array.prototype.forEach.call(i,e,void 0);else for(var t=hO(i),n=cO(i),r=n.length,s=0;s<r;s++)e.call(void 0,n[s],t&&t[s],i)}var mE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dO(i,e){if(i){i=i.split("&");for(var t=0;t<i.length;t++){var n=i[t].indexOf("="),r=null;if(0<=n){var s=i[t].substring(0,n);r=i[t].substring(n+1)}else s=i[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Vr(i){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,i instanceof Vr){this.h=i.h,Yl(this,i.j),this.s=i.s,this.g=i.g,Ql(this,i.m),this.l=i.l;var e=i.i,t=new Vo;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),p_(this,t),this.o=i.o}else i&&(e=String(i).match(mE))?(this.h=!1,Yl(this,e[1]||"",!0),this.s=oo(e[2]||""),this.g=oo(e[3]||"",!0),Ql(this,e[4]),this.l=oo(e[5]||"",!0),p_(this,e[6]||"",!0),this.o=oo(e[7]||"")):(this.h=!1,this.i=new Vo(null,this.h))}Vr.prototype.toString=function(){var i=[],e=this.j;e&&i.push(uo(e,m_,!0),":");var t=this.g;return(t||e=="file")&&(i.push("//"),(e=this.s)&&i.push(uo(e,m_,!0),"@"),i.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&i.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&i.push("/"),i.push(uo(t,t.charAt(0)=="/"?mO:pO,!0))),(t=this.i.toString())&&i.push("?",t),(t=this.o)&&i.push("#",uo(t,_O)),i.join("")};function qn(i){return new Vr(i)}function Yl(i,e,t){i.j=t?oo(e,!0):e,i.j&&(i.j=i.j.replace(/:$/,""))}function Ql(i,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);i.m=e}else i.m=null}function p_(i,e,t){e instanceof Vo?(i.i=e,yO(i.i,i.h)):(t||(e=uo(e,gO)),i.i=new Vo(e,i.h))}function Je(i,e,t){i.i.set(e,t)}function $c(i){return Je(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function oo(i,e){return i?e?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function uo(i,e,t){return typeof i=="string"?(i=encodeURI(i).replace(e,fO),t&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function fO(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var m_=/[#\/\?@]/g,pO=/[#\?:]/g,mO=/[#\?]/g,gO=/[#\?@]/g,_O=/#/g;function Vo(i,e){this.h=this.g=null,this.i=i||null,this.j=!!e}function vr(i){i.g||(i.g=new Map,i.h=0,i.i&&dO(i.i,function(e,t){i.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}Y=Vo.prototype;Y.add=function(i,e){vr(this),this.i=null,i=Ea(this,i);var t=this.g.get(i);return t||this.g.set(i,t=[]),t.push(e),this.h+=1,this};function gE(i,e){vr(i),e=Ea(i,e),i.g.has(e)&&(i.i=null,i.h-=i.g.get(e).length,i.g.delete(e))}function _E(i,e){return vr(i),e=Ea(i,e),i.g.has(e)}Y.forEach=function(i,e){vr(this),this.g.forEach(function(t,n){t.forEach(function(r){i.call(e,r,n,this)},this)},this)};Y.ta=function(){vr(this);const i=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let n=0;n<e.length;n++){const r=i[n];for(let s=0;s<r.length;s++)t.push(e[n])}return t};Y.Z=function(i){vr(this);let e=[];if(typeof i=="string")_E(this,i)&&(e=e.concat(this.g.get(Ea(this,i))));else{i=Array.from(this.g.values());for(let t=0;t<i.length;t++)e=e.concat(i[t])}return e};Y.set=function(i,e){return vr(this),this.i=null,i=Ea(this,i),_E(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[e]),this.h+=1,this};Y.get=function(i,e){return i?(i=this.Z(i),0<i.length?String(i[0]):e):e};function yE(i,e,t){gE(i,e),0<t.length&&(i.i=null,i.g.set(Ea(i,e),Vp(t)),i.h+=t.length)}Y.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var n=e[t];const s=encodeURIComponent(String(n)),a=this.Z(n);for(n=0;n<a.length;n++){var r=s;a[n]!==""&&(r+="="+encodeURIComponent(String(a[n]))),i.push(r)}}return this.i=i.join("&")};function Ea(i,e){return e=String(e),i.j&&(e=e.toLowerCase()),e}function yO(i,e){e&&!i.j&&(vr(i),i.i=null,i.g.forEach(function(t,n){var r=n.toLowerCase();n!=r&&(gE(this,n),yE(this,r,t))},i)),i.j=e}var vO=class{constructor(i,e){this.g=i,this.map=e}};function vE(i){this.l=i||TO,pe.PerformanceNavigationTiming?(i=pe.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(pe.g&&pe.g.Ka&&pe.g.Ka()&&pe.g.Ka().ec),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var TO=10;function TE(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function bE(i){return i.h?1:i.g?i.g.size:0}function cf(i,e){return i.h?i.h==e:i.g?i.g.has(e):!1}function em(i,e){i.g?i.g.add(e):i.h=e}function EE(i,e){i.h&&i.h==e?i.h=null:i.g&&i.g.has(e)&&i.g.delete(e)}vE.prototype.cancel=function(){if(this.i=SE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function SE(i){if(i.h!=null)return i.i.concat(i.h.F);if(i.g!=null&&i.g.size!==0){let e=i.i;for(const t of i.g.values())e=e.concat(t.F);return e}return Vp(i.i)}var bO=class{stringify(i){return pe.JSON.stringify(i,void 0)}parse(i){return pe.JSON.parse(i,void 0)}};function EO(){this.g=new bO}function SO(i,e,t){const n=t||"";try{pE(i,function(r,s){let a=r;ru(r)&&(a=Wp(r)),e.push(n+s+"="+encodeURIComponent(a))})}catch(r){throw e.push(n+"type="+encodeURIComponent("_badmap")),r}}function xO(i,e){const t=new Fc;if(pe.Image){const n=new Image;n.onload=zu(Ku,t,n,"TestLoadImage: loaded",!0,e),n.onerror=zu(Ku,t,n,"TestLoadImage: error",!1,e),n.onabort=zu(Ku,t,n,"TestLoadImage: abort",!1,e),n.ontimeout=zu(Ku,t,n,"TestLoadImage: timeout",!1,e),pe.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=i}else e(!1)}function Ku(i,e,t,n,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(n)}catch{}}function cu(i){this.l=i.fc||null,this.j=i.ob||!1}It(cu,Qp);cu.prototype.g=function(){return new qc(this.l,this.j)};cu.prototype.i=function(i){return function(){return i}}({});function qc(i,e){At.call(this),this.F=i,this.u=e,this.m=void 0,this.readyState=tm,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}It(qc,At);var tm=0;Y=qc.prototype;Y.open=function(i,e){if(this.readyState!=tm)throw this.abort(),Error("Error reopening a connection");this.C=i,this.B=e,this.readyState=1,jo(this)};Y.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};i&&(e.body=i),(this.F||pe).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};Y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,hu(this)),this.readyState=tm};Y.$a=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,jo(this)),this.g&&(this.readyState=3,jo(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof pe.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;xE(this)}else i.text().then(this.Za.bind(this),this.ka.bind(this))};function xE(i){i.j.read().then(i.Xa.bind(i)).catch(i.ka.bind(i))}Y.Xa=function(i){if(this.g){if(this.u&&i.value)this.response.push(i.value);else if(!this.u){var e=i.value?i.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!i.done}))&&(this.response=this.responseText+=e)}i.done?hu(this):jo(this),this.readyState==3&&xE(this)}};Y.Za=function(i){this.g&&(this.response=this.responseText=i,hu(this))};Y.Ya=function(i){this.g&&(this.response=i,hu(this))};Y.ka=function(){this.g&&hu(this)};function hu(i){i.readyState=4,i.l=null,i.j=null,i.A=null,jo(i)}Y.setRequestHeader=function(i,e){this.v.append(i,e)};Y.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""};Y.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,i.push(t[0]+": "+t[1]),t=e.next();return i.join(`\r
`)};function jo(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(qc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});var CO=pe.JSON.parse;function at(i){At.call(this),this.headers=new Map,this.u=i||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=CE,this.L=this.M=!1}It(at,At);var CE="",wO=/^https?$/i,AO=["POST","PUT"];Y=at.prototype;Y.Oa=function(i){this.M=i};Y.ha=function(i,e,t,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+i);e=e?e.toUpperCase():"GET",this.I=i,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():af.g(),this.C=this.u?f_(this.u):f_(af),this.g.onreadystatechange=Gt(this.La,this);try{this.G=!0,this.g.open(e,String(i),!0),this.G=!1}catch(s){g_(this,s);return}if(i=t||"",t=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)t.set(r,n[r]);else if(typeof n.keys=="function"&&typeof n.get=="function")for(const s of n.keys())t.set(s,n.get(s));else throw Error("Unknown input type for opt_headers: "+String(n));n=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),r=pe.FormData&&i instanceof pe.FormData,!(0<=$b(AO,e))||n||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{DE(this),0<this.B&&((this.L=DO(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Gt(this.ua,this)):this.A=Yp(this.ua,this.B,this)),this.v=!0,this.g.send(i),this.v=!1}catch(s){g_(this,s)}};function DO(i){return ra&&typeof i.timeout=="number"&&i.ontimeout!==void 0}Y.ua=function(){typeof Up<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Lt(this,"timeout"),this.abort(8))};function g_(i,e){i.h=!1,i.g&&(i.l=!0,i.g.abort(),i.l=!1),i.j=e,i.m=5,wE(i),Hc(i)}function wE(i){i.F||(i.F=!0,Lt(i,"complete"),Lt(i,"error"))}Y.abort=function(i){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=i||7,Lt(this,"complete"),Lt(this,"abort"),Hc(this))};Y.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Hc(this,!0)),at.$.N.call(this)};Y.La=function(){this.s||(this.G||this.v||this.l?AE(this):this.kb())};Y.kb=function(){AE(this)};function AE(i){if(i.h&&typeof Up<"u"&&(!i.C[1]||gn(i)!=4||i.da()!=2)){if(i.v&&gn(i)==4)Yp(i.La,0,i);else if(Lt(i,"readystatechange"),gn(i)==4){i.h=!1;try{const a=i.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var n;if(n=a===0){var r=String(i.I).match(mE)[1]||null;!r&&pe.self&&pe.self.location&&(r=pe.self.location.protocol.slice(0,-1)),n=!wO.test(r?r.toLowerCase():"")}t=n}if(t)Lt(i,"complete"),Lt(i,"success");else{i.m=6;try{var s=2<gn(i)?i.g.statusText:""}catch{s=""}i.j=s+" ["+i.da()+"]",wE(i)}}finally{Hc(i)}}}}function Hc(i,e){if(i.g){DE(i);const t=i.g,n=i.C[0]?()=>{}:null;i.g=null,i.C=null,e||Lt(i,"ready");try{t.onreadystatechange=n}catch{}}}function DE(i){i.g&&i.L&&(i.g.ontimeout=null),i.A&&(pe.clearTimeout(i.A),i.A=null)}Y.isActive=function(){return!!this.g};function gn(i){return i.g?i.g.readyState:0}Y.da=function(){try{return 2<gn(this)?this.g.status:-1}catch{return-1}};Y.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};Y.Wa=function(i){if(this.g){var e=this.g.responseText;return i&&e.indexOf(i)==0&&(e=e.substring(i.length)),CO(e)}};function __(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.K){case CE:case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function IO(i){const e={};i=(i.g&&2<=gn(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let n=0;n<i.length;n++){if(Lo(i[n]))continue;var t=eO(i[n]);const r=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const s=e[r]||[];e[r]=s,s.push(t)}WR(e,function(n){return n.join(", ")})}Y.Ia=function(){return this.m};Y.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function IE(i){let e="";return $p(i,function(t,n){e+=n,e+=":",e+=t,e+=`\r
`}),e}function im(i,e,t){e:{for(n in t){var n=!1;break e}n=!0}n||(t=IE(t),typeof i=="string"?t!=null&&encodeURIComponent(String(t)):Je(i,e,t))}function Za(i,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[i]||e}function kE(i){this.Ga=0,this.j=[],this.l=new Fc,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Za("failFast",!1,i),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Za("baseRetryDelayMs",5e3,i),this.hb=Za("retryDelaySeedMs",1e4,i),this.eb=Za("forwardChannelMaxRetries",2,i),this.xa=Za("forwardChannelRequestTimeoutMs",2e4,i),this.va=i&&i.xmlHttpFactory||void 0,this.Ha=i&&i.dc||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.i=new vE(i&&i.concurrentRequestLimit),this.Ja=new EO,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=i&&i.bc||!1,i&&i.Ea&&this.l.Ea(),i&&i.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&i&&i.detectBufferingProxy||!1,this.qa=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.qa=i.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}Y=kE.prototype;Y.ra=8;Y.H=1;function nm(i){if(PE(i),i.H==3){var e=i.W++,t=qn(i.I);if(Je(t,"SID",i.K),Je(t,"RID",e),Je(t,"TYPE","terminate"),du(i,t),e=new uu(i,i.l,e),e.L=2,e.v=$c(qn(t)),t=!1,pe.navigator&&pe.navigator.sendBeacon)try{t=pe.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&pe.Image&&(new Image().src=e.v,t=!0),t||(e.g=UE(e.l,null),e.g.ha(e.v)),e.G=Date.now(),lu(e)}FE(i)}function Gc(i){i.g&&(sm(i),i.g.cancel(),i.g=null)}function PE(i){Gc(i),i.u&&(pe.clearTimeout(i.u),i.u=null),Jl(i),i.i.cancel(),i.m&&(typeof i.m=="number"&&pe.clearTimeout(i.m),i.m=null)}function zc(i){if(!TE(i.i)&&!i.m){i.m=!0;var e=i.Na;Mo||eE(),Fo||(Mo(),Fo=!0),Kp.add(e,i),i.C=0}}function kO(i,e){return bE(i.i)>=i.i.j-(i.m?1:0)?!1:i.m?(i.j=e.F.concat(i.j),!0):i.H==1||i.H==2||i.C>=(i.cb?0:i.eb)?!1:(i.m=au(Gt(i.Na,i,e),ME(i,i.C)),i.C++,!0)}Y.Na=function(i){if(this.m)if(this.m=null,this.H==1){if(!i){this.W=Math.floor(1e5*Math.random()),i=this.W++;const r=new uu(this,this.l,i);let s=this.s;if(this.U&&(s?(s=zb(s),Wb(s,this.U)):s=this.U),this.o!==null||this.O||(r.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var n=this.j[t];if("__data__"in n.map&&(n=n.map.__data__,typeof n=="string")){n=n.length;break t}n=void 0}if(n===void 0)break;if(e+=n,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=RE(this,r,e),t=qn(this.I),Je(t,"RID",i),Je(t,"CVER",22),this.F&&Je(t,"X-HTTP-Session-Id",this.F),du(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(IE(s)))+"&"+e:this.o&&im(t,this.o,s)),em(this.i,r),this.bb&&Je(t,"TYPE","init"),this.P?(Je(t,"$req",e),Je(t,"SID","null"),r.aa=!0,uf(r,t,null)):uf(r,t,e),this.H=2}}else this.H==3&&(i?y_(this,i):this.j.length==0||TE(this.i)||y_(this))};function y_(i,e){var t;e?t=e.m:t=i.W++;const n=qn(i.I);Je(n,"SID",i.K),Je(n,"RID",t),Je(n,"AID",i.V),du(i,n),i.o&&i.s&&im(n,i.o,i.s),t=new uu(i,i.l,t,i.C+1),i.o===null&&(t.I=i.s),e&&(i.j=e.F.concat(i.j)),e=RE(i,t,1e3),t.setTimeout(Math.round(.5*i.xa)+Math.round(.5*i.xa*Math.random())),em(i.i,t),uf(t,n,e)}function du(i,e){i.na&&$p(i.na,function(t,n){Je(e,n,t)}),i.h&&pE({},function(t,n){Je(e,n,t)})}function RE(i,e,t){t=Math.min(i.j.length,t);var n=i.h?Gt(i.h.Va,i.h,i):null;e:{var r=i.j;let s=-1;for(;;){const a=["count="+t];s==-1?0<t?(s=r[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let o=!0;for(let u=0;u<t;u++){let c=r[u].g;const h=r[u].map;if(c-=s,0>c)s=Math.max(0,r[u].g-100),o=!1;else try{SO(h,a,"req"+c+"_")}catch{n&&n(h)}}if(o){n=a.join("&");break e}}}return i=i.j.splice(0,t),e.F=i,n}function OE(i){if(!i.g&&!i.u){i.ba=1;var e=i.Ma;Mo||eE(),Fo||(Mo(),Fo=!0),Kp.add(e,i),i.A=0}}function rm(i){return i.g||i.u||3<=i.A?!1:(i.ba++,i.u=au(Gt(i.Ma,i),ME(i,i.A)),i.A++,!0)}Y.Ma=function(){if(this.u=null,LE(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var i=2*this.S;this.l.info("BP detection timer enabled: "+i),this.B=au(Gt(this.jb,this),i)}};Y.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,li(10),Gc(this),LE(this))};function sm(i){i.B!=null&&(pe.clearTimeout(i.B),i.B=null)}function LE(i){i.g=new uu(i,i.l,"rpc",i.ba),i.o===null&&(i.g.I=i.s),i.g.O=0;var e=qn(i.wa);Je(e,"RID","rpc"),Je(e,"SID",i.K),Je(e,"AID",i.V),Je(e,"CI",i.G?"0":"1"),!i.G&&i.qa&&Je(e,"TO",i.qa),Je(e,"TYPE","xmlhttp"),du(i,e),i.o&&i.s&&im(e,i.o,i.s),i.L&&i.g.setTimeout(i.L);var t=i.g;i=i.pa,t.L=1,t.v=$c(qn(e)),t.s=null,t.S=!0,cE(t,i)}Y.ib=function(){this.v!=null&&(this.v=null,Gc(this),rm(this),li(19))};function Jl(i){i.v!=null&&(pe.clearTimeout(i.v),i.v=null)}function NE(i,e){var t=null;if(i.g==e){Jl(i),sm(i),i.g=null;var n=2}else if(cf(i.i,e))t=e.F,EE(i.i,e),n=1;else return;if(i.H!=0){if(e.i)if(n==1){t=e.s?e.s.length:0,e=Date.now()-e.G;var r=i.C;n=Bc(),Lt(n,new aE(n,t)),zc(i)}else OE(i);else if(r=e.o,r==3||r==0&&0<e.ca||!(n==1&&kO(i,e)||n==2&&rm(i)))switch(t&&0<t.length&&(e=i.i,e.i=e.i.concat(t)),r){case 1:Nr(i,5);break;case 4:Nr(i,10);break;case 3:Nr(i,6);break;default:Nr(i,2)}}}function ME(i,e){let t=i.ab+Math.floor(Math.random()*i.hb);return i.isActive()||(t*=2),t*e}function Nr(i,e){if(i.l.info("Error code "+e),e==2){var t=null;i.h&&(t=null);var n=Gt(i.pb,i);t||(t=new Vr("//www.google.com/images/cleardot.gif"),pe.location&&pe.location.protocol=="http"||Yl(t,"https"),$c(t)),xO(t.toString(),n)}else li(2);i.H=0,i.h&&i.h.za(e),FE(i),PE(i)}Y.pb=function(i){i?(this.l.info("Successfully pinged google.com"),li(2)):(this.l.info("Failed to ping google.com"),li(1))};function FE(i){if(i.H=0,i.ma=[],i.h){const e=SE(i.i);(e.length!=0||i.j.length!=0)&&(u_(i.ma,e),u_(i.ma,i.j),i.i.i.length=0,Vp(i.j),i.j.length=0),i.h.ya()}}function BE(i,e,t){var n=t instanceof Vr?qn(t):new Vr(t);if(n.g!="")e&&(n.g=e+"."+n.g),Ql(n,n.m);else{var r=pe.location;n=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Vr(null);n&&Yl(s,n),e&&(s.g=e),r&&Ql(s,r),t&&(s.l=t),n=s}return t=i.F,e=i.Da,t&&e&&Je(n,t,e),Je(n,"VER",i.ra),du(i,n),n}function UE(i,e,t){if(e&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&i.Ha&&!i.va?new at(new cu({ob:!0})):new at(i.va),e.Oa(i.J),e}Y.isActive=function(){return!!this.h&&this.h.isActive(this)};function VE(){}Y=VE.prototype;Y.Ba=function(){};Y.Aa=function(){};Y.za=function(){};Y.ya=function(){};Y.isActive=function(){return!0};Y.Va=function(){};function Zl(){if(ra&&!(10<=Number(qR)))throw Error("Environmental error: no available transport.")}Zl.prototype.g=function(i,e){return new Ri(i,e)};function Ri(i,e){At.call(this),this.g=new kE(e),this.l=i,this.h=e&&e.messageUrlParams||null,i=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.s=i,i=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(i?i["X-WebChannel-Content-Type"]=e.messageContentType:i={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(i?i["X-WebChannel-Client-Profile"]=e.Ca:i={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=i,(i=e&&e.cc)&&!Lo(i)&&(this.g.o=i),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Lo(e)&&(this.g.F=e,i=this.h,i!==null&&e in i&&(i=this.h,e in i&&delete i[e])),this.j=new Sa(this)}It(Ri,At);Ri.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var i=this.g,e=this.l,t=this.h||void 0;li(0),i.Y=e,i.na=t||{},i.G=i.aa,i.I=BE(i,null,i.Y),zc(i)};Ri.prototype.close=function(){nm(this.g)};Ri.prototype.u=function(i){var e=this.g;if(typeof i=="string"){var t={};t.__data__=i,i=t}else this.v&&(t={},t.__data__=Wp(i),i=t);e.j.push(new vO(e.fb++,i)),e.H==3&&zc(e)};Ri.prototype.N=function(){this.g.h=null,delete this.j,nm(this.g),delete this.g,Ri.$.N.call(this)};function jE(i){Jp.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var e=i.__sm__;if(e){e:{for(const t in e){i=t;break e}i=void 0}(this.i=i)&&(i=this.i,e=e!==null&&i in e?e[i]:void 0),this.data=e}else this.data=i}It(jE,Jp);function $E(){Zp.call(this),this.status=1}It($E,Zp);function Sa(i){this.g=i}It(Sa,VE);Sa.prototype.Ba=function(){Lt(this.g,"a")};Sa.prototype.Aa=function(i){Lt(this.g,new jE(i))};Sa.prototype.za=function(i){Lt(this.g,new $E)};Sa.prototype.ya=function(){Lt(this.g,"b")};function PO(){this.blockSize=-1}function Qi(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}It(Qi,PO);Qi.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function sd(i,e,t){t||(t=0);var n=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)n[r]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(r=0;16>r;++r)n[r]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=i.g[0],t=i.g[1],r=i.g[2];var s=i.g[3],a=e+(s^t&(r^s))+n[0]+3614090360&4294967295;e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[1]+3905402710&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[2]+606105819&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[3]+3250441966&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(s^t&(r^s))+n[4]+4118548399&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[5]+1200080426&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[6]+2821735955&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[7]+4249261313&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(s^t&(r^s))+n[8]+1770035416&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[9]+2336552879&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[10]+4294925233&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[11]+2304563134&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(s^t&(r^s))+n[12]+1804603682&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[13]+4254626195&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[14]+2792965006&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[15]+1236535329&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(r^s&(t^r))+n[1]+4129170786&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[6]+3225465664&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[11]+643717713&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[0]+3921069994&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(r^s&(t^r))+n[5]+3593408605&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[10]+38016083&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[15]+3634488961&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[4]+3889429448&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(r^s&(t^r))+n[9]+568446438&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[14]+3275163606&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[3]+4107603335&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[8]+1163531501&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(r^s&(t^r))+n[13]+2850285829&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[2]+4243563512&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[7]+1735328473&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[12]+2368359562&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(t^r^s)+n[5]+4294588738&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[8]+2272392833&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[11]+1839030562&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[14]+4259657740&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(t^r^s)+n[1]+2763975236&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[4]+1272893353&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[7]+4139469664&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[10]+3200236656&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(t^r^s)+n[13]+681279174&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[0]+3936430074&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[3]+3572445317&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[6]+76029189&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(t^r^s)+n[9]+3654602809&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[12]+3873151461&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[15]+530742520&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[2]+3299628645&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(r^(t|~s))+n[0]+4096336452&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[7]+1126891415&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[14]+2878612391&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[5]+4237533241&4294967295,t=r+(a<<21&4294967295|a>>>11),a=e+(r^(t|~s))+n[12]+1700485571&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[3]+2399980690&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[10]+4293915773&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[1]+2240044497&4294967295,t=r+(a<<21&4294967295|a>>>11),a=e+(r^(t|~s))+n[8]+1873313359&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[15]+4264355552&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[6]+2734768916&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[13]+1309151649&4294967295,t=r+(a<<21&4294967295|a>>>11),a=e+(r^(t|~s))+n[4]+4149444226&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[11]+3174756917&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[2]+718787259&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[9]+3951481745&4294967295,i.g[0]=i.g[0]+e&4294967295,i.g[1]=i.g[1]+(r+(a<<21&4294967295|a>>>11))&4294967295,i.g[2]=i.g[2]+r&4294967295,i.g[3]=i.g[3]+s&4294967295}Qi.prototype.j=function(i,e){e===void 0&&(e=i.length);for(var t=e-this.blockSize,n=this.m,r=this.h,s=0;s<e;){if(r==0)for(;s<=t;)sd(this,i,s),s+=this.blockSize;if(typeof i=="string"){for(;s<e;)if(n[r++]=i.charCodeAt(s++),r==this.blockSize){sd(this,n),r=0;break}}else for(;s<e;)if(n[r++]=i[s++],r==this.blockSize){sd(this,n),r=0;break}}this.h=r,this.i+=e};Qi.prototype.l=function(){var i=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);i[0]=128;for(var e=1;e<i.length-8;++e)i[e]=0;var t=8*this.i;for(e=i.length-8;e<i.length;++e)i[e]=t&255,t/=256;for(this.j(i),i=Array(16),e=t=0;4>e;++e)for(var n=0;32>n;n+=8)i[t++]=this.g[e]>>>n&255;return i};function je(i,e){this.h=e;for(var t=[],n=!0,r=i.length-1;0<=r;r--){var s=i[r]|0;n&&s==e||(t[r]=s,n=!1)}this.g=t}var RO={};function am(i){return-128<=i&&128>i?VR(i,function(e){return new je([e|0],0>e?-1:0)}):new je([i|0],0>i?-1:0)}function _n(i){if(isNaN(i)||!isFinite(i))return Fs;if(0>i)return Ot(_n(-i));for(var e=[],t=1,n=0;i>=t;n++)e[n]=i/t|0,t*=hf;return new je(e,0)}function qE(i,e){if(i.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(i.charAt(0)=="-")return Ot(qE(i.substring(1),e));if(0<=i.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=_n(Math.pow(e,8)),n=Fs,r=0;r<i.length;r+=8){var s=Math.min(8,i.length-r),a=parseInt(i.substring(r,r+s),e);8>s?(s=_n(Math.pow(e,s)),n=n.R(s).add(_n(a))):(n=n.R(t),n=n.add(_n(a)))}return n}var hf=4294967296,Fs=am(0),df=am(1),v_=am(16777216);Y=je.prototype;Y.ea=function(){if(Ui(this))return-Ot(this).ea();for(var i=0,e=1,t=0;t<this.g.length;t++){var n=this.D(t);i+=(0<=n?n:hf+n)*e,e*=hf}return i};Y.toString=function(i){if(i=i||10,2>i||36<i)throw Error("radix out of range: "+i);if(Nn(this))return"0";if(Ui(this))return"-"+Ot(this).toString(i);for(var e=_n(Math.pow(i,6)),t=this,n="";;){var r=tc(t,e).g;t=ec(t,r.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(i);if(t=r,Nn(t))return s+n;for(;6>s.length;)s="0"+s;n=s+n}};Y.D=function(i){return 0>i?0:i<this.g.length?this.g[i]:this.h};function Nn(i){if(i.h!=0)return!1;for(var e=0;e<i.g.length;e++)if(i.g[e]!=0)return!1;return!0}function Ui(i){return i.h==-1}Y.X=function(i){return i=ec(this,i),Ui(i)?-1:Nn(i)?0:1};function Ot(i){for(var e=i.g.length,t=[],n=0;n<e;n++)t[n]=~i.g[n];return new je(t,~i.h).add(df)}Y.abs=function(){return Ui(this)?Ot(this):this};Y.add=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0,r=0;r<=e;r++){var s=n+(this.D(r)&65535)+(i.D(r)&65535),a=(s>>>16)+(this.D(r)>>>16)+(i.D(r)>>>16);n=a>>>16,s&=65535,a&=65535,t[r]=a<<16|s}return new je(t,t[t.length-1]&-2147483648?-1:0)};function ec(i,e){return i.add(Ot(e))}Y.R=function(i){if(Nn(this)||Nn(i))return Fs;if(Ui(this))return Ui(i)?Ot(this).R(Ot(i)):Ot(Ot(this).R(i));if(Ui(i))return Ot(this.R(Ot(i)));if(0>this.X(v_)&&0>i.X(v_))return _n(this.ea()*i.ea());for(var e=this.g.length+i.g.length,t=[],n=0;n<2*e;n++)t[n]=0;for(n=0;n<this.g.length;n++)for(var r=0;r<i.g.length;r++){var s=this.D(n)>>>16,a=this.D(n)&65535,o=i.D(r)>>>16,u=i.D(r)&65535;t[2*n+2*r]+=a*u,Xu(t,2*n+2*r),t[2*n+2*r+1]+=s*u,Xu(t,2*n+2*r+1),t[2*n+2*r+1]+=a*o,Xu(t,2*n+2*r+1),t[2*n+2*r+2]+=s*o,Xu(t,2*n+2*r+2)}for(n=0;n<e;n++)t[n]=t[2*n+1]<<16|t[2*n];for(n=e;n<2*e;n++)t[n]=0;return new je(t,0)};function Xu(i,e){for(;(i[e]&65535)!=i[e];)i[e+1]+=i[e]>>>16,i[e]&=65535,e++}function eo(i,e){this.g=i,this.h=e}function tc(i,e){if(Nn(e))throw Error("division by zero");if(Nn(i))return new eo(Fs,Fs);if(Ui(i))return e=tc(Ot(i),e),new eo(Ot(e.g),Ot(e.h));if(Ui(e))return e=tc(i,Ot(e)),new eo(Ot(e.g),e.h);if(30<i.g.length){if(Ui(i)||Ui(e))throw Error("slowDivide_ only works with positive integers.");for(var t=df,n=e;0>=n.X(i);)t=T_(t),n=T_(n);var r=vs(t,1),s=vs(n,1);for(n=vs(n,2),t=vs(t,2);!Nn(n);){var a=s.add(n);0>=a.X(i)&&(r=r.add(t),s=a),n=vs(n,1),t=vs(t,1)}return e=ec(i,r.R(e)),new eo(r,e)}for(r=Fs;0<=i.X(e);){for(t=Math.max(1,Math.floor(i.ea()/e.ea())),n=Math.ceil(Math.log(t)/Math.LN2),n=48>=n?1:Math.pow(2,n-48),s=_n(t),a=s.R(e);Ui(a)||0<a.X(i);)t-=n,s=_n(t),a=s.R(e);Nn(s)&&(s=df),r=r.add(s),i=ec(i,a)}return new eo(r,i)}Y.gb=function(i){return tc(this,i).h};Y.and=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0;n<e;n++)t[n]=this.D(n)&i.D(n);return new je(t,this.h&i.h)};Y.or=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0;n<e;n++)t[n]=this.D(n)|i.D(n);return new je(t,this.h|i.h)};Y.xor=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0;n<e;n++)t[n]=this.D(n)^i.D(n);return new je(t,this.h^i.h)};function T_(i){for(var e=i.g.length+1,t=[],n=0;n<e;n++)t[n]=i.D(n)<<1|i.D(n-1)>>>31;return new je(t,i.h)}function vs(i,e){var t=e>>5;e%=32;for(var n=i.g.length-t,r=[],s=0;s<n;s++)r[s]=0<e?i.D(s+t)>>>e|i.D(s+t+1)<<32-e:i.D(s+t);return new je(r,i.h)}Zl.prototype.createWebChannel=Zl.prototype.g;Ri.prototype.send=Ri.prototype.u;Ri.prototype.open=Ri.prototype.m;Ri.prototype.close=Ri.prototype.close;Uc.NO_ERROR=0;Uc.TIMEOUT=8;Uc.HTTP_ERROR=6;oE.COMPLETE="complete";uE.EventType=ou;ou.OPEN="a";ou.CLOSE="b";ou.ERROR="c";ou.MESSAGE="d";At.prototype.listen=At.prototype.O;at.prototype.listenOnce=at.prototype.P;at.prototype.getLastError=at.prototype.Sa;at.prototype.getLastErrorCode=at.prototype.Ia;at.prototype.getStatus=at.prototype.da;at.prototype.getResponseJson=at.prototype.Wa;at.prototype.getResponseText=at.prototype.ja;at.prototype.send=at.prototype.ha;at.prototype.setWithCredentials=at.prototype.Oa;Qi.prototype.digest=Qi.prototype.l;Qi.prototype.reset=Qi.prototype.reset;Qi.prototype.update=Qi.prototype.j;je.prototype.add=je.prototype.add;je.prototype.multiply=je.prototype.R;je.prototype.modulo=je.prototype.gb;je.prototype.compare=je.prototype.X;je.prototype.toNumber=je.prototype.ea;je.prototype.toString=je.prototype.toString;je.prototype.getBits=je.prototype.D;je.fromNumber=_n;je.fromString=qE;var OO=function(){return new Zl},LO=function(){return Bc()},ad=Uc,NO=oE,MO=Jr,b_={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},FO=cu,Yu=uE,BO=at,UO=Qi,Bs=je;const E_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ut.UNAUTHENTICATED=new Ut(null),Ut.GOOGLE_CREDENTIALS=new Ut("google-credentials-uid"),Ut.FIRST_PARTY=new Ut("first-party-uid"),Ut.MOCK_USER=new Ut("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xa="10.1.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr=new ky("@firebase/firestore");function S_(){return Wr.logLevel}function ae(i,...e){if(Wr.logLevel<=Ne.DEBUG){const t=e.map(om);Wr.debug(`Firestore (${xa}): ${i}`,...t)}}function Hn(i,...e){if(Wr.logLevel<=Ne.ERROR){const t=e.map(om);Wr.error(`Firestore (${xa}): ${i}`,...t)}}function sa(i,...e){if(Wr.logLevel<=Ne.WARN){const t=e.map(om);Wr.warn(`Firestore (${xa}): ${i}`,...t)}}function om(i){if(typeof i=="string")return i;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(i)}catch{return i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ee(i="Unexpected state"){const e=`FIRESTORE (${xa}) INTERNAL ASSERTION FAILED: `+i;throw Hn(e),new Error(e)}function vt(i,e){i||Ee()}function Re(i,e){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class re extends fa{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class VO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ut.UNAUTHENTICATED))}shutdown(){}}class jO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class $O{constructor(e){this.t=e,this.currentUser=Ut.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve();let s=new jr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new jr,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const u=s;e.enqueueRetryable(async()=>{await u.promise,await r(this.currentUser)})},o=u=>{ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(u=>o(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?o(u):(ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new jr)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(vt(typeof n.accessToken=="string"),new HE(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return vt(e===null||typeof e=="string"),new Ut(e)}}class qO{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ut.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class HO{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new qO(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ut.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class GO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zO{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{s.error!=null&&ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,ae("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const r=s=>{ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?r(s):ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(vt(typeof t.token=="string"),this.R=t.token,new GO(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WO(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{static V(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=WO(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%e.length))}return n}}function Me(i,e){return i<e?-1:i>e?1:0}function aa(i,e,t){return i.length===e.length&&i.every((n,r)=>t(n,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new re(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new re(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new re(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new re(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ct.fromMillis(Date.now())}static fromDate(e){return Ct.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ct(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Me(this.nanoseconds,e.nanoseconds):Me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Te(e)}static min(){return new Te(new Ct(0,0))}static max(){return new Te(new Ct(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e,t,n){t===void 0?t=0:t>e.length&&Ee(),n===void 0?n=e.length-t:n>e.length-t&&Ee(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return $o.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $o?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const s=e.get(r),a=t.get(r);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class nt extends $o{construct(e,t,n){return new nt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new re(G.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(r=>r.length>0))}return new nt(t)}static emptyPath(){return new nt([])}}const XO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class oi extends $o{construct(e,t,n){return new oi(e,t,n)}static isValidIdentifier(e){return XO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),oi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new oi(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(n.length===0)throw new re(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new re(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new re(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(n+=o,r++):(s(),r++)}if(s(),a)throw new re(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new oi(t)}static emptyPath(){return new oi([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e){this.path=e}static fromPath(e){return new ce(nt.fromString(e))}static fromName(e){return new ce(nt.fromString(e).popFirst(5))}static empty(){return new ce(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&nt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return nt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ce(new nt(e.slice()))}}function YO(i,e){const t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,r=Te.fromTimestamp(n===1e9?new Ct(t+1,0):new Ct(t,n));return new dr(r,ce.empty(),e)}function QO(i){return new dr(i.readTime,i.key,-1)}class dr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new dr(Te.min(),ce.empty(),-1)}static max(){return new dr(Te.max(),ce.empty(),-1)}}function JO(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=ce.comparator(i.documentKey,e.documentKey),t!==0?t:Me(i.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function um(i){if(i.code!==G.FAILED_PRECONDITION||i.message!==ZO)throw i;ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ee(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new H((n,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof H?t:H.resolve(t)}catch(t){return H.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):H.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):H.reject(t)}static resolve(e){return new H((t,n)=>{t(e)})}static reject(e){return new H((t,n)=>{n(e)})}static waitFor(e){return new H((t,n)=>{let r=0,s=0,a=!1;e.forEach(o=>{++r,o.next(()=>{++s,a&&s===r&&t()},u=>n(u))}),a=!0,s===r&&t()})}static or(e){let t=H.resolve(!1);for(const n of e)t=t.next(r=>r?H.resolve(r):n());return t}static forEach(e,t){const n=[];return e.forEach((r,s)=>{n.push(t.call(this,r,s))}),this.waitFor(n)}static mapArray(e,t){return new H((n,r)=>{const s=e.length,a=new Array(s);let o=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(h=>{a[c]=h,++o,o===s&&n(a)},h=>r(h))}})}static doWhile(e,t){return new H((n,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):n()};s()})}}function fu(i){return i.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.oe(n),this._e=n=>t.writeSequenceNumber(n))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}lm.ae=-1;function Wc(i){return i==null}function ic(i){return i===0&&1/i==-1/0}function tL(i){return typeof i=="number"&&Number.isInteger(i)&&!ic(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x_(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function pu(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function GE(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e,t){this.comparator=e,this.root=t||Rt.EMPTY}insert(e,t){return new ht(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Rt.BLACK,null,null))}remove(e){return new ht(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qu(this.root,e,this.comparator,!0)}}class Qu{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rt{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??Rt.RED,this.left=r??Rt.EMPTY,this.right=s??Rt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Rt(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Rt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Rt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ee();const e=this.left.check();if(e!==this.right.check())throw Ee();return e+(this.isRed()?0:1)}}Rt.EMPTY=null,Rt.RED=!0,Rt.BLACK=!1;Rt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ee()}get value(){throw Ee()}get color(){throw Ee()}get left(){throw Ee()}get right(){throw Ee()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Rt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.comparator=e,this.data=new ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new C_(this.data.getIterator())}getIteratorFrom(e){return new C_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Wt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Wt(this.comparator);return t.data=e,t}}class C_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.fields=e,e.sort(oi.comparator)}static empty(){return new rr([])}unionWith(e){let t=new Wt(oi.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new rr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return aa(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new zE("Invalid base64 string: "+s):s}}(e);return new Kt(t)}static fromUint8Array(e){const t=function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s}(e);return new Kt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Kt.EMPTY_BYTE_STRING=new Kt("");const iL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fr(i){if(vt(!!i),typeof i=="string"){let e=0;const t=iL.exec(i);if(vt(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:pt(i.seconds),nanos:pt(i.nanos)}}function pt(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Kr(i){return typeof i=="string"?Kt.fromBase64String(i):Kt.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(i){var e,t;return((t=(((e=i==null?void 0:i.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function hm(i){const e=i.mapValue.fields.__previous_value__;return cm(e)?hm(e):e}function qo(i){const e=fr(i.mapValue.fields.__local_write_time__.timestampValue);return new Ct(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nL{constructor(e,t,n,r,s,a,o,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=u,this.useFetchStreams=c}}class Ho{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ho("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Ho&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ju={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Xr(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?cm(i)?4:rL(i)?9007199254740991:10:Ee()}function An(i,e){if(i===e)return!0;const t=Xr(i);if(t!==Xr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return qo(i).isEqual(qo(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const a=fr(r.timestampValue),o=fr(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(r,s){return Kr(r.bytesValue).isEqual(Kr(s.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(r,s){return pt(r.geoPointValue.latitude)===pt(s.geoPointValue.latitude)&&pt(r.geoPointValue.longitude)===pt(s.geoPointValue.longitude)}(i,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return pt(r.integerValue)===pt(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const a=pt(r.doubleValue),o=pt(s.doubleValue);return a===o?ic(a)===ic(o):isNaN(a)&&isNaN(o)}return!1}(i,e);case 9:return aa(i.arrayValue.values||[],e.arrayValue.values||[],An);case 10:return function(r,s){const a=r.mapValue.fields||{},o=s.mapValue.fields||{};if(x_(a)!==x_(o))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(o[u]===void 0||!An(a[u],o[u])))return!1;return!0}(i,e);default:return Ee()}}function Go(i,e){return(i.values||[]).find(t=>An(t,e))!==void 0}function oa(i,e){if(i===e)return 0;const t=Xr(i),n=Xr(e);if(t!==n)return Me(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Me(i.booleanValue,e.booleanValue);case 2:return function(s,a){const o=pt(s.integerValue||s.doubleValue),u=pt(a.integerValue||a.doubleValue);return o<u?-1:o>u?1:o===u?0:isNaN(o)?isNaN(u)?0:-1:1}(i,e);case 3:return w_(i.timestampValue,e.timestampValue);case 4:return w_(qo(i),qo(e));case 5:return Me(i.stringValue,e.stringValue);case 6:return function(s,a){const o=Kr(s),u=Kr(a);return o.compareTo(u)}(i.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),u=a.split("/");for(let c=0;c<o.length&&c<u.length;c++){const h=Me(o[c],u[c]);if(h!==0)return h}return Me(o.length,u.length)}(i.referenceValue,e.referenceValue);case 8:return function(s,a){const o=Me(pt(s.latitude),pt(a.latitude));return o!==0?o:Me(pt(s.longitude),pt(a.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return function(s,a){const o=s.values||[],u=a.values||[];for(let c=0;c<o.length&&c<u.length;++c){const h=oa(o[c],u[c]);if(h)return h}return Me(o.length,u.length)}(i.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===Ju.mapValue&&a===Ju.mapValue)return 0;if(s===Ju.mapValue)return 1;if(a===Ju.mapValue)return-1;const o=s.fields||{},u=Object.keys(o),c=a.fields||{},h=Object.keys(c);u.sort(),h.sort();for(let g=0;g<u.length&&g<h.length;++g){const y=Me(u[g],h[g]);if(y!==0)return y;const T=oa(o[u[g]],c[h[g]]);if(T!==0)return T}return Me(u.length,h.length)}(i.mapValue,e.mapValue);default:throw Ee()}}function w_(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return Me(i,e);const t=fr(i),n=fr(e),r=Me(t.seconds,n.seconds);return r!==0?r:Me(t.nanos,n.nanos)}function ua(i){return ff(i)}function ff(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){const n=fr(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return Kr(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return ce.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",r=!0;for(const s of t.values||[])r?r=!1:n+=",",n+=ff(s);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){const n=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const a of n)s?s=!1:r+=",",r+=`${a}:${ff(t.fields[a])}`;return r+"}"}(i.mapValue):Ee()}function A_(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function pf(i){return!!i&&"integerValue"in i}function dm(i){return!!i&&"arrayValue"in i}function D_(i){return!!i&&"nullValue"in i}function I_(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function od(i){return!!i&&"mapValue"in i}function vo(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){const e={mapValue:{fields:{}}};return pu(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=vo(n)),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=vo(i.arrayValue.values[t]);return e}return Object.assign({},i)}function rL(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.value=e}static empty(){return new dn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!od(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vo(t)}setAll(e){let t=oi.emptyPath(),n={},r=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const u=this.getFieldsMap(t);this.applyChanges(u,n,r),n={},r=[],t=o.popLast()}a?n[o.lastSegment()]=vo(a):r.push(o.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());od(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return An(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];od(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){pu(t,(r,s)=>e[r]=s);for(const r of n)delete e[r]}clone(){return new dn(vo(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,t,n,r,s,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new jt(e,0,Te.min(),Te.min(),Te.min(),dn.empty(),0)}static newFoundDocument(e,t,n,r){return new jt(e,1,t,Te.min(),n,r,0)}static newNoDocument(e,t){return new jt(e,2,t,Te.min(),Te.min(),dn.empty(),0)}static newUnknownDocument(e,t){return new jt(e,3,t,Te.min(),Te.min(),dn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=dn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=dn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof jt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new jt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(e,t){this.position=e,this.inclusive=t}}function k_(i,e,t){let n=0;for(let r=0;r<i.position.length;r++){const s=e[r],a=i.position[r];if(s.field.isKeyField()?n=ce.comparator(ce.fromName(a.referenceValue),t.key):n=oa(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function P_(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!An(i.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(e,t="asc"){this.field=e,this.dir=t}}function sL(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{}class gt extends WE{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new oL(e,t,n):t==="array-contains"?new cL(e,n):t==="in"?new hL(e,n):t==="not-in"?new dL(e,n):t==="array-contains-any"?new fL(e,n):new gt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new uL(e,n):new lL(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(oa(t,this.value)):t!==null&&Xr(this.value)===Xr(t)&&this.matchesComparison(oa(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ee()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Ji extends WE{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Ji(e,t)}matches(e){return KE(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le(t=>t.isInequality());return e!==null?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function KE(i){return i.op==="and"}function XE(i){return aL(i)&&KE(i)}function aL(i){for(const e of i.filters)if(e instanceof Ji)return!1;return!0}function mf(i){if(i instanceof gt)return i.field.canonicalString()+i.op.toString()+ua(i.value);if(XE(i))return i.filters.map(e=>mf(e)).join(",");{const e=i.filters.map(t=>mf(t)).join(",");return`${i.op}(${e})`}}function YE(i,e){return i instanceof gt?function(n,r){return r instanceof gt&&n.op===r.op&&n.field.isEqual(r.field)&&An(n.value,r.value)}(i,e):i instanceof Ji?function(n,r){return r instanceof Ji&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((s,a,o)=>s&&YE(a,r.filters[o]),!0):!1}(i,e):void Ee()}function QE(i){return i instanceof gt?function(t){return`${t.field.canonicalString()} ${t.op} ${ua(t.value)}`}(i):i instanceof Ji?function(t){return t.op.toString()+" {"+t.getFilters().map(QE).join(" ,")+"}"}(i):"Filter"}class oL extends gt{constructor(e,t,n){super(e,t,n),this.key=ce.fromName(n.referenceValue)}matches(e){const t=ce.comparator(e.key,this.key);return this.matchesComparison(t)}}class uL extends gt{constructor(e,t){super(e,"in",t),this.keys=JE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class lL extends gt{constructor(e,t){super(e,"not-in",t),this.keys=JE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function JE(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>ce.fromName(n.referenceValue))}class cL extends gt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return dm(t)&&Go(t.arrayValue,this.value)}}class hL extends gt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Go(this.value.arrayValue,t)}}class dL extends gt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Go(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Go(this.value.arrayValue,t)}}class fL extends gt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!dm(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Go(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pL{constructor(e,t=null,n=[],r=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=a,this.endAt=o,this.he=null}}function R_(i,e=null,t=[],n=[],r=null,s=null,a=null){return new pL(i,e,t,n,r,s,a)}function fm(i){const e=Re(i);if(e.he===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>mf(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Wc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>ua(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>ua(n)).join(",")),e.he=t}return e.he}function pm(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!sL(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!YE(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!P_(i.startAt,e.startAt)&&P_(i.endAt,e.endAt)}function gf(i){return ce.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e,t=null,n=[],r=[],s=null,a="F",o=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=u,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function mL(i,e,t,n,r,s,a,o){return new Ca(i,e,t,n,r,s,a,o)}function ZE(i){return new Ca(i)}function O_(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function mm(i){return i.explicitOrderBy.length>0?i.explicitOrderBy[0].field:null}function Kc(i){for(const e of i.filters){const t=e.getFirstInequalityField();if(t!==null)return t}return null}function e2(i){return i.collectionGroup!==null}function Vs(i){const e=Re(i);if(e.Pe===null){e.Pe=[];const t=Kc(e),n=mm(e);if(t!==null&&n===null)t.isKeyField()||e.Pe.push(new Us(t)),e.Pe.push(new Us(oi.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.Pe.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new Us(oi.keyField(),s))}}}return e.Pe}function Gn(i){const e=Re(i);if(!e.Ie)if(e.limitType==="F")e.Ie=R_(e.path,e.collectionGroup,Vs(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Vs(e)){const a=s.dir==="desc"?"asc":"desc";t.push(new Us(s.field,a))}const n=e.endAt?new nc(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new nc(e.startAt.position,e.startAt.inclusive):null;e.Ie=R_(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.Ie}function _f(i,e){e.getFirstInequalityField(),Kc(i);const t=i.filters.concat([e]);return new Ca(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function yf(i,e,t){return new Ca(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function Xc(i,e){return pm(Gn(i),Gn(e))&&i.limitType===e.limitType}function t2(i){return`${fm(Gn(i))}|lt:${i.limitType}`}function vf(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(r=>QE(r)).join(", ")}]`),Wc(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>ua(r)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>ua(r)).join(",")),`Target(${n})`}(Gn(i))}; limitType=${i.limitType})`}function Yc(i,e){return e.isFoundDocument()&&function(n,r){const s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):ce.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(i,e)&&function(n,r){for(const s of Vs(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(i,e)&&function(n,r){for(const s of n.filters)if(!s.matches(r))return!1;return!0}(i,e)&&function(n,r){return!(n.startAt&&!function(a,o,u){const c=k_(a,o,u);return a.inclusive?c<=0:c<0}(n.startAt,Vs(n),r)||n.endAt&&!function(a,o,u){const c=k_(a,o,u);return a.inclusive?c>=0:c>0}(n.endAt,Vs(n),r))}(i,e)}function gL(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function i2(i){return(e,t)=>{let n=!1;for(const r of Vs(i)){const s=_L(r,e,t);if(s!==0)return s;n=n||r.field.isKeyField()}return 0}}function _L(i,e,t){const n=i.field.isKeyField()?ce.comparator(e.key,t.key):function(s,a,o){const u=a.data.field(s),c=o.data.field(s);return u!==null&&c!==null?oa(u,c):Ee()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return Ee()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[r,s]of n)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){pu(this.inner,(t,n)=>{for(const[r,s]of n)e(r,s)})}isEmpty(){return GE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yL=new ht(ce.comparator);function pr(){return yL}const n2=new ht(ce.comparator);function lo(...i){let e=n2;for(const t of i)e=e.insert(t.key,t);return e}function vL(i){let e=n2;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Mr(){return To()}function r2(){return To()}function To(){return new wa(i=>i.toString(),(i,e)=>i.isEqual(e))}const TL=new Wt(ce.comparator);function Pe(...i){let e=TL;for(const t of i)e=e.add(t);return e}const bL=new Wt(Me);function EL(){return bL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ic(e)?"-0":e}}function a2(i){return{integerValue:""+i}}function SL(i,e){return tL(e)?a2(e):s2(i,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(){this._=void 0}}function xL(i,e,t){return i instanceof Tf?function(r,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&cm(s)&&(s=hm(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):i instanceof rc?o2(i,e):i instanceof sc?u2(i,e):function(r,s){const a=wL(r,s),o=L_(a)+L_(r.Te);return pf(a)&&pf(r.Te)?a2(o):s2(r.serializer,o)}(i,e)}function CL(i,e,t){return i instanceof rc?o2(i,e):i instanceof sc?u2(i,e):t}function wL(i,e){return i instanceof bf?function(n){return pf(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}class Tf extends Qc{}class rc extends Qc{constructor(e){super(),this.elements=e}}function o2(i,e){const t=l2(e);for(const n of i.elements)t.some(r=>An(r,n))||t.push(n);return{arrayValue:{values:t}}}class sc extends Qc{constructor(e){super(),this.elements=e}}function u2(i,e){let t=l2(e);for(const n of i.elements)t=t.filter(r=>!An(r,n));return{arrayValue:{values:t}}}class bf extends Qc{constructor(e,t){super(),this.serializer=e,this.Te=t}}function L_(i){return pt(i.integerValue||i.doubleValue)}function l2(i){return dm(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}function AL(i,e){return i.field.isEqual(e.field)&&function(n,r){return n instanceof rc&&r instanceof rc||n instanceof sc&&r instanceof sc?aa(n.elements,r.elements,An):n instanceof bf&&r instanceof bf?An(n.Te,r.Te):n instanceof Tf&&r instanceof Tf}(i.transform,e.transform)}class $r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new $r}static exists(e){return new $r(void 0,e)}static updateTime(e){return new $r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cl(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class gm{}function c2(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new IL(i.key,$r.none()):new _m(i.key,i.data,$r.none());{const t=i.data,n=dn.empty();let r=new Wt(oi.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),r=r.add(s)}return new Jc(i.key,n,new rr(r.toArray()),$r.none())}}function DL(i,e,t){i instanceof _m?function(r,s,a){const o=r.value.clone(),u=M_(r.fieldTransforms,s,a.transformResults);o.setAll(u),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(i,e,t):i instanceof Jc?function(r,s,a){if(!cl(r.precondition,s))return void s.convertToUnknownDocument(a.version);const o=M_(r.fieldTransforms,s,a.transformResults),u=s.data;u.setAll(h2(r)),u.setAll(o),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(i,e,t):function(r,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function bo(i,e,t,n){return i instanceof _m?function(s,a,o,u){if(!cl(s.precondition,a))return o;const c=s.value.clone(),h=F_(s.fieldTransforms,u,a);return c.setAll(h),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),null}(i,e,t,n):i instanceof Jc?function(s,a,o,u){if(!cl(s.precondition,a))return o;const c=F_(s.fieldTransforms,u,a),h=a.data;return h.setAll(h2(s)),h.setAll(c),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(i,e,t,n):function(s,a,o){return cl(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(i,e,t)}function N_(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&aa(n,r,(s,a)=>AL(s,a))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class _m extends gm{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Jc extends gm{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function h2(i){const e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=i.data.field(t);e.set(t,n)}}),e}function M_(i,e,t){const n=new Map;vt(i.length===t.length);for(let r=0;r<t.length;r++){const s=i[r],a=s.transform,o=e.data.field(s.field);n.set(s.field,CL(a,o,t[r]))}return n}function F_(i,e,t){const n=new Map;for(const r of i){const s=r.transform,a=t.data.field(r.field);n.set(r.field,xL(s,a,e))}return n}class IL extends gm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&DL(s,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=bo(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=bo(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=r2();return this.mutations.forEach(r=>{const s=e.get(r.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=t.has(r.key)?null:o;const u=c2(a,o);u!==null&&n.set(r.key,u),a.isValidDocument()||a.convertToNoDocument(Te.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Pe())}isEqual(e){return this.batchId===e.batchId&&aa(this.mutations,e.mutations,(t,n)=>N_(t,n))&&aa(this.baseMutations,e.baseMutations,(t,n)=>N_(t,n))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PL{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ft,ke;function d2(i){if(i===void 0)return Hn("GRPC error has no .code"),G.UNKNOWN;switch(i){case ft.OK:return G.OK;case ft.CANCELLED:return G.CANCELLED;case ft.UNKNOWN:return G.UNKNOWN;case ft.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case ft.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case ft.INTERNAL:return G.INTERNAL;case ft.UNAVAILABLE:return G.UNAVAILABLE;case ft.UNAUTHENTICATED:return G.UNAUTHENTICATED;case ft.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case ft.NOT_FOUND:return G.NOT_FOUND;case ft.ALREADY_EXISTS:return G.ALREADY_EXISTS;case ft.PERMISSION_DENIED:return G.PERMISSION_DENIED;case ft.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case ft.ABORTED:return G.ABORTED;case ft.OUT_OF_RANGE:return G.OUT_OF_RANGE;case ft.UNIMPLEMENTED:return G.UNIMPLEMENTED;case ft.DATA_LOSS:return G.DATA_LOSS;default:return Ee()}}(ke=ft||(ft={}))[ke.OK=0]="OK",ke[ke.CANCELLED=1]="CANCELLED",ke[ke.UNKNOWN=2]="UNKNOWN",ke[ke.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ke[ke.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ke[ke.NOT_FOUND=5]="NOT_FOUND",ke[ke.ALREADY_EXISTS=6]="ALREADY_EXISTS",ke[ke.PERMISSION_DENIED=7]="PERMISSION_DENIED",ke[ke.UNAUTHENTICATED=16]="UNAUTHENTICATED",ke[ke.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ke[ke.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ke[ke.ABORTED=10]="ABORTED",ke[ke.OUT_OF_RANGE=11]="OUT_OF_RANGE",ke[ke.UNIMPLEMENTED=12]="UNIMPLEMENTED",ke[ke.INTERNAL=13]="INTERNAL",ke[ke.UNAVAILABLE=14]="UNAVAILABLE",ke[ke.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Zu}static getOrCreateInstance(){return Zu===null&&(Zu=new ym),Zu}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let Zu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL=new Bs([4294967295,4294967295],0);function B_(i){const e=OL().encode(i),t=new UO;return t.update(e),new Uint8Array(t.digest())}function U_(i){const e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Bs([t,n],0),new Bs([r,s],0)]}class vm{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new co(`Invalid padding: ${t}`);if(n<0)throw new co(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new co(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new co(`Invalid padding when bitmap length is 0: ${t}`);this.de=8*e.length-t,this.Ae=Bs.fromNumber(this.de)}Re(e,t,n){let r=e.add(t.multiply(Bs.fromNumber(n)));return r.compare(LL)===1&&(r=new Bs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ae).toNumber()}Ve(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.de===0)return!1;const t=B_(e),[n,r]=U_(t);for(let s=0;s<this.hashCount;s++){const a=this.Re(n,r,s);if(!this.Ve(a))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new vm(s,r,t);return n.forEach(o=>a.insert(o)),a}insert(e){if(this.de===0)return;const t=B_(e),[n,r]=U_(t);for(let s=0;s<this.hashCount;s++){const a=this.Re(n,r,s);this.me(a)}}me(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class co extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,mu.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Zc(Te.min(),r,new ht(Me),pr(),Pe())}}class mu{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new mu(n,t,Pe(),Pe(),Pe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e,t,n,r){this.fe=e,this.removedTargetIds=t,this.key=n,this.ge=r}}class f2{constructor(e,t){this.targetId=e,this.pe=t}}class p2{constructor(e,t,n=Kt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class V_{constructor(){this.ye=0,this.we=$_(),this.Se=Kt.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return this.ye!==0}get Ce(){return this.De}Fe(e){e.approximateByteSize()>0&&(this.De=!0,this.Se=e)}Me(){let e=Pe(),t=Pe(),n=Pe();return this.we.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Ee()}}),new mu(this.Se,this.be,e,t,n)}xe(){this.De=!1,this.we=$_()}Oe(e,t){this.De=!0,this.we=this.we.insert(e,t)}Ne(e){this.De=!0,this.we=this.we.remove(e)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class NL{constructor(e){this.qe=e,this.Qe=new Map,this.Ke=pr(),this.$e=j_(),this.Ue=new ht(Me)}We(e){for(const t of e.fe)e.ge&&e.ge.isFoundDocument()?this.Ge(t,e.ge):this.ze(t,e.key,e.ge);for(const t of e.removedTargetIds)this.ze(t,e.key,e.ge)}je(e){this.forEachTarget(e,t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Fe(e.resumeToken);break;case 1:n.Le(),n.ve||n.xe(),n.Fe(e.resumeToken);break;case 2:n.Le(),n.ve||this.removeTarget(t);break;case 3:this.Je(t)&&(n.ke(),n.Fe(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Fe(e.resumeToken));break;default:Ee()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qe.forEach((n,r)=>{this.Je(r)&&t(r)})}Ze(e){var t,n;const r=e.targetId,s=e.pe.count,a=this.Xe(r);if(a){const o=a.target;if(gf(o))if(s===0){const u=new ce(o.path);this.ze(r,u,jt.newNoDocument(u,Te.min()))}else vt(s===1);else{const u=this.et(r);if(u!==s){const c=this.tt(e,u);if(c.status!==0){this.Ye(r);const h=c.status===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(r,h)}(t=ym.instance)===null||t===void 0||t.notifyOnExistenceFilterMismatch(function(g,y,T,v){var x,A,D,P,M,O;const R={localCacheCount:T,existenceFilterCount:v.count},$=v.unchangedNames;return $&&(R.bloomFilter={applied:g===0,hashCount:(x=$==null?void 0:$.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(P=(D=(A=$==null?void 0:$.bits)===null||A===void 0?void 0:A.bitmap)===null||D===void 0?void 0:D.length)!==null&&P!==void 0?P:0,padding:(O=(M=$==null?void 0:$.bits)===null||M===void 0?void 0:M.padding)!==null&&O!==void 0?O:0},y&&(R.bloomFilter.mightContain=y)),R}(c.status,(n=c.nt)!==null&&n!==void 0?n:null,u,e.pe))}}}}tt(e,t){const{unchangedNames:n,count:r}=e.pe;if(!n||!n.bits)return{status:1};const{bits:{bitmap:s="",padding:a=0},hashCount:o=0}=n;let u,c;try{u=Kr(s).toUint8Array()}catch(g){if(g instanceof zE)return sa("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw g}try{c=new vm(u,a,o)}catch(g){return sa(g instanceof co?"BloomFilter error: ":"Applying bloom filter failed: ",g),{status:1}}const h=g=>{const y=this.qe.rt();return c.mightContain(`projects/${y.projectId}/databases/${y.database}/documents/${g}`)};return c.de===0?{status:1}:{status:r===t-this.it(e.targetId,h)?0:2,nt:h}}it(e,t){const n=this.qe.getRemoteKeysForTarget(e);let r=0;return n.forEach(s=>{t(s.path.canonicalString())||(this.ze(e,s,null),r++)}),r}st(e){const t=new Map;this.Qe.forEach((s,a)=>{const o=this.Xe(a);if(o){if(s.current&&gf(o.target)){const u=new ce(o.target.path);this.Ke.get(u)!==null||this.ot(a,u)||this.ze(a,u,jt.newNoDocument(u,e))}s.Ce&&(t.set(a,s.Me()),s.xe())}});let n=Pe();this.$e.forEach((s,a)=>{let o=!0;a.forEachWhile(u=>{const c=this.Xe(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(n=n.add(s))}),this.Ke.forEach((s,a)=>a.setReadTime(e));const r=new Zc(e,t,this.Ue,this.Ke,n);return this.Ke=pr(),this.$e=j_(),this.Ue=new ht(Me),r}Ge(e,t){if(!this.Je(e))return;const n=this.ot(e,t.key)?2:0;this.He(e).Oe(t.key,n),this.Ke=this.Ke.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const r=this.He(e);this.ot(e,t)?r.Oe(t,1):r.Ne(t),this.$e=this.$e.insert(t,this._t(t).delete(e)),n&&(this.Ke=this.Ke.insert(t,n))}removeTarget(e){this.Qe.delete(e)}et(e){const t=this.He(e).Me();return this.qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Be(e){this.He(e).Be()}He(e){let t=this.Qe.get(e);return t||(t=new V_,this.Qe.set(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new Wt(Me),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||ae("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.Qe.get(e);return t&&t.ve?null:this.qe.ut(e)}Ye(e){this.Qe.set(e,new V_),this.qe.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ot(e,t){return this.qe.getRemoteKeysForTarget(e).has(t)}}function j_(){return new ht(ce.comparator)}function $_(){return new ht(ce.comparator)}const ML=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),FL=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),BL=(()=>({and:"AND",or:"OR"}))();class UL{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ef(i,e){return i.useProto3Json||Wc(e)?e:{value:e}}function Sf(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function m2(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function js(i){return vt(!!i),Te.fromTimestamp(function(t){const n=fr(t);return new Ct(n.seconds,n.nanos)}(i))}function g2(i,e){return function(n){return new nt(["projects",n.projectId,"databases",n.database])}(i).child("documents").child(e).canonicalString()}function _2(i){const e=nt.fromString(i);return vt(b2(e)),e}function ud(i,e){const t=_2(e);if(t.get(1)!==i.databaseId.projectId)throw new re(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new re(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new ce(y2(t))}function xf(i,e){return g2(i.databaseId,e)}function VL(i){const e=_2(i);return e.length===4?nt.emptyPath():y2(e)}function q_(i){return new nt(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function y2(i){return vt(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function jL(i,e){let t;if("targetChange"in e){e.targetChange;const n=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ee()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,h){return c.useProto3Json?(vt(h===void 0||typeof h=="string"),Kt.fromBase64String(h||"")):(vt(h===void 0||h instanceof Uint8Array),Kt.fromUint8Array(h||new Uint8Array))}(i,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(c){const h=c.code===void 0?G.UNKNOWN:d2(c.code);return new re(h,c.message||"")}(a);t=new p2(n,r,s,o||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=ud(i,n.document.name),s=js(n.document.updateTime),a=n.document.createTime?js(n.document.createTime):Te.min(),o=new dn({mapValue:{fields:n.document.fields}}),u=jt.newFoundDocument(r,s,a,o),c=n.targetIds||[],h=n.removedTargetIds||[];t=new hl(c,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=ud(i,n.document),s=n.readTime?js(n.readTime):Te.min(),a=jt.newNoDocument(r,s),o=n.removedTargetIds||[];t=new hl([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=ud(i,n.document),s=n.removedTargetIds||[];t=new hl([],s,r,null)}else{if(!("filter"in e))return Ee();{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:s}=n,a=new RL(r,s),o=n.targetId;t=new f2(o,a)}}return t}function $L(i,e){return{documents:[xf(i,e.path)]}}function qL(i,e){const t={structuredQuery:{}},n=e.path;e.collectionGroup!==null?(t.parent=xf(i,n),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=xf(i,n.popLast()),t.structuredQuery.from=[{collectionId:n.lastSegment()}]);const r=function(u){if(u.length!==0)return T2(Ji.create(u,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(u){if(u.length!==0)return u.map(c=>function(g){return{field:Es(g.field),direction:zL(g.dir)}}(c))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=Ef(i,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),t}function HL(i){let e=VL(i.parent);const t=i.structuredQuery,n=t.from?t.from.length:0;let r=null;if(n>0){vt(n===1);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(g){const y=v2(g);return y instanceof Ji&&XE(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=function(g){return g.map(y=>function(v){return new Us(Ss(v.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(y))}(t.orderBy));let o=null;t.limit&&(o=function(g){let y;return y=typeof g=="object"?g.value:g,Wc(y)?null:y}(t.limit));let u=null;t.startAt&&(u=function(g){const y=!!g.before,T=g.values||[];return new nc(T,y)}(t.startAt));let c=null;return t.endAt&&(c=function(g){const y=!g.before,T=g.values||[];return new nc(T,y)}(t.endAt)),mL(e,r,a,s,o,"F",u,c)}function GL(i,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ee()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function v2(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Ss(t.unaryFilter.field);return gt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=Ss(t.unaryFilter.field);return gt.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ss(t.unaryFilter.field);return gt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ss(t.unaryFilter.field);return gt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return Ee()}}(i):i.fieldFilter!==void 0?function(t){return gt.create(Ss(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ee()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return Ji.create(t.compositeFilter.filters.map(n=>v2(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ee()}}(t.compositeFilter.op))}(i):Ee()}function zL(i){return ML[i]}function WL(i){return FL[i]}function KL(i){return BL[i]}function Es(i){return{fieldPath:i.canonicalString()}}function Ss(i){return oi.fromServerFormat(i.fieldPath)}function T2(i){return i instanceof gt?function(t){if(t.op==="=="){if(I_(t.value))return{unaryFilter:{field:Es(t.field),op:"IS_NAN"}};if(D_(t.value))return{unaryFilter:{field:Es(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(I_(t.value))return{unaryFilter:{field:Es(t.field),op:"IS_NOT_NAN"}};if(D_(t.value))return{unaryFilter:{field:Es(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Es(t.field),op:WL(t.op),value:t.value}}}(i):i instanceof Ji?function(t){const n=t.getFilters().map(r=>T2(r));return n.length===1?n[0]:{compositeFilter:{op:KL(t.op),filters:n}}}(i):Ee()}function b2(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e,t,n,r,s=Te.min(),a=Te.min(),o=Kt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=u}withSequenceNumber(e){return new sr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new sr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new sr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new sr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e){this.ct=e}}function YL(i){const e=HL({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?yf(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QL{constructor(){this.sn=new JL}addToCollectionParentIndex(e,t){return this.sn.add(t),H.resolve()}getCollectionParents(e,t){return H.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return H.resolve()}deleteFieldIndex(e,t){return H.resolve()}getDocumentsMatchingTarget(e,t){return H.resolve(null)}getIndexType(e,t){return H.resolve(0)}getFieldIndexes(e,t){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,t){return H.resolve(dr.min())}getMinOffsetFromCollectionGroup(e,t){return H.resolve(dr.min())}updateCollectionGroup(e,t,n){return H.resolve()}updateIndexEntries(e,t){return H.resolve()}}class JL{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Wt(nt.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Wt(nt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new la(0)}static On(){return new la(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(){this.changes=new wa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,jt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?H.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(n!==null&&bo(n.mutation,r,rr.empty(),Ct.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Pe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Pe()){const r=Mr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(s=>{let a=lo();return s.forEach((o,u)=>{a=a.insert(o,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=Mr();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Pe()))}populateOverlays(e,t,n){const r=[];return n.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,n,r){let s=pr();const a=To(),o=function(){return To()}();return t.forEach((u,c)=>{const h=n.get(c.key);r.has(c.key)&&(h===void 0||h.mutation instanceof Jc)?s=s.insert(c.key,c):h!==void 0?(a.set(c.key,h.mutation.getFieldMask()),bo(h.mutation,c,h.mutation.getFieldMask(),Ct.now())):a.set(c.key,rr.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,h)=>a.set(c,h)),t.forEach((c,h)=>{var g;return o.set(c,new eN(h,(g=a.get(c))!==null&&g!==void 0?g:null))}),o))}recalculateAndSaveOverlays(e,t){const n=To();let r=new ht((a,o)=>a-o),s=Pe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(u=>{const c=t.get(u);if(c===null)return;let h=n.get(u)||rr.empty();h=o.applyToLocalView(c,h),n.set(u,h);const g=(r.get(o.batchId)||Pe()).add(u);r=r.insert(o.batchId,g)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const u=o.getNext(),c=u.key,h=u.value,g=r2();h.forEach(y=>{if(!s.has(y)){const T=c2(t.get(y),n.get(y));T!==null&&g.set(y,T),s=s.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,c,g))}return H.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n){return function(s){return ce.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):e2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{const a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):H.resolve(Mr());let o=-1,u=s;return a.next(c=>H.forEach(c,(h,g)=>(o<g.largestBatchId&&(o=g.largestBatchId),s.get(h)?H.resolve():this.remoteDocumentCache.getEntry(e,h).next(y=>{u=u.insert(h,y)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,Pe())).next(h=>({batchId:o,changes:vL(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ce(t)).next(n=>{let r=lo();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let s=lo();return this.indexManager.getCollectionParents(e,r).next(a=>H.forEach(a,o=>{const u=function(h,g){return new Ca(g,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,o.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,n).next(c=>{c.forEach((h,g)=>{s=s.insert(h,g)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r))).next(s=>{r.forEach((o,u)=>{const c=u.getKey();s.get(c)===null&&(s=s.insert(c,jt.newInvalidDocument(c)))});let a=lo();return s.forEach((o,u)=>{const c=r.get(o);c!==void 0&&bo(c.mutation,u,rr.empty(),Ct.now()),Yc(t,u)&&(a=a.insert(o,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return H.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,function(r){return{id:r.id,version:r.version,createTime:js(r.createTime)}}(t)),H.resolve()}getNamedQuery(e,t){return H.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,function(r){return{name:r.name,query:YL(r.bundledQuery),readTime:js(r.readTime)}}(t)),H.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(){this.overlays=new ht(ce.comparator),this.cr=new Map}getOverlay(e,t){return H.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Mr();return H.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&n.set(r,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((r,s)=>{this.ht(e,t,s)}),H.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.cr.get(n);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.cr.delete(n)),H.resolve()}getOverlaysForCollection(e,t,n){const r=Mr(),s=t.length+1,a=new ce(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const u=o.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>n&&r.set(u.getKey(),u)}return H.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new ht((c,h)=>c-h);const a=this.overlays.getIterator();for(;a.hasNext();){const c=a.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>n){let h=s.get(c.largestBatchId);h===null&&(h=Mr(),s=s.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const o=Mr(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,h)=>o.set(c,h)),!(o.size()>=r)););return H.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(r!==null){const a=this.cr.get(r.largestBatchId).delete(n.key);this.cr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new PL(t,n));let s=this.cr.get(t);s===void 0&&(s=Pe(),this.cr.set(t,s)),this.cr.set(t,s.add(n.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(){this.lr=new Wt(Et.hr),this.Pr=new Wt(Et.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){const n=new Et(e,t);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Er(new Et(e,t))}dr(e,t){e.forEach(n=>this.removeReference(n,t))}Ar(e){const t=new ce(new nt([])),n=new Et(t,e),r=new Et(t,e+1),s=[];return this.Pr.forEachInRange([n,r],a=>{this.Er(a),s.push(a.key)}),s}Rr(){this.lr.forEach(e=>this.Er(e))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){const t=new ce(new nt([])),n=new Et(t,e),r=new Et(t,e+1);let s=Pe();return this.Pr.forEachInRange([n,r],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Et(e,0),n=this.lr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Et{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return ce.comparator(e.key,t.key)||Me(e.mr,t.mr)}static Ir(e,t){return Me(e.mr,t.mr)||ce.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new Wt(Et.hr)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){const s=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new kL(s,t,n,r);this.mutationQueue.push(a);for(const o of r)this.pr=this.pr.add(new Et(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return H.resolve(a)}lookupMutationBatch(e,t){return H.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.wr(n),s=r<0?0:r;return H.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?-1:this.gr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Et(t,0),r=new Et(t,Number.POSITIVE_INFINITY),s=[];return this.pr.forEachInRange([n,r],a=>{const o=this.yr(a.mr);s.push(o)}),H.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Wt(Me);return t.forEach(r=>{const s=new Et(r,0),a=new Et(r,Number.POSITIVE_INFINITY);this.pr.forEachInRange([s,a],o=>{n=n.add(o.mr)})}),H.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;ce.isDocumentKey(s)||(s=s.child(""));const a=new Et(new ce(s),0);let o=new Wt(Me);return this.pr.forEachWhile(u=>{const c=u.key.path;return!!n.isPrefixOf(c)&&(c.length===r&&(o=o.add(u.mr)),!0)},a),H.resolve(this.Sr(o))}Sr(e){const t=[];return e.forEach(n=>{const r=this.yr(n);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){vt(this.br(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.pr;return H.forEach(t.mutations,r=>{const s=new Et(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.pr=n})}Cn(e){}containsKey(e,t){const n=new Et(t,0),r=this.pr.firstAfterOrEqual(n);return H.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}br(e,t){return this.wr(e)}wr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}yr(e){const t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(e){this.Dr=e,this.docs=function(){return new ht(ce.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,a=this.Dr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return H.resolve(n?n.document.mutableCopy():jt.newInvalidDocument(t))}getEntries(e,t){let n=pr();return t.forEach(r=>{const s=this.docs.get(r);n=n.insert(r,s?s.document.mutableCopy():jt.newInvalidDocument(r))}),H.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=pr();const a=t.path,o=new ce(a.child("")),u=this.docs.getIteratorFrom(o);for(;u.hasNext();){const{key:c,value:{document:h}}=u.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||JO(QO(h),n)<=0||(r.has(h.key)||Yc(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return H.resolve(s)}getAllFromCollectionGroup(e,t,n,r){Ee()}vr(e,t){return H.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new aN(this)}getSize(e){return H.resolve(this.size)}}class aN extends ZL{constructor(e){super(),this.sr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.sr.addEntry(e,r)):this.sr.removeEntry(n)}),H.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oN{constructor(e){this.persistence=e,this.Cr=new wa(t=>fm(t),pm),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new Tm,this.targetCount=0,this.Or=la.xn()}forEachTarget(e,t){return this.Cr.forEach((n,r)=>t(r)),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Fr&&(this.Fr=t),H.resolve()}Ln(e){this.Cr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Or=new la(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,H.resolve()}updateTargetData(e,t){return this.Ln(t),H.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,H.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.Cr.forEach((a,o)=>{o.sequenceNumber<=t&&n.get(o.targetId)===null&&(this.Cr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),H.waitFor(s).next(()=>r)}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,t){const n=this.Cr.get(t)||null;return H.resolve(n)}addMatchingKeys(e,t,n){return this.Mr.Tr(t,n),H.resolve()}removeMatchingKeys(e,t,n){this.Mr.dr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(a=>{s.push(r.markPotentiallyOrphaned(e,a))}),H.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),H.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Mr.Vr(t);return H.resolve(n)}containsKey(e,t){return H.resolve(this.Mr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{constructor(e,t){this.Nr={},this.overlays={},this.Br=new lm(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new oN(this),this.indexManager=new QL,this.remoteDocumentCache=function(r){return new sN(r)}(n=>this.referenceDelegate.qr(n)),this.serializer=new XL(t),this.Qr=new iN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nN,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Nr[e.toKey()];return n||(n=new rN(t,this.referenceDelegate),this.Nr[e.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,n){ae("MemoryPersistence","Starting transaction:",e);const r=new lN(this.Br.next());return this.referenceDelegate.Kr(),n(r).next(s=>this.referenceDelegate.$r(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ur(e,t){return H.or(Object.values(this.Nr).map(n=>()=>n.containsKey(e,t)))}}class lN extends eL{constructor(e){super(),this.currentSequenceNumber=e}}class bm{constructor(e){this.persistence=e,this.Wr=new Tm,this.Gr=null}static zr(e){return new bm(e)}get jr(){if(this.Gr)return this.Gr;throw Ee()}addReference(e,t,n){return this.Wr.addReference(n,t),this.jr.delete(n.toString()),H.resolve()}removeReference(e,t,n){return this.Wr.removeReference(n,t),this.jr.add(n.toString()),H.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),H.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach(r=>this.jr.add(r.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Kr(){this.Gr=new Set}$r(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.jr,n=>{const r=ce.fromPath(n);return this.Hr(e,r).next(s=>{s||t.removeEntry(r,Te.min())})}).next(()=>(this.Gr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hr(e,t).next(n=>{n?this.jr.delete(t.toString()):this.jr.add(t.toString())})}qr(e){return 0}Hr(e,t){return H.or([()=>H.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Li=n,this.ki=r}static qi(e,t){let n=Pe(),r=Pe();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Em(e,t.fromCache,n,r)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.$i(e,t).next(s=>s||this.Ui(e,t,r,n)).next(s=>s||this.Wi(e,t))}$i(e,t){if(O_(t))return H.resolve(null);let n=Gn(t);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=yf(t,null,"F"),n=Gn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=Pe(...s);return this.Ki.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,n).next(u=>{const c=this.Gi(t,o);return this.zi(t,c,a,u.readTime)?this.$i(e,yf(t,null,"F")):this.ji(e,c,t,u)}))})))}Ui(e,t,n,r){return O_(t)||r.isEqual(Te.min())?this.Wi(e,t):this.Ki.getDocuments(e,n).next(s=>{const a=this.Gi(t,s);return this.zi(t,a,n,r)?this.Wi(e,t):(S_()<=Ne.DEBUG&&ae("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vf(t)),this.ji(e,a,t,YO(r,-1)))})}Gi(e,t){let n=new Wt(i2(e));return t.forEach((r,s)=>{Yc(e,s)&&(n=n.add(s))}),n}zi(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Wi(e,t){return S_()<=Ne.DEBUG&&ae("QueryEngine","Using full collection scan to execute query:",vf(t)),this.Ki.getDocumentsMatchingQuery(e,t,dr.min())}ji(e,t,n,r){return this.Ki.getDocumentsMatchingQuery(e,n,r).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new ht(Me),this.Yi=new wa(s=>fm(s),pm),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(n)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tN(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function dN(i,e,t,n){return new hN(i,e,t,n)}async function E2(i,e){const t=Re(i);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next(s=>(r=s,t.es(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],o=[];let u=Pe();for(const c of r){a.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}for(const c of s){o.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(n,u).next(c=>({ts:c,removedBatchIds:a,addedBatchIds:o}))})})}function S2(i){const e=Re(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.kr.getLastRemoteSnapshotVersion(t))}function fN(i,e){const t=Re(i),n=e.snapshotVersion;let r=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Xi.newChangeBuffer({trackRemovals:!0});r=t.Ji;const o=[];e.targetChanges.forEach((h,g)=>{const y=r.get(g);if(!y)return;o.push(t.kr.removeMatchingKeys(s,h.removedDocuments,g).next(()=>t.kr.addMatchingKeys(s,h.addedDocuments,g)));let T=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?T=T.withResumeToken(Kt.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):h.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(h.resumeToken,n)),r=r.insert(g,T),function(x,A,D){return x.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(y,T,h)&&o.push(t.kr.updateTargetData(s,T))});let u=pr(),c=Pe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),o.push(pN(s,a,e.documentUpdates).next(h=>{u=h.ns,c=h.rs})),!n.isEqual(Te.min())){const h=t.kr.getLastRemoteSnapshotVersion(s).next(g=>t.kr.setTargetsMetadata(s,s.currentSequenceNumber,n));o.push(h)}return H.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.Ji=r,s))}function pN(i,e,t){let n=Pe(),r=Pe();return t.forEach(s=>n=n.add(s)),e.getEntries(i,n).next(s=>{let a=pr();return t.forEach((o,u)=>{const c=s.get(o);u.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(o)),u.isNoDocument()&&u.version.isEqual(Te.min())?(e.removeEntry(o,u.readTime),a=a.insert(o,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),a=a.insert(o,u)):ae("LocalStore","Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",u.version)}),{ns:a,rs:r}})}function mN(i,e){const t=Re(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return t.kr.getTargetData(n,e).next(s=>s?(r=s,H.resolve(r)):t.kr.allocateTargetId(n).next(a=>(r=new sr(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.kr.addTargetData(n,r).next(()=>r))))}).then(n=>{const r=t.Ji.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(n.targetId,n),t.Yi.set(e,n.targetId)),n})}async function Cf(i,e,t){const n=Re(i),r=n.Ji.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!fu(a))throw a;ae("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ji=n.Ji.remove(e),n.Yi.delete(r.target)}function H_(i,e,t){const n=Re(i);let r=Te.min(),s=Pe();return n.persistence.runTransaction("Execute query","readonly",a=>function(u,c,h){const g=Re(u),y=g.Yi.get(h);return y!==void 0?H.resolve(g.Ji.get(y)):g.kr.getTargetData(c,h)}(n,a,Gn(e)).next(o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,n.kr.getMatchingKeysForTargetId(a,o.targetId).next(u=>{s=u})}).next(()=>n.Hi.getDocumentsMatchingQuery(a,e,t?r:Te.min(),t?s:Pe())).next(o=>(gN(n,gL(e),o),{documents:o,ss:s})))}function gN(i,e,t){let n=i.Zi.get(e)||Te.min();t.forEach((r,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),i.Zi.set(e,n)}class G_{constructor(){this.activeTargetIds=EL()}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _N{constructor(){this.Hs=new G_,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,n){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new G_,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{Ys(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z_{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){ae("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ro)e(0)}no(){ae("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ro)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let el=null;function ld(){return el===null?el=function(){return 268435456+Math.round(2147483648*Math.random())}():el++,"0x"+el.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft="WebChannelConnection";class bN extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.To=n+"://"+t.host,this.Eo=`projects/${r}/databases/${s}`,this.Ao=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Ro(){return!1}Vo(t,n,r,s,a){const o=ld(),u=this.mo(t,n);ae("RestConnection",`Sending RPC '${t}' ${o}:`,u,r);const c={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(c,s,a),this.po(t,u,c,r).then(h=>(ae("RestConnection",`Received RPC '${t}' ${o}: `,h),h),h=>{throw sa("RestConnection",`RPC '${t}' ${o} failed with error: `,h,"url: ",u,"request:",r),h})}yo(t,n,r,s,a,o){return this.Vo(t,n,r,s,a)}fo(t,n,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+xa}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),r&&r.headers.forEach((s,a)=>t[a]=s)}mo(t,n){const r=vN[t];return`${this.To}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}po(e,t,n,r){const s=ld();return new Promise((a,o)=>{const u=new BO;u.setWithCredentials(!0),u.listenOnce(NO.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case ad.NO_ERROR:const h=u.getResponseJson();ae(Ft,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),a(h);break;case ad.TIMEOUT:ae(Ft,`RPC '${e}' ${s} timed out`),o(new re(G.DEADLINE_EXCEEDED,"Request time out"));break;case ad.HTTP_ERROR:const g=u.getStatus();if(ae(Ft,`RPC '${e}' ${s} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const T=y==null?void 0:y.error;if(T&&T.status&&T.message){const v=function(A){const D=A.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(D)>=0?D:G.UNKNOWN}(T.status);o(new re(v,T.message))}else o(new re(G.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new re(G.UNAVAILABLE,"Connection failed."));break;default:Ee()}}finally{ae(Ft,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(r);ae(Ft,`RPC '${e}' ${s} sending request:`,r),u.send(t,"POST",c,n,15)})}wo(e,t,n){const r=ld(),s=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=OO(),o=LO(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new FO({})),this.fo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const h=s.join("");ae(Ft,`Creating RPC '${e}' stream ${r}: ${h}`,u);const g=a.createWebChannel(h,u);let y=!1,T=!1;const v=new TN({so:A=>{T?ae(Ft,`Not sending because RPC '${e}' stream ${r} is closed:`,A):(y||(ae(Ft,`Opening RPC '${e}' stream ${r} transport.`),g.open(),y=!0),ae(Ft,`RPC '${e}' stream ${r} sending:`,A),g.send(A))},oo:()=>g.close()}),x=(A,D,P)=>{A.listen(D,M=>{try{P(M)}catch(O){setTimeout(()=>{throw O},0)}})};return x(g,Yu.EventType.OPEN,()=>{T||ae(Ft,`RPC '${e}' stream ${r} transport opened.`)}),x(g,Yu.EventType.CLOSE,()=>{T||(T=!0,ae(Ft,`RPC '${e}' stream ${r} transport closed`),v.Po())}),x(g,Yu.EventType.ERROR,A=>{T||(T=!0,sa(Ft,`RPC '${e}' stream ${r} transport errored:`,A),v.Po(new re(G.UNAVAILABLE,"The operation could not be completed")))}),x(g,Yu.EventType.MESSAGE,A=>{var D;if(!T){const P=A.data[0];vt(!!P);const M=P,O=M.error||((D=M[0])===null||D===void 0?void 0:D.error);if(O){ae(Ft,`RPC '${e}' stream ${r} received error:`,O);const R=O.status;let $=function(Z){const he=ft[Z];if(he!==void 0)return d2(he)}(R),V=O.message;$===void 0&&($=G.INTERNAL,V="Unknown error status: "+R+" with message "+O.message),T=!0,v.Po(new re($,V)),g.close()}else ae(Ft,`RPC '${e}' stream ${r} received:`,P),v.Io(P)}}),x(o,MO.STAT_EVENT,A=>{A.stat===b_.PROXY?ae(Ft,`RPC '${e}' stream ${r} detected buffering proxy`):A.stat===b_.NOPROXY&&ae(Ft,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.ho()},0),v}}function cd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eh(i){return new UL(i,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{constructor(e,t,n=1e3,r=1.5,s=6e4){this.ii=e,this.timerId=t,this.So=n,this.bo=r,this.Do=s,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(e){this.cancel();const t=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),r=Math.max(0,t-n);r>0&&ae("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.vo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,r,()=>(this.Fo=Date.now(),e())),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){this.Co!==null&&(this.Co.skipDelay(),this.Co=null)}cancel(){this.Co!==null&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,t,n,r,s,a,o,u){this.ii=e,this.Bo=n,this.Lo=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new x2(e,t)}$o(){return this.state===1||this.state===5||this.Uo()}Uo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&this.qo===null&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,()=>this.jo()))}Ho(e){this.Jo(),this.stream.send(e)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(e,t){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,e!==4?this.Ko.reset():t&&t.code===G.RESOURCE_EXHAUSTED?(Hn(t.toString()),Hn("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):t&&t.code===G.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Zo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.uo(t)}Zo(){}auth(){this.state=1;const e=this.Xo(this.ko),t=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.ko===t&&this.e_(n,r)},n=>{e(()=>{const r=new re(G.UNKNOWN,"Fetching auth token failed: "+n.message);return this.t_(r)})})}e_(e,t){const n=this.Xo(this.ko);this.stream=this.n_(e,t),this.stream._o(()=>{n(()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,()=>(this.Uo()&&(this.state=3),Promise.resolve())),this.listener._o()))}),this.stream.uo(r=>{n(()=>this.t_(r))}),this.stream.onMessage(r=>{n(()=>this.onMessage(r))})}Wo(){this.state=5,this.Ko.xo(async()=>{this.state=0,this.start()})}t_(e){return ae("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.ko===e?t():(ae("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class SN extends EN{constructor(e,t,n,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,a),this.serializer=s}n_(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Ko.reset();const t=jL(this.serializer,e),n=function(s){if(!("targetChange"in s))return Te.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?Te.min():a.readTime?js(a.readTime):Te.min()}(e);return this.listener.r_(t,n)}i_(e){const t={};t.database=q_(this.serializer),t.addTarget=function(s,a){let o;const u=a.target;if(o=gf(u)?{documents:$L(s,u)}:{query:qL(s,u)},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=m2(s,a.resumeToken);const c=Ef(s,a.expectedCount);c!==null&&(o.expectedCount=c)}else if(a.snapshotVersion.compareTo(Te.min())>0){o.readTime=Sf(s,a.snapshotVersion.toTimestamp());const c=Ef(s,a.expectedCount);c!==null&&(o.expectedCount=c)}return o}(this.serializer,e);const n=GL(this.serializer,e);n&&(t.labels=n),this.Ho(t)}s_(e){const t={};t.database=q_(this.serializer),t.removeTarget=e,this.Ho(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.h_=!1}P_(){if(this.h_)throw new re(G.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(e,t,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Vo(e,t,n,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new re(G.UNKNOWN,r.toString())})}yo(e,t,n,r){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.yo(e,t,n,s,a,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new re(G.UNKNOWN,s.toString())})}terminate(){this.h_=!0}}class CN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){this.T_===0&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve())))}m_(e){this.state==="Online"?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.R_("Offline")))}set(e){this.f_(),this.T_=0,e==="Online"&&(this.d_=!1),this.R_(e)}R_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}V_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(Hn(t),this.d_=!1):ae("OnlineStateTracker",t)}f_(){this.E_!==null&&(this.E_.cancel(),this.E_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=s,this.S_.Ys(a=>{n.enqueueAndForget(async()=>{_u(this)&&(ae("RemoteStore","Restarting streams for network reachability change."),await async function(u){const c=Re(u);c.y_.add(4),await gu(c),c.b_.set("Unknown"),c.y_.delete(4),await th(c)}(this))})}),this.b_=new CN(n,r)}}async function th(i){if(_u(i))for(const e of i.w_)await e(!0)}async function gu(i){for(const e of i.w_)await e(!1)}function C2(i,e){const t=Re(i);t.p_.has(e.targetId)||(t.p_.set(e.targetId,e),Cm(t)?xm(t):Aa(t).Uo()&&Sm(t,e))}function w2(i,e){const t=Re(i),n=Aa(t);t.p_.delete(e),n.Uo()&&A2(t,e),t.p_.size===0&&(n.Uo()?n.zo():_u(t)&&t.b_.set("Unknown"))}function Sm(i,e){if(i.D_.Be(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){const t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Aa(i).i_(e)}function A2(i,e){i.D_.Be(e),Aa(i).s_(e)}function xm(i){i.D_=new NL({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>i.p_.get(e)||null,rt:()=>i.datastore.serializer.databaseId}),Aa(i).start(),i.b_.A_()}function Cm(i){return _u(i)&&!Aa(i).$o()&&i.p_.size>0}function _u(i){return Re(i).y_.size===0}function D2(i){i.D_=void 0}async function AN(i){i.p_.forEach((e,t)=>{Sm(i,e)})}async function DN(i,e){D2(i),Cm(i)?(i.b_.m_(e),xm(i)):i.b_.set("Unknown")}async function IN(i,e,t){if(i.b_.set("Online"),e instanceof p2&&e.state===2&&e.cause)try{await async function(r,s){const a=s.cause;for(const o of s.targetIds)r.p_.has(o)&&(await r.remoteSyncer.rejectListen(o,a),r.p_.delete(o),r.D_.removeTarget(o))}(i,e)}catch(n){ae("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await W_(i,n)}else if(e instanceof hl?i.D_.We(e):e instanceof f2?i.D_.Ze(e):i.D_.je(e),!t.isEqual(Te.min()))try{const n=await S2(i.localStore);t.compareTo(n)>=0&&await function(s,a){const o=s.D_.st(a);return o.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const h=s.p_.get(c);h&&s.p_.set(c,h.withResumeToken(u.resumeToken,a))}}),o.targetMismatches.forEach((u,c)=>{const h=s.p_.get(u);if(!h)return;s.p_.set(u,h.withResumeToken(Kt.EMPTY_BYTE_STRING,h.snapshotVersion)),A2(s,u);const g=new sr(h.target,u,c,h.sequenceNumber);Sm(s,g)}),s.remoteSyncer.applyRemoteEvent(o)}(i,t)}catch(n){ae("RemoteStore","Failed to raise snapshot:",n),await W_(i,n)}}async function W_(i,e,t){if(!fu(e))throw e;i.y_.add(1),await gu(i),i.b_.set("Offline"),t||(t=()=>S2(i.localStore)),i.asyncQueue.enqueueRetryable(async()=>{ae("RemoteStore","Retrying IndexedDB access"),await t(),i.y_.delete(1),await th(i)})}async function K_(i,e){const t=Re(i);t.asyncQueue.verifyOperationInProgress(),ae("RemoteStore","RemoteStore received new credentials");const n=_u(t);t.y_.add(3),await gu(t),n&&t.b_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.y_.delete(3),await th(t)}async function kN(i,e){const t=Re(i);e?(t.y_.delete(2),await th(t)):e||(t.y_.add(2),await gu(t),t.b_.set("Unknown"))}function Aa(i){return i.v_||(i.v_=function(t,n,r){const s=Re(t);return s.P_(),new SN(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(i.datastore,i.asyncQueue,{_o:AN.bind(null,i),uo:DN.bind(null,i),r_:IN.bind(null,i)}),i.w_.push(async e=>{e?(i.v_.Go(),Cm(i)?xm(i):i.b_.set("Unknown")):(await i.v_.stop(),D2(i))})),i.v_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new jr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}static createAndSchedule(e,t,n,r,s){const a=Date.now()+n,o=new wm(e,t,a,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new re(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function I2(i,e){if(Hn("AsyncQueue",`${e}: ${i}`),fu(i))return new re(G.UNAVAILABLE,`${e}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ce.comparator(t.key,n.key):(t,n)=>ce.comparator(t.key,n.key),this.keyedMap=lo(),this.sortedSet=new ht(this.comparator)}static emptySet(e){return new $s(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $s)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new $s;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(){this.F_=new ht(ce.comparator)}track(e){const t=e.doc.key,n=this.F_.get(t);n?e.type!==0&&n.type===3?this.F_=this.F_.insert(t,e):e.type===3&&n.type!==1?this.F_=this.F_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.F_=this.F_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.F_=this.F_.remove(t):e.type===1&&n.type===2?this.F_=this.F_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):Ee():this.F_=this.F_.insert(t,e)}M_(){const e=[];return this.F_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ca{constructor(e,t,n,r,s,a,o,u,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new ca(e,t,$s.emptySet(t),a,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{constructor(){this.x_=void 0,this.listeners=[]}}class RN{constructor(){this.queries=new wa(e=>t2(e),Xc),this.onlineState="Unknown",this.O_=new Set}}async function ON(i,e){const t=Re(i),n=e.query;let r=!1,s=t.queries.get(n);if(s||(r=!0,s=new PN),r)try{s.x_=await t.onListen(n)}catch(a){const o=I2(a,`Initialization of query '${vf(e.query)}' failed`);return void e.onError(o)}t.queries.set(n,s),s.listeners.push(e),e.N_(t.onlineState),s.x_&&e.B_(s.x_)&&Am(t)}async function LN(i,e){const t=Re(i),n=e.query;let r=!1;const s=t.queries.get(n);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),r=s.listeners.length===0)}if(r)return t.queries.delete(n),t.onUnlisten(n)}function NN(i,e){const t=Re(i);let n=!1;for(const r of e){const s=r.query,a=t.queries.get(s);if(a){for(const o of a.listeners)o.B_(r)&&(n=!0);a.x_=r}}n&&Am(t)}function MN(i,e,t){const n=Re(i),r=n.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);n.queries.delete(e)}function Am(i){i.O_.forEach(e=>{e.next()})}class FN{constructor(e,t,n){this.query=e,this.L_=t,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=n||{}}B_(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new ca(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.k_?this.Q_(e)&&(this.L_.next(e),t=!0):this.K_(e,this.onlineState)&&(this.U_(e),t=!0),this.q_=e,t}onError(e){this.L_.error(e)}N_(e){this.onlineState=e;let t=!1;return this.q_&&!this.k_&&this.K_(this.q_,e)&&(this.U_(this.q_),t=!0),t}K_(e,t){if(!e.fromCache)return!0;const n=t!=="Offline";return(!this.options.W_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Q_(e){if(e.docChanges.length>0)return!0;const t=this.q_&&this.q_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}U_(e){e=ca.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.k_=!0,this.L_.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{constructor(e){this.key=e}}class P2{constructor(e){this.key=e}}class BN{constructor(e,t){this.query=e,this.X_=t,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=Pe(),this.mutatedKeys=Pe(),this.na=i2(e),this.ra=new $s(this.na)}get ia(){return this.X_}sa(e,t){const n=t?t.oa:new X_,r=t?t.ra:this.ra;let s=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((h,g)=>{const y=r.get(h),T=Yc(this.query,g)?g:null,v=!!y&&this.mutatedKeys.has(y.key),x=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let A=!1;y&&T?y.data.isEqual(T.data)?v!==x&&(n.track({type:3,doc:T}),A=!0):this._a(y,T)||(n.track({type:2,doc:T}),A=!0,(u&&this.na(T,u)>0||c&&this.na(T,c)<0)&&(o=!0)):!y&&T?(n.track({type:0,doc:T}),A=!0):y&&!T&&(n.track({type:1,doc:y}),A=!0,(u||c)&&(o=!0)),A&&(T?(a=a.add(T),s=x?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),s=s.delete(h.key),n.track({type:1,doc:h})}return{ra:a,oa:n,zi:o,mutatedKeys:s}}_a(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ra;this.ra=e.ra,this.mutatedKeys=e.mutatedKeys;const s=e.oa.M_();s.sort((c,h)=>function(y,T){const v=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ee()}};return v(y)-v(T)}(c.type,h.type)||this.na(c.doc,h.doc)),this.aa(n);const a=t?this.ua():[],o=this.ta.size===0&&this.current?1:0,u=o!==this.ea;return this.ea=o,s.length!==0||u?{snapshot:new ca(this.query,e.ra,r,s,e.mutatedKeys,o===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),ca:a}:{ca:a}}N_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ra:this.ra,oa:new X_,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(e){return!this.X_.has(e)&&!!this.ra.has(e)&&!this.ra.get(e).hasLocalMutations}aa(e){e&&(e.addedDocuments.forEach(t=>this.X_=this.X_.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.X_=this.X_.delete(t)),this.current=e.current)}ua(){if(!this.current)return[];const e=this.ta;this.ta=Pe(),this.ra.forEach(n=>{this.la(n.key)&&(this.ta=this.ta.add(n.key))});const t=[];return e.forEach(n=>{this.ta.has(n)||t.push(new P2(n))}),this.ta.forEach(n=>{e.has(n)||t.push(new k2(n))}),t}ha(e){this.X_=e.ss,this.ta=Pe();const t=this.sa(e.documents);return this.applyChanges(t,!0)}Pa(){return ca.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,this.ea===0,this.hasCachedResults)}}class UN{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class VN{constructor(e){this.key=e,this.Ia=!1}}class jN{constructor(e,t,n,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ta={},this.Ea=new wa(o=>t2(o),Xc),this.da=new Map,this.Aa=new Set,this.Ra=new ht(ce.comparator),this.Va=new Map,this.ma=new Tm,this.fa={},this.ga=new Map,this.pa=la.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return this.ya===!0}}async function $N(i,e){const t=XN(i);let n,r;const s=t.Ea.get(e);if(s)n=s.targetId,t.sharedClientState.addLocalQueryTarget(n),r=s.view.Pa();else{const a=await mN(t.localStore,Gn(e)),o=t.sharedClientState.addLocalQueryTarget(a.targetId);n=a.targetId,r=await qN(t,e,n,o==="current",a.resumeToken),t.isPrimaryClient&&C2(t.remoteStore,a)}return r}async function qN(i,e,t,n,r){i.wa=(g,y,T)=>async function(x,A,D,P){let M=A.view.sa(D);M.zi&&(M=await H_(x.localStore,A.query,!1).then(({documents:$})=>A.view.sa($,M)));const O=P&&P.targetChanges.get(A.targetId),R=A.view.applyChanges(M,x.isPrimaryClient,O);return Q_(x,A.targetId,R.ca),R.snapshot}(i,g,y,T);const s=await H_(i.localStore,e,!0),a=new BN(e,s.ss),o=a.sa(s.documents),u=mu.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",r),c=a.applyChanges(o,i.isPrimaryClient,u);Q_(i,t,c.ca);const h=new UN(e,t,a);return i.Ea.set(e,h),i.da.has(t)?i.da.get(t).push(e):i.da.set(t,[e]),c.snapshot}async function HN(i,e){const t=Re(i),n=t.Ea.get(e),r=t.da.get(n.targetId);if(r.length>1)return t.da.set(n.targetId,r.filter(s=>!Xc(s,e))),void t.Ea.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(n.targetId),t.sharedClientState.isActiveQueryTarget(n.targetId)||await Cf(t.localStore,n.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(n.targetId),w2(t.remoteStore,n.targetId),wf(t,n.targetId)}).catch(um)):(wf(t,n.targetId),await Cf(t.localStore,n.targetId,!0))}async function R2(i,e){const t=Re(i);try{const n=await fN(t.localStore,e);e.targetChanges.forEach((r,s)=>{const a=t.Va.get(s);a&&(vt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?a.Ia=!0:r.modifiedDocuments.size>0?vt(a.Ia):r.removedDocuments.size>0&&(vt(a.Ia),a.Ia=!1))}),await L2(t,n,e)}catch(n){await um(n)}}function Y_(i,e,t){const n=Re(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const r=[];n.Ea.forEach((s,a)=>{const o=a.view.N_(e);o.snapshot&&r.push(o.snapshot)}),function(a,o){const u=Re(a);u.onlineState=o;let c=!1;u.queries.forEach((h,g)=>{for(const y of g.listeners)y.N_(o)&&(c=!0)}),c&&Am(u)}(n.eventManager,e),r.length&&n.Ta.r_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function GN(i,e,t){const n=Re(i);n.sharedClientState.updateQueryState(e,"rejected",t);const r=n.Va.get(e),s=r&&r.key;if(s){let a=new ht(ce.comparator);a=a.insert(s,jt.newNoDocument(s,Te.min()));const o=Pe().add(s),u=new Zc(Te.min(),new Map,new ht(Me),a,o);await R2(n,u),n.Ra=n.Ra.remove(s),n.Va.delete(e),Dm(n)}else await Cf(n.localStore,e,!1).then(()=>wf(n,e,t)).catch(um)}function wf(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const n of i.da.get(e))i.Ea.delete(n),t&&i.Ta.Sa(n,t);i.da.delete(e),i.isPrimaryClient&&i.ma.Ar(e).forEach(n=>{i.ma.containsKey(n)||O2(i,n)})}function O2(i,e){i.Aa.delete(e.path.canonicalString());const t=i.Ra.get(e);t!==null&&(w2(i.remoteStore,t),i.Ra=i.Ra.remove(e),i.Va.delete(t),Dm(i))}function Q_(i,e,t){for(const n of t)n instanceof k2?(i.ma.addReference(n.key,e),zN(i,n)):n instanceof P2?(ae("SyncEngine","Document no longer in limbo: "+n.key),i.ma.removeReference(n.key,e),i.ma.containsKey(n.key)||O2(i,n.key)):Ee()}function zN(i,e){const t=e.key,n=t.path.canonicalString();i.Ra.get(t)||i.Aa.has(n)||(ae("SyncEngine","New document in limbo: "+t),i.Aa.add(n),Dm(i))}function Dm(i){for(;i.Aa.size>0&&i.Ra.size<i.maxConcurrentLimboResolutions;){const e=i.Aa.values().next().value;i.Aa.delete(e);const t=new ce(nt.fromString(e)),n=i.pa.next();i.Va.set(n,new VN(t)),i.Ra=i.Ra.insert(t,n),C2(i.remoteStore,new sr(Gn(ZE(t.path)),n,"TargetPurposeLimboResolution",lm.ae))}}async function L2(i,e,t){const n=Re(i),r=[],s=[],a=[];n.Ea.isEmpty()||(n.Ea.forEach((o,u)=>{a.push(n.wa(u,e,t).then(c=>{if((c||t)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(u.targetId,c!=null&&c.fromCache?"not-current":"current"),c){r.push(c);const h=Em.qi(u.targetId,c);s.push(h)}}))}),await Promise.all(a),n.Ta.r_(r),await async function(u,c){const h=Re(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>H.forEach(c,y=>H.forEach(y.Li,T=>h.persistence.referenceDelegate.addReference(g,y.targetId,T)).next(()=>H.forEach(y.ki,T=>h.persistence.referenceDelegate.removeReference(g,y.targetId,T)))))}catch(g){if(!fu(g))throw g;ae("LocalStore","Failed to update sequence numbers: "+g)}for(const g of c){const y=g.targetId;if(!g.fromCache){const T=h.Ji.get(y),v=T.snapshotVersion,x=T.withLastLimboFreeSnapshotVersion(v);h.Ji=h.Ji.insert(y,x)}}}(n.localStore,s))}async function WN(i,e){const t=Re(i);if(!t.currentUser.isEqual(e)){ae("SyncEngine","User change. New user:",e.toKey());const n=await E2(t.localStore,e);t.currentUser=e,function(s,a){s.ga.forEach(o=>{o.forEach(u=>{u.reject(new re(G.CANCELLED,a))})}),s.ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await L2(t,n.ts)}}function KN(i,e){const t=Re(i),n=t.Va.get(e);if(n&&n.Ia)return Pe().add(n.key);{let r=Pe();const s=t.da.get(e);if(!s)return r;for(const a of s){const o=t.Ea.get(a);r=r.unionWith(o.view.ia)}return r}}function XN(i){const e=Re(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=R2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=GN.bind(null,e),e.Ta.r_=NN.bind(null,e.eventManager),e.Ta.Sa=MN.bind(null,e.eventManager),e}class J_{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=eh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return dN(this.persistence,new cN,e.initialUser,this.serializer)}createPersistence(e){return new uN(bm.zr,this.serializer)}createSharedClientState(e){return new _N}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class YN{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Y_(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=WN.bind(null,this.syncEngine),await kN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new RN}()}createDatastore(e){const t=eh(e.databaseInfo.databaseId),n=function(s){return new bN(s)}(e.databaseInfo);return function(s,a,o,u){return new xN(s,a,o,u)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,r,s,a,o){return new wN(n,r,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>Y_(this.syncEngine,t,0),function(){return z_.v()?new z_:new yN}())}createSyncEngine(e,t){return function(r,s,a,o,u,c,h){const g=new jN(r,s,a,o,u,c);return h&&(g.ya=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const n=Re(t);ae("RemoteStore","RemoteStore shutting down."),n.y_.add(5),await gu(n),n.S_.shutdown(),n.b_.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.va(this.observer.next,e)}error(e){this.observer.error?this.va(this.observer.error,e):Hn("Uncaught Error in snapshot listener:",e.toString())}Ca(){this.muted=!0}va(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ut.UNAUTHENTICATED,this.clientId=KO.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async s=>{ae("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(n,s=>(ae("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new re(G.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=I2(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function hd(i,e){i.asyncQueue.verifyOperationInProgress(),ae("FirestoreClient","Initializing OfflineComponentProvider");const t=await i.getConfiguration();await e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(async r=>{n.isEqual(r)||(await E2(e.localStore,r),n=r)}),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e}async function Z_(i,e){i.asyncQueue.verifyOperationInProgress();const t=await eM(i);ae("FirestoreClient","Initializing OnlineComponentProvider");const n=await i.getConfiguration();await e.initialize(t,n),i.setCredentialChangeListener(r=>K_(e.remoteStore,r)),i.setAppCheckTokenChangeListener((r,s)=>K_(e.remoteStore,s)),i._onlineComponents=e}function ZN(i){return i.name==="FirebaseError"?i.code===G.FAILED_PRECONDITION||i.code===G.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}async function eM(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){ae("FirestoreClient","Using user provided OfflineComponentProvider");try{await hd(i,i._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!ZN(t))throw t;sa("Error using user provided cache. Falling back to memory cache: "+t),await hd(i,new J_)}}else ae("FirestoreClient","Using default OfflineComponentProvider"),await hd(i,new J_);return i._offlineComponents}async function tM(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(ae("FirestoreClient","Using user provided OnlineComponentProvider"),await Z_(i,i._uninitializedComponentsProvider._online)):(ae("FirestoreClient","Using default OnlineComponentProvider"),await Z_(i,new YN))),i._onlineComponents}async function iM(i){const e=await tM(i),t=e.eventManager;return t.onListen=$N.bind(null,e.syncEngine),t.onUnlisten=HN.bind(null,e.syncEngine),t}function nM(i,e,t={}){const n=new jr;return i.asyncQueue.enqueueAndForget(async()=>function(s,a,o,u,c){const h=new QN({next:y=>{a.enqueueAndForget(()=>LN(s,g)),y.fromCache&&u.source==="server"?c.reject(new re(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(y)},error:y=>c.reject(y)}),g=new FN(o,h,{includeMetadataChanges:!0,W_:!0});return ON(s,g)}(await iM(i),i.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N2(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ey=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rM(i,e,t){if(!t)throw new re(G.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function sM(i,e,t,n){if(e===!0&&n===!0)throw new re(G.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function ty(i){if(ce.isDocumentKey(i))throw new re(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function ih(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":Ee()}function Af(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new re(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ih(i);throw new re(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new re(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new re(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}sM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=N2((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new re(G.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new re(G.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new re(G.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Im{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iy({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new re(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new re(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iy(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new VO;switch(n.type){case"firstParty":return new HO(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new re(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=ey.get(t);n&&(ae("ComponentProvider","Removing Datastore"),ey.delete(t),n.terminate())}(this),Promise.resolve()}}function aM(i,e,t,n={}){var r;const s=(i=Af(i,Im))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&sa("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let o,u;if(typeof n.mockUserToken=="string")o=n.mockUserToken,u=Ut.MOCK_USER;else{o=cx(n.mockUserToken,(r=i._app)===null||r===void 0?void 0:r.options.projectId);const c=n.mockUserToken.sub||n.mockUserToken.user_id;if(!c)throw new re(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ut(c)}i._authCredentials=new jO(new HE(o,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Zr(this.firestore,e,this._query)}}class Yn{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Yn(this.firestore,e,this._key)}}class qs extends Zr{constructor(e,t,n){super(e,t,ZE(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Yn(this.firestore,null,new ce(e))}withConverter(e){return new qs(this.firestore,e,this._path)}}function M2(i,e,...t){if(i=_l(i),rM("collection","path",e),i instanceof Im){const n=nt.fromString(e,...t);return ty(n),new qs(i,null,n)}{if(!(i instanceof Yn||i instanceof qs))throw new re(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(nt.fromString(e,...t));return ty(n),new qs(i.firestore,null,n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new x2(this,"async_queue_retry"),this.Xa=()=>{const t=cd();t&&ae("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const e=cd();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.eu(),this.tu(e)}enterRestrictedMode(e){if(!this.za){this.za=!0,this.Ya=e||!1;const t=cd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Xa)}}enqueue(e){if(this.eu(),this.za)return new Promise(()=>{});const t=new jr;return this.tu(()=>this.za&&this.Ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ga.push(e),this.nu()))}async nu(){if(this.Ga.length!==0){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(e){if(!fu(e))throw e;ae("AsyncQueue","Operation failed with retryable error: "+e)}this.Ga.length>0&&this.Ko.xo(()=>this.nu())}}tu(e){const t=this.Wa.then(()=>(this.Ja=!0,e().catch(n=>{this.Ha=n,this.Ja=!1;const r=function(a){let o=a.message||"";return a.stack&&(o=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),o}(n);throw Hn("INTERNAL UNHANDLED ERROR: ",r),n}).then(n=>(this.Ja=!1,n))));return this.Wa=t,t}enqueueAfterDelay(e,t,n){this.eu(),this.Za.indexOf(e)>-1&&(t=0);const r=wm.createAndSchedule(this,e,t,n,s=>this.ru(s));return this.ja.push(r),r}eu(){this.Ha&&Ee()}verifyOperationInProgress(){}async iu(){let e;do e=this.Wa,await e;while(e!==this.Wa)}su(e){for(const t of this.ja)if(t.timerId===e)return!0;return!1}ou(e){return this.iu().then(()=>{this.ja.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.ja)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.iu()})}_u(e){this.Za.push(e)}ru(e){const t=this.ja.indexOf(e);this.ja.splice(t,1)}}class F2 extends Im{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=function(){return new oM}(),this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||U2(this),this._firestoreClient.terminate()}}function B2(i,e){const t=typeof i=="object"?i:pC(),n=typeof i=="string"?i:e||"(default)",r=cC(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const s=ux("firestore");s&&aM(r,...s)}return r}function uM(i){return i._firestoreClient||U2(i),i._firestoreClient.verifyNotTerminated(),i._firestoreClient}function U2(i){var e,t,n;const r=i._freezeSettings(),s=function(o,u,c,h){return new nL(o,u,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,N2(h.experimentalLongPollingOptions),h.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,r);i._firestoreClient=new JN(i._authCredentials,i._appCheckCredentials,i._queue,s),!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=r.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ha(Kt.fromBase64String(e))}catch(t){throw new re(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ha(Kt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new re(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new re(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new re(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Me(this._lat,e._lat)||Me(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lM=/^__.*__$/;function $2(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ee()}}class Pm{constructor(e,t,n,r,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,s===void 0&&this.au(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get uu(){return this.settings.uu}cu(e){return new Pm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}lu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.cu({path:n,hu:!1});return r.Pu(e),r}Iu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.cu({path:n,hu:!1});return r.au(),r}Tu(e){return this.cu({path:void 0,hu:!0})}Eu(e){return Df(e,this.settings.methodName,this.settings.du||!1,this.path,this.settings.Au)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}au(){if(this.path)for(let e=0;e<this.path.length;e++)this.Pu(this.path.get(e))}Pu(e){if(e.length===0)throw this.Eu("Document fields must not be empty");if($2(this.uu)&&lM.test(e))throw this.Eu('Document fields cannot begin and end with "__"')}}class cM{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||eh(e)}Ru(e,t,n,r=!1){return new Pm({uu:e,methodName:t,Au:n,path:oi.emptyPath(),hu:!1,du:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hM(i){const e=i._freezeSettings(),t=eh(i._databaseId);return new cM(i._databaseId,!!e.ignoreUndefinedProperties,t)}function dM(i,e,t,n=!1){return Rm(t,i.Ru(n?4:3,e))}function Rm(i,e){if(q2(i=_l(i)))return pM("Unsupported field value:",e,i),fM(i,e);if(i instanceof j2)return function(n,r){if(!$2(r.uu))throw r.Eu(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Eu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.hu&&e.uu!==4)throw e.Eu("Nested arrays are not supported");return function(n,r){const s=[];let a=0;for(const o of n){let u=Rm(o,r.Tu(a));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),a++}return{arrayValue:{values:s}}}(i,e)}return function(n,r){if((n=_l(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return SL(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=Ct.fromDate(n);return{timestampValue:Sf(r.serializer,s)}}if(n instanceof Ct){const s=new Ct(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Sf(r.serializer,s)}}if(n instanceof km)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ha)return{bytesValue:m2(r.serializer,n._byteString)};if(n instanceof Yn){const s=r.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw r.Eu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:g2(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Eu(`Unsupported field value: ${ih(n)}`)}(i,e)}function fM(i,e){const t={};return GE(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pu(i,(n,r)=>{const s=Rm(r,e.lu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function q2(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Ct||i instanceof km||i instanceof ha||i instanceof Yn||i instanceof j2)}function pM(i,e,t){if(!q2(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const n=ih(t);throw n==="an object"?e.Eu(i+" a custom object"):e.Eu(i+" "+n)}}const mM=new RegExp("[~\\*/\\[\\]]");function gM(i,e,t){if(e.search(mM)>=0)throw Df(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new V2(...e.split("."))._internalPath}catch{throw Df(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function Df(i,e,t,n,r){const s=n&&!n.isEmpty(),a=r!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${n}`),a&&(u+=` in document ${r}`),u+=")"),new re(G.INVALID_ARGUMENT,o+i+u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Yn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new _M(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(nh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class _M extends H2{data(){return super.data()}}function nh(i,e){return typeof e=="string"?gM(i,e):e instanceof V2?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yM(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new re(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Om{}class G2 extends Om{}function z2(i,e,...t){let n=[];e instanceof Om&&n.push(e),n=n.concat(t),function(s){const a=s.filter(u=>u instanceof Lm).length,o=s.filter(u=>u instanceof rh).length;if(a>1||a>0&&o>0)throw new re(G.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const r of n)i=r._apply(i);return i}class rh extends G2{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new rh(e,t,n)}_apply(e){const t=this._parse(e);return X2(e._query,t),new Zr(e.firestore,e.converter,_f(e._query,t))}_parse(e){const t=hM(e.firestore);return function(s,a,o,u,c,h,g){let y;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new re(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){ry(g,h);const T=[];for(const v of g)T.push(ny(u,s,v));y={arrayValue:{values:T}}}else y=ny(u,s,g)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||ry(g,h),y=dM(o,a,g,h==="in"||h==="not-in");return gt.create(c,h,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function W2(i,e,t){const n=e,r=nh("where",i);return rh._create(r,n,t)}class Lm extends Om{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Lm(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Ji.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let a=r;const o=s.getFlattenedFilters();for(const u of o)X2(a,u),a=_f(a,u)}(e._query,t),new Zr(e.firestore,e.converter,_f(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Nm extends G2{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Nm(e,t)}_apply(e){const t=function(r,s,a){if(r.startAt!==null)throw new re(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new re(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Us(s,a);return function(c,h){if(mm(c)===null){const g=Kc(c);g!==null&&Y2(c,g,h.field)}}(r,o),o}(e._query,this._field,this._direction);return new Zr(e.firestore,e.converter,function(r,s){const a=r.explicitOrderBy.concat([s]);return new Ca(r.path,r.collectionGroup,a,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function K2(i,e="asc"){const t=e,n=nh("orderBy",i);return Nm._create(n,t)}function ny(i,e,t){if(typeof(t=_l(t))=="string"){if(t==="")throw new re(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!e2(e)&&t.indexOf("/")!==-1)throw new re(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(nt.fromString(t));if(!ce.isDocumentKey(n))throw new re(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return A_(i,new ce(n))}if(t instanceof Yn)return A_(i,t._key);throw new re(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ih(t)}.`)}function ry(i,e){if(!Array.isArray(i)||i.length===0)throw new re(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function X2(i,e){if(e.isInequality()){const n=Kc(i),r=e.field;if(n!==null&&!n.isEqual(r))throw new re(G.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const s=mm(i);s!==null&&Y2(i,r,s)}const t=function(r,s){for(const a of r)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(i.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new re(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new re(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Y2(i,e,t){if(!t.isEqual(e))throw new re(G.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class vM{convertValue(e,t="none"){switch(Xr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Kr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ee()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return pu(e,(r,s)=>{n[r]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new km(pt(e.latitude),pt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=hm(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(qo(e));default:return null}}convertTimestamp(e){const t=fr(e);return new Ct(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=nt.fromString(e);vt(b2(n));const r=new Ho(n.get(1),n.get(3)),s=new ce(n.popFirst(5));return r.isEqual(t)||Hn(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class TM extends H2{constructor(e,t,n,r,s,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(nh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class dl extends TM{data(e={}){return super.data(e)}}class bM{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new tl(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new dl(this._firestore,this._userDataWriter,n.key,n,new tl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new re(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(o=>{const u=new dl(r._firestore,r._userDataWriter,o.doc.key,o.doc,new tl(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const u=new dl(r._firestore,r._userDataWriter,o.doc.key,o.doc,new tl(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,h=-1;return o.type!==0&&(c=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),h=a.indexOf(o.doc.key)),{type:EM(o.type),doc:u,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function EM(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ee()}}class SM extends vM{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Yn(this.firestore,null,t)}}function Q2(i){i=Af(i,Zr);const e=Af(i.firestore,F2),t=uM(e),n=new SM(e);return yM(i._query),nM(t,i._query).then(r=>new bM(e,n,i,r))}(function(e,t=!0){(function(r){xa=r})(fC),vl(new xo("firestore",(n,{instanceIdentifier:r,options:s})=>{const a=n.getProvider("app").getImmediate(),o=new F2(new $O(n.getProvider("auth-internal")),new zO(n.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new re(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ho(c.options.projectId,h)}(a,r),a);return s=Object.assign({useFetchStreams:t},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),ks(E_,"4.1.0",e),ks(E_,"4.1.0","esm2017")})();const xM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M6.75 2.25A.75.75 0 017.5 3v1.5h9V3A.75.75 0 0118 3v1.5h.75a3 3 0 013 3v11.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V7.5a3 3 0 013-3H6V3a.75.75 0 01.75-.75zm13.5 9a1.5 1.5 0 00-1.5-1.5H5.25a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-7.5z","clip-rule":"evenodd"}]}},CM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M7.72 12.53a.75.75 0 010-1.06l7.5-7.5a.75.75 0 111.06 1.06L9.31 12l6.97 6.97a.75.75 0 11-1.06 1.06l-7.5-7.5z","clip-rule":"evenodd"}]}},wM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z","clip-rule":"evenodd"}]}},AM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z","clip-rule":"evenodd"}]}},DM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{d:"M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zM12.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0A.75.75 0 0115 4.5h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H15a.75.75 0 01-.75-.75V5.25z","clip-rule":"evenodd"}]}},IM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z","clip-rule":"evenodd"}]}};function sy(i,e,t){const n=i.slice();return n[6]=e[t],n}function ay(i){let e,t=[i[6]],n={};for(let r=0;r<t.length;r+=1)n=ur(n,t[r]);return{c(){e=by("path"),pl(e,n)},m(r,s){Dt(r,e,s)},p(r,s){pl(e,n=Lf(t,[s&2&&r[6]]))},d(r){r&&Tt(e)}}}function kM(i){var a,o;let e,t=((a=i[1])==null?void 0:a.path)??[],n=[];for(let u=0;u<t.length;u+=1)n[u]=ay(sy(i,t,u));let r=[(o=i[1])==null?void 0:o.a,{xmlns:"http://www.w3.org/2000/svg"},{width:i[0]},{height:i[0]},{"aria-hidden":"true"},i[2]],s={};for(let u=0;u<r.length;u+=1)s=ur(s,r[u]);return{c(){e=by("svg");for(let u=0;u<n.length;u+=1)n[u].c();pl(e,s)},m(u,c){Dt(u,e,c);for(let h=0;h<n.length;h+=1)n[h]&&n[h].m(e,null)},p(u,[c]){var h,g;if(c&2){t=((h=u[1])==null?void 0:h.path)??[];let y;for(y=0;y<t.length;y+=1){const T=sy(u,t,y);n[y]?n[y].p(T,c):(n[y]=ay(T),n[y].c(),n[y].m(e,null))}for(;y<n.length;y+=1)n[y].d(1);n.length=t.length}pl(e,s=Lf(r,[c&2&&((g=u[1])==null?void 0:g.a),{xmlns:"http://www.w3.org/2000/svg"},c&1&&{width:u[0]},c&1&&{height:u[0]},{"aria-hidden":"true"},c&4&&u[2]]))},i:et,o:et,d(u){u&&Tt(e),Ty(n,u)}}}function PM(i,e,t){let n;const r=["src","size","solid","mini"];let s=fl(e,r),{src:a}=e,{size:o="100%"}=e,{solid:u=!1}=e,{mini:c=!1}=e;if(o!=="100%"&&o.slice(-1)!="x"&&o.slice(-1)!="m"&&o.slice(-1)!="%")try{o=parseInt(o)+"px"}catch{o="100%"}return i.$$set=h=>{e=ur(ur({},e),vy(h)),t(2,s=fl(e,r)),"src"in h&&t(3,a=h.src),"size"in h&&t(0,o=h.size),"solid"in h&&t(4,u=h.solid),"mini"in h&&t(5,c=h.mini)},i.$$.update=()=>{i.$$.dirty&56&&t(1,n=a==null?void 0:a[u?"solid":c?"mini":"default"])},[o,n,s,a,u,c]}class da extends Kn{constructor(e){super(),Wn(this,e,PM,kM,zn,{src:3,size:0,solid:4,mini:5})}}function RM(i){let e,t,n,r,s;return t=new da({props:{src:DM,size:"1.5em"}}),{c(){e=Fe("button"),_i(t.$$.fragment),we(e,"class","bg-gray-700 p-1 rounded-md text-white")},m(a,o){Dt(a,e,o),ti(t,e,null),n=!0,r||(s=Xi(e,"click",i[4]),r=!0)},p:et,i(a){n||(Ue(t.$$.fragment,a),n=!0)},o(a){Qe(t.$$.fragment,a),n=!1},d(a){a&&Tt(e),ii(t),r=!1,s()}}}function OM(i){let e,t,n,r,s;return t=new da({props:{src:IM,size:"1.5em"}}),{c(){e=Fe("button"),_i(t.$$.fragment),we(e,"class","bg-gray-700 p-1 rounded-md text-white")},m(a,o){Dt(a,e,o),ti(t,e,null),n=!0,r||(s=Xi(e,"click",i[3]),r=!0)},p:et,i(a){n||(Ue(t.$$.fragment,a),n=!0)},o(a){Qe(t.$$.fragment,a),n=!1},d(a){a&&Tt(e),ii(t),r=!1,s()}}}function LM(i){let e,t,n,r;const s=[OM,RM],a=[];function o(u,c){return u[0]?0:1}return e=o(i),t=a[e]=s[e](i),{c(){t.c(),n=kf()},m(u,c){a[e].m(u,c),Dt(u,n,c),r=!0},p(u,[c]){let h=e;e=o(u),e===h?a[e].p(u,c):(Wo(),Qe(a[h],1,1,()=>{a[h]=null}),Ko(),t=a[e],t?t.p(u,c):(t=a[e]=s[e](u),t.c()),Ue(t,1),t.m(n.parentNode,n))},i(u){r||(Ue(t),r=!0)},o(u){Qe(t),r=!1},d(u){a[e].d(u),u&&Tt(n)}}}function NM(i,e,t){let{paused:n}=e,{pause:r}=e,{unpause:s}=e;const a=()=>s(),o=()=>r();return i.$$set=u=>{"paused"in u&&t(0,n=u.paused),"pause"in u&&t(1,r=u.pause),"unpause"in u&&t(2,s=u.unpause)},[n,r,s,a,o]}class MM extends Kn{constructor(e){super(),Wn(this,e,NM,LM,zn,{paused:0,pause:1,unpause:2})}}function FM(i){let e,t,n,r,s,a,o;return{c(){e=Fe("select"),t=Fe("option"),t.textContent="2 minutos",n=Fe("option"),n.textContent="10 minutos",r=Fe("option"),r.textContent="1 hora",s=Fe("option"),s.textContent="24 horas",t.__value=1e3*60*2,t.value=t.__value,n.__value=1e3*60*10,n.value=n.__value,r.__value=1e3*60*60,r.value=r.__value,s.__value=1e3*60*60*24,s.value=s.__value,i[0]===void 0&&ml(()=>i[1].call(e))},m(u,c){Dt(u,e,c),De(e,t),De(e,n),De(e,r),De(e,s),wg(e,i[0],!0),a||(o=Xi(e,"change",i[1]),a=!0)},p(u,[c]){c&1&&wg(e,u[0])},i:et,o:et,d(u){u&&Tt(e),a=!1,o()}}}function BM(i,e,t){let{scale:n}=e;function r(){n=zS(this),t(0,n)}return i.$$set=s=>{"scale"in s&&t(0,n=s.scale)},[n,r]}class UM extends Kn{constructor(e){super(),Wn(this,e,BM,FM,zn,{scale:0})}}var dd=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],Hs={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:typeof window=="object"&&window.navigator.userAgent.indexOf("MSIE")===-1,ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(i){return typeof console<"u"&&console.warn(i)},getWeek:function(i){var e=new Date(i.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},zo={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(i){var e=i%100;if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},gi=function(i,e){return e===void 0&&(e=2),("000"+i).slice(e*-1)},Bi=function(i){return i===!0?1:0};function oy(i,e){var t;return function(){var n=this,r=arguments;clearTimeout(t),t=setTimeout(function(){return i.apply(n,r)},e)}}var fd=function(i){return i instanceof Array?i:[i]};function ei(i,e,t){if(t===!0)return i.classList.add(e);i.classList.remove(e)}function Le(i,e,t){var n=window.document.createElement(i);return e=e||"",t=t||"",n.className=e,t!==void 0&&(n.textContent=t),n}function il(i){for(;i.firstChild;)i.removeChild(i.firstChild)}function J2(i,e){if(e(i))return i;if(i.parentNode)return J2(i.parentNode,e)}function nl(i,e){var t=Le("div","numInputWrapper"),n=Le("input","numInput "+i),r=Le("span","arrowUp"),s=Le("span","arrowDown");if(navigator.userAgent.indexOf("MSIE 9.0")===-1?n.type="number":(n.type="text",n.pattern="\\d*"),e!==void 0)for(var a in e)n.setAttribute(a,e[a]);return t.appendChild(n),t.appendChild(r),t.appendChild(s),t}function Ai(i){try{if(typeof i.composedPath=="function"){var e=i.composedPath();return e[0]}return i.target}catch{return i.target}}var pd=function(){},ac=function(i,e,t){return t.months[e?"shorthand":"longhand"][i]},VM={D:pd,F:function(i,e,t){i.setMonth(t.months.longhand.indexOf(e))},G:function(i,e){i.setHours((i.getHours()>=12?12:0)+parseFloat(e))},H:function(i,e){i.setHours(parseFloat(e))},J:function(i,e){i.setDate(parseFloat(e))},K:function(i,e,t){i.setHours(i.getHours()%12+12*Bi(new RegExp(t.amPM[1],"i").test(e)))},M:function(i,e,t){i.setMonth(t.months.shorthand.indexOf(e))},S:function(i,e){i.setSeconds(parseFloat(e))},U:function(i,e){return new Date(parseFloat(e)*1e3)},W:function(i,e,t){var n=parseInt(e),r=new Date(i.getFullYear(),0,2+(n-1)*7,0,0,0,0);return r.setDate(r.getDate()-r.getDay()+t.firstDayOfWeek),r},Y:function(i,e){i.setFullYear(parseFloat(e))},Z:function(i,e){return new Date(e)},d:function(i,e){i.setDate(parseFloat(e))},h:function(i,e){i.setHours((i.getHours()>=12?12:0)+parseFloat(e))},i:function(i,e){i.setMinutes(parseFloat(e))},j:function(i,e){i.setDate(parseFloat(e))},l:pd,m:function(i,e){i.setMonth(parseFloat(e)-1)},n:function(i,e){i.setMonth(parseFloat(e)-1)},s:function(i,e){i.setSeconds(parseFloat(e))},u:function(i,e){return new Date(parseFloat(e))},w:pd,y:function(i,e){i.setFullYear(2e3+parseFloat(e))}},Pr={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},Eo={Z:function(i){return i.toISOString()},D:function(i,e,t){return e.weekdays.shorthand[Eo.w(i,e,t)]},F:function(i,e,t){return ac(Eo.n(i,e,t)-1,!1,e)},G:function(i,e,t){return gi(Eo.h(i,e,t))},H:function(i){return gi(i.getHours())},J:function(i,e){return e.ordinal!==void 0?i.getDate()+e.ordinal(i.getDate()):i.getDate()},K:function(i,e){return e.amPM[Bi(i.getHours()>11)]},M:function(i,e){return ac(i.getMonth(),!0,e)},S:function(i){return gi(i.getSeconds())},U:function(i){return i.getTime()/1e3},W:function(i,e,t){return t.getWeek(i)},Y:function(i){return gi(i.getFullYear(),4)},d:function(i){return gi(i.getDate())},h:function(i){return i.getHours()%12?i.getHours()%12:12},i:function(i){return gi(i.getMinutes())},j:function(i){return i.getDate()},l:function(i,e){return e.weekdays.longhand[i.getDay()]},m:function(i){return gi(i.getMonth()+1)},n:function(i){return i.getMonth()+1},s:function(i){return i.getSeconds()},u:function(i){return i.getTime()},w:function(i){return i.getDay()},y:function(i){return String(i.getFullYear()).substring(2)}},Z2=function(i){var e=i.config,t=e===void 0?Hs:e,n=i.l10n,r=n===void 0?zo:n,s=i.isMobile,a=s===void 0?!1:s;return function(o,u,c){var h=c||r;return t.formatDate!==void 0&&!a?t.formatDate(o,u,h):u.split("").map(function(g,y,T){return Eo[g]&&T[y-1]!=="\\"?Eo[g](o,h,t):g!=="\\"?g:""}).join("")}},If=function(i){var e=i.config,t=e===void 0?Hs:e,n=i.l10n,r=n===void 0?zo:n;return function(s,a,o,u){if(!(s!==0&&!s)){var c=u||r,h,g=s;if(s instanceof Date)h=new Date(s.getTime());else if(typeof s!="string"&&s.toFixed!==void 0)h=new Date(s);else if(typeof s=="string"){var y=a||(t||Hs).dateFormat,T=String(s).trim();if(T==="today")h=new Date,o=!0;else if(t&&t.parseDate)h=t.parseDate(s,y);else if(/Z$/.test(T)||/GMT$/.test(T))h=new Date(s);else{for(var v=void 0,x=[],A=0,D=0,P="";A<y.length;A++){var M=y[A],O=M==="\\",R=y[A-1]==="\\"||O;if(Pr[M]&&!R){P+=Pr[M];var $=new RegExp(P).exec(s);$&&(v=!0)&&x[M!=="Y"?"push":"unshift"]({fn:VM[M],val:$[++D]})}else O||(P+=".")}h=!t||!t.noCalendar?new Date(new Date().getFullYear(),0,1,0,0,0,0):new Date(new Date().setHours(0,0,0,0)),x.forEach(function(V){var ie=V.fn,Z=V.val;return h=ie(h,Z,c)||h}),h=v?h:void 0}}if(!(h instanceof Date&&!isNaN(h.getTime()))){t.errorHandler(new Error("Invalid date provided: "+g));return}return o===!0&&h.setHours(0,0,0,0),h}}};function Di(i,e,t){return t===void 0&&(t=!0),t!==!1?new Date(i.getTime()).setHours(0,0,0,0)-new Date(e.getTime()).setHours(0,0,0,0):i.getTime()-e.getTime()}var jM=function(i,e,t){return i>Math.min(e,t)&&i<Math.max(e,t)},md=function(i,e,t){return i*3600+e*60+t},$M=function(i){var e=Math.floor(i/3600),t=(i-e*3600)/60;return[e,t,i-e*3600-t*60]},qM={DAY:864e5};function gd(i){var e=i.defaultHour,t=i.defaultMinute,n=i.defaultSeconds;if(i.minDate!==void 0){var r=i.minDate.getHours(),s=i.minDate.getMinutes(),a=i.minDate.getSeconds();e<r&&(e=r),e===r&&t<s&&(t=s),e===r&&t===s&&n<a&&(n=i.minDate.getSeconds())}if(i.maxDate!==void 0){var o=i.maxDate.getHours(),u=i.maxDate.getMinutes();e=Math.min(e,o),e===o&&(t=Math.min(u,t)),e===o&&t===u&&(n=i.maxDate.getSeconds())}return{hours:e,minutes:t,seconds:n}}typeof Object.assign!="function"&&(Object.assign=function(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(!i)throw TypeError("Cannot convert undefined or null to object");for(var n=function(o){o&&Object.keys(o).forEach(function(u){return i[u]=o[u]})},r=0,s=e;r<s.length;r++){var a=s[r];n(a)}return i});var Vt=globalThis&&globalThis.__assign||function(){return Vt=Object.assign||function(i){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r])}return i},Vt.apply(this,arguments)},uy=globalThis&&globalThis.__spreadArrays||function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var n=Array(i),r=0,e=0;e<t;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,r++)n[r]=s[a];return n},HM=300;function GM(i,e){var t={config:Vt(Vt({},Hs),mt.defaultConfig),l10n:zo};t.parseDate=If({config:t.config,l10n:t.l10n}),t._handlers=[],t.pluginElements=[],t.loadedPlugins=[],t._bind=x,t._setHoursFromDate=y,t._positionCalendar=qi,t.changeMonth=kt,t.changeYear=rn,t.clear=hi,t.close=tn,t.onMouseOver=Xe,t._createElement=Le,t.createDay=$,t.destroy=Qn,t.isEnabled=Si,t.jumpToDate=P,t.updateValue=Gi,t.open=dt,t.redraw=fi,t.set=Da,t.setDate=Ia,t.toggle=es;function n(){t.utils={getDaysInMonth:function(E,C){return E===void 0&&(E=t.currentMonth),C===void 0&&(C=t.currentYear),E===1&&(C%4===0&&C%100!==0||C%400===0)?29:t.l10n.daysInMonth[E]}}}function r(){t.element=t.input=i,t.isOpen=!1,Jn(),xi(),vu(),yu(),n(),t.isMobile||R(),D(),(t.selectedDates.length||t.config.noCalendar)&&(t.config.enableTime&&y(t.config.noCalendar?t.latestSelectedDateObj:void 0),Gi(!1)),o();var E=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!t.isMobile&&E&&qi(),Ye("onReady")}function s(){var E;return((E=t.calendarContainer)===null||E===void 0?void 0:E.getRootNode()).activeElement||document.activeElement}function a(E){return E.bind(t)}function o(){var E=t.config;E.weekNumbers===!1&&E.showMonths===1||E.noCalendar!==!0&&window.requestAnimationFrame(function(){if(t.calendarContainer!==void 0&&(t.calendarContainer.style.visibility="hidden",t.calendarContainer.style.display="block"),t.daysContainer!==void 0){var C=(t.days.offsetWidth+1)*E.showMonths;t.daysContainer.style.width=C+"px",t.calendarContainer.style.width=C+(t.weekWrapper!==void 0?t.weekWrapper.offsetWidth:0)+"px",t.calendarContainer.style.removeProperty("visibility"),t.calendarContainer.style.removeProperty("display")}})}function u(E){if(t.selectedDates.length===0){var C=t.config.minDate===void 0||Di(new Date,t.config.minDate)>=0?new Date:new Date(t.config.minDate.getTime()),N=gd(t.config);C.setHours(N.hours,N.minutes,N.seconds,C.getMilliseconds()),t.selectedDates=[C],t.latestSelectedDateObj=C}E!==void 0&&E.type!=="blur"&&uh(E);var U=t._input.value;g(),Gi(),t._input.value!==U&&t._debouncedChange()}function c(E,C){return E%12+12*Bi(C===t.l10n.amPM[1])}function h(E){switch(E%24){case 0:case 12:return 12;default:return E%12}}function g(){if(!(t.hourElement===void 0||t.minuteElement===void 0)){var E=(parseInt(t.hourElement.value.slice(-2),10)||0)%24,C=(parseInt(t.minuteElement.value,10)||0)%60,N=t.secondElement!==void 0?(parseInt(t.secondElement.value,10)||0)%60:0;t.amPM!==void 0&&(E=c(E,t.amPM.textContent));var U=t.config.minTime!==void 0||t.config.minDate&&t.minDateHasTime&&t.latestSelectedDateObj&&Di(t.latestSelectedDateObj,t.config.minDate,!0)===0,W=t.config.maxTime!==void 0||t.config.maxDate&&t.maxDateHasTime&&t.latestSelectedDateObj&&Di(t.latestSelectedDateObj,t.config.maxDate,!0)===0;if(t.config.maxTime!==void 0&&t.config.minTime!==void 0&&t.config.minTime>t.config.maxTime){var ee=md(t.config.minTime.getHours(),t.config.minTime.getMinutes(),t.config.minTime.getSeconds()),ye=md(t.config.maxTime.getHours(),t.config.maxTime.getMinutes(),t.config.maxTime.getSeconds()),se=md(E,C,N);if(se>ye&&se<ee){var Se=$M(ee);E=Se[0],C=Se[1],N=Se[2]}}else{if(W){var ne=t.config.maxTime!==void 0?t.config.maxTime:t.config.maxDate;E=Math.min(E,ne.getHours()),E===ne.getHours()&&(C=Math.min(C,ne.getMinutes())),C===ne.getMinutes()&&(N=Math.min(N,ne.getSeconds()))}if(U){var ue=t.config.minTime!==void 0?t.config.minTime:t.config.minDate;E=Math.max(E,ue.getHours()),E===ue.getHours()&&C<ue.getMinutes()&&(C=ue.getMinutes()),C===ue.getMinutes()&&(N=Math.max(N,ue.getSeconds()))}}T(E,C,N)}}function y(E){var C=E||t.latestSelectedDateObj;C&&C instanceof Date&&T(C.getHours(),C.getMinutes(),C.getSeconds())}function T(E,C,N){t.latestSelectedDateObj!==void 0&&t.latestSelectedDateObj.setHours(E%24,C,N||0,0),!(!t.hourElement||!t.minuteElement||t.isMobile)&&(t.hourElement.value=gi(t.config.time_24hr?E:(12+E)%12+12*Bi(E%12===0)),t.minuteElement.value=gi(C),t.amPM!==void 0&&(t.amPM.textContent=t.l10n.amPM[Bi(E>=12)]),t.secondElement!==void 0&&(t.secondElement.value=gi(N)))}function v(E){var C=Ai(E),N=parseInt(C.value)+(E.delta||0);(N/1e3>1||E.key==="Enter"&&!/[^\d]/.test(N.toString()))&&rn(N)}function x(E,C,N,U){if(C instanceof Array)return C.forEach(function(W){return x(E,W,N,U)});if(E instanceof Array)return E.forEach(function(W){return x(W,C,N,U)});E.addEventListener(C,N,U),t._handlers.push({remove:function(){return E.removeEventListener(C,N,U)}})}function A(){Ye("onChange")}function D(){if(t.config.wrap&&["open","close","toggle","clear"].forEach(function(N){Array.prototype.forEach.call(t.element.querySelectorAll("[data-"+N+"]"),function(U){return x(U,"click",t[N])})}),t.isMobile){sh();return}var E=oy(di,50);if(t._debouncedChange=oy(A,HM),t.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&x(t.daysContainer,"mouseover",function(N){t.config.mode==="range"&&Xe(Ai(N))}),x(t._input,"keydown",Ke),t.calendarContainer!==void 0&&x(t.calendarContainer,"keydown",Ke),!t.config.inline&&!t.config.static&&x(window,"resize",E),window.ontouchstart!==void 0?x(window.document,"touchstart",nn):x(window.document,"mousedown",nn),x(window.document,"focus",nn,{capture:!0}),t.config.clickOpens===!0&&(x(t._input,"focus",t.open),x(t._input,"click",t.open)),t.daysContainer!==void 0&&(x(t.monthNav,"click",oh),x(t.monthNav,["keyup","increment"],v),x(t.daysContainer,"click",Dn)),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0){var C=function(N){return Ai(N).select()};x(t.timeContainer,["increment"],u),x(t.timeContainer,"blur",u,{capture:!0}),x(t.timeContainer,"click",M),x([t.hourElement,t.minuteElement],["focus","click"],C),t.secondElement!==void 0&&x(t.secondElement,"focus",function(){return t.secondElement&&t.secondElement.select()}),t.amPM!==void 0&&x(t.amPM,"click",function(N){u(N)})}t.config.allowInput&&x(t._input,"blur",de)}function P(E,C){var N=E!==void 0?t.parseDate(E):t.latestSelectedDateObj||(t.config.minDate&&t.config.minDate>t.now?t.config.minDate:t.config.maxDate&&t.config.maxDate<t.now?t.config.maxDate:t.now),U=t.currentYear,W=t.currentMonth;try{N!==void 0&&(t.currentYear=N.getFullYear(),t.currentMonth=N.getMonth())}catch(ee){ee.message="Invalid date supplied: "+N,t.config.errorHandler(ee)}C&&t.currentYear!==U&&(Ye("onYearChange"),X()),C&&(t.currentYear!==U||t.currentMonth!==W)&&Ye("onMonthChange"),t.redraw()}function M(E){var C=Ai(E);~C.className.indexOf("arrow")&&O(E,C.classList.contains("arrowUp")?1:-1)}function O(E,C,N){var U=E&&Ai(E),W=N||U&&U.parentNode&&U.parentNode.firstChild,ee=Pa("increment");ee.delta=C,W&&W.dispatchEvent(ee)}function R(){var E=window.document.createDocumentFragment();if(t.calendarContainer=Le("div","flatpickr-calendar"),t.calendarContainer.tabIndex=-1,!t.config.noCalendar){if(E.appendChild(Ce()),t.innerContainer=Le("div","flatpickr-innerContainer"),t.config.weekNumbers){var C=bt(),N=C.weekWrapper,U=C.weekNumbers;t.innerContainer.appendChild(N),t.weekNumbers=U,t.weekWrapper=N}t.rContainer=Le("div","flatpickr-rContainer"),t.rContainer.appendChild(tt()),t.daysContainer||(t.daysContainer=Le("div","flatpickr-days"),t.daysContainer.tabIndex=-1),me(),t.rContainer.appendChild(t.daysContainer),t.innerContainer.appendChild(t.rContainer),E.appendChild(t.innerContainer)}t.config.enableTime&&E.appendChild($e()),ei(t.calendarContainer,"rangeMode",t.config.mode==="range"),ei(t.calendarContainer,"animate",t.config.animate===!0),ei(t.calendarContainer,"multiMonth",t.config.showMonths>1),t.calendarContainer.appendChild(E);var W=t.config.appendTo!==void 0&&t.config.appendTo.nodeType!==void 0;if((t.config.inline||t.config.static)&&(t.calendarContainer.classList.add(t.config.inline?"inline":"static"),t.config.inline&&(!W&&t.element.parentNode?t.element.parentNode.insertBefore(t.calendarContainer,t._input.nextSibling):t.config.appendTo!==void 0&&t.config.appendTo.appendChild(t.calendarContainer)),t.config.static)){var ee=Le("div","flatpickr-wrapper");t.element.parentNode&&t.element.parentNode.insertBefore(ee,t.element),ee.appendChild(t.element),t.altInput&&ee.appendChild(t.altInput),ee.appendChild(t.calendarContainer)}!t.config.static&&!t.config.inline&&(t.config.appendTo!==void 0?t.config.appendTo:window.document.body).appendChild(t.calendarContainer)}function $(E,C,N,U){var W=Si(C,!0),ee=Le("span",E,C.getDate().toString());return ee.dateObj=C,ee.$i=U,ee.setAttribute("aria-label",t.formatDate(C,t.config.ariaDateFormat)),E.indexOf("hidden")===-1&&Di(C,t.now)===0&&(t.todayDateElem=ee,ee.classList.add("today"),ee.setAttribute("aria-current","date")),W?(ee.tabIndex=-1,Ra(C)&&(ee.classList.add("selected"),t.selectedDateElem=ee,t.config.mode==="range"&&(ei(ee,"startRange",t.selectedDates[0]&&Di(C,t.selectedDates[0],!0)===0),ei(ee,"endRange",t.selectedDates[1]&&Di(C,t.selectedDates[1],!0)===0),E==="nextMonthDay"&&ee.classList.add("inRange")))):ee.classList.add("flatpickr-disabled"),t.config.mode==="range"&&ah(C)&&!Ra(C)&&ee.classList.add("inRange"),t.weekNumbers&&t.config.showMonths===1&&E!=="prevMonthDay"&&U%7===6&&t.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+t.config.getWeek(C)+"</span>"),Ye("onDayCreate",ee),ee}function V(E){E.focus(),t.config.mode==="range"&&Xe(E)}function ie(E){for(var C=E>0?0:t.config.showMonths-1,N=E>0?t.config.showMonths:-1,U=C;U!=N;U+=E)for(var W=t.daysContainer.children[U],ee=E>0?0:W.children.length-1,ye=E>0?W.children.length:-1,se=ee;se!=ye;se+=E){var Se=W.children[se];if(Se.className.indexOf("hidden")===-1&&Si(Se.dateObj))return Se}}function Z(E,C){for(var N=E.className.indexOf("Month")===-1?E.dateObj.getMonth():t.currentMonth,U=C>0?t.config.showMonths:-1,W=C>0?1:-1,ee=N-t.currentMonth;ee!=U;ee+=W)for(var ye=t.daysContainer.children[ee],se=N-t.currentMonth===ee?E.$i+C:C<0?ye.children.length-1:0,Se=ye.children.length,ne=se;ne>=0&&ne<Se&&ne!=(C>0?Se:-1);ne+=W){var ue=ye.children[ne];if(ue.className.indexOf("hidden")===-1&&Si(ue.dateObj)&&Math.abs(E.$i-ne)>=Math.abs(C))return V(ue)}t.changeMonth(W),he(ie(W),0)}function he(E,C){var N=s(),U=Q(N||document.body),W=E!==void 0?E:U?N:t.selectedDateElem!==void 0&&Q(t.selectedDateElem)?t.selectedDateElem:t.todayDateElem!==void 0&&Q(t.todayDateElem)?t.todayDateElem:ie(C>0?1:-1);W===void 0?t._input.focus():U?Z(W,C):V(W)}function _e(E,C){for(var N=(new Date(E,C,1).getDay()-t.l10n.firstDayOfWeek+7)%7,U=t.utils.getDaysInMonth((C-1+12)%12,E),W=t.utils.getDaysInMonth(C,E),ee=window.document.createDocumentFragment(),ye=t.config.showMonths>1,se=ye?"prevMonthDay hidden":"prevMonthDay",Se=ye?"nextMonthDay hidden":"nextMonthDay",ne=U+1-N,ue=0;ne<=U;ne++,ue++)ee.appendChild($("flatpickr-day "+se,new Date(E,C-1,ne),ne,ue));for(ne=1;ne<=W;ne++,ue++)ee.appendChild($("flatpickr-day",new Date(E,C,ne),ne,ue));for(var be=W+1;be<=42-N&&(t.config.showMonths===1||ue%7!==0);be++,ue++)ee.appendChild($("flatpickr-day "+Se,new Date(E,C+1,be%W),be,ue));var Li=Le("div","dayContainer");return Li.appendChild(ee),Li}function me(){if(t.daysContainer!==void 0){il(t.daysContainer),t.weekNumbers&&il(t.weekNumbers);for(var E=document.createDocumentFragment(),C=0;C<t.config.showMonths;C++){var N=new Date(t.currentYear,t.currentMonth,1);N.setMonth(t.currentMonth+C),E.appendChild(_e(N.getFullYear(),N.getMonth()))}t.daysContainer.appendChild(E),t.days=t.daysContainer.firstChild,t.config.mode==="range"&&t.selectedDates.length===1&&Xe()}}function X(){if(!(t.config.showMonths>1||t.config.monthSelectorType!=="dropdown")){var E=function(U){return t.config.minDate!==void 0&&t.currentYear===t.config.minDate.getFullYear()&&U<t.config.minDate.getMonth()?!1:!(t.config.maxDate!==void 0&&t.currentYear===t.config.maxDate.getFullYear()&&U>t.config.maxDate.getMonth())};t.monthsDropdownContainer.tabIndex=-1,t.monthsDropdownContainer.innerHTML="";for(var C=0;C<12;C++)if(E(C)){var N=Le("option","flatpickr-monthDropdown-month");N.value=new Date(t.currentYear,C).getMonth().toString(),N.textContent=ac(C,t.config.shorthandCurrentMonth,t.l10n),N.tabIndex=-1,t.currentMonth===C&&(N.selected=!0),t.monthsDropdownContainer.appendChild(N)}}}function Ae(){var E=Le("div","flatpickr-month"),C=window.document.createDocumentFragment(),N;t.config.showMonths>1||t.config.monthSelectorType==="static"?N=Le("span","cur-month"):(t.monthsDropdownContainer=Le("select","flatpickr-monthDropdown-months"),t.monthsDropdownContainer.setAttribute("aria-label",t.l10n.monthAriaLabel),x(t.monthsDropdownContainer,"change",function(ye){var se=Ai(ye),Se=parseInt(se.value,10);t.changeMonth(Se-t.currentMonth),Ye("onMonthChange")}),X(),N=t.monthsDropdownContainer);var U=nl("cur-year",{tabindex:"-1"}),W=U.getElementsByTagName("input")[0];W.setAttribute("aria-label",t.l10n.yearAriaLabel),t.config.minDate&&W.setAttribute("min",t.config.minDate.getFullYear().toString()),t.config.maxDate&&(W.setAttribute("max",t.config.maxDate.getFullYear().toString()),W.disabled=!!t.config.minDate&&t.config.minDate.getFullYear()===t.config.maxDate.getFullYear());var ee=Le("div","flatpickr-current-month");return ee.appendChild(N),ee.appendChild(U),C.appendChild(ee),E.appendChild(C),{container:E,yearElement:W,monthElement:N}}function rt(){il(t.monthNav),t.monthNav.appendChild(t.prevMonthNav),t.config.showMonths&&(t.yearElements=[],t.monthElements=[]);for(var E=t.config.showMonths;E--;){var C=Ae();t.yearElements.push(C.yearElement),t.monthElements.push(C.monthElement),t.monthNav.appendChild(C.container)}t.monthNav.appendChild(t.nextMonthNav)}function Ce(){return t.monthNav=Le("div","flatpickr-months"),t.yearElements=[],t.monthElements=[],t.prevMonthNav=Le("span","flatpickr-prev-month"),t.prevMonthNav.innerHTML=t.config.prevArrow,t.nextMonthNav=Le("span","flatpickr-next-month"),t.nextMonthNav.innerHTML=t.config.nextArrow,rt(),Object.defineProperty(t,"_hidePrevMonthArrow",{get:function(){return t.__hidePrevMonthArrow},set:function(E){t.__hidePrevMonthArrow!==E&&(ei(t.prevMonthNav,"flatpickr-disabled",E),t.__hidePrevMonthArrow=E)}}),Object.defineProperty(t,"_hideNextMonthArrow",{get:function(){return t.__hideNextMonthArrow},set:function(E){t.__hideNextMonthArrow!==E&&(ei(t.nextMonthNav,"flatpickr-disabled",E),t.__hideNextMonthArrow=E)}}),t.currentYearElement=t.yearElements[0],ts(),t.monthNav}function $e(){t.calendarContainer.classList.add("hasTime"),t.config.noCalendar&&t.calendarContainer.classList.add("noCalendar");var E=gd(t.config);t.timeContainer=Le("div","flatpickr-time"),t.timeContainer.tabIndex=-1;var C=Le("span","flatpickr-time-separator",":"),N=nl("flatpickr-hour",{"aria-label":t.l10n.hourAriaLabel});t.hourElement=N.getElementsByTagName("input")[0];var U=nl("flatpickr-minute",{"aria-label":t.l10n.minuteAriaLabel});if(t.minuteElement=U.getElementsByTagName("input")[0],t.hourElement.tabIndex=t.minuteElement.tabIndex=-1,t.hourElement.value=gi(t.latestSelectedDateObj?t.latestSelectedDateObj.getHours():t.config.time_24hr?E.hours:h(E.hours)),t.minuteElement.value=gi(t.latestSelectedDateObj?t.latestSelectedDateObj.getMinutes():E.minutes),t.hourElement.setAttribute("step",t.config.hourIncrement.toString()),t.minuteElement.setAttribute("step",t.config.minuteIncrement.toString()),t.hourElement.setAttribute("min",t.config.time_24hr?"0":"1"),t.hourElement.setAttribute("max",t.config.time_24hr?"23":"12"),t.hourElement.setAttribute("maxlength","2"),t.minuteElement.setAttribute("min","0"),t.minuteElement.setAttribute("max","59"),t.minuteElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(N),t.timeContainer.appendChild(C),t.timeContainer.appendChild(U),t.config.time_24hr&&t.timeContainer.classList.add("time24hr"),t.config.enableSeconds){t.timeContainer.classList.add("hasSeconds");var W=nl("flatpickr-second");t.secondElement=W.getElementsByTagName("input")[0],t.secondElement.value=gi(t.latestSelectedDateObj?t.latestSelectedDateObj.getSeconds():E.seconds),t.secondElement.setAttribute("step",t.minuteElement.getAttribute("step")),t.secondElement.setAttribute("min","0"),t.secondElement.setAttribute("max","59"),t.secondElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(Le("span","flatpickr-time-separator",":")),t.timeContainer.appendChild(W)}return t.config.time_24hr||(t.amPM=Le("span","flatpickr-am-pm",t.l10n.amPM[Bi((t.latestSelectedDateObj?t.hourElement.value:t.config.defaultHour)>11)]),t.amPM.title=t.l10n.toggleTitle,t.amPM.tabIndex=-1,t.timeContainer.appendChild(t.amPM)),t.timeContainer}function tt(){t.weekdayContainer?il(t.weekdayContainer):t.weekdayContainer=Le("div","flatpickr-weekdays");for(var E=t.config.showMonths;E--;){var C=Le("div","flatpickr-weekdaycontainer");t.weekdayContainer.appendChild(C)}return Nt(),t.weekdayContainer}function Nt(){if(t.weekdayContainer){var E=t.l10n.firstDayOfWeek,C=uy(t.l10n.weekdays.shorthand);E>0&&E<C.length&&(C=uy(C.splice(E,C.length),C.splice(0,E)));for(var N=t.config.showMonths;N--;)t.weekdayContainer.children[N].innerHTML=`
      <span class='flatpickr-weekday'>
        `+C.join("</span><span class='flatpickr-weekday'>")+`
      </span>
      `}}function bt(){t.calendarContainer.classList.add("hasWeeks");var E=Le("div","flatpickr-weekwrapper");E.appendChild(Le("span","flatpickr-weekday",t.l10n.weekAbbreviation));var C=Le("div","flatpickr-weeks");return E.appendChild(C),{weekWrapper:E,weekNumbers:C}}function kt(E,C){C===void 0&&(C=!0);var N=C?E:E-t.currentMonth;N<0&&t._hidePrevMonthArrow===!0||N>0&&t._hideNextMonthArrow===!0||(t.currentMonth+=N,(t.currentMonth<0||t.currentMonth>11)&&(t.currentYear+=t.currentMonth>11?1:-1,t.currentMonth=(t.currentMonth+12)%12,Ye("onYearChange"),X()),me(),Ye("onMonthChange"),ts())}function hi(E,C){if(E===void 0&&(E=!0),C===void 0&&(C=!0),t.input.value="",t.altInput!==void 0&&(t.altInput.value=""),t.mobileInput!==void 0&&(t.mobileInput.value=""),t.selectedDates=[],t.latestSelectedDateObj=void 0,C===!0&&(t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth()),t.config.enableTime===!0){var N=gd(t.config),U=N.hours,W=N.minutes,ee=N.seconds;T(U,W,ee)}t.redraw(),E&&Ye("onChange")}function tn(){t.isOpen=!1,t.isMobile||(t.calendarContainer!==void 0&&t.calendarContainer.classList.remove("open"),t._input!==void 0&&t._input.classList.remove("active")),Ye("onClose")}function Qn(){t.config!==void 0&&Ye("onDestroy");for(var E=t._handlers.length;E--;)t._handlers[E].remove();if(t._handlers=[],t.mobileInput)t.mobileInput.parentNode&&t.mobileInput.parentNode.removeChild(t.mobileInput),t.mobileInput=void 0;else if(t.calendarContainer&&t.calendarContainer.parentNode)if(t.config.static&&t.calendarContainer.parentNode){var C=t.calendarContainer.parentNode;if(C.lastChild&&C.removeChild(C.lastChild),C.parentNode){for(;C.firstChild;)C.parentNode.insertBefore(C.firstChild,C);C.parentNode.removeChild(C)}}else t.calendarContainer.parentNode.removeChild(t.calendarContainer);t.altInput&&(t.input.type="text",t.altInput.parentNode&&t.altInput.parentNode.removeChild(t.altInput),delete t.altInput),t.input&&(t.input.type=t.input._type,t.input.classList.remove("flatpickr-input"),t.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(N){try{delete t[N]}catch{}})}function Oi(E){return t.calendarContainer.contains(E)}function nn(E){if(t.isOpen&&!t.config.inline){var C=Ai(E),N=Oi(C),U=C===t.input||C===t.altInput||t.element.contains(C)||E.path&&E.path.indexOf&&(~E.path.indexOf(t.input)||~E.path.indexOf(t.altInput)),W=!U&&!N&&!Oi(E.relatedTarget),ee=!t.config.ignoredFocusElements.some(function(ye){return ye.contains(C)});W&&ee&&(t.config.allowInput&&t.setDate(t._input.value,!1,t.config.altInput?t.config.altFormat:t.config.dateFormat),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0&&t.input.value!==""&&t.input.value!==void 0&&u(),t.close(),t.config&&t.config.mode==="range"&&t.selectedDates.length===1&&t.clear(!1))}}function rn(E){if(!(!E||t.config.minDate&&E<t.config.minDate.getFullYear()||t.config.maxDate&&E>t.config.maxDate.getFullYear())){var C=E,N=t.currentYear!==C;t.currentYear=C||t.currentYear,t.config.maxDate&&t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth=Math.min(t.config.maxDate.getMonth(),t.currentMonth):t.config.minDate&&t.currentYear===t.config.minDate.getFullYear()&&(t.currentMonth=Math.max(t.config.minDate.getMonth(),t.currentMonth)),N&&(t.redraw(),Ye("onYearChange"),X())}}function Si(E,C){var N;C===void 0&&(C=!0);var U=t.parseDate(E,void 0,C);if(t.config.minDate&&U&&Di(U,t.config.minDate,C!==void 0?C:!t.minDateHasTime)<0||t.config.maxDate&&U&&Di(U,t.config.maxDate,C!==void 0?C:!t.maxDateHasTime)>0)return!1;if(!t.config.enable&&t.config.disable.length===0)return!0;if(U===void 0)return!1;for(var W=!!t.config.enable,ee=(N=t.config.enable)!==null&&N!==void 0?N:t.config.disable,ye=0,se=void 0;ye<ee.length;ye++){if(se=ee[ye],typeof se=="function"&&se(U))return W;if(se instanceof Date&&U!==void 0&&se.getTime()===U.getTime())return W;if(typeof se=="string"){var Se=t.parseDate(se,void 0,!0);return Se&&Se.getTime()===U.getTime()?W:!W}else if(typeof se=="object"&&U!==void 0&&se.from&&se.to&&U.getTime()>=se.from.getTime()&&U.getTime()<=se.to.getTime())return W}return!W}function Q(E){return t.daysContainer!==void 0?E.className.indexOf("hidden")===-1&&E.className.indexOf("flatpickr-disabled")===-1&&t.daysContainer.contains(E):!1}function de(E){var C=E.target===t._input,N=t._input.value.trimEnd()!==Oa();C&&N&&!(E.relatedTarget&&Oi(E.relatedTarget))&&t.setDate(t._input.value,!0,E.target===t.altInput?t.config.altFormat:t.config.dateFormat)}function Ke(E){var C=Ai(E),N=t.config.wrap?i.contains(C):C===t._input,U=t.config.allowInput,W=t.isOpen&&(!U||!N),ee=t.config.inline&&N&&!U;if(E.keyCode===13&&N){if(U)return t.setDate(t._input.value,!0,C===t.altInput?t.config.altFormat:t.config.dateFormat),t.close(),C.blur();t.open()}else if(Oi(C)||W||ee){var ye=!!t.timeContainer&&t.timeContainer.contains(C);switch(E.keyCode){case 13:ye?(E.preventDefault(),u(),Zn()):Dn(E);break;case 27:E.preventDefault(),Zn();break;case 8:case 46:N&&!t.config.allowInput&&(E.preventDefault(),t.clear());break;case 37:case 39:if(!ye&&!N){E.preventDefault();var se=s();if(t.daysContainer!==void 0&&(U===!1||se&&Q(se))){var Se=E.keyCode===39?1:-1;E.ctrlKey?(E.stopPropagation(),kt(Se),he(ie(1),0)):he(void 0,Se)}}else t.hourElement&&t.hourElement.focus();break;case 38:case 40:E.preventDefault();var ne=E.keyCode===40?1:-1;t.daysContainer&&C.$i!==void 0||C===t.input||C===t.altInput?E.ctrlKey?(E.stopPropagation(),rn(t.currentYear-ne),he(ie(1),0)):ye||he(void 0,ne*7):C===t.currentYearElement?rn(t.currentYear-ne):t.config.enableTime&&(!ye&&t.hourElement&&t.hourElement.focus(),u(E),t._debouncedChange());break;case 9:if(ye){var ue=[t.hourElement,t.minuteElement,t.secondElement,t.amPM].concat(t.pluginElements).filter(function(Qt){return Qt}),be=ue.indexOf(C);if(be!==-1){var Li=ue[be+(E.shiftKey?-1:1)];E.preventDefault(),(Li||t._input).focus()}}else!t.config.noCalendar&&t.daysContainer&&t.daysContainer.contains(C)&&E.shiftKey&&(E.preventDefault(),t._input.focus());break}}if(t.amPM!==void 0&&C===t.amPM)switch(E.key){case t.l10n.amPM[0].charAt(0):case t.l10n.amPM[0].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[0],g(),Gi();break;case t.l10n.amPM[1].charAt(0):case t.l10n.amPM[1].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[1],g(),Gi();break}(N||Oi(C))&&Ye("onKeyDown",E)}function Xe(E,C){if(C===void 0&&(C="flatpickr-day"),!(t.selectedDates.length!==1||E&&(!E.classList.contains(C)||E.classList.contains("flatpickr-disabled")))){for(var N=E?E.dateObj.getTime():t.days.firstElementChild.dateObj.getTime(),U=t.parseDate(t.selectedDates[0],void 0,!0).getTime(),W=Math.min(N,t.selectedDates[0].getTime()),ee=Math.max(N,t.selectedDates[0].getTime()),ye=!1,se=0,Se=0,ne=W;ne<ee;ne+=qM.DAY)Si(new Date(ne),!0)||(ye=ye||ne>W&&ne<ee,ne<U&&(!se||ne>se)?se=ne:ne>U&&(!Se||ne<Se)&&(Se=ne));var ue=Array.from(t.rContainer.querySelectorAll("*:nth-child(-n+"+t.config.showMonths+") > ."+C));ue.forEach(function(be){var Li=be.dateObj,Qt=Li.getTime(),sn=se>0&&Qt<se||Se>0&&Qt>Se;if(sn){be.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(Mt){be.classList.remove(Mt)});return}else if(ye&&!sn)return;["startRange","inRange","endRange","notAllowed"].forEach(function(Mt){be.classList.remove(Mt)}),E!==void 0&&(E.classList.add(N<=t.selectedDates[0].getTime()?"startRange":"endRange"),U<N&&Qt===U?be.classList.add("startRange"):U>N&&Qt===U&&be.classList.add("endRange"),Qt>=se&&(Se===0||Qt<=Se)&&jM(Qt,U,N)&&be.classList.add("inRange"))})}}function di(){t.isOpen&&!t.config.static&&!t.config.inline&&qi()}function dt(E,C){if(C===void 0&&(C=t._positionElement),t.isMobile===!0){if(E){E.preventDefault();var N=Ai(E);N&&N.blur()}t.mobileInput!==void 0&&(t.mobileInput.focus(),t.mobileInput.click()),Ye("onOpen");return}else if(t._input.disabled||t.config.inline)return;var U=t.isOpen;t.isOpen=!0,U||(t.calendarContainer.classList.add("open"),t._input.classList.add("active"),Ye("onOpen"),qi(C)),t.config.enableTime===!0&&t.config.noCalendar===!0&&t.config.allowInput===!1&&(E===void 0||!t.timeContainer.contains(E.relatedTarget))&&setTimeout(function(){return t.hourElement.select()},50)}function Tr(E){return function(C){var N=t.config["_"+E+"Date"]=t.parseDate(C,t.config.dateFormat),U=t.config["_"+(E==="min"?"max":"min")+"Date"];N!==void 0&&(t[E==="min"?"minDateHasTime":"maxDateHasTime"]=N.getHours()>0||N.getMinutes()>0||N.getSeconds()>0),t.selectedDates&&(t.selectedDates=t.selectedDates.filter(function(W){return Si(W)}),!t.selectedDates.length&&E==="min"&&y(N),Gi()),t.daysContainer&&(fi(),N!==void 0?t.currentYearElement[E]=N.getFullYear().toString():t.currentYearElement.removeAttribute(E),t.currentYearElement.disabled=!!U&&N!==void 0&&U.getFullYear()===N.getFullYear())}}function Jn(){var E=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],C=Vt(Vt({},JSON.parse(JSON.stringify(i.dataset||{}))),e),N={};t.config.parseDate=C.parseDate,t.config.formatDate=C.formatDate,Object.defineProperty(t.config,"enable",{get:function(){return t.config._enable},set:function(ue){t.config._enable=ka(ue)}}),Object.defineProperty(t.config,"disable",{get:function(){return t.config._disable},set:function(ue){t.config._disable=ka(ue)}});var U=C.mode==="time";if(!C.dateFormat&&(C.enableTime||U)){var W=mt.defaultConfig.dateFormat||Hs.dateFormat;N.dateFormat=C.noCalendar||U?"H:i"+(C.enableSeconds?":S":""):W+" H:i"+(C.enableSeconds?":S":"")}if(C.altInput&&(C.enableTime||U)&&!C.altFormat){var ee=mt.defaultConfig.altFormat||Hs.altFormat;N.altFormat=C.noCalendar||U?"h:i"+(C.enableSeconds?":S K":" K"):ee+(" h:i"+(C.enableSeconds?":S":"")+" K")}Object.defineProperty(t.config,"minDate",{get:function(){return t.config._minDate},set:Tr("min")}),Object.defineProperty(t.config,"maxDate",{get:function(){return t.config._maxDate},set:Tr("max")});var ye=function(ue){return function(be){t.config[ue==="min"?"_minTime":"_maxTime"]=t.parseDate(be,"H:i:S")}};Object.defineProperty(t.config,"minTime",{get:function(){return t.config._minTime},set:ye("min")}),Object.defineProperty(t.config,"maxTime",{get:function(){return t.config._maxTime},set:ye("max")}),C.mode==="time"&&(t.config.noCalendar=!0,t.config.enableTime=!0),Object.assign(t.config,N,C);for(var se=0;se<E.length;se++)t.config[E[se]]=t.config[E[se]]===!0||t.config[E[se]]==="true";dd.filter(function(ue){return t.config[ue]!==void 0}).forEach(function(ue){t.config[ue]=fd(t.config[ue]||[]).map(a)}),t.isMobile=!t.config.disableMobile&&!t.config.inline&&t.config.mode==="single"&&!t.config.disable.length&&!t.config.enable&&!t.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var se=0;se<t.config.plugins.length;se++){var Se=t.config.plugins[se](t)||{};for(var ne in Se)dd.indexOf(ne)>-1?t.config[ne]=fd(Se[ne]).map(a).concat(t.config[ne]):typeof C[ne]>"u"&&(t.config[ne]=Se[ne])}C.altInputClass||(t.config.altInputClass=Yt().className+" "+t.config.altInputClass),Ye("onParseConfig")}function Yt(){return t.config.wrap?i.querySelector("[data-input]"):i}function xi(){typeof t.config.locale!="object"&&typeof mt.l10ns[t.config.locale]>"u"&&t.config.errorHandler(new Error("flatpickr: invalid locale "+t.config.locale)),t.l10n=Vt(Vt({},mt.l10ns.default),typeof t.config.locale=="object"?t.config.locale:t.config.locale!=="default"?mt.l10ns[t.config.locale]:void 0),Pr.D="("+t.l10n.weekdays.shorthand.join("|")+")",Pr.l="("+t.l10n.weekdays.longhand.join("|")+")",Pr.M="("+t.l10n.months.shorthand.join("|")+")",Pr.F="("+t.l10n.months.longhand.join("|")+")",Pr.K="("+t.l10n.amPM[0]+"|"+t.l10n.amPM[1]+"|"+t.l10n.amPM[0].toLowerCase()+"|"+t.l10n.amPM[1].toLowerCase()+")";var E=Vt(Vt({},e),JSON.parse(JSON.stringify(i.dataset||{})));E.time_24hr===void 0&&mt.defaultConfig.time_24hr===void 0&&(t.config.time_24hr=t.l10n.time_24hr),t.formatDate=Z2(t),t.parseDate=If({config:t.config,l10n:t.l10n})}function qi(E){if(typeof t.config.position=="function")return void t.config.position(t,E);if(t.calendarContainer!==void 0){Ye("onPreCalendarPosition");var C=E||t._positionElement,N=Array.prototype.reduce.call(t.calendarContainer.children,function(Tu,ss){return Tu+ss.offsetHeight},0),U=t.calendarContainer.offsetWidth,W=t.config.position.split(" "),ee=W[0],ye=W.length>1?W[1]:null,se=C.getBoundingClientRect(),Se=window.innerHeight-se.bottom,ne=ee==="above"||ee!=="below"&&Se<N&&se.top>N,ue=window.pageYOffset+se.top+(ne?-N-2:C.offsetHeight+2);if(ei(t.calendarContainer,"arrowTop",!ne),ei(t.calendarContainer,"arrowBottom",ne),!t.config.inline){var be=window.pageXOffset+se.left,Li=!1,Qt=!1;ye==="center"?(be-=(U-se.width)/2,Li=!0):ye==="right"&&(be-=U-se.width,Qt=!0),ei(t.calendarContainer,"arrowLeft",!Li&&!Qt),ei(t.calendarContainer,"arrowCenter",Li),ei(t.calendarContainer,"arrowRight",Qt);var sn=window.document.body.offsetWidth-(window.pageXOffset+se.right),Mt=be+U>window.document.body.offsetWidth,is=sn+U>window.document.body.offsetWidth;if(ei(t.calendarContainer,"rightMost",Mt),!t.config.static)if(t.calendarContainer.style.top=ue+"px",!Mt)t.calendarContainer.style.left=be+"px",t.calendarContainer.style.right="auto";else if(!is)t.calendarContainer.style.left="auto",t.calendarContainer.style.right=sn+"px";else{var Oe=z();if(Oe===void 0)return;var lh=window.document.body.offsetWidth,ns=Math.max(0,lh/2-U/2),rs=".flatpickr-calendar.centerMost:before",ch=".flatpickr-calendar.centerMost:after",In=Oe.cssRules.length,He="{left:"+se.left+"px;right:auto;}";ei(t.calendarContainer,"rightMost",!1),ei(t.calendarContainer,"centerMost",!0),Oe.insertRule(rs+","+ch+He,In),t.calendarContainer.style.left=ns+"px",t.calendarContainer.style.right="auto"}}}}function z(){for(var E=null,C=0;C<document.styleSheets.length;C++){var N=document.styleSheets[C];if(N.cssRules){try{N.cssRules}catch{continue}E=N;break}}return E??ot()}function ot(){var E=document.createElement("style");return document.head.appendChild(E),E.sheet}function fi(){t.config.noCalendar||t.isMobile||(X(),ts(),me())}function Zn(){t._input.focus(),window.navigator.userAgent.indexOf("MSIE")!==-1||navigator.msMaxTouchPoints!==void 0?setTimeout(t.close,0):t.close()}function Dn(E){E.preventDefault(),E.stopPropagation();var C=function(ue){return ue.classList&&ue.classList.contains("flatpickr-day")&&!ue.classList.contains("flatpickr-disabled")&&!ue.classList.contains("notAllowed")},N=J2(Ai(E),C);if(N!==void 0){var U=N,W=t.latestSelectedDateObj=new Date(U.dateObj.getTime()),ee=(W.getMonth()<t.currentMonth||W.getMonth()>t.currentMonth+t.config.showMonths-1)&&t.config.mode!=="range";if(t.selectedDateElem=U,t.config.mode==="single")t.selectedDates=[W];else if(t.config.mode==="multiple"){var ye=Ra(W);ye?t.selectedDates.splice(parseInt(ye),1):t.selectedDates.push(W)}else t.config.mode==="range"&&(t.selectedDates.length===2&&t.clear(!1,!1),t.latestSelectedDateObj=W,t.selectedDates.push(W),Di(W,t.selectedDates[0],!0)!==0&&t.selectedDates.sort(function(ue,be){return ue.getTime()-be.getTime()}));if(g(),ee){var se=t.currentYear!==W.getFullYear();t.currentYear=W.getFullYear(),t.currentMonth=W.getMonth(),se&&(Ye("onYearChange"),X()),Ye("onMonthChange")}if(ts(),me(),Gi(),!ee&&t.config.mode!=="range"&&t.config.showMonths===1?V(U):t.selectedDateElem!==void 0&&t.hourElement===void 0&&t.selectedDateElem&&t.selectedDateElem.focus(),t.hourElement!==void 0&&t.hourElement!==void 0&&t.hourElement.focus(),t.config.closeOnSelect){var Se=t.config.mode==="single"&&!t.config.enableTime,ne=t.config.mode==="range"&&t.selectedDates.length===2&&!t.config.enableTime;(Se||ne)&&Zn()}A()}}var Hi={locale:[xi,Nt],showMonths:[rt,o,tt],minDate:[P],maxDate:[P],positionElement:[qe],clickOpens:[function(){t.config.clickOpens===!0?(x(t._input,"focus",t.open),x(t._input,"click",t.open)):(t._input.removeEventListener("focus",t.open),t._input.removeEventListener("click",t.open))}]};function Da(E,C){if(E!==null&&typeof E=="object"){Object.assign(t.config,E);for(var N in E)Hi[N]!==void 0&&Hi[N].forEach(function(U){return U()})}else t.config[E]=C,Hi[E]!==void 0?Hi[E].forEach(function(U){return U()}):dd.indexOf(E)>-1&&(t.config[E]=fd(C));t.redraw(),Gi(!0)}function br(E,C){var N=[];if(E instanceof Array)N=E.map(function(U){return t.parseDate(U,C)});else if(E instanceof Date||typeof E=="number")N=[t.parseDate(E,C)];else if(typeof E=="string")switch(t.config.mode){case"single":case"time":N=[t.parseDate(E,C)];break;case"multiple":N=E.split(t.config.conjunction).map(function(U){return t.parseDate(U,C)});break;case"range":N=E.split(t.l10n.rangeSeparator).map(function(U){return t.parseDate(U,C)});break}else t.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(E)));t.selectedDates=t.config.allowInvalidPreload?N:N.filter(function(U){return U instanceof Date&&Si(U,!1)}),t.config.mode==="range"&&t.selectedDates.sort(function(U,W){return U.getTime()-W.getTime()})}function Ia(E,C,N){if(C===void 0&&(C=!1),N===void 0&&(N=t.config.dateFormat),E!==0&&!E||E instanceof Array&&E.length===0)return t.clear(C);br(E,N),t.latestSelectedDateObj=t.selectedDates[t.selectedDates.length-1],t.redraw(),P(void 0,C),y(),t.selectedDates.length===0&&t.clear(!1),Gi(C),C&&Ye("onChange")}function ka(E){return E.slice().map(function(C){return typeof C=="string"||typeof C=="number"||C instanceof Date?t.parseDate(C,void 0,!0):C&&typeof C=="object"&&C.from&&C.to?{from:t.parseDate(C.from,void 0),to:t.parseDate(C.to,void 0)}:C}).filter(function(C){return C})}function yu(){t.selectedDates=[],t.now=t.parseDate(t.config.now)||new Date;var E=t.config.defaultDate||((t.input.nodeName==="INPUT"||t.input.nodeName==="TEXTAREA")&&t.input.placeholder&&t.input.value===t.input.placeholder?null:t.input.value);E&&br(E,t.config.dateFormat),t._initialDate=t.selectedDates.length>0?t.selectedDates[0]:t.config.minDate&&t.config.minDate.getTime()>t.now.getTime()?t.config.minDate:t.config.maxDate&&t.config.maxDate.getTime()<t.now.getTime()?t.config.maxDate:t.now,t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth(),t.selectedDates.length>0&&(t.latestSelectedDateObj=t.selectedDates[0]),t.config.minTime!==void 0&&(t.config.minTime=t.parseDate(t.config.minTime,"H:i")),t.config.maxTime!==void 0&&(t.config.maxTime=t.parseDate(t.config.maxTime,"H:i")),t.minDateHasTime=!!t.config.minDate&&(t.config.minDate.getHours()>0||t.config.minDate.getMinutes()>0||t.config.minDate.getSeconds()>0),t.maxDateHasTime=!!t.config.maxDate&&(t.config.maxDate.getHours()>0||t.config.maxDate.getMinutes()>0||t.config.maxDate.getSeconds()>0)}function vu(){if(t.input=Yt(),!t.input){t.config.errorHandler(new Error("Invalid input element specified"));return}t.input._type=t.input.type,t.input.type="text",t.input.classList.add("flatpickr-input"),t._input=t.input,t.config.altInput&&(t.altInput=Le(t.input.nodeName,t.config.altInputClass),t._input=t.altInput,t.altInput.placeholder=t.input.placeholder,t.altInput.disabled=t.input.disabled,t.altInput.required=t.input.required,t.altInput.tabIndex=t.input.tabIndex,t.altInput.type="text",t.input.setAttribute("type","hidden"),!t.config.static&&t.input.parentNode&&t.input.parentNode.insertBefore(t.altInput,t.input.nextSibling)),t.config.allowInput||t._input.setAttribute("readonly","readonly"),qe()}function qe(){t._positionElement=t.config.positionElement||t._input}function sh(){var E=t.config.enableTime?t.config.noCalendar?"time":"datetime-local":"date";t.mobileInput=Le("input",t.input.className+" flatpickr-mobile"),t.mobileInput.tabIndex=1,t.mobileInput.type=E,t.mobileInput.disabled=t.input.disabled,t.mobileInput.required=t.input.required,t.mobileInput.placeholder=t.input.placeholder,t.mobileFormatStr=E==="datetime-local"?"Y-m-d\\TH:i:S":E==="date"?"Y-m-d":"H:i:S",t.selectedDates.length>0&&(t.mobileInput.defaultValue=t.mobileInput.value=t.formatDate(t.selectedDates[0],t.mobileFormatStr)),t.config.minDate&&(t.mobileInput.min=t.formatDate(t.config.minDate,"Y-m-d")),t.config.maxDate&&(t.mobileInput.max=t.formatDate(t.config.maxDate,"Y-m-d")),t.input.getAttribute("step")&&(t.mobileInput.step=String(t.input.getAttribute("step"))),t.input.type="hidden",t.altInput!==void 0&&(t.altInput.type="hidden");try{t.input.parentNode&&t.input.parentNode.insertBefore(t.mobileInput,t.input.nextSibling)}catch{}x(t.mobileInput,"change",function(C){t.setDate(Ai(C).value,!1,t.mobileFormatStr),Ye("onChange"),Ye("onClose")})}function es(E){if(t.isOpen===!0)return t.close();t.open(E)}function Ye(E,C){if(t.config!==void 0){var N=t.config[E];if(N!==void 0&&N.length>0)for(var U=0;N[U]&&U<N.length;U++)N[U](t.selectedDates,t.input.value,t,C);E==="onChange"&&(t.input.dispatchEvent(Pa("change")),t.input.dispatchEvent(Pa("input")))}}function Pa(E){var C=document.createEvent("Event");return C.initEvent(E,!0,!0),C}function Ra(E){for(var C=0;C<t.selectedDates.length;C++){var N=t.selectedDates[C];if(N instanceof Date&&Di(N,E)===0)return""+C}return!1}function ah(E){return t.config.mode!=="range"||t.selectedDates.length<2?!1:Di(E,t.selectedDates[0])>=0&&Di(E,t.selectedDates[1])<=0}function ts(){t.config.noCalendar||t.isMobile||!t.monthNav||(t.yearElements.forEach(function(E,C){var N=new Date(t.currentYear,t.currentMonth,1);N.setMonth(t.currentMonth+C),t.config.showMonths>1||t.config.monthSelectorType==="static"?t.monthElements[C].textContent=ac(N.getMonth(),t.config.shorthandCurrentMonth,t.l10n)+" ":t.monthsDropdownContainer.value=N.getMonth().toString(),E.value=N.getFullYear().toString()}),t._hidePrevMonthArrow=t.config.minDate!==void 0&&(t.currentYear===t.config.minDate.getFullYear()?t.currentMonth<=t.config.minDate.getMonth():t.currentYear<t.config.minDate.getFullYear()),t._hideNextMonthArrow=t.config.maxDate!==void 0&&(t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth+1>t.config.maxDate.getMonth():t.currentYear>t.config.maxDate.getFullYear()))}function Oa(E){var C=E||(t.config.altInput?t.config.altFormat:t.config.dateFormat);return t.selectedDates.map(function(N){return t.formatDate(N,C)}).filter(function(N,U,W){return t.config.mode!=="range"||t.config.enableTime||W.indexOf(N)===U}).join(t.config.mode!=="range"?t.config.conjunction:t.l10n.rangeSeparator)}function Gi(E){E===void 0&&(E=!0),t.mobileInput!==void 0&&t.mobileFormatStr&&(t.mobileInput.value=t.latestSelectedDateObj!==void 0?t.formatDate(t.latestSelectedDateObj,t.mobileFormatStr):""),t.input.value=Oa(t.config.dateFormat),t.altInput!==void 0&&(t.altInput.value=Oa(t.config.altFormat)),E!==!1&&Ye("onValueUpdate")}function oh(E){var C=Ai(E),N=t.prevMonthNav.contains(C),U=t.nextMonthNav.contains(C);N||U?kt(N?-1:1):t.yearElements.indexOf(C)>=0?C.select():C.classList.contains("arrowUp")?t.changeYear(t.currentYear+1):C.classList.contains("arrowDown")&&t.changeYear(t.currentYear-1)}function uh(E){E.preventDefault();var C=E.type==="keydown",N=Ai(E),U=N;t.amPM!==void 0&&N===t.amPM&&(t.amPM.textContent=t.l10n.amPM[Bi(t.amPM.textContent===t.l10n.amPM[0])]);var W=parseFloat(U.getAttribute("min")),ee=parseFloat(U.getAttribute("max")),ye=parseFloat(U.getAttribute("step")),se=parseInt(U.value,10),Se=E.delta||(C?E.which===38?1:-1:0),ne=se+ye*Se;if(typeof U.value<"u"&&U.value.length===2){var ue=U===t.hourElement,be=U===t.minuteElement;ne<W?(ne=ee+ne+Bi(!ue)+(Bi(ue)&&Bi(!t.amPM)),be&&O(void 0,-1,t.hourElement)):ne>ee&&(ne=U===t.hourElement?ne-ee-Bi(!t.amPM):W,be&&O(void 0,1,t.hourElement)),t.amPM&&ue&&(ye===1?ne+se===23:Math.abs(ne-se)>ye)&&(t.amPM.textContent=t.l10n.amPM[Bi(t.amPM.textContent===t.l10n.amPM[0])]),U.value=gi(ne)}}return r(),t}function Gs(i,e){for(var t=Array.prototype.slice.call(i).filter(function(a){return a instanceof HTMLElement}),n=[],r=0;r<t.length;r++){var s=t[r];try{if(s.getAttribute("data-fp-omit")!==null)continue;s._flatpickr!==void 0&&(s._flatpickr.destroy(),s._flatpickr=void 0),s._flatpickr=GM(s,e||{}),n.push(s._flatpickr)}catch(a){console.error(a)}}return n.length===1?n[0]:n}typeof HTMLElement<"u"&&typeof HTMLCollection<"u"&&typeof NodeList<"u"&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(i){return Gs(this,i)},HTMLElement.prototype.flatpickr=function(i){return Gs([this],i)});var mt=function(i,e){return typeof i=="string"?Gs(window.document.querySelectorAll(i),e):i instanceof Node?Gs([i],e):Gs(i,e)};mt.defaultConfig={};mt.l10ns={en:Vt({},zo),default:Vt({},zo)};mt.localize=function(i){mt.l10ns.default=Vt(Vt({},mt.l10ns.default),i)};mt.setDefaults=function(i){mt.defaultConfig=Vt(Vt({},mt.defaultConfig),i)};mt.parseDate=If({});mt.formatDate=Z2({});mt.compareDates=Di;typeof jQuery<"u"&&typeof jQuery.fn<"u"&&(jQuery.fn.flatpickr=function(i){return Gs(this,i)});Date.prototype.fp_incr=function(i){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(typeof i=="string"?parseInt(i,10):i))};typeof window<"u"&&(window.flatpickr=mt);function zM(i){let e,t=[i[1]],n={};for(let r=0;r<t.length;r+=1)n=ur(n,t[r]);return{c(){e=Fe("input"),Cg(e,n)},m(r,s){Dt(r,e,s),e.autofocus&&e.focus(),i[11](e)},p(r,s){Cg(e,n=Lf(t,[s&2&&r[1]]))},d(r){r&&Tt(e),i[11](null)}}}function WM(i){let e;const t=i[10].default,n=VS(t,i,i[9],null),r=n||zM(i);return{c(){r&&r.c()},m(s,a){r&&r.m(s,a),e=!0},p(s,[a]){n?n.p&&(!e||a&512)&&$S(n,t,s,s[9],e?jS(t,s[9],a,null):qS(s[9]),null):r&&r.p&&(!e||a&3)&&r.p(s,e?a:-1)},i(s){e||(Ue(r,s),e=!0)},o(s){Qe(r,s),e=!1},d(s){r&&r.d(s)}}}function KM(i){return i.charAt(2).toLowerCase()+i.substring(3)}function ly(i,e){var n;return(((n=i==null?void 0:i.config)==null?void 0:n.mode)??"single")==="single"?e[0]:e}function cy(i,e){return!!(i==e||i instanceof Date&&e instanceof Date&&i.valueOf()===e.valueOf()||Array.isArray(i)&&Array.isArray(e)&&i.length===e.length&&i.every((t,n)=>t===e[n]))}function XM(i,e,t){const n=["value","formattedValue","element","dateFormat","options","input","flatpickr"];let r=fl(e,n),{$$slots:s={},$$scope:a}=e;const o=new Set(["onChange","onOpen","onClose","onMonthChange","onYearChange","onReady","onValueUpdate","onDayCreate"]);let{value:u=void 0,formattedValue:c="",element:h=void 0,dateFormat:g=void 0}=e,{options:y={}}=e,T=!1,{input:v=void 0,flatpickr:x=void 0}=e;Ey(()=>{const O=h??v,R=D(y);return R.onReady.push(($,V,ie)=>{u===void 0&&P($,V,ie),KS().then(()=>{t(8,T=!0)})}),t(3,x=mt(O,Object.assign(R,h?{wrap:!0}:{}))),()=>{x.destroy()}});const A=Rf();function D(O={}){O=Object.assign({},O);for(const R of o){const $=(V,ie,Z)=>{A(KM(R),[V,ie,Z])};R in O?(Array.isArray(O[R])||(O[R]=[O[R]]),O[R].push($)):O[R]=[$]}return O.onChange&&!O.onChange.includes(P)&&O.onChange.push(P),O}function P(O,R,$){const V=ly($,O);!cy(u,V)&&(u||V)&&t(2,u=V),t(4,c=R)}function M(O){Bt[O?"unshift":"push"](()=>{v=O,t(0,v)})}return i.$$set=O=>{e=ur(ur({},e),vy(O)),t(1,r=fl(e,n)),"value"in O&&t(2,u=O.value),"formattedValue"in O&&t(4,c=O.formattedValue),"element"in O&&t(5,h=O.element),"dateFormat"in O&&t(6,g=O.dateFormat),"options"in O&&t(7,y=O.options),"input"in O&&t(0,v=O.input),"flatpickr"in O&&t(3,x=O.flatpickr),"$$scope"in O&&t(9,a=O.$$scope)},i.$$.update=()=>{if(i.$$.dirty&332&&x&&T&&(cy(u,ly(x,x.selectedDates))||x.setDate(u,!0,g)),i.$$.dirty&392&&x&&T)for(const[O,R]of Object.entries(D(y)))x.set(O,R)},[v,r,u,x,c,h,g,y,T,a,s,M]}class e1 extends Kn{constructor(e){super(),Wn(this,e,XM,WM,zn,{value:2,formattedValue:4,element:5,dateFormat:6,options:7,input:0,flatpickr:3})}}function YM(i){let e,t,n,r,s;return r=new da({props:{src:xM,size:"1.5em"}}),{c(){e=Fe("div"),t=Fe("div"),n=Fe("button"),_i(r.$$.fragment),we(n,"class","bg-gray-700 rounded-md p-1 text-white"),we(n,"data-toggle",""),we(t,"data-input",""),we(e,"class","flatpickr"),we(e,"id","date-picker")},m(a,o){Dt(a,e,o),De(e,t),De(t,n),ti(r,n,null),s=!0},p:et,i(a){s||(Ue(r.$$.fragment,a),s=!0)},o(a){Qe(r.$$.fragment,a),s=!1},d(a){a&&Tt(e),ii(r)}}}function QM(i){let e,t;return e=new e1({props:{element:"#date-picker",value:i[0],$$slots:{default:[YM]},$$scope:{ctx:i}}}),e.$on("close",i[1]),{c(){_i(e.$$.fragment)},m(n,r){ti(e,n,r),t=!0},p(n,[r]){const s={};r&1&&(s.value=n[0]),r&8&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(Ue(e.$$.fragment,n),t=!0)},o(n){Qe(e.$$.fragment,n),t=!1},d(n){ii(e,n)}}}function JM(i,e,t){let{value:n}=e;const r=Rf();function s(a){t(0,n=a.detail[0][0]),r("change",{value:n})}return i.$$set=a=>{"value"in a&&t(0,n=a.value)},[n,s]}class ZM extends Kn{constructor(e){super(),Wn(this,e,JM,QM,zn,{value:0})}}function eF(i){let e,t,n,r,s;return r=new da({props:{src:AM,size:"1.5em"}}),{c(){e=Fe("div"),t=Fe("div"),n=Fe("button"),_i(r.$$.fragment),we(n,"class","bg-gray-700 rounded-md p-1 text-white"),we(n,"data-toggle",""),we(t,"data-input",""),we(e,"class","flatpickr"),we(e,"id","time-picker")},m(a,o){Dt(a,e,o),De(e,t),De(t,n),ti(r,n,null),s=!0},p:et,i(a){s||(Ue(r.$$.fragment,a),s=!0)},o(a){Qe(r.$$.fragment,a),s=!1},d(a){a&&Tt(e),ii(r)}}}function tF(i){let e,t;return e=new e1({props:{element:"#time-picker",value:i[0],options:{enableTime:!0,noCalendar:!0,time_24hr:!0},$$slots:{default:[eF]},$$scope:{ctx:i}}}),e.$on("close",i[1]),{c(){_i(e.$$.fragment)},m(n,r){ti(e,n,r),t=!0},p(n,[r]){const s={};r&1&&(s.value=n[0]),r&8&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(Ue(e.$$.fragment,n),t=!0)},o(n){Qe(e.$$.fragment,n),t=!1},d(n){ii(e,n)}}}function iF(i,e,t){let{value:n}=e;const r=Rf();function s(a){t(0,n=a.detail[0][0]),r("change",{value:n})}return i.$$set=a=>{"value"in a&&t(0,n=a.value)},[n,s]}class nF extends Kn{constructor(e){super(),Wn(this,e,iF,tF,zn,{value:0})}}class hy{constructor(e,t){cs(this,"name");cs(this,"duration");this.name=e,this.duration=t}}function dy(i){let e,t,n,r,s,a=rl(i[2].getTime())+"",o,u,c,h,g,y,T,v,x,A,D,P=rl(i[2].getTime()+i[0])+"",M,O,R,$,V,ie,Z,he,_e,me,X,Ae,rt,Ce,$e,tt,Nt,bt,kt,hi;r=new da({props:{src:CM,size:"1.5em"}});function tn(z){i[22](z)}function Qn(z){i[23](z)}function Oi(z){i[24](z)}function nn(z){i[25](z)}function rn(z){i[26](z)}function Si(z){i[27](z)}let Q={setDate:i[16]};i[7]!==void 0&&(Q.intervals=i[7]),i[6]!==void 0&&(Q.sessions=i[6]),i[8]!==void 0&&(Q.flag=i[8]),i[1]!==void 0&&(Q.now=i[1]),i[2]!==void 0&&(Q.t0=i[2]),i[11]!==void 0&&(Q.t1=i[11]),c=new PR({props:Q}),Bt.push(()=>un(c,"intervals",tn)),Bt.push(()=>un(c,"sessions",Qn)),Bt.push(()=>un(c,"flag",Oi)),Bt.push(()=>un(c,"now",nn)),Bt.push(()=>un(c,"t0",rn)),Bt.push(()=>un(c,"t1",Si)),R=new da({props:{src:wM,size:"1.5em"}});let de=i[5]!=null&&fy(i);function Ke(z){i[29](z)}let Xe={};i[13]!==void 0&&(Xe.value=i[13]),Z=new ZM({props:Xe}),Bt.push(()=>un(Z,"value",Ke)),Z.$on("change",i[30]);function di(z){i[31](z)}let dt={};i[12]!==void 0&&(dt.value=i[12]),me=new nF({props:dt}),Bt.push(()=>un(me,"value",di)),me.$on("change",i[32]);function Tr(z,ot){return z[3]?sF:rF}let Jn=Tr(i),Yt=Jn(i);function xi(z){i[33](z)}let qi={};return i[0]!==void 0&&(qi.scale=i[0]),tt=new UM({props:qi}),Bt.push(()=>un(tt,"scale",xi)),{c(){e=Fe("div"),t=Fe("div"),n=Fe("button"),_i(r.$$.fragment),s=pi(),o=qr(a),u=pi(),_i(c.$$.fragment),A=pi(),D=Fe("button"),M=qr(P),O=pi(),_i(R.$$.fragment),$=pi(),V=Fe("div"),de&&de.c(),ie=pi(),_i(Z.$$.fragment),_e=pi(),_i(me.$$.fragment),Ae=pi(),Yt.c(),rt=pi(),Ce=Fe("div"),$e=pi(),_i(tt.$$.fragment),we(n,"class","flex p-1 space-x-1 bg-gray-700 text-white"),we(D,"class","flex p-1 space-x-1 bg-gray-700 text-white"),we(t,"class","flex w-full h-min bg-gray-500 items-center"),we(Ce,"class","flex-1"),we(V,"class","flex w-full p-4 bg-gray-500 items-center space-x-4"),we(e,"class","flex flex-col h-px")},m(z,ot){Dt(z,e,ot),De(e,t),De(t,n),ti(r,n,null),De(n,s),De(n,o),De(t,u),ti(c,t,null),De(t,A),De(t,D),De(D,M),De(D,O),ti(R,D,null),De(e,$),De(e,V),de&&de.m(V,null),De(V,ie),ti(Z,V,null),De(V,_e),ti(me,V,null),De(V,Ae),Yt.m(V,null),De(V,rt),De(V,Ce),De(V,$e),ti(tt,V,null),bt=!0,kt||(hi=[Xi(n,"click",i[21]),Xi(D,"click",i[28])],kt=!0)},p(z,ot){(!bt||ot[0]&4)&&a!==(a=rl(z[2].getTime())+"")&&_d(o,a);const fi={};!h&&ot[0]&128&&(h=!0,fi.intervals=z[7],on(()=>h=!1)),!g&&ot[0]&64&&(g=!0,fi.sessions=z[6],on(()=>g=!1)),!y&&ot[0]&256&&(y=!0,fi.flag=z[8],on(()=>y=!1)),!T&&ot[0]&2&&(T=!0,fi.now=z[1],on(()=>T=!1)),!v&&ot[0]&4&&(v=!0,fi.t0=z[2],on(()=>v=!1)),!x&&ot[0]&2048&&(x=!0,fi.t1=z[11],on(()=>x=!1)),c.$set(fi),(!bt||ot[0]&5)&&P!==(P=rl(z[2].getTime()+z[0])+"")&&_d(M,P),z[5]!=null?de?(de.p(z,ot),ot[0]&32&&Ue(de,1)):(de=fy(z),de.c(),Ue(de,1),de.m(V,ie)):de&&(Wo(),Qe(de,1,1,()=>{de=null}),Ko());const Zn={};!he&&ot[0]&8192&&(he=!0,Zn.value=z[13],on(()=>he=!1)),Z.$set(Zn);const Dn={};!X&&ot[0]&4096&&(X=!0,Dn.value=z[12],on(()=>X=!1)),me.$set(Dn),Jn===(Jn=Tr(z))&&Yt?Yt.p(z,ot):(Yt.d(1),Yt=Jn(z),Yt&&(Yt.c(),Yt.m(V,rt)));const Hi={};!Nt&&ot[0]&1&&(Nt=!0,Hi.scale=z[0],on(()=>Nt=!1)),tt.$set(Hi)},i(z){bt||(Ue(r.$$.fragment,z),Ue(c.$$.fragment,z),Ue(R.$$.fragment,z),Ue(de),Ue(Z.$$.fragment,z),Ue(me.$$.fragment,z),Ue(tt.$$.fragment,z),bt=!0)},o(z){Qe(r.$$.fragment,z),Qe(c.$$.fragment,z),Qe(R.$$.fragment,z),Qe(de),Qe(Z.$$.fragment,z),Qe(me.$$.fragment,z),Qe(tt.$$.fragment,z),bt=!1},d(z){z&&Tt(e),ii(r),ii(c),ii(R),de&&de.d(),ii(Z),ii(me),Yt.d(),ii(tt),kt=!1,Yr(hi)}}}function fy(i){let e,t;return e=new MM({props:{pause:i[14],unpause:i[15],paused:i[9]}}),{c(){_i(e.$$.fragment)},m(n,r){ti(e,n,r),t=!0},p(n,r){const s={};r[0]&512&&(s.paused=n[9]),e.$set(s)},i(n){t||(Ue(e.$$.fragment,n),t=!0)},o(n){Qe(e.$$.fragment,n),t=!1},d(n){ii(e,n)}}}function rF(i){let e,t,n;return{c(){e=Fe("button"),e.textContent="Ver ao vivo",we(e,"class","rounded-md bg-gray-700 text-white p-1 px-2")},m(r,s){Dt(r,e,s),t||(n=Xi(e,"click",i[17]),t=!0)},p:et,d(r){r&&Tt(e),t=!1,n()}}}function sF(i){let e;return{c(){e=Fe("div"),e.textContent="Ao Vivo",we(e,"class","rounded-md bg-red-600 text-white p-1")},m(t,n){Dt(t,e,n)},p:et,d(t){t&&Tt(e)}}}function aF(i){let e,t,n,r,s,a,o,u,c,h=i[6]!=null&&i[7]!=null&&dy(i);return{c(){e=Fe("div"),t=Fe("div"),n=Fe("video"),r=pi(),s=Fe("div"),a=qr("Não há gravações nesse período"),u=pi(),h&&h.c(),we(n,"id","vid1"),we(n,"class","video-js w-full"),n.autoplay=!0,we(n,"preload","auto"),we(t,"data-vjs-player",""),we(t,"class","player-container"),we(s,"class",o="w-full h-full absolute top-0 flex justify-center items-center text-white font-bold text-xl bg-black/50 "+(!i[10]&&"hidden")),we(e,"class","relative")},m(g,y){Dt(g,e,y),De(e,t),De(t,n),i[20](n),De(e,r),De(e,s),De(s,a),De(e,u),h&&h.m(e,null),c=!0},p(g,y){(!c||y[0]&1024&&o!==(o="w-full h-full absolute top-0 flex justify-center items-center text-white font-bold text-xl bg-black/50 "+(!g[10]&&"hidden")))&&we(s,"class",o),g[6]!=null&&g[7]!=null?h?(h.p(g,y),y[0]&192&&Ue(h,1)):(h=dy(g),h.c(),Ue(h,1),h.m(e,null)):h&&(Wo(),Qe(h,1,1,()=>{h=null}),Ko())},i(g){c||(Ue(h),c=!0)},o(g){Qe(h),c=!1},d(g){g&&Tt(e),i[20](null),h&&h.d()}}}function py(i,e){const t=new Date(i.getTime());return t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(0),t}function rl(i){return new Date(i).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}function oF(i,e,t){let n,r,{camera:s}=e,{tracks:a}=e,o=!0,u=a.length-1,c,h,g,y,T=!1,v=1e3*60*10,x=!1,A=!1,D=new Date("2023-07-24T18:00:00"),P,M;Ey(async()=>(O(),t(6,g=await _e(s)),t(7,y=await X()),()=>{h.dispose()}));function O(){t(5,h=F(c,{})),h.src(a[u]),h.on("timeupdate",V)}function R(){t(9,x=!0),h.pause()}function $(){t(9,x=!1),h.play()}async function V(){if(g==null)return;if(x){h.pause();return}t(10,A=!1);const Q=h.currentTime();h.remainingTime()==0&&u!=a.length-1&&ie(u+1,0),await he(Q);const Ke=g[u].time;D.setTime(Ke.getTime()+Q*1e3),t(1,D)}function ie(Q,de){Q>=0&&Q<a.length&&(u!=Q&&(u=Q,h.src(a[u])),h.currentTime(de),t(3,o=!1))}async function Z(Q){let de=g.findIndex(Ke=>Ke.time.getTime()<=Q.getTime()&&Ke.end.getTime()>=Q.getTime());if(de!=-1){let Ke=(Q.getTime()-g[de].time.getTime())/1e3;Ke>g[de].duration&&(Ke=0,de+=1),t(10,A=!1),$(),ie(de,Ke)}else{t(10,A=!0),de=g.findIndex(Xe=>Xe.time.getTime()>=Q.getTime());let Ke=0;de==-1&&(de=a.length-1,Ke=g[de].duration),R(),ie(de,Ke)}t(1,D=Q)}async function he(Q){if(u!=a.length-1)return;let de=g[u].duration;for(;Q>de;)g[u].segments.push(new hy("PADDING",2)),de=g[u].duration;t(7,y=await X())}async function _e(Q){if(Q=="")return;const de=B2(),Ke=await Q2(z2(M2(de,"sessions"),W2("camera_id","==",Q),K2("session_id"))).then(di=>di.docs.map(dt=>({id:dt.id,...dt.data()})));return await Promise.all(Ke.map(async di=>new RR(di.id,di.time.toDate(),await me(di.source))))}async function me(Q){const de=await(await fetch(Q)).text(),Ke=de.split(`
`).filter(dt=>dt.endsWith(".ts")),Xe=de.split(`
`).filter(dt=>dt.startsWith("#EXTINF")).map(dt=>parseFloat(dt.replace("#EXTINF:","").replace(",",""))),di=[];for(let dt=0;dt<Ke.length;dt++)di.push(new hy(Ke[dt],Xe[dt]));return di}async function X(){if(g==null)return;let Q=g.map(Xe=>[Xe.time,Xe.end]).flat();const de=Q.findIndex(Xe=>Xe.getTime()>P.getTime()),Ke=Q.findLastIndex(Xe=>Xe.getTime()<M.getTime());return Q=Q.slice(de,Ke+1),t(8,T=de%2!=0),Q.unshift(P),Q.push(M),[...Array(Q.length-1).keys()].map(Xe=>Q[Xe+1].getTime()-Q[Xe].getTime())}async function Ae(){t(6,g=await _e(s)),t(7,y=await X()),ie(g.length-1,g[g.length-1].duration),t(3,o=!0)}function rt(Q){Bt[Q?"unshift":"push"](()=>{c=Q,t(4,c)})}const Ce=()=>{Z(new Date(D.getTime()-v))};function $e(Q){y=Q,t(7,y),t(0,v),t(1,D),t(2,P)}function tt(Q){g=Q,t(6,g)}function Nt(Q){T=Q,t(8,T)}function bt(Q){D=Q,t(1,D)}function kt(Q){P=Q,t(2,P),t(0,v),t(1,D)}function hi(Q){M=Q,t(11,M),t(0,v),t(1,D),t(2,P)}const tn=()=>{Z(new Date(D.getTime()+v))};function Qn(Q){n=Q,t(13,n),t(1,D)}const Oi=()=>Z(py(n,r));function nn(Q){r=Q,t(12,r),t(1,D)}const rn=()=>Z(py(n,r));function Si(Q){v=Q,t(0,v)}return i.$$set=Q=>{"camera"in Q&&t(18,s=Q.camera),"tracks"in Q&&t(19,a=Q.tracks)},i.$$.update=()=>{if(i.$$.dirty[0]&2&&t(13,n=new Date(D.getTime())),i.$$.dirty[0]&2&&t(12,r=new Date(D.getTime())),i.$$.dirty[0]&7){let Q=0;v>1e3*60*60*3&&(Q=new Date().getTimezoneOffset()*60*1e3),t(2,P=new Date(Math.floor(D.getTime()/v)*v+Q)),t(11,M=new Date(P.getTime()+v)),(async()=>t(7,y=await X()))()}},[v,D,P,o,c,h,g,y,T,x,A,M,r,n,R,$,Z,Ae,s,a,rt,Ce,$e,tt,Nt,bt,kt,hi,tn,Qn,Oi,nn,rn,Si]}class uF extends Kn{constructor(e){super(),Wn(this,e,oF,aF,zn,{camera:18,tracks:19},null,[-1,-1])}}function my(i){let e,t,n,r={ctx:i,current:null,token:null,hasCatch:!1,pending:hF,then:cF,catch:lF,value:1,blocks:[,,,]};return Ag(t=i[1],r),{c(){e=kf(),r.block.c()},m(s,a){Dt(s,e,a),r.block.m(s,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(s,a){i=s,r.ctx=i,a&2&&t!==(t=i[1])&&Ag(t,r)||QS(r,i,a)},i(s){n||(Ue(r.block),n=!0)},o(s){for(let a=0;a<3;a+=1){const o=r.blocks[a];Qe(o)}n=!1},d(s){s&&Tt(e),r.block.d(s),r.token=null,r=null}}}function lF(i){return{c:et,m:et,p:et,i:et,o:et,d:et}}function cF(i){let e,t,n;function r(a){i[2](a)}let s={tracks:i[1]};return i[0]!==void 0&&(s.camera=i[0]),e=new uF({props:s}),Bt.push(()=>un(e,"camera",r)),{c(){_i(e.$$.fragment)},m(a,o){ti(e,a,o),n=!0},p(a,o){const u={};o&2&&(u.tracks=a[1]),!t&&o&1&&(t=!0,u.camera=a[0],on(()=>t=!1)),e.$set(u)},i(a){n||(Ue(e.$$.fragment,a),n=!0)},o(a){Qe(e.$$.fragment,a),n=!1},d(a){ii(e,a)}}}function hF(i){let e;return{c(){e=qr("...")},m(t,n){Dt(t,e,n)},p:et,i:et,o:et,d(t){t&&Tt(e)}}}function dF(i){let e,t,n=i[0]!=""&&my(i);return{c(){n&&n.c(),e=kf()},m(r,s){n&&n.m(r,s),Dt(r,e,s),t=!0},p(r,[s]){r[0]!=""?n?(n.p(r,s),s&1&&Ue(n,1)):(n=my(r),n.c(),Ue(n,1),n.m(e.parentNode,e)):n&&(Wo(),Qe(n,1,1,()=>{n=null}),Ko())},i(r){t||(Ue(n),t=!0)},o(r){Qe(n),t=!1},d(r){n&&n.d(r),r&&Tt(e)}}}function fF(i,e,t){let{camera:n}=e,r;async function s(o){const u=B2();return(await Q2(z2(M2(u,"sessions"),W2("camera_id","==",o),K2("session_id"))).then(h=>h.docs.map(g=>({id:g.id,...g.data()})))).map(h=>h.source)}function a(o){n=o,t(0,n)}return i.$$set=o=>{"camera"in o&&t(0,n=o.camera)},i.$$.update=()=>{i.$$.dirty&1&&n!=""&&t(1,r=s(n))},[n,r,a]}class t1 extends Kn{constructor(e){super(),Wn(this,e,fF,dF,zn,{camera:0})}}const pF=document.querySelectorAll(".video-player");for(let i of pF)new t1({target:i,props:{camera:i.getAttribute("camera")}});function mF(i){return new t1({target:i,props:{camera:i.getAttribute("camera")}})}function gF(i,e){i.$set({camera:e})}window.initVideoPlayer=mF;window.setCamera=gF;
