var W1=Object.defineProperty;var K1=(i,e,t)=>e in i?W1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var ju=(i,e,t)=>(K1(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function ut(){}function rr(i,e){for(const t in e)i[t]=e[t];return i}function X1(i){return!!i&&(typeof i=="object"||typeof i=="function")&&typeof i.then=="function"}function Sy(i){return i()}function Ig(){return Object.create(null)}function Gr(i){i.forEach(Sy)}function xy(i){return typeof i=="function"}function jn(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}let $u;function kg(i,e){return $u||($u=document.createElement("a")),$u.href=e,i===$u.href}function Y1(i){return Object.keys(i).length===0}function Q1(i,e,t,n){if(i){const r=Cy(i,e,t,n);return i[0](r)}}function Cy(i,e,t,n){return i[1]&&n?rr(t.ctx.slice(),i[1](n(e))):t.ctx}function J1(i,e,t,n){if(i[2]&&n){const r=i[2](n(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],a=Math.max(e.dirty.length,r.length);for(let o=0;o<a;o+=1)s[o]=e.dirty[o]|r[o];return s}return e.dirty|r}return e.dirty}function Z1(i,e,t,n,r,s){if(r){const a=Cy(e,t,n,s);i.p(a,r)}}function ex(i){if(i.ctx.length>32){const e=[],t=i.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function wy(i){const e={};for(const t in i)t[0]!=="$"&&(e[t]=i[t]);return e}function _l(i,e){const t={};e=new Set(e);for(const n in i)!e.has(n)&&n[0]!=="$"&&(t[n]=i[n]);return t}const Ay=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;class Xo{constructor(e){this.options=e,this._listeners="WeakMap"in Ay?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(t=>{var n;for(const r of t)Xo.entries.set(r.target,r),(n=this._listeners.get(r.target))===null||n===void 0||n(r)})}}Xo.entries="WeakMap"in Ay?new WeakMap:void 0;function Re(i,e){i.appendChild(e)}function Jt(i,e,t){i.insertBefore(e,t||null)}function Bt(i){i.parentNode&&i.parentNode.removeChild(i)}function Dy(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function ze(i){return document.createElement(i)}function Iy(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function $s(i){return document.createTextNode(i)}function Ui(){return $s(" ")}function Lf(){return $s("")}function rn(i,e,t,n){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t,n)}function Ae(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}const tx=["width","height"];function Pg(i,e){const t=Object.getOwnPropertyDescriptors(i.__proto__);for(const n in e)e[n]==null?i.removeAttribute(n):n==="style"?i.style.cssText=e[n]:n==="__value"?i.value=i[n]=e[n]:t[n]&&t[n].set&&tx.indexOf(n)===-1?i[n]=e[n]:Ae(i,n,e[n])}function yl(i,e){for(const t in e)Ae(i,t,e[t])}function ix(i){return Array.from(i.childNodes)}function bd(i,e){e=""+e,i.data!==e&&(i.data=e)}function Xn(i,e,t,n){t==null?i.style.removeProperty(e):i.style.setProperty(e,t,n?"important":"")}function Rg(i,e,t){for(let n=0;n<i.options.length;n+=1){const r=i.options[n];if(r.__value===e){r.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function nx(i){const e=i.querySelector(":checked");return e&&e.__value}const rx=new Xo({box:"content-box"});function sx(i,e,{bubbles:t=!1,cancelable:n=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(i,t,n,e),r}let So;function In(i){So=i}function Nf(){if(!So)throw new Error("Function called outside component initialization");return So}function ky(i){Nf().$$.on_mount.push(i)}function Mf(){const i=Nf();return(e,t,{cancelable:n=!1}={})=>{const r=i.$$.callbacks[e];if(r){const s=sx(e,t,{cancelable:n});return r.slice().forEach(a=>{a.call(i,s)}),!s.defaultPrevented}return!0}}const _s=[],Ot=[];let ws=[];const Ed=[],Py=Promise.resolve();let Sd=!1;function Ry(){Sd||(Sd=!0,Py.then(Ff))}function ax(){return Ry(),Py}function vl(i){ws.push(i)}function Mi(i){Ed.push(i)}const Ph=new Set;let us=0;function Ff(){if(us!==0)return;const i=So;do{try{for(;us<_s.length;){const e=_s[us];us++,In(e),ox(e.$$)}}catch(e){throw _s.length=0,us=0,e}for(In(null),_s.length=0,us=0;Ot.length;)Ot.pop()();for(let e=0;e<ws.length;e+=1){const t=ws[e];Ph.has(t)||(Ph.add(t),t())}ws.length=0}while(_s.length);for(;Ed.length;)Ed.pop()();Sd=!1,Ph.clear(),In(i)}function ox(i){if(i.fragment!==null){i.update(),Gr(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(vl)}}function ux(i){const e=[],t=[];ws.forEach(n=>i.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),ws=e}const ll=new Set;let Ir;function Yo(){Ir={r:0,c:[],p:Ir}}function Qo(){Ir.r||Gr(Ir.c),Ir=Ir.p}function je(i,e){i&&i.i&&(ll.delete(i),i.i(e))}function et(i,e,t,n){if(i&&i.o){if(ll.has(i))return;ll.add(i),Ir.c.push(()=>{ll.delete(i),n&&(t&&i.d(1),n())}),i.o(e)}else n&&n()}function Og(i,e){const t=e.token={};function n(r,s,a,o){if(e.token!==t)return;e.resolved=o;let u=e.ctx;a!==void 0&&(u=u.slice(),u[a]=o);const c=r&&(e.current=r)(u);let h=!1;e.block&&(e.blocks?e.blocks.forEach((g,y)=>{y!==s&&g&&(Yo(),et(g,1,1,()=>{e.blocks[y]===g&&(e.blocks[y]=null)}),Qo())}):e.block.d(1),c.c(),je(c,1),c.m(e.mount(),e.anchor),h=!0),e.block=c,e.blocks&&(e.blocks[s]=c),h&&Ff()}if(X1(i)){const r=Nf();if(i.then(s=>{In(r),n(e.then,1,e.value,s),In(null)},s=>{if(In(r),n(e.catch,2,e.error,s),In(null),!e.hasCatch)throw s}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,i),!0;e.resolved=i}}function lx(i,e,t){const n=e.slice(),{resolved:r}=i;i.current===i.then&&(n[i.value]=r),i.current===i.catch&&(n[i.error]=r),i.block.p(n,t)}function Bf(i,e){const t={},n={},r={$$scope:1};let s=i.length;for(;s--;){const a=i[s],o=e[s];if(o){for(const u in a)u in o||(n[u]=1);for(const u in o)r[u]||(t[u]=o[u],r[u]=1);i[s]=o}else for(const u in a)r[u]=1}for(const a in n)a in t||(t[a]=void 0);return t}function Fi(i,e,t){const n=i.$$.props[e];n!==void 0&&(i.$$.bound[n]=t,t(i.$$.ctx[n]))}function gi(i){i&&i.c()}function ri(i,e,t,n){const{fragment:r,after_update:s}=i.$$;r&&r.m(e,t),n||vl(()=>{const a=i.$$.on_mount.map(Sy).filter(xy);i.$$.on_destroy?i.$$.on_destroy.push(...a):Gr(a),i.$$.on_mount=[]}),s.forEach(vl)}function si(i,e){const t=i.$$;t.fragment!==null&&(ux(t.after_update),Gr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function cx(i,e){i.$$.dirty[0]===-1&&(_s.push(i),Ry(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function $n(i,e,t,n,r,s,a,o=[-1]){const u=So;In(i);const c=i.$$={fragment:null,ctx:[],props:s,update:ut,not_equal:r,bound:Ig(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ig(),dirty:o,skip_bound:!1,root:e.target||u.$$.root};a&&a(c.root);let h=!1;if(c.ctx=t?t(i,e.props||{},(g,y,...v)=>{const T=v.length?v[0]:y;return c.ctx&&r(c.ctx[g],c.ctx[g]=T)&&(!c.skip_bound&&c.bound[g]&&c.bound[g](T),h&&cx(i,g)),y}):[],c.update(),h=!0,Gr(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const g=ix(e.target);c.fragment&&c.fragment.l(g),g.forEach(Bt)}else c.fragment&&c.fragment.c();e.intro&&je(i.$$.fragment),ri(i,e.target,e.anchor,e.customElement),Ff()}In(u)}class qn{$destroy(){si(this,1),this.$destroy=ut}$on(e,t){if(!xy(t))return ut;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!Y1(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oy=function(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(i.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},hx=function(i){const e=[];let t=0,n=0;for(;t<i.length;){const r=i[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const s=i[t++];e[n++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=i[t++],a=i[t++],o=i[t++],u=((r&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{const s=i[t++],a=i[t++];e[n++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Ly={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<i.length;r+=3){const s=i[r],a=r+1<i.length,o=a?i[r+1]:0,u=r+2<i.length,c=u?i[r+2]:0,h=s>>2,g=(s&3)<<4|o>>4;let y=(o&15)<<2|c>>6,v=c&63;u||(v=64,a||(y=64)),n.push(t[h],t[g],t[y],t[v])}return n.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(Oy(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):hx(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<i.length;){const s=t[i.charAt(r++)],o=r<i.length?t[i.charAt(r)]:0;++r;const c=r<i.length?t[i.charAt(r)]:64;++r;const g=r<i.length?t[i.charAt(r)]:64;if(++r,s==null||o==null||c==null||g==null)throw new dx;const y=s<<2|o>>4;if(n.push(y),c!==64){const v=o<<4&240|c>>2;if(n.push(v),g!==64){const T=c<<6&192|g;n.push(T)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class dx extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fx=function(i){const e=Oy(i);return Ly.encodeByteArray(e,!0)},Tl=function(i){return fx(i).replace(/\./g,"")},px=function(i){try{return Ly.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gx=()=>mx().__FIREBASE_DEFAULTS__,_x=()=>{if(typeof process>"u"||typeof process.env>"u")return;const i={}.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},yx=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&px(i[1]);return e&&JSON.parse(e)},Ny=()=>{try{return gx()||_x()||yx()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},vx=i=>{var e,t;return(t=(e=Ny())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[i]},Tx=i=>{const e=vx(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},My=()=>{var i;return(i=Ny())===null||i===void 0?void 0:i.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ex(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=i.iat||0,s=i.sub||i.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},i),o="";return[Tl(JSON.stringify(t)),Tl(JSON.stringify(a)),o].join(".")}function Sx(){try{return typeof indexedDB=="object"}catch{return!1}}function xx(){return new Promise((i,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),i(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cx="FirebaseError";class ca extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Cx,Object.setPrototypeOf(this,ca.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fy.prototype.create)}}class Fy{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?wx(s,n):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new ca(r,o,n)}}function wx(i,e){return i.replace(Ax,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const Ax=/\{\$([^}]+)}/g;function xd(i,e){if(i===e)return!0;const t=Object.keys(i),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const s=i[r],a=e[r];if(Lg(s)&&Lg(a)){if(!xd(s,a))return!1}else if(s!==a)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function Lg(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(i){return i&&i._delegate?i._delegate:i}let Co=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dx{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new bx;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(kx(e))try{this.getOrInitializeService({instanceIdentifier:Cr})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});n.resolve(s)}catch{}}}}clearInstance(e=Cr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Cr){return this.instances.has(e)}getOptions(e=Cr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);n===o&&a.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=(n=this.onInitCallbacks.get(r))!==null&&n!==void 0?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const a=this.instances.get(r);return a&&e(a,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Ix(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Cr){return this.component?this.component.multipleInstances?e:Cr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ix(i){return i===Cr?void 0:i}function kx(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Dx(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Be;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Be||(Be={}));const Rx={debug:Be.DEBUG,verbose:Be.VERBOSE,info:Be.INFO,warn:Be.WARN,error:Be.ERROR,silent:Be.SILENT},Ox=Be.INFO,Lx={[Be.DEBUG]:"log",[Be.VERBOSE]:"log",[Be.INFO]:"info",[Be.WARN]:"warn",[Be.ERROR]:"error"},Nx=(i,e,...t)=>{if(e<i.logLevel)return;const n=new Date().toISOString(),r=Lx[e];if(r)console[r](`[${n}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class By{constructor(e){this.name=e,this._logLevel=Ox,this._logHandler=Nx,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Be))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Rx[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Be.DEBUG,...e),this._logHandler(this,Be.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Be.VERBOSE,...e),this._logHandler(this,Be.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Be.INFO,...e),this._logHandler(this,Be.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Be.WARN,...e),this._logHandler(this,Be.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Be.ERROR,...e),this._logHandler(this,Be.ERROR,...e)}}const Mx=(i,e)=>e.some(t=>i instanceof t);let Ng,Mg;function Fx(){return Ng||(Ng=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bx(){return Mg||(Mg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Uy=new WeakMap,Cd=new WeakMap,Vy=new WeakMap,Rh=new WeakMap,Uf=new WeakMap;function Ux(i){const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("success",s),i.removeEventListener("error",a)},s=()=>{t(er(i.result)),r()},a=()=>{n(i.error),r()};i.addEventListener("success",s),i.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Uy.set(t,i)}).catch(()=>{}),Uf.set(e,i),e}function Vx(i){if(Cd.has(i))return;const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("complete",s),i.removeEventListener("error",a),i.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{n(i.error||new DOMException("AbortError","AbortError")),r()};i.addEventListener("complete",s),i.addEventListener("error",a),i.addEventListener("abort",a)});Cd.set(i,e)}let wd={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return Cd.get(i);if(e==="objectStoreNames")return i.objectStoreNames||Vy.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return er(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function jx(i){wd=i(wd)}function $x(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=i.call(Oh(this),e,...t);return Vy.set(n,e.sort?e.sort():[e]),er(n)}:Bx().includes(i)?function(...e){return i.apply(Oh(this),e),er(Uy.get(this))}:function(...e){return er(i.apply(Oh(this),e))}}function qx(i){return typeof i=="function"?$x(i):(i instanceof IDBTransaction&&Vx(i),Mx(i,Fx())?new Proxy(i,wd):i)}function er(i){if(i instanceof IDBRequest)return Ux(i);if(Rh.has(i))return Rh.get(i);const e=qx(i);return e!==i&&(Rh.set(i,e),Uf.set(e,i)),e}const Oh=i=>Uf.get(i);function Hx(i,e,{blocked:t,upgrade:n,blocking:r,terminated:s}={}){const a=indexedDB.open(i,e),o=er(a);return n&&a.addEventListener("upgradeneeded",u=>{n(er(a.result),u.oldVersion,u.newVersion,er(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),o.then(u=>{s&&u.addEventListener("close",()=>s()),r&&u.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const Gx=["get","getKey","getAll","getAllKeys","count"],zx=["put","add","delete","clear"],Lh=new Map;function Fg(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(Lh.get(e))return Lh.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=zx.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||Gx.includes(t)))return;const s=async function(a,...o){const u=this.transaction(a,r?"readwrite":"readonly");let c=u.store;return n&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),r&&u.done]))[0]};return Lh.set(e,s),s}jx(i=>({...i,get:(e,t,n)=>Fg(e,t)||i.get(e,t,n),has:(e,t)=>!!Fg(e,t)||i.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Kx(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Kx(i){const e=i.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ad="@firebase/app",Bg="0.9.15";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ur=new By("@firebase/app"),Xx="@firebase/app-compat",Yx="@firebase/analytics-compat",Qx="@firebase/analytics",Jx="@firebase/app-check-compat",Zx="@firebase/app-check",eC="@firebase/auth",tC="@firebase/auth-compat",iC="@firebase/database",nC="@firebase/database-compat",rC="@firebase/functions",sC="@firebase/functions-compat",aC="@firebase/installations",oC="@firebase/installations-compat",uC="@firebase/messaging",lC="@firebase/messaging-compat",cC="@firebase/performance",hC="@firebase/performance-compat",dC="@firebase/remote-config",fC="@firebase/remote-config-compat",pC="@firebase/storage",mC="@firebase/storage-compat",gC="@firebase/firestore",_C="@firebase/firestore-compat",yC="firebase",vC="10.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dd="[DEFAULT]",TC={[Ad]:"fire-core",[Xx]:"fire-core-compat",[Qx]:"fire-analytics",[Yx]:"fire-analytics-compat",[Zx]:"fire-app-check",[Jx]:"fire-app-check-compat",[eC]:"fire-auth",[tC]:"fire-auth-compat",[iC]:"fire-rtdb",[nC]:"fire-rtdb-compat",[rC]:"fire-fn",[sC]:"fire-fn-compat",[aC]:"fire-iid",[oC]:"fire-iid-compat",[uC]:"fire-fcm",[lC]:"fire-fcm-compat",[cC]:"fire-perf",[hC]:"fire-perf-compat",[dC]:"fire-rc",[fC]:"fire-rc-compat",[pC]:"fire-gcs",[mC]:"fire-gcs-compat",[gC]:"fire-fst",[_C]:"fire-fst-compat","fire-js":"fire-js",[yC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl=new Map,Id=new Map;function bC(i,e){try{i.container.addComponent(e)}catch(t){Ur.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function El(i){const e=i.name;if(Id.has(e))return Ur.debug(`There were multiple attempts to register component ${e}.`),!1;Id.set(e,i);for(const t of bl.values())bC(t,i);return!0}function EC(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},tr=new Fy("app","Firebase",SC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Co("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CC=vC;function jy(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Dd,automaticDataCollectionEnabled:!1},e),r=n.name;if(typeof r!="string"||!r)throw tr.create("bad-app-name",{appName:String(r)});if(t||(t=My()),!t)throw tr.create("no-options");const s=bl.get(r);if(s){if(xd(t,s.options)&&xd(n,s.config))return s;throw tr.create("duplicate-app",{appName:r})}const a=new Px(r);for(const u of Id.values())a.addComponent(u);const o=new xC(t,n,a);return bl.set(r,o),o}function wC(i=Dd){const e=bl.get(i);if(!e&&i===Dd&&My())return jy();if(!e)throw tr.create("no-app",{appName:i});return e}function As(i,e,t){var n;let r=(n=TC[i])!==null&&n!==void 0?n:i;t&&(r+=`-${t}`);const s=r.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ur.warn(o.join(" "));return}El(new Co(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AC="firebase-heartbeat-database",DC=1,wo="firebase-heartbeat-store";let Nh=null;function $y(){return Nh||(Nh=Hx(AC,DC,{upgrade:(i,e)=>{switch(e){case 0:i.createObjectStore(wo)}}}).catch(i=>{throw tr.create("idb-open",{originalErrorMessage:i.message})})),Nh}async function IC(i){try{return await(await $y()).transaction(wo).objectStore(wo).get(qy(i))}catch(e){if(e instanceof ca)Ur.warn(e.message);else{const t=tr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ur.warn(t.message)}}}async function Ug(i,e){try{const n=(await $y()).transaction(wo,"readwrite");await n.objectStore(wo).put(e,qy(i)),await n.done}catch(t){if(t instanceof ca)Ur.warn(t.message);else{const n=tr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ur.warn(n.message)}}}function qy(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kC=1024,PC=30*24*60*60*1e3;class RC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new LC(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Vg();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(r=>r.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const s=new Date(r.date).valueOf();return Date.now()-s<=PC}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Vg(),{heartbeatsToSend:t,unsentEntries:n}=OC(this._heartbeatsCache.heartbeats),r=Tl(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Vg(){return new Date().toISOString().substring(0,10)}function OC(i,e=kC){const t=[];let n=i.slice();for(const r of i){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),jg(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),jg(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class LC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Sx()?xx().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await IC(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Ug(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Ug(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function jg(i){return Tl(JSON.stringify({version:2,heartbeats:i})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NC(i){El(new Co("platform-logger",e=>new Wx(e),"PRIVATE")),El(new Co("heartbeat",e=>new RC(e),"PRIVATE")),As(Ad,Bg,i),As(Ad,Bg,"esm2017"),As("fire-js","")}NC("");var MC="firebase",FC="10.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */As(MC,FC,"app");const BC={apiKey:"AIzaSyARBKzaouW4fSbBwlJrVzCDYLIUZnku_ds",authDomain:"surfview-001.firebaseapp.com",projectId:"surfview-001",storageBucket:"surfview-001.appspot.com",messagingSenderId:"778677178141",appId:"1:778677178141:web:17f15426c5929c1da31bf4",measurementId:"G-V2S1CF6BP3"};jy(BC);var Sl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Hy(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}),t}var eo;typeof window<"u"?eo=window:typeof Sl<"u"?eo=Sl:typeof self<"u"?eo=self:eo={};var cc=eo;const D=hr(cc),UC={},VC=Object.freeze(Object.defineProperty({__proto__:null,default:UC},Symbol.toStringTag,{value:"Module"})),jC=Hy(VC);var $g=typeof Sl<"u"?Sl:typeof window<"u"?window:{},$C=jC,to;typeof document<"u"?to=document:(to=$g["__GLOBAL_DOCUMENT_CACHE@4"],to||(to=$g["__GLOBAL_DOCUMENT_CACHE@4"]=$C));var Gy=to;const W=hr(Gy);var kd={exports:{}};(function(i,e){function t(u){if(u&&typeof u=="object"){var c=u.which||u.keyCode||u.charCode;c&&(u=c)}if(typeof u=="number")return a[u];var h=String(u),g=n[h.toLowerCase()];if(g)return g;var g=r[h.toLowerCase()];if(g)return g;if(h.length===1)return h.charCodeAt(0)}t.isEventKey=function(c,h){if(c&&typeof c=="object"){var g=c.which||c.keyCode||c.charCode;if(g==null)return!1;if(typeof h=="string"){var y=n[h.toLowerCase()];if(y)return y===g;var y=r[h.toLowerCase()];if(y)return y===g}else if(typeof h=="number")return h===g;return!1}},e=i.exports=t;var n=e.code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(s=97;s<123;s++)n[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)n[s-48]=s;for(s=1;s<13;s++)n["f"+s]=s+111;for(s=0;s<10;s++)n["numpad "+s]=s+96;var a=e.names=e.title={};for(s in n)a[n[s]]=s;for(var o in r)n[o]=r[o]})(kd,kd.exports);var qC=kd.exports;const me=hr(qC);var HC=GC;function GC(i,e){var t,n=null;try{t=JSON.parse(i,e)}catch(r){n=r}return[n,t]}const zC=hr(HC);var Vf={exports:{}};function On(){return On=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},On.apply(this,arguments)}const WC=Object.freeze(Object.defineProperty({__proto__:null,default:On},Symbol.toStringTag,{value:"Module"})),KC=Hy(WC);var XC=QC,YC=Object.prototype.toString;function QC(i){if(!i)return!1;var e=YC.call(i);return e==="[object Function]"||typeof i=="function"&&e!=="[object RegExp]"||typeof window<"u"&&(i===window.setTimeout||i===window.alert||i===window.confirm||i===window.prompt)}var JC=cc,ZC=function(e,t){return t===void 0&&(t=!1),function(n,r,s){if(n){e(n);return}if(r.statusCode>=400&&r.statusCode<=599){var a=s;if(t)if(JC.TextDecoder){var o=ew(r.headers&&r.headers["content-type"]);try{a=new TextDecoder(o).decode(s)}catch{}}else a=String.fromCharCode.apply(null,new Uint8Array(s));e({cause:a});return}e(null,s)}};function ew(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(e,t){var n=t.split("="),r=n[0],s=n[1];return r.trim()==="charset"?s.trim():e},"utf-8")}var tw=ZC,zy=cc,iw=KC,nw=XC;dn.httpHandler=tw;/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Björklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var rw=function(e){var t={};return e&&e.trim().split(`
`).forEach(function(n){var r=n.indexOf(":"),s=n.slice(0,r).trim().toLowerCase(),a=n.slice(r+1).trim();typeof t[s]>"u"?t[s]=a:Array.isArray(t[s])?t[s].push(a):t[s]=[t[s],a]}),t};Vf.exports=dn;Vf.exports.default=dn;dn.XMLHttpRequest=zy.XMLHttpRequest||uw;dn.XDomainRequest="withCredentials"in new dn.XMLHttpRequest?dn.XMLHttpRequest:zy.XDomainRequest;sw(["get","put","post","patch","head","delete"],function(i){dn[i==="delete"?"del":i]=function(e,t,n){return t=Wy(e,t,n),t.method=i.toUpperCase(),Ky(t)}});function sw(i,e){for(var t=0;t<i.length;t++)e(i[t])}function aw(i){for(var e in i)if(i.hasOwnProperty(e))return!1;return!0}function Wy(i,e,t){var n=i;return nw(e)?(t=e,typeof i=="string"&&(n={uri:i})):n=iw({},e,{uri:i}),n.callback=t,n}function dn(i,e,t){return e=Wy(i,e,t),Ky(e)}function Ky(i){if(typeof i.callback>"u")throw new Error("callback argument missing");var e=!1,t=function(M,R,O){e||(e=!0,i.callback(M,R,O))};function n(){o.readyState===4&&setTimeout(a,0)}function r(){var P=void 0;if(o.response?P=o.response:P=o.responseText||ow(o),S)try{P=JSON.parse(P)}catch{}return P}function s(P){return clearTimeout(A),P instanceof Error||(P=new Error(""+(P||"Unknown XMLHttpRequest Error"))),P.statusCode=0,t(P,k)}function a(){if(!c){var P;clearTimeout(A),i.useXDR&&o.status===void 0?P=200:P=o.status===1223?204:o.status;var M=k,R=null;return P!==0?(M={body:r(),statusCode:P,method:g,headers:{},url:h,rawRequest:o},o.getAllResponseHeaders&&(M.headers=rw(o.getAllResponseHeaders()))):R=new Error("Internal XMLHttpRequest Error"),t(R,M,M.body)}}var o=i.xhr||null;o||(i.cors||i.useXDR?o=new dn.XDomainRequest:o=new dn.XMLHttpRequest);var u,c,h=o.url=i.uri||i.url,g=o.method=i.method||"GET",y=i.body||i.data,v=o.headers=i.headers||{},T=!!i.sync,S=!1,A,k={body:void 0,headers:{},statusCode:0,method:g,url:h,rawRequest:o};if("json"in i&&i.json!==!1&&(S=!0,v.accept||v.Accept||(v.Accept="application/json"),g!=="GET"&&g!=="HEAD"&&(v["content-type"]||v["Content-Type"]||(v["Content-Type"]="application/json"),y=JSON.stringify(i.json===!0?y:i.json))),o.onreadystatechange=n,o.onload=a,o.onerror=s,o.onprogress=function(){},o.onabort=function(){c=!0},o.ontimeout=s,o.open(g,h,!T,i.username,i.password),T||(o.withCredentials=!!i.withCredentials),!T&&i.timeout>0&&(A=setTimeout(function(){if(!c){c=!0,o.abort("timeout");var P=new Error("XMLHttpRequest timeout");P.code="ETIMEDOUT",s(P)}},i.timeout)),o.setRequestHeader)for(u in v)v.hasOwnProperty(u)&&o.setRequestHeader(u,v[u]);else if(i.headers&&!aw(i.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in i&&(o.responseType=i.responseType),"beforeSend"in i&&typeof i.beforeSend=="function"&&i.beforeSend(o),o.send(y||null),o}function ow(i){try{if(i.responseType==="document")return i.responseXML;var e=i.responseXML&&i.responseXML.documentElement.nodeName==="parsererror";if(i.responseType===""&&!e)return i.responseXML}catch{}return null}function uw(){}var lw=Vf.exports;const Xy=hr(lw);var Yy={exports:{}},qg=Gy,jf=Object.create||function(){function i(){}return function(e){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return i.prototype=e,new i}}();function wi(i,e){this.name="ParsingError",this.code=i.code,this.message=e||i.message}wi.prototype=jf(Error.prototype);wi.prototype.constructor=wi;wi.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function $f(i){function e(n,r,s,a){return(n|0)*3600+(r|0)*60+(s|0)+(a|0)/1e3}var t=i.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return t?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):t[1]>59?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null}function ho(){this.values=jf(null)}ho.prototype={set:function(i,e){!this.get(i)&&e!==""&&(this.values[i]=e)},get:function(i,e,t){return t?this.has(i)?this.values[i]:e[t]:this.has(i)?this.values[i]:e},has:function(i){return i in this.values},alt:function(i,e,t){for(var n=0;n<t.length;++n)if(e===t[n]){this.set(i,e);break}},integer:function(i,e){/^-?\d+$/.test(e)&&this.set(i,parseInt(e,10))},percent:function(i,e){return e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e),e>=0&&e<=100)?(this.set(i,e),!0):!1}};function io(i,e,t,n){var r=n?i.split(n):[i];for(var s in r)if(typeof r[s]=="string"){var a=r[s].split(t);if(a.length===2){var o=a[0].trim(),u=a[1].trim();e(o,u)}}}function cw(i,e,t){var n=i;function r(){var o=$f(i);if(o===null)throw new wi(wi.Errors.BadTimeStamp,"Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,u){var c=new ho;io(o,function(h,g){switch(h){case"region":for(var y=t.length-1;y>=0;y--)if(t[y].id===g){c.set(h,t[y].region);break}break;case"vertical":c.alt(h,g,["rl","lr"]);break;case"line":var v=g.split(","),T=v[0];c.integer(h,T),c.percent(h,T)&&c.set("snapToLines",!1),c.alt(h,T,["auto"]),v.length===2&&c.alt("lineAlign",v[1],["start","center","end"]);break;case"position":v=g.split(","),c.percent(h,v[0]),v.length===2&&c.alt("positionAlign",v[1],["start","center","end"]);break;case"size":c.percent(h,g);break;case"align":c.alt(h,g,["start","center","end","left","right"]);break}},/:/,/\s/),u.region=c.get("region",null),u.vertical=c.get("vertical","");try{u.line=c.get("line","auto")}catch{}u.lineAlign=c.get("lineAlign","start"),u.snapToLines=c.get("snapToLines",!0),u.size=c.get("size",100);try{u.align=c.get("align","center")}catch{u.align=c.get("align","middle")}try{u.position=c.get("position","auto")}catch{u.position=c.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},u.align)}u.positionAlign=c.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},u.align)}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),i.substr(0,3)!=="-->")throw new wi(wi.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.substr(3),a(),e.endTime=r(),a(),s(i,e)}var Mh=qg.createElement&&qg.createElement("textarea"),hw={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Hg={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},dw={v:"title",lang:"lang"},Gg={rt:"ruby"};function Qy(i,e){function t(){if(!e)return null;function T(A){return e=e.substr(A.length),A}var S=e.match(/^([^<]*)(<[^>]*>?)?/);return T(S[1]?S[1]:S[2])}function n(T){return Mh.innerHTML=T,T=Mh.textContent,Mh.textContent="",T}function r(T,S){return!Gg[S.localName]||Gg[S.localName]===T.localName}function s(T,S){var A=hw[T];if(!A)return null;var k=i.document.createElement(A),P=dw[T];return P&&S&&(k[P]=S.trim()),k}for(var a=i.document.createElement("div"),o=a,u,c=[];(u=t())!==null;){if(u[0]==="<"){if(u[1]==="/"){c.length&&c[c.length-1]===u.substr(2).replace(">","")&&(c.pop(),o=o.parentNode);continue}var h=$f(u.substr(1,u.length-2)),g;if(h){g=i.document.createProcessingInstruction("timestamp",h),o.appendChild(g);continue}var y=u.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!y||(g=s(y[1],y[3]),!g)||!r(o,g))continue;if(y[2]){var v=y[2].split(".");v.forEach(function(T){var S=/^bg_/.test(T),A=S?T.slice(3):T;if(Hg.hasOwnProperty(A)){var k=S?"background-color":"color",P=Hg[A];g.style[k]=P}}),g.className=v.join(" ")}c.push(y[1]),o.appendChild(g),o=g;continue}o.appendChild(i.document.createTextNode(n(u)))}return a}var zg=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function fw(i){for(var e=0;e<zg.length;e++){var t=zg[e];if(i>=t[0]&&i<=t[1])return!0}return!1}function pw(i){var e=[],t="",n;if(!i||!i.childNodes)return"ltr";function r(o,u){for(var c=u.childNodes.length-1;c>=0;c--)o.push(u.childNodes[c])}function s(o){if(!o||!o.length)return null;var u=o.pop(),c=u.textContent||u.innerText;if(c){var h=c.match(/^.*(\n|\r)/);return h?(o.length=0,h[0]):c}if(u.tagName==="ruby")return s(o);if(u.childNodes)return r(o,u),s(o)}for(r(e,i);t=s(e);)for(var a=0;a<t.length;a++)if(n=t.charCodeAt(a),fw(n))return"rtl";return"ltr"}function mw(i){if(typeof i.line=="number"&&(i.snapToLines||i.line>=0&&i.line<=100))return i.line;if(!i.track||!i.track.textTrackList||!i.track.textTrackList.mediaElement)return-1;for(var e=i.track,t=e.textTrackList,n=0,r=0;r<t.length&&t[r]!==e;r++)t[r].mode==="showing"&&n++;return++n*-1}function hc(){}hc.prototype.applyStyles=function(i,e){e=e||this.div;for(var t in i)i.hasOwnProperty(t)&&(e.style[t]=i[t])};hc.prototype.formatStyle=function(i,e){return i===0?0:i+e};function xl(i,e,t){hc.call(this),this.cue=e,this.cueDiv=Qy(i,e.text);var n={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(n,this.cueDiv),this.div=i.document.createElement("div"),n={direction:pw(this.cueDiv),writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:e.align==="middle"?"center":e.align,font:t.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var r=0;switch(e.positionAlign){case"start":r=e.position;break;case"center":r=e.position-e.size/2;break;case"end":r=e.position-e.size;break}e.vertical===""?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(e.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(e.size,"%")}),this.move=function(s){this.applyStyles({top:this.formatStyle(s.top,"px"),bottom:this.formatStyle(s.bottom,"px"),left:this.formatStyle(s.left,"px"),right:this.formatStyle(s.right,"px"),height:this.formatStyle(s.height,"px"),width:this.formatStyle(s.width,"px")})}}xl.prototype=jf(hc.prototype);xl.prototype.constructor=xl;function oi(i){var e,t,n,r;if(i.div){t=i.div.offsetHeight,n=i.div.offsetWidth,r=i.div.offsetTop;var s=(s=i.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();i=i.div.getBoundingClientRect(),e=s?Math.max(s[0]&&s[0].height||0,i.height/s.length):0}this.left=i.left,this.right=i.right,this.top=i.top||r,this.height=i.height||t,this.bottom=i.bottom||r+(i.height||t),this.width=i.width||n,this.lineHeight=e!==void 0?e:i.lineHeight}oi.prototype.move=function(i,e){switch(e=e!==void 0?e:this.lineHeight,i){case"+x":this.left+=e,this.right+=e;break;case"-x":this.left-=e,this.right-=e;break;case"+y":this.top+=e,this.bottom+=e;break;case"-y":this.top-=e,this.bottom-=e;break}};oi.prototype.overlaps=function(i){return this.left<i.right&&this.right>i.left&&this.top<i.bottom&&this.bottom>i.top};oi.prototype.overlapsAny=function(i){for(var e=0;e<i.length;e++)if(this.overlaps(i[e]))return!0;return!1};oi.prototype.within=function(i){return this.top>=i.top&&this.bottom<=i.bottom&&this.left>=i.left&&this.right<=i.right};oi.prototype.overlapsOppositeAxis=function(i,e){switch(e){case"+x":return this.left<i.left;case"-x":return this.right>i.right;case"+y":return this.top<i.top;case"-y":return this.bottom>i.bottom}};oi.prototype.intersectPercentage=function(i){var e=Math.max(0,Math.min(this.right,i.right)-Math.max(this.left,i.left)),t=Math.max(0,Math.min(this.bottom,i.bottom)-Math.max(this.top,i.top)),n=e*t;return n/(this.height*this.width)};oi.prototype.toCSSCompatValues=function(i){return{top:this.top-i.top,bottom:i.bottom-this.bottom,left:this.left-i.left,right:i.right-this.right,height:this.height,width:this.width}};oi.getSimpleBoxPosition=function(i){var e=i.div?i.div.offsetHeight:i.tagName?i.offsetHeight:0,t=i.div?i.div.offsetWidth:i.tagName?i.offsetWidth:0,n=i.div?i.div.offsetTop:i.tagName?i.offsetTop:0;i=i.div?i.div.getBoundingClientRect():i.tagName?i.getBoundingClientRect():i;var r={left:i.left,right:i.right,top:i.top||n,height:i.height||e,bottom:i.bottom||n+(i.height||e),width:i.width||t};return r};function gw(i,e,t,n){function r(A,k){for(var P,M=new oi(A),R=1,O=0;O<k.length;O++){for(;A.overlapsOppositeAxis(t,k[O])||A.within(t)&&A.overlapsAny(n);)A.move(k[O]);if(A.within(t))return A;var j=A.intersectPercentage(t);R>j&&(P=new oi(A),R=j),A=new oi(M)}return P||M}var s=new oi(e),a=e.cue,o=mw(a),u=[];if(a.snapToLines){var c;switch(a.vertical){case"":u=["+y","-y"],c="height";break;case"rl":u=["+x","-x"],c="width";break;case"lr":u=["-x","+x"],c="width";break}var h=s.lineHeight,g=h*Math.round(o),y=t[c]+h,v=u[0];Math.abs(g)>y&&(g=g<0?-1:1,g*=Math.ceil(y/h)*h),o<0&&(g+=a.vertical===""?t.height:t.width,u=u.reverse()),s.move(v,g)}else{var T=s.lineHeight/t.height*100;switch(a.lineAlign){case"center":o-=T/2;break;case"end":o-=T;break}switch(a.vertical){case"":e.applyStyles({top:e.formatStyle(o,"%")});break;case"rl":e.applyStyles({left:e.formatStyle(o,"%")});break;case"lr":e.applyStyles({right:e.formatStyle(o,"%")});break}u=["+y","-x","+x","-y"],s=new oi(e)}var S=r(s,u);e.move(S.toCSSCompatValues(t))}function ha(){}ha.StringDecoder=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}};ha.convertCueToDOMTree=function(i,e){return!i||!e?null:Qy(i,e)};var _w=.05,yw="sans-serif",vw="1.5%";ha.processCues=function(i,e,t){if(!i||!e||!t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);var n=i.document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin=vw,t.appendChild(n);function r(h){for(var g=0;g<h.length;g++)if(h[g].hasBeenReset||!h[g].displayState)return!0;return!1}if(!r(e)){for(var s=0;s<e.length;s++)n.appendChild(e[s].displayState);return}var a=[],o=oi.getSimpleBoxPosition(n),u=Math.round(o.height*_w*100)/100,c={font:u+"px "+yw};(function(){for(var h,g,y=0;y<e.length;y++)g=e[y],h=new xl(i,g,c),n.appendChild(h.div),gw(i,h,o,a),g.displayState=h.div,a.push(oi.getSimpleBoxPosition(h))})()};ha.Parser=function(i,e,t){t||(t=e,e={}),e||(e={}),this.window=i,this.vttjs=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]};ha.Parser.prototype={reportOrThrowError:function(i){if(i instanceof wi)this.onparsingerror&&this.onparsingerror(i);else throw i},parse:function(i){var e=this;i&&(e.buffer+=e.decoder.decode(i,{stream:!0}));function t(){for(var h=e.buffer,g=0;g<h.length&&h[g]!=="\r"&&h[g]!==`
`;)++g;var y=h.substr(0,g);return h[g]==="\r"&&++g,h[g]===`
`&&++g,e.buffer=h.substr(g),y}function n(h){var g=new ho;if(io(h,function(v,T){switch(v){case"id":g.set(v,T);break;case"width":g.percent(v,T);break;case"lines":g.integer(v,T);break;case"regionanchor":case"viewportanchor":var S=T.split(",");if(S.length!==2)break;var A=new ho;if(A.percent("x",S[0]),A.percent("y",S[1]),!A.has("x")||!A.has("y"))break;g.set(v+"X",A.get("x")),g.set(v+"Y",A.get("y"));break;case"scroll":g.alt(v,T,["up"]);break}},/=/,/\s/),g.has("id")){var y=new(e.vttjs.VTTRegion||e.window.VTTRegion);y.width=g.get("width",100),y.lines=g.get("lines",3),y.regionAnchorX=g.get("regionanchorX",0),y.regionAnchorY=g.get("regionanchorY",100),y.viewportAnchorX=g.get("viewportanchorX",0),y.viewportAnchorY=g.get("viewportanchorY",100),y.scroll=g.get("scroll",""),e.onregion&&e.onregion(y),e.regionList.push({id:g.get("id"),region:y})}}function r(h){var g=new ho;io(h,function(y,v){switch(y){case"MPEGT":g.integer(y+"S",v);break;case"LOCA":g.set(y+"L",$f(v));break}},/[^\d]:/,/,/),e.ontimestampmap&&e.ontimestampmap({MPEGTS:g.get("MPEGTS"),LOCAL:g.get("LOCAL")})}function s(h){h.match(/X-TIMESTAMP-MAP/)?io(h,function(g,y){switch(g){case"X-TIMESTAMP-MAP":r(y);break}},/=/):io(h,function(g,y){switch(g){case"Region":n(y);break}},/:/)}try{var a;if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=t();var o=a.match(/^WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new wi(wi.Errors.BadSignature);e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:a=t(),e.state){case"HEADER":/:/.test(a)?s(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;e.cue=new(e.vttjs.VTTCue||e.window.VTTCue)(0,0,"");try{e.cue.align="center"}catch{e.cue.align="middle"}if(e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":try{cw(a,e.cue,e.regionList)}catch(h){e.reportOrThrowError(h),e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var c=a.indexOf("-->")!==-1;if(!a||c&&(u=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":a||(e.state="ID");continue}}}catch(h){e.reportOrThrowError(h),e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var i=this;try{if(i.buffer+=i.decoder.decode(),(i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL")throw new wi(wi.Errors.BadSignature)}catch(e){i.reportOrThrowError(e)}return i.onflush&&i.onflush(),this}};var Tw=ha,bw="auto",Ew={"":1,lr:1,rl:1},Sw={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function xw(i){if(typeof i!="string")return!1;var e=Ew[i.toLowerCase()];return e?i.toLowerCase():!1}function Fh(i){if(typeof i!="string")return!1;var e=Sw[i.toLowerCase()];return e?i.toLowerCase():!1}function Jy(i,e,t){this.hasBeenReset=!1;var n="",r=!1,s=i,a=e,o=t,u=null,c="",h=!0,g="auto",y="start",v="auto",T="auto",S=100,A="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return n},set:function(k){n=""+k}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(k){r=!!k}},startTime:{enumerable:!0,get:function(){return s},set:function(k){if(typeof k!="number")throw new TypeError("Start time must be set to a number.");s=k,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return a},set:function(k){if(typeof k!="number")throw new TypeError("End time must be set to a number.");a=k,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(k){o=""+k,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return u},set:function(k){u=k,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return c},set:function(k){var P=xw(k);if(P===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");c=P,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return h},set:function(k){h=!!k,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return g},set:function(k){if(typeof k!="number"&&k!==bw)throw new SyntaxError("Line: an invalid number or illegal string was specified.");g=k,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return y},set:function(k){var P=Fh(k);P?(y=P,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return v},set:function(k){if(k<0||k>100)throw new Error("Position must be between 0 and 100.");v=k,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return T},set:function(k){var P=Fh(k);P?(T=P,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return S},set:function(k){if(k<0||k>100)throw new Error("Size must be between 0 and 100.");S=k,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return A},set:function(k){var P=Fh(k);if(!P)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");A=P,this.hasBeenReset=!0}}}),this.displayState=void 0}Jy.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var Cw=Jy,ww={"":!0,up:!0};function Aw(i){if(typeof i!="string")return!1;var e=ww[i.toLowerCase()];return e?i.toLowerCase():!1}function Ga(i){return typeof i=="number"&&i>=0&&i<=100}function Dw(){var i=100,e=3,t=0,n=100,r=0,s=100,a="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return i},set:function(o){if(!Ga(o))throw new Error("Width must be between 0 and 100.");i=o}},lines:{enumerable:!0,get:function(){return e},set:function(o){if(typeof o!="number")throw new TypeError("Lines must be set to a number.");e=o}},regionAnchorY:{enumerable:!0,get:function(){return n},set:function(o){if(!Ga(o))throw new Error("RegionAnchorX must be between 0 and 100.");n=o}},regionAnchorX:{enumerable:!0,get:function(){return t},set:function(o){if(!Ga(o))throw new Error("RegionAnchorY must be between 0 and 100.");t=o}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(o){if(!Ga(o))throw new Error("ViewportAnchorY must be between 0 and 100.");s=o}},viewportAnchorX:{enumerable:!0,get:function(){return r},set:function(o){if(!Ga(o))throw new Error("ViewportAnchorX must be between 0 and 100.");r=o}},scroll:{enumerable:!0,get:function(){return a},set:function(o){var u=Aw(o);u===!1?console.warn("Scroll: an invalid or illegal string was specified."):a=u}}})}var Iw=Dw,Ln=cc,zr=Yy.exports={WebVTT:Tw,VTTCue:Cw,VTTRegion:Iw};Ln.vttjs=zr;Ln.WebVTT=zr.WebVTT;var kw=zr.VTTCue,Pw=zr.VTTRegion,Rw=Ln.VTTCue,Ow=Ln.VTTRegion;zr.shim=function(){Ln.VTTCue=kw,Ln.VTTRegion=Pw};zr.restore=function(){Ln.VTTCue=Rw,Ln.VTTRegion=Ow};Ln.VTTCue||zr.shim();var Lw=Yy.exports;const Wg=hr(Lw);var Zy={exports:{}};(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(u,c,h){if(h=h||{},u=u.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return u;var g=o.parseURL(u);if(!g)throw new Error("Error trying to parse base URL.");return g.path=o.normalizePath(g.path),o.buildURLFromParts(g)}var y=o.parseURL(c);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return h.alwaysNormalize?(y.path=o.normalizePath(y.path),o.buildURLFromParts(y)):c;var v=o.parseURL(u);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var T=r.exec(v.path);v.netLoc=T[1],v.path=T[2]}v.netLoc&&!v.path&&(v.path="/");var S={scheme:v.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(S.netLoc=v.netLoc,y.path[0]!=="/"))if(!y.path)S.path=v.path,y.params||(S.params=v.params,y.query||(S.query=v.query));else{var A=v.path,k=A.substring(0,A.lastIndexOf("/")+1)+y.path;S.path=o.normalizePath(k)}return S.path===null&&(S.path=h.alwaysNormalize?o.normalizePath(y.path):y.path),o.buildURLFromParts(S)},parseURL:function(u){var c=n.exec(u);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(a,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};i.exports=o})()})(Zy);var Nw=Zy.exports;const Cl=hr(Nw);var Kg="http://example.com",Mw=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=D.location&&D.location.href||"");var n=typeof D.URL=="function",r=/^\/\//.test(e),s=!D.location&&!/\/\//i.test(e);if(n?e=new D.URL(e,D.location||Kg):/\/\//i.test(e)||(e=Cl.buildAbsoluteURL(D.location&&D.location.href||"",e)),n){var a=new URL(t,e);return s?a.href.slice(Kg.length):r?a.href.slice(a.protocol.length):a.href}return Cl.buildAbsoluteURL(e,t)},qf=function(){function i(){this.listeners={}}var e=i.prototype;return e.on=function(n,r){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(r)},e.off=function(n,r){if(!this.listeners[n])return!1;var s=this.listeners[n].indexOf(r);return this.listeners[n]=this.listeners[n].slice(0),this.listeners[n].splice(s,1),s>-1},e.trigger=function(n){var r=this.listeners[n];if(r)if(arguments.length===2)for(var s=r.length,a=0;a<s;++a)r[a].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),u=r.length,c=0;c<u;++c)r[c].apply(this,o)},e.dispose=function(){this.listeners={}},e.pipe=function(n){this.on("data",function(r){n.push(r)})},i}(),Fw=function(e){return D.atob?D.atob(e):Buffer.from(e,"base64").toString("binary")};function Bw(i){for(var e=Fw(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}/*! @name m3u8-parser @version 6.2.0 @license Apache-2.0 */class Uw extends qf{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const Vw=String.fromCharCode(9),Bh=function(i){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(i||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},jw=function(){const i="[^=]*",e='"[^"]*"|[^,]*',t="(?:"+i+")=(?:"+e+")";return new RegExp("(?:^|,)("+t+")")},Li=function(i){const e={};if(!i)return e;const t=i.split(jw());let n=t.length,r;for(;n--;)t[n]!==""&&(r=/([^=]*)=(.*)/.exec(t[n]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),e[r[0]]=r[1]);return e};class $w extends qf{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((s,a)=>{const o=a(e);return o===e?s:s.concat([o])},[e]).forEach(s=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,s))return;if(s.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:s.slice(1)});return}if(s=s.replace("\r",""),t=/^#EXTM3U/.exec(s),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(s),t){n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),this.trigger("data",n);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(s),t){n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),this.trigger("data",n);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(s),t){n=On(Bh(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",n);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(s),t){n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(s),t){if(n={type:"tag",tagType:"map"},t[1]){const a=Li(t[1]);a.URI&&(n.uri=a.URI),a.BYTERANGE&&(n.byterange=Bh(a.BYTERANGE))}this.trigger("data",n);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(s),t){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=Li(t[1]),n.attributes.RESOLUTION){const a=n.attributes.RESOLUTION.split("x"),o={};a[0]&&(o.width=parseInt(a[0],10)),a[1]&&(o.height=parseInt(a[1],10)),n.attributes.RESOLUTION=o}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(s),t){n={type:"tag",tagType:"media"},t[1]&&(n.attributes=Li(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-ENDLIST/.exec(s),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(s),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(s),t){n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(s),t){n={type:"tag",tagType:"key"},t[1]&&(n.attributes=Li(t[1]),n.attributes.IV&&(n.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),this.trigger("data",n);return}if(t=/^#EXT-X-START:(.*)$/.exec(s),t){n={type:"tag",tagType:"start"},t[1]&&(n.attributes=Li(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"skip"},n.attributes=Li(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(Vw)),this.trigger("data",n);return}if(t=/^#EXT-X-PART:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"part"},n.attributes=Li(t[1]),["DURATION"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=Bh(n.attributes.BYTERANGE)),this.trigger("data",n);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"server-control"},n.attributes=Li(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"part-inf"},n.attributes=Li(t[1]),["PART-TARGET"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"preload-hint"},n.attributes=Li(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(n.attributes.hasOwnProperty(a)){n.attributes[a]=parseInt(n.attributes[a],10);const o=a==="BYTERANGE-LENGTH"?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[o]=n.attributes[a],delete n.attributes[a]}}),this.trigger("data",n);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"rendition-report"},n.attributes=Li(t[1]),["LAST-MSN","LAST-PART"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseInt(n.attributes[a],10))}),this.trigger("data",n);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=Li(t[1]),["ID","CLASS"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=String(n.attributes[o]))}),["START-DATE","END-DATE"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=new Date(n.attributes[o]))}),["DURATION","PLANNED-DURATION"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=parseFloat(n.attributes[o]))}),["END-ON-NEXT"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=/YES/i.test(n.attributes[o]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=n.attributes[o].toString(16))});const a=/^X-([A-Z]+-)+[A-Z]+$/;for(const o in n.attributes){if(!a.test(o))continue;const u=/[0-9A-Fa-f]{6}/g.test(n.attributes[o]),c=/^\d+(\.\d+)?$/.test(n.attributes[o]);n.attributes[o]=u?n.attributes[o].toString(16):c?parseFloat(n.attributes[o]):String(n.attributes[o])}this.trigger("data",n);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(s),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}this.trigger("data",{type:"tag",data:s.slice(4)})})}addParser({expression:e,customType:t,dataParser:n,segment:r}){typeof n!="function"&&(n=s=>s),this.customParsers.push(s=>{if(e.exec(s))return this.trigger("data",{type:"custom",data:n(s),customType:t,segment:r}),!0})}addTagMapper({expression:e,map:t}){const n=r=>e.test(r)?t(r):r;this.tagMappers.push(n)}}const qw=i=>i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),Sr=function(i){const e={};return Object.keys(i).forEach(function(t){e[qw(t)]=i[t]}),e},Uh=function(i){const{serverControl:e,targetDuration:t,partTargetDuration:n}=i;if(!e)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=t&&t*3,u=n&&n*2;t&&!e.hasOwnProperty(s)&&(e[s]=o,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&e[s]<o&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${e[s]}) to targetDuration * 3 (${o})`}),e[s]=o),n&&!e.hasOwnProperty(a)&&(e[a]=n*3,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),n&&e[a]<u&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${u}).`}),e[a]=u)};class Hw extends qf{constructor(){super(),this.lineStream=new Uw,this.parseStream=new $w,this.lineStream.pipe(this.parseStream);const e=this,t=[];let n={},r,s,a=!1;const o=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let h=0;this.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};let g=0,y=0;const v={};this.on("end",()=>{n.uri||!n.parts&&!n.preloadHints||(!n.map&&r&&(n.map=r),!n.key&&s&&(n.key=s),!n.timeline&&typeof h=="number"&&(n.timeline=h),this.manifest.preloadSegment=n)}),this.parseStream.on("data",function(T){let S,A;({tag(){({version(){T.version&&(this.manifest.version=T.version)},"allow-cache"(){this.manifest.allowCache=T.allowed,"allowed"in T||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const k={};"length"in T&&(n.byterange=k,k.length=T.length,"offset"in T||(T.offset=g)),"offset"in T&&(n.byterange=k,k.offset=T.offset),g=k.offset+k.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),T.duration>0&&(n.duration=T.duration),T.duration===0&&(n.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(!T.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(T.attributes.METHOD==="NONE"){s=null;return}if(!T.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(T.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:T.attributes};return}if(T.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:T.attributes.URI};return}if(T.attributes.KEYFORMAT===c){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(T.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(T.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),T.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(T.attributes.KEYID&&T.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:T.attributes.KEYFORMAT,keyId:T.attributes.KEYID.substring(2)},pssh:Bw(T.attributes.URI.split(",")[1])};return}T.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),s={method:T.attributes.METHOD||"AES-128",uri:T.attributes.URI},typeof T.attributes.IV<"u"&&(s.iv=T.attributes.IV)},"media-sequence"(){if(!isFinite(T.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+T.number});return}this.manifest.mediaSequence=T.number},"discontinuity-sequence"(){if(!isFinite(T.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+T.number});return}this.manifest.discontinuitySequence=T.number,h=T.number},"playlist-type"(){if(!/VOD|EVENT/.test(T.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+T.playlist});return}this.manifest.playlistType=T.playlistType},map(){r={},T.uri&&(r.uri=T.uri),T.byterange&&(r.byterange=T.byterange),s&&(r.key=s)},"stream-inf"(){if(this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||u,!T.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}n.attributes||(n.attributes={}),On(n.attributes,T.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,!(T.attributes&&T.attributes.TYPE&&T.attributes["GROUP-ID"]&&T.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const k=this.manifest.mediaGroups[T.attributes.TYPE];k[T.attributes["GROUP-ID"]]=k[T.attributes["GROUP-ID"]]||{},S=k[T.attributes["GROUP-ID"]],A={default:/yes/i.test(T.attributes.DEFAULT)},A.default?A.autoselect=!0:A.autoselect=/yes/i.test(T.attributes.AUTOSELECT),T.attributes.LANGUAGE&&(A.language=T.attributes.LANGUAGE),T.attributes.URI&&(A.uri=T.attributes.URI),T.attributes["INSTREAM-ID"]&&(A.instreamId=T.attributes["INSTREAM-ID"]),T.attributes.CHARACTERISTICS&&(A.characteristics=T.attributes.CHARACTERISTICS),T.attributes.FORCED&&(A.forced=/yes/i.test(T.attributes.FORCED)),S[T.attributes.NAME]=A},discontinuity(){h+=1,n.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=T.dateTimeString,this.manifest.dateTimeObject=T.dateTimeObject),n.dateTimeString=T.dateTimeString,n.dateTimeObject=T.dateTimeObject},targetduration(){if(!isFinite(T.duration)||T.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+T.duration});return}this.manifest.targetDuration=T.duration,Uh.call(this,this.manifest)},start(){if(!T.attributes||isNaN(T.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:T.attributes["TIME-OFFSET"],precise:T.attributes.PRECISE}},"cue-out"(){n.cueOut=T.data},"cue-out-cont"(){n.cueOutCont=T.data},"cue-in"(){n.cueIn=T.data},skip(){this.manifest.skip=Sr(T.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",T.attributes,["SKIPPED-SEGMENTS"])},part(){a=!0;const k=this.manifest.segments.length,P=Sr(T.attributes);n.parts=n.parts||[],n.parts.push(P),P.byterange&&(P.byterange.hasOwnProperty("offset")||(P.byterange.offset=y),y=P.byterange.offset+P.byterange.length);const M=n.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${M} for segment #${k}`,T.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((R,O)=>{R.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${O} lacks required attribute(s): LAST-PART`})})},"server-control"(){const k=this.manifest.serverControl=Sr(T.attributes);k.hasOwnProperty("canBlockReload")||(k.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Uh.call(this,this.manifest),k.canSkipDateranges&&!k.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const k=this.manifest.segments.length,P=Sr(T.attributes),M=P.type&&P.type==="PART";n.preloadHints=n.preloadHints||[],n.preloadHints.push(P),P.byterange&&(P.byterange.hasOwnProperty("offset")||(P.byterange.offset=M?y:0,M&&(y=P.byterange.offset+P.byterange.length)));const R=n.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${R} for segment #${k}`,T.attributes,["TYPE","URI"]),!!P.type)for(let O=0;O<n.preloadHints.length-1;O++){const j=n.preloadHints[O];j.type&&j.type===P.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${R} for segment #${k} has the same TYPE ${P.type} as preload hint #${O}`})}},"rendition-report"(){const k=Sr(T.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(k);const P=this.manifest.renditionReports.length-1,M=["LAST-MSN","URI"];a&&M.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${P}`,T.attributes,M)},"part-inf"(){this.manifest.partInf=Sr(T.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",T.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Uh.call(this,this.manifest)},daterange(){this.manifest.daterange=this.manifest.daterange||[],this.manifest.daterange.push(Sr(T.attributes));const k=this.manifest.daterange.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${k}`,T.attributes,["ID","START-DATE"]);const P=this.manifest.daterange[k];P.endDate&&P.startDate&&new Date(P.endDate)<new Date(P.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),P.duration&&P.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),P.plannedDuration&&P.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const M=!!P.endOnNext;if(M&&!P.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),M&&(P.duration||P.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),P.duration&&P.endDate){const R=P.startDate,O=R.setSeconds(R.getSeconds()+P.duration);this.manifest.daterange[k].endDate=new Date(O)}if(P&&!this.manifest.dateTimeString&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),!v[P.id])v[P.id]=P;else for(const R in v[P.id])if(v[P.id][R]!==P[R]){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes and same attribute values"});break}},"independent-segments"(){this.manifest.independentSegments=!0}}[T.tagType]||o).call(e)},uri(){n.uri=T.uri,t.push(n),this.manifest.targetDuration&&!("duration"in n)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),n.duration=this.manifest.targetDuration),s&&(n.key=s),n.timeline=h,r&&(n.map=r),y=0,n={}},comment(){},custom(){T.segment?(n.custom=n.custom||{},n.custom[T.customType]=T.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[T.customType]=T.data)}})[T.type].call(e)})}warnOnMissingAttributes_(e,t,n){const r=[];n.forEach(function(s){t.hasOwnProperty(s)||r.push(s)}),r.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${r.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var Lr={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},Gw=["video","audio","text"],Xg=["Video","Audio","Text"],ev=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(t,n,r){var s=("00"+Number(n).toString(16)).slice(-2),a=("00"+Number(r).toString(16)).slice(-2);return"avc1."+s+"00"+a})},tn=function(e){e===void 0&&(e="");var t=e.split(","),n=[];return t.forEach(function(r){r=r.trim();var s;Gw.forEach(function(a){var o=Lr[a].exec(r.toLowerCase());if(!(!o||o.length<=1)){s=a;var u=r.substring(0,o[1].length),c=r.replace(u,"");n.push({type:u,details:c,mediaType:a})}}),s||n.push({type:r,details:"",mediaType:"unknown"})}),n},zw=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var r in n){var s=n[r];if(s.default&&s.playlists)return tn(s.playlists[0].attributes.CODECS)}return null},tv=function(e){return e===void 0&&(e=""),Lr.audio.test(e.trim().toLowerCase())},Ww=function(e){return e===void 0&&(e=""),Lr.text.test(e.trim().toLowerCase())},Ao=function(e){if(!(!e||typeof e!="string")){var t=e.toLowerCase().split(",").map(function(s){return ev(s.trim())}),n="video";t.length===1&&tv(t[0])?n="audio":t.length===1&&Ww(t[0])&&(n="application");var r="mp4";return t.every(function(s){return Lr.mp4.test(s)})?r="mp4":t.every(function(s){return Lr.webm.test(s)})?r="webm":t.every(function(s){return Lr.ogg.test(s)})&&(r="ogg"),n+"/"+r+';codecs="'+e+'"'}},cl=function(e){return e===void 0&&(e=""),D.MediaSource&&D.MediaSource.isTypeSupported&&D.MediaSource.isTypeSupported(Ao(e))||!1},Vh=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(t){t=t.trim();for(var n=0;n<Xg.length;n++){var r=Xg[n];if(Lr["muxer"+r].test(t))return!0}return!1})},Yg="mp4a.40.2",Kw="avc1.4d400d",Xw=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,Yw=/^application\/dash\+xml/i,iv=function(e){return Xw.test(e)?"hls":Yw.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},Qw=function(e){return e.toString(2).length},Jw=function(e){return Math.ceil(Qw(e)/8)},nv=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},Zw=function(e){return nv(e)},ue=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!Zw(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},Lt=D.BigInt||Number,Pd=[Lt("0x1"),Lt("0x100"),Lt("0x10000"),Lt("0x1000000"),Lt("0x100000000"),Lt("0x10000000000"),Lt("0x1000000000000"),Lt("0x100000000000000"),Lt("0x10000000000000000")];(function(){var i=new Uint16Array([65484]),e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var eA=function(e,t){var n=t===void 0?{}:t,r=n.signed,s=r===void 0?!1:r,a=n.le,o=a===void 0?!1:a;e=ue(e);var u=o?"reduce":"reduceRight",c=e[u]?e[u]:Array.prototype[u],h=c.call(e,function(y,v,T){var S=o?T:Math.abs(T+1-e.length);return y+Lt(v)*Pd[S]},Lt(0));if(s){var g=Pd[e.length]/Lt(2)-Lt(1);h=Lt(h),h>g&&(h-=g,h-=g,h-=Lt(2))}return Number(h)},tA=function(e,t){var n=t===void 0?{}:t,r=n.le,s=r===void 0?!1:r;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=Lt(e);for(var a=Jw(e),o=new Uint8Array(new ArrayBuffer(a)),u=0;u<a;u++){var c=s?u:Math.abs(u+1-o.length);o[c]=Number(e/Pd[u]&Lt(255)),e<0&&(o[c]=Math.abs(~o[c]),o[c]-=u===0?1:2)}return o},rv=function(e,t){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},iA=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter(function(o){return o&&(o.byteLength||o.length)&&typeof o!="string"}),t.length<=1)return ue(t[0]);var r=t.reduce(function(o,u,c){return o+(u.byteLength||u.length)},0),s=new Uint8Array(r),a=0;return t.forEach(function(o){o=ue(o),s.set(o,a),a+=o.byteLength}),s},nt=function(e,t,n){var r=n===void 0?{}:n,s=r.offset,a=s===void 0?0:s,o=r.mask,u=o===void 0?[]:o;e=ue(e),t=ue(t);var c=t.every?t.every:Array.prototype.every;return t.length&&e.length-a>=t.length&&c.call(t,function(h,g){var y=u[g]?u[g]&e[a+g]:e[a+g];return h===y})},Qg="http://example.com",Hf=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=D.location&&D.location.href||"");var n=typeof D.URL=="function",r=/^\/\//.test(e),s=!D.location&&!/\/\//i.test(e);if(n?e=new D.URL(e,D.location||Qg):/\/\//i.test(e)||(e=Cl.buildAbsoluteURL(D.location&&D.location.href||"",e)),n){var a=new URL(t,e);return s?a.href.slice(Qg.length):r?a.href.slice(a.protocol.length):a.href}return Cl.buildAbsoluteURL(e,t)},nA=function(e,t,n){t.forEach(function(r){for(var s in e.mediaGroups[r])for(var a in e.mediaGroups[r][s]){var o=e.mediaGroups[r][s][a];n(o,r,s,a)}})},rA=function(e){return D.atob?D.atob(e):Buffer.from(e,"base64").toString("binary")};function sA(i){for(var e=rA(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}var dr={},Hn={};function aA(i,e,t){if(t===void 0&&(t=Array.prototype),i&&typeof t.find=="function")return t.find.call(i,e);for(var n=0;n<i.length;n++)if(Object.prototype.hasOwnProperty.call(i,n)){var r=i[n];if(e.call(void 0,r,n,i))return r}}function Gf(i,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(i):i}function oA(i,e){if(i===null||typeof i!="object")throw new TypeError("target is not an object");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t]);return i}var sv=Gf({HTML:"text/html",isHTML:function(i){return i===sv.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),av=Gf({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(i){return i===av.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});Hn.assign=oA;Hn.find=aA;Hn.freeze=Gf;Hn.MIME_TYPE=sv;Hn.NAMESPACE=av;var ov=Hn,fn=ov.find,Do=ov.NAMESPACE;function uA(i){return i!==""}function lA(i){return i?i.split(/[\t\n\f\r ]+/).filter(uA):[]}function cA(i,e){return i.hasOwnProperty(e)||(i[e]=!0),i}function Jg(i){if(!i)return[];var e=lA(i);return Object.keys(e.reduce(cA,{}))}function hA(i){return function(e){return i&&i.indexOf(e)!==-1}}function Jo(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function Ti(i,e){var t=i.prototype;if(!(t instanceof e)){let r=function(){};var n=r;r.prototype=e.prototype,r=new r,Jo(t,r),i.prototype=t=r}t.constructor!=i&&(typeof i!="function"&&console.error("unknown Class:"+i),t.constructor=i)}var bi={},Ki=bi.ELEMENT_NODE=1,qs=bi.ATTRIBUTE_NODE=2,wl=bi.TEXT_NODE=3,uv=bi.CDATA_SECTION_NODE=4,lv=bi.ENTITY_REFERENCE_NODE=5,dA=bi.ENTITY_NODE=6,cv=bi.PROCESSING_INSTRUCTION_NODE=7,hv=bi.COMMENT_NODE=8,dv=bi.DOCUMENT_NODE=9,fv=bi.DOCUMENT_TYPE_NODE=10,Nn=bi.DOCUMENT_FRAGMENT_NODE=11,fA=bi.NOTATION_NODE=12,Zt={},It={};Zt.INDEX_SIZE_ERR=(It[1]="Index size error",1);Zt.DOMSTRING_SIZE_ERR=(It[2]="DOMString size error",2);var _i=Zt.HIERARCHY_REQUEST_ERR=(It[3]="Hierarchy request error",3);Zt.WRONG_DOCUMENT_ERR=(It[4]="Wrong document",4);Zt.INVALID_CHARACTER_ERR=(It[5]="Invalid character",5);Zt.NO_DATA_ALLOWED_ERR=(It[6]="No data allowed",6);Zt.NO_MODIFICATION_ALLOWED_ERR=(It[7]="No modification allowed",7);var pv=Zt.NOT_FOUND_ERR=(It[8]="Not found",8);Zt.NOT_SUPPORTED_ERR=(It[9]="Not supported",9);var Zg=Zt.INUSE_ATTRIBUTE_ERR=(It[10]="Attribute in use",10);Zt.INVALID_STATE_ERR=(It[11]="Invalid state",11);Zt.SYNTAX_ERR=(It[12]="Syntax error",12);Zt.INVALID_MODIFICATION_ERR=(It[13]="Invalid modification",13);Zt.NAMESPACE_ERR=(It[14]="Invalid namespace",14);Zt.INVALID_ACCESS_ERR=(It[15]="Invalid access",15);function dt(i,e){if(e instanceof Error)var t=e;else t=this,Error.call(this,It[i]),this.message=It[i],Error.captureStackTrace&&Error.captureStackTrace(this,dt);return t.code=i,e&&(this.message=this.message+": "+e),t}dt.prototype=Error.prototype;Jo(Zt,dt);function Pn(){}Pn.prototype={length:0,item:function(i){return i>=0&&i<this.length?this[i]:null},toString:function(i,e){for(var t=[],n=0;n<this.length;n++)bs(this[n],t,i,e);return t.join("")},filter:function(i){return Array.prototype.filter.call(this,i)},indexOf:function(i){return Array.prototype.indexOf.call(this,i)}};function Hs(i,e){this._node=i,this._refresh=e,zf(this)}function zf(i){var e=i._node._inc||i._node.ownerDocument._inc;if(i._inc!==e){var t=i._refresh(i._node);if(wv(i,"length",t.length),!i.$$length||t.length<i.$$length)for(var n=t.length;n in i;n++)Object.prototype.hasOwnProperty.call(i,n)&&delete i[n];Jo(t,i),i._inc=e}}Hs.prototype.item=function(i){return zf(this),this[i]||null};Ti(Hs,Pn);function Al(){}function mv(i,e){for(var t=i.length;t--;)if(i[t]===e)return t}function e0(i,e,t,n){if(n?e[mv(e,n)]=t:e[e.length++]=t,i){t.ownerElement=i;var r=i.ownerDocument;r&&(n&&yv(r,i,n),pA(r,i,t))}}function t0(i,e,t){var n=mv(e,t);if(n>=0){for(var r=e.length-1;n<r;)e[n]=e[++n];if(e.length=r,i){var s=i.ownerDocument;s&&(yv(s,i,t),t.ownerElement=null)}}else throw new dt(pv,new Error(i.tagName+"@"+t))}Al.prototype={length:0,item:Pn.prototype.item,getNamedItem:function(i){for(var e=this.length;e--;){var t=this[e];if(t.nodeName==i)return t}},setNamedItem:function(i){var e=i.ownerElement;if(e&&e!=this._ownerElement)throw new dt(Zg);var t=this.getNamedItem(i.nodeName);return e0(this._ownerElement,this,i,t),t},setNamedItemNS:function(i){var e=i.ownerElement,t;if(e&&e!=this._ownerElement)throw new dt(Zg);return t=this.getNamedItemNS(i.namespaceURI,i.localName),e0(this._ownerElement,this,i,t),t},removeNamedItem:function(i){var e=this.getNamedItem(i);return t0(this._ownerElement,this,e),e},removeNamedItemNS:function(i,e){var t=this.getNamedItemNS(i,e);return t0(this._ownerElement,this,t),t},getNamedItemNS:function(i,e){for(var t=this.length;t--;){var n=this[t];if(n.localName==e&&n.namespaceURI==i)return n}return null}};function gv(){}gv.prototype={hasFeature:function(i,e){return!0},createDocument:function(i,e,t){var n=new Zo;if(n.implementation=this,n.childNodes=new Pn,n.doctype=t||null,t&&n.appendChild(t),e){var r=n.createElementNS(i,e);n.appendChild(r)}return n},createDocumentType:function(i,e,t){var n=new dc;return n.name=i,n.nodeName=i,n.publicId=e||"",n.systemId=t||"",n}};function $e(){}$e.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(i,e){return Dl(this,i,e)},replaceChild:function(i,e){Dl(this,i,e,Tv),e&&this.removeChild(e)},removeChild:function(i){return vv(this,i)},appendChild:function(i){return this.insertBefore(i,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(i){return Rd(this.ownerDocument||this,this,i)},normalize:function(){for(var i=this.firstChild;i;){var e=i.nextSibling;e&&e.nodeType==wl&&i.nodeType==wl?(this.removeChild(e),i.appendData(e.data)):(i.normalize(),i=e)}},isSupported:function(i,e){return this.ownerDocument.implementation.hasFeature(i,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(i){for(var e=this;e;){var t=e._nsMap;if(t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&t[n]===i)return n}e=e.nodeType==qs?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(i){for(var e=this;e;){var t=e._nsMap;if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i];e=e.nodeType==qs?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(i){var e=this.lookupPrefix(i);return e==null}};function _v(i){return i=="<"&&"&lt;"||i==">"&&"&gt;"||i=="&"&&"&amp;"||i=='"'&&"&quot;"||"&#"+i.charCodeAt()+";"}Jo(bi,$e);Jo(bi,$e.prototype);function Io(i,e){if(e(i))return!0;if(i=i.firstChild)do if(Io(i,e))return!0;while(i=i.nextSibling)}function Zo(){this.ownerDocument=this}function pA(i,e,t){i&&i._inc++;var n=t.namespaceURI;n===Do.XMLNS&&(e._nsMap[t.prefix?t.localName:""]=t.value)}function yv(i,e,t,n){i&&i._inc++;var r=t.namespaceURI;r===Do.XMLNS&&delete e._nsMap[t.prefix?t.localName:""]}function Wf(i,e,t){if(i&&i._inc){i._inc++;var n=e.childNodes;if(t)n[n.length++]=t;else{for(var r=e.firstChild,s=0;r;)n[s++]=r,r=r.nextSibling;n.length=s,delete n[n.length]}}}function vv(i,e){var t=e.previousSibling,n=e.nextSibling;return t?t.nextSibling=n:i.firstChild=n,n?n.previousSibling=t:i.lastChild=t,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,Wf(i.ownerDocument,i),e}function mA(i){return i&&(i.nodeType===$e.DOCUMENT_NODE||i.nodeType===$e.DOCUMENT_FRAGMENT_NODE||i.nodeType===$e.ELEMENT_NODE)}function gA(i){return i&&(pn(i)||Kf(i)||Mn(i)||i.nodeType===$e.DOCUMENT_FRAGMENT_NODE||i.nodeType===$e.COMMENT_NODE||i.nodeType===$e.PROCESSING_INSTRUCTION_NODE)}function Mn(i){return i&&i.nodeType===$e.DOCUMENT_TYPE_NODE}function pn(i){return i&&i.nodeType===$e.ELEMENT_NODE}function Kf(i){return i&&i.nodeType===$e.TEXT_NODE}function i0(i,e){var t=i.childNodes||[];if(fn(t,pn)||Mn(e))return!1;var n=fn(t,Mn);return!(e&&n&&t.indexOf(n)>t.indexOf(e))}function n0(i,e){var t=i.childNodes||[];function n(s){return pn(s)&&s!==e}if(fn(t,n))return!1;var r=fn(t,Mn);return!(e&&r&&t.indexOf(r)>t.indexOf(e))}function _A(i,e,t){if(!mA(i))throw new dt(_i,"Unexpected parent node type "+i.nodeType);if(t&&t.parentNode!==i)throw new dt(pv,"child not in parent");if(!gA(e)||Mn(e)&&i.nodeType!==$e.DOCUMENT_NODE)throw new dt(_i,"Unexpected node type "+e.nodeType+" for parent node type "+i.nodeType)}function yA(i,e,t){var n=i.childNodes||[],r=e.childNodes||[];if(e.nodeType===$e.DOCUMENT_FRAGMENT_NODE){var s=r.filter(pn);if(s.length>1||fn(r,Kf))throw new dt(_i,"More than one element or text in fragment");if(s.length===1&&!i0(i,t))throw new dt(_i,"Element in fragment can not be inserted before doctype")}if(pn(e)&&!i0(i,t))throw new dt(_i,"Only one element can be added and only after doctype");if(Mn(e)){if(fn(n,Mn))throw new dt(_i,"Only one doctype is allowed");var a=fn(n,pn);if(t&&n.indexOf(a)<n.indexOf(t))throw new dt(_i,"Doctype can only be inserted before an element");if(!t&&a)throw new dt(_i,"Doctype can not be appended since element is present")}}function Tv(i,e,t){var n=i.childNodes||[],r=e.childNodes||[];if(e.nodeType===$e.DOCUMENT_FRAGMENT_NODE){var s=r.filter(pn);if(s.length>1||fn(r,Kf))throw new dt(_i,"More than one element or text in fragment");if(s.length===1&&!n0(i,t))throw new dt(_i,"Element in fragment can not be inserted before doctype")}if(pn(e)&&!n0(i,t))throw new dt(_i,"Only one element can be added and only after doctype");if(Mn(e)){let u=function(c){return Mn(c)&&c!==t};var o=u;if(fn(n,u))throw new dt(_i,"Only one doctype is allowed");var a=fn(n,pn);if(t&&n.indexOf(a)<n.indexOf(t))throw new dt(_i,"Doctype can only be inserted before an element")}}function Dl(i,e,t,n){_A(i,e,t),i.nodeType===$e.DOCUMENT_NODE&&(n||yA)(i,e,t);var r=e.parentNode;if(r&&r.removeChild(e),e.nodeType===Nn){var s=e.firstChild;if(s==null)return e;var a=e.lastChild}else s=a=e;var o=t?t.previousSibling:i.lastChild;s.previousSibling=o,a.nextSibling=t,o?o.nextSibling=s:i.firstChild=s,t==null?i.lastChild=a:t.previousSibling=a;do s.parentNode=i;while(s!==a&&(s=s.nextSibling));return Wf(i.ownerDocument||i,i),e.nodeType==Nn&&(e.firstChild=e.lastChild=null),e}function vA(i,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=i,e.previousSibling=i.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:i.firstChild=e,i.lastChild=e,Wf(i.ownerDocument,i,e),e}Zo.prototype={nodeName:"#document",nodeType:dv,doctype:null,documentElement:null,_inc:1,insertBefore:function(i,e){if(i.nodeType==Nn){for(var t=i.firstChild;t;){var n=t.nextSibling;this.insertBefore(t,e),t=n}return i}return Dl(this,i,e),i.ownerDocument=this,this.documentElement===null&&i.nodeType===Ki&&(this.documentElement=i),i},removeChild:function(i){return this.documentElement==i&&(this.documentElement=null),vv(this,i)},replaceChild:function(i,e){Dl(this,i,e,Tv),i.ownerDocument=this,e&&this.removeChild(e),pn(i)&&(this.documentElement=i)},importNode:function(i,e){return Cv(this,i,e)},getElementById:function(i){var e=null;return Io(this.documentElement,function(t){if(t.nodeType==Ki&&t.getAttribute("id")==i)return e=t,!0}),e},getElementsByClassName:function(i){var e=Jg(i);return new Hs(this,function(t){var n=[];return e.length>0&&Io(t.documentElement,function(r){if(r!==t&&r.nodeType===Ki){var s=r.getAttribute("class");if(s){var a=i===s;if(!a){var o=Jg(s);a=e.every(hA(o))}a&&n.push(r)}}}),n})},createElement:function(i){var e=new Vr;e.ownerDocument=this,e.nodeName=i,e.tagName=i,e.localName=i,e.childNodes=new Pn;var t=e.attributes=new Al;return t._ownerElement=e,e},createDocumentFragment:function(){var i=new fc;return i.ownerDocument=this,i.childNodes=new Pn,i},createTextNode:function(i){var e=new Xf;return e.ownerDocument=this,e.appendData(i),e},createComment:function(i){var e=new Yf;return e.ownerDocument=this,e.appendData(i),e},createCDATASection:function(i){var e=new Qf;return e.ownerDocument=this,e.appendData(i),e},createProcessingInstruction:function(i,e){var t=new Zf;return t.ownerDocument=this,t.tagName=t.nodeName=t.target=i,t.nodeValue=t.data=e,t},createAttribute:function(i){var e=new Il;return e.ownerDocument=this,e.name=i,e.nodeName=i,e.localName=i,e.specified=!0,e},createEntityReference:function(i){var e=new Jf;return e.ownerDocument=this,e.nodeName=i,e},createElementNS:function(i,e){var t=new Vr,n=e.split(":"),r=t.attributes=new Al;return t.childNodes=new Pn,t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.namespaceURI=i,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,r._ownerElement=t,t},createAttributeNS:function(i,e){var t=new Il,n=e.split(":");return t.ownerDocument=this,t.nodeName=e,t.name=e,t.namespaceURI=i,t.specified=!0,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,t}};Ti(Zo,$e);function Vr(){this._nsMap={}}Vr.prototype={nodeType:Ki,hasAttribute:function(i){return this.getAttributeNode(i)!=null},getAttribute:function(i){var e=this.getAttributeNode(i);return e&&e.value||""},getAttributeNode:function(i){return this.attributes.getNamedItem(i)},setAttribute:function(i,e){var t=this.ownerDocument.createAttribute(i);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(i){var e=this.getAttributeNode(i);e&&this.removeAttributeNode(e)},appendChild:function(i){return i.nodeType===Nn?this.insertBefore(i,null):vA(this,i)},setAttributeNode:function(i){return this.attributes.setNamedItem(i)},setAttributeNodeNS:function(i){return this.attributes.setNamedItemNS(i)},removeAttributeNode:function(i){return this.attributes.removeNamedItem(i.nodeName)},removeAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);t&&this.removeAttributeNode(t)},hasAttributeNS:function(i,e){return this.getAttributeNodeNS(i,e)!=null},getAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);return t&&t.value||""},setAttributeNS:function(i,e,t){var n=this.ownerDocument.createAttributeNS(i,e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},getAttributeNodeNS:function(i,e){return this.attributes.getNamedItemNS(i,e)},getElementsByTagName:function(i){return new Hs(this,function(e){var t=[];return Io(e,function(n){n!==e&&n.nodeType==Ki&&(i==="*"||n.tagName==i)&&t.push(n)}),t})},getElementsByTagNameNS:function(i,e){return new Hs(this,function(t){var n=[];return Io(t,function(r){r!==t&&r.nodeType===Ki&&(i==="*"||r.namespaceURI===i)&&(e==="*"||r.localName==e)&&n.push(r)}),n})}};Zo.prototype.getElementsByTagName=Vr.prototype.getElementsByTagName;Zo.prototype.getElementsByTagNameNS=Vr.prototype.getElementsByTagNameNS;Ti(Vr,$e);function Il(){}Il.prototype.nodeType=qs;Ti(Il,$e);function eu(){}eu.prototype={data:"",substringData:function(i,e){return this.data.substring(i,i+e)},appendData:function(i){i=this.data+i,this.nodeValue=this.data=i,this.length=i.length},insertData:function(i,e){this.replaceData(i,0,e)},appendChild:function(i){throw new Error(It[_i])},deleteData:function(i,e){this.replaceData(i,e,"")},replaceData:function(i,e,t){var n=this.data.substring(0,i),r=this.data.substring(i+e);t=n+t+r,this.nodeValue=this.data=t,this.length=t.length}};Ti(eu,$e);function Xf(){}Xf.prototype={nodeName:"#text",nodeType:wl,splitText:function(i){var e=this.data,t=e.substring(i);e=e.substring(0,i),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}};Ti(Xf,eu);function Yf(){}Yf.prototype={nodeName:"#comment",nodeType:hv};Ti(Yf,eu);function Qf(){}Qf.prototype={nodeName:"#cdata-section",nodeType:uv};Ti(Qf,eu);function dc(){}dc.prototype.nodeType=fv;Ti(dc,$e);function bv(){}bv.prototype.nodeType=fA;Ti(bv,$e);function Ev(){}Ev.prototype.nodeType=dA;Ti(Ev,$e);function Jf(){}Jf.prototype.nodeType=lv;Ti(Jf,$e);function fc(){}fc.prototype.nodeName="#document-fragment";fc.prototype.nodeType=Nn;Ti(fc,$e);function Zf(){}Zf.prototype.nodeType=cv;Ti(Zf,$e);function Sv(){}Sv.prototype.serializeToString=function(i,e,t){return xv.call(i,e,t)};$e.prototype.toString=xv;function xv(i,e){var t=[],n=this.nodeType==9&&this.documentElement||this,r=n.prefix,s=n.namespaceURI;if(s&&r==null){var r=n.lookupPrefix(s);if(r==null)var a=[{namespace:s,prefix:null}]}return bs(this,t,i,e,a),t.join("")}function r0(i,e,t){var n=i.prefix||"",r=i.namespaceURI;if(!r||n==="xml"&&r===Do.XML||r===Do.XMLNS)return!1;for(var s=t.length;s--;){var a=t[s];if(a.prefix===n)return a.namespace!==r}return!0}function jh(i,e,t){i.push(" ",e,'="',t.replace(/[<>&"\t\n\r]/g,_v),'"')}function bs(i,e,t,n,r){if(r||(r=[]),n)if(i=n(i),i){if(typeof i=="string"){e.push(i);return}}else return;switch(i.nodeType){case Ki:var s=i.attributes,a=s.length,k=i.firstChild,o=i.tagName;t=Do.isHTML(i.namespaceURI)||t;var u=o;if(!t&&!i.prefix&&i.namespaceURI){for(var c,h=0;h<s.length;h++)if(s.item(h).name==="xmlns"){c=s.item(h).value;break}if(!c)for(var g=r.length-1;g>=0;g--){var y=r[g];if(y.prefix===""&&y.namespace===i.namespaceURI){c=y.namespace;break}}if(c!==i.namespaceURI)for(var g=r.length-1;g>=0;g--){var y=r[g];if(y.namespace===i.namespaceURI){y.prefix&&(u=y.prefix+":"+o);break}}}e.push("<",u);for(var v=0;v<a;v++){var T=s.item(v);T.prefix=="xmlns"?r.push({prefix:T.localName,namespace:T.value}):T.nodeName=="xmlns"&&r.push({prefix:"",namespace:T.value})}for(var v=0;v<a;v++){var T=s.item(v);if(r0(T,t,r)){var S=T.prefix||"",A=T.namespaceURI;jh(e,S?"xmlns:"+S:"xmlns",A),r.push({prefix:S,namespace:A})}bs(T,e,t,n,r)}if(o===u&&r0(i,t,r)){var S=i.prefix||"",A=i.namespaceURI;jh(e,S?"xmlns:"+S:"xmlns",A),r.push({prefix:S,namespace:A})}if(k||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(o)){if(e.push(">"),t&&/^script$/i.test(o))for(;k;)k.data?e.push(k.data):bs(k,e,t,n,r.slice()),k=k.nextSibling;else for(;k;)bs(k,e,t,n,r.slice()),k=k.nextSibling;e.push("</",u,">")}else e.push("/>");return;case dv:case Nn:for(var k=i.firstChild;k;)bs(k,e,t,n,r.slice()),k=k.nextSibling;return;case qs:return jh(e,i.name,i.value);case wl:return e.push(i.data.replace(/[<&>]/g,_v));case uv:return e.push("<![CDATA[",i.data,"]]>");case hv:return e.push("<!--",i.data,"-->");case fv:var P=i.publicId,M=i.systemId;if(e.push("<!DOCTYPE ",i.name),P)e.push(" PUBLIC ",P),M&&M!="."&&e.push(" ",M),e.push(">");else if(M&&M!=".")e.push(" SYSTEM ",M,">");else{var R=i.internalSubset;R&&e.push(" [",R,"]"),e.push(">")}return;case cv:return e.push("<?",i.target," ",i.data,"?>");case lv:return e.push("&",i.nodeName,";");default:e.push("??",i.nodeName)}}function Cv(i,e,t){var n;switch(e.nodeType){case Ki:n=e.cloneNode(!1),n.ownerDocument=i;case Nn:break;case qs:t=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=i,n.parentNode=null,t)for(var r=e.firstChild;r;)n.appendChild(Cv(i,r,t)),r=r.nextSibling;return n}function Rd(i,e,t){var n=new e.constructor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=e[r];typeof s!="object"&&s!=n[r]&&(n[r]=s)}switch(e.childNodes&&(n.childNodes=new Pn),n.ownerDocument=i,n.nodeType){case Ki:var a=e.attributes,o=n.attributes=new Al,u=a.length;o._ownerElement=n;for(var c=0;c<u;c++)n.setAttributeNode(Rd(i,a.item(c),!0));break;case qs:t=!0}if(t)for(var h=e.firstChild;h;)n.appendChild(Rd(i,h,t)),h=h.nextSibling;return n}function wv(i,e,t){i[e]=t}try{if(Object.defineProperty){let i=function(e){switch(e.nodeType){case Ki:case Nn:var t=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&t.push(i(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}};var PF=i;Object.defineProperty(Hs.prototype,"length",{get:function(){return zf(this),this.$$length}}),Object.defineProperty($e.prototype,"textContent",{get:function(){return i(this)},set:function(e){switch(this.nodeType){case Ki:case Nn:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),wv=function(e,t,n){e["$$"+t]=n}}}catch{}dr.DocumentType=dc;dr.DOMException=dt;dr.DOMImplementation=gv;dr.Element=Vr;dr.Node=$e;dr.NodeList=Pn;dr.XMLSerializer=Sv;var pc={},Av={};(function(i){var e=Hn.freeze;i.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),i.HTML_ENTITIES=e({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),i.entityMap=i.HTML_ENTITIES})(Av);var ep={},ko=Hn.NAMESPACE,Od=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s0=new RegExp("[\\-\\.0-9"+Od.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a0=new RegExp("^"+Od.source+s0.source+"*(?::"+Od.source+s0.source+"*)?$"),za=0,Yn=1,ls=2,Wa=3,cs=4,hs=5,Ka=6,qu=7;function Gs(i,e){this.message=i,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Gs)}Gs.prototype=new Error;Gs.prototype.name=Gs.name;function Dv(){}Dv.prototype={parse:function(i,e,t){var n=this.domBuilder;n.startDocument(),Iv(e,e={}),TA(i,e,t,n,this.errorHandler),n.endDocument()}};function TA(i,e,t,n,r){function s(Ee){if(Ee>65535){Ee-=65536;var Fe=55296+(Ee>>10),He=56320+(Ee&1023);return String.fromCharCode(Fe,He)}else return String.fromCharCode(Ee)}function a(Ee){var Fe=Ee.slice(1,-1);return Object.hasOwnProperty.call(t,Fe)?t[Fe]:Fe.charAt(0)==="#"?s(parseInt(Fe.substr(1).replace("x","0x"))):(r.error("entity not found:"+Ee),Ee)}function o(Ee){if(Ee>S){var Fe=i.substring(S,Ee).replace(/&#?\w+;/g,a);y&&u(S),n.characters(Fe,0,Ee-S),S=Ee}}function u(Ee,Fe){for(;Ee>=h&&(Fe=g.exec(i));)c=Fe.index,h=c+Fe[0].length,y.lineNumber++;y.columnNumber=Ee-c+1}for(var c=0,h=0,g=/.*(?:\r\n?|\n)|.*$/g,y=n.locator,v=[{currentNSMap:e}],T={},S=0;;){try{var A=i.indexOf("<",S);if(A<0){if(!i.substr(S).match(/^\s*$/)){var k=n.doc,P=k.createTextNode(i.substr(S));k.appendChild(P),n.currentElement=P}return}switch(A>S&&o(A),i.charAt(A+1)){case"/":var pe=i.indexOf(">",A+3),M=i.substring(A+2,pe).replace(/[ \t\n\r]+$/g,""),R=v.pop();pe<0?(M=i.substring(A+2).replace(/[\s<].*/,""),r.error("end tag name: "+M+" is not complete:"+R.tagName),pe=A+1+M.length):M.match(/\s</)&&(M=M.replace(/[\s<].*/,""),r.error("end tag name: "+M+" maybe not complete"),pe=A+1+M.length);var O=R.localNSMap,j=R.tagName==M,z=j||R.tagName&&R.tagName.toLowerCase()==M.toLowerCase();if(z){if(n.endElement(R.uri,R.localName,M),O)for(var ee in O)Object.prototype.hasOwnProperty.call(O,ee)&&n.endPrefixMapping(ee);j||r.fatalError("end tag name: "+M+" is not match the current start tagName:"+R.tagName)}else v.push(R);pe++;break;case"?":y&&u(A),pe=CA(i,A,n);break;case"!":y&&u(A),pe=xA(i,A,n,r);break;default:y&&u(A);var K=new kv,oe=v[v.length-1].currentNSMap,pe=bA(i,A,K,oe,a,r),we=K.length;if(!K.closed&&SA(i,pe,K.tagName,T)&&(K.closed=!0,t.nbsp||r.warning("unclosed xml attribute")),y&&we){for(var X=o0(y,{}),ge=0;ge<we;ge++){var rt=K[ge];u(rt.offset),rt.locator=o0(y,{})}n.locator=X,u0(K,n,oe)&&v.push(K),n.locator=y}else u0(K,n,oe)&&v.push(K);ko.isHTML(K.uri)&&!K.closed?pe=EA(i,pe,K.tagName,a,n):pe++}}catch(Ee){if(Ee instanceof Gs)throw Ee;r.error("element parse error: "+Ee),pe=-1}pe>S?S=pe:o(Math.max(A,S)+1)}}function o0(i,e){return e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber,e}function bA(i,e,t,n,r,s){function a(y,v,T){t.attributeNames.hasOwnProperty(y)&&s.fatalError("Attribute "+y+" redefined"),t.addValue(y,v.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,r),T)}for(var o,u,c=++e,h=za;;){var g=i.charAt(c);switch(g){case"=":if(h===Yn)o=i.slice(e,c),h=Wa;else if(h===ls)h=Wa;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(h===Wa||h===Yn)if(h===Yn&&(s.warning('attribute value must after "="'),o=i.slice(e,c)),e=c+1,c=i.indexOf(g,e),c>0)u=i.slice(e,c),a(o,u,e-1),h=hs;else throw new Error("attribute value no end '"+g+"' match");else if(h==cs)u=i.slice(e,c),a(o,u,e),s.warning('attribute "'+o+'" missed start quot('+g+")!!"),e=c+1,h=hs;else throw new Error('attribute value must after "="');break;case"/":switch(h){case za:t.setTagName(i.slice(e,c));case hs:case Ka:case qu:h=qu,t.closed=!0;case cs:case Yn:break;case ls:t.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),h==za&&t.setTagName(i.slice(e,c)),c;case">":switch(h){case za:t.setTagName(i.slice(e,c));case hs:case Ka:case qu:break;case cs:case Yn:u=i.slice(e,c),u.slice(-1)==="/"&&(t.closed=!0,u=u.slice(0,-1));case ls:h===ls&&(u=o),h==cs?(s.warning('attribute "'+u+'" missed quot(")!'),a(o,u,e)):((!ko.isHTML(n[""])||!u.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),a(u,u,e));break;case Wa:throw new Error("attribute value missed!!")}return c;case"":g=" ";default:if(g<=" ")switch(h){case za:t.setTagName(i.slice(e,c)),h=Ka;break;case Yn:o=i.slice(e,c),h=ls;break;case cs:var u=i.slice(e,c);s.warning('attribute "'+u+'" missed quot(")!!'),a(o,u,e);case hs:h=Ka;break}else switch(h){case ls:t.tagName,(!ko.isHTML(n[""])||!o.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),a(o,o,e),e=c,h=Yn;break;case hs:s.warning('attribute space is required"'+o+'"!!');case Ka:h=Yn,e=c;break;case Wa:h=cs,e=c;break;case qu:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function u0(i,e,t){for(var n=i.tagName,r=null,g=i.length;g--;){var s=i[g],a=s.qName,o=s.value,y=a.indexOf(":");if(y>0)var u=s.prefix=a.slice(0,y),c=a.slice(y+1),h=u==="xmlns"&&c;else c=a,u=null,h=a==="xmlns"&&"";s.localName=c,h!==!1&&(r==null&&(r={},Iv(t,t={})),t[h]=r[h]=o,s.uri=ko.XMLNS,e.startPrefixMapping(h,o))}for(var g=i.length;g--;){s=i[g];var u=s.prefix;u&&(u==="xml"&&(s.uri=ko.XML),u!=="xmlns"&&(s.uri=t[u||""]))}var y=n.indexOf(":");y>0?(u=i.prefix=n.slice(0,y),c=i.localName=n.slice(y+1)):(u=null,c=i.localName=n);var v=i.uri=t[u||""];if(e.startElement(v,c,n,i),i.closed){if(e.endElement(v,c,n),r)for(u in r)Object.prototype.hasOwnProperty.call(r,u)&&e.endPrefixMapping(u)}else return i.currentNSMap=t,i.localNSMap=r,!0}function EA(i,e,t,n,r){if(/^(?:script|textarea)$/i.test(t)){var s=i.indexOf("</"+t+">",e),a=i.substring(e+1,s);if(/[&<]/.test(a))return/^script$/i.test(t)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,n),r.characters(a,0,a.length),s)}return e+1}function SA(i,e,t,n){var r=n[t];return r==null&&(r=i.lastIndexOf("</"+t+">"),r<e&&(r=i.lastIndexOf("</"+t)),n[t]=r),r<e}function Iv(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function xA(i,e,t,n){var r=i.charAt(e+2);switch(r){case"-":if(i.charAt(e+3)==="-"){var s=i.indexOf("-->",e+4);return s>e?(t.comment(i,e+4,s-e-4),s+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(i.substr(e+3,6)=="CDATA["){var s=i.indexOf("]]>",e+9);return t.startCDATA(),t.characters(i,e+9,s-e-9),t.endCDATA(),s+3}var a=wA(i,e),o=a.length;if(o>1&&/!doctype/i.test(a[0][0])){var u=a[1][0],c=!1,h=!1;o>3&&(/^public$/i.test(a[2][0])?(c=a[3][0],h=o>4&&a[4][0]):/^system$/i.test(a[2][0])&&(h=a[3][0]));var g=a[o-1];return t.startDTD(u,c,h),t.endDTD(),g.index+g[0].length}}return-1}function CA(i,e,t){var n=i.indexOf("?>",e);if(n){var r=i.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return r?(r[0].length,t.processingInstruction(r[1],r[2]),n+2):-1}return-1}function kv(){this.attributeNames={}}kv.prototype={setTagName:function(i){if(!a0.test(i))throw new Error("invalid tagName:"+i);this.tagName=i},addValue:function(i,e,t){if(!a0.test(i))throw new Error("invalid attribute:"+i);this.attributeNames[i]=this.length,this[this.length++]={qName:i,value:e,offset:t}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function wA(i,e){var t,n=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(r.lastIndex=e,r.exec(i);t=r.exec(i);)if(n.push(t),t[1])return n}ep.XMLReader=Dv;ep.ParseError=Gs;var AA=Hn,DA=dr,l0=Av,Pv=ep,IA=DA.DOMImplementation,c0=AA.NAMESPACE,kA=Pv.ParseError,PA=Pv.XMLReader;function Rv(i){return i.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function Ov(i){this.options=i||{locator:{}}}Ov.prototype.parseFromString=function(i,e){var t=this.options,n=new PA,r=t.domBuilder||new tu,s=t.errorHandler,a=t.locator,o=t.xmlns||{},u=/\/x?html?$/.test(e),c=u?l0.HTML_ENTITIES:l0.XML_ENTITIES;a&&r.setDocumentLocator(a),n.errorHandler=RA(s,r,a),n.domBuilder=t.domBuilder||r,u&&(o[""]=c0.HTML),o.xml=o.xml||c0.XML;var h=t.normalizeLineEndings||Rv;return i&&typeof i=="string"?n.parse(h(i),o,c):n.errorHandler.error("invalid doc source"),r.doc};function RA(i,e,t){if(!i){if(e instanceof tu)return e;i=e}var n={},r=i instanceof Function;t=t||{};function s(a){var o=i[a];!o&&r&&(o=i.length==2?function(u){i(a,u)}:i),n[a]=o&&function(u){o("[xmldom "+a+"]	"+u+Ld(t))}||function(){}}return s("warning"),s("error"),s("fatalError"),n}function tu(){this.cdata=!1}function ds(i,e){e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber}tu.prototype={startDocument:function(){this.doc=new IA().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(i,e,t,n){var r=this.doc,s=r.createElementNS(i,t||e),a=n.length;Hu(this,s),this.currentElement=s,this.locator&&ds(this.locator,s);for(var o=0;o<a;o++){var i=n.getURI(o),u=n.getValue(o),t=n.getQName(o),c=r.createAttributeNS(i,t);this.locator&&ds(n.getLocator(o),c),c.value=c.nodeValue=u,s.setAttributeNode(c)}},endElement:function(i,e,t){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(i,e){},endPrefixMapping:function(i){},processingInstruction:function(i,e){var t=this.doc.createProcessingInstruction(i,e);this.locator&&ds(this.locator,t),Hu(this,t)},ignorableWhitespace:function(i,e,t){},characters:function(i,e,t){if(i=h0.apply(this,arguments),i){if(this.cdata)var n=this.doc.createCDATASection(i);else var n=this.doc.createTextNode(i);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(i)&&this.doc.appendChild(n),this.locator&&ds(this.locator,n)}},skippedEntity:function(i){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(i){(this.locator=i)&&(i.lineNumber=0)},comment:function(i,e,t){i=h0.apply(this,arguments);var n=this.doc.createComment(i);this.locator&&ds(this.locator,n),Hu(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(i,e,t){var n=this.doc.implementation;if(n&&n.createDocumentType){var r=n.createDocumentType(i,e,t);this.locator&&ds(this.locator,r),Hu(this,r),this.doc.doctype=r}},warning:function(i){console.warn("[xmldom warning]	"+i,Ld(this.locator))},error:function(i){console.error("[xmldom error]	"+i,Ld(this.locator))},fatalError:function(i){throw new kA(i,this.locator)}};function Ld(i){if(i)return`
@`+(i.systemId||"")+"#[line:"+i.lineNumber+",col:"+i.columnNumber+"]"}function h0(i,e,t){return typeof i=="string"?i.substr(e,t):i.length>=e+t||e?new java.lang.String(i,e,t)+"":i}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(i){tu.prototype[i]=function(){return null}});function Hu(i,e){i.currentElement?i.currentElement.appendChild(e):i.doc.appendChild(e)}pc.__DOMHandler=tu;pc.normalizeLineEndings=Rv;pc.DOMParser=Ov;var OA=pc.DOMParser;/*! @name mpd-parser @version 1.1.1 @license Apache-2.0 */const d0=i=>!!i&&typeof i=="object",Gt=(...i)=>i.reduce((e,t)=>(typeof t!="object"||Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):d0(e[n])&&d0(t[n])?e[n]=Gt(e[n],t[n]):e[n]=t[n]}),e),{}),Lv=i=>Object.keys(i).map(e=>i[e]),LA=(i,e)=>{const t=[];for(let n=i;n<e;n++)t.push(n);return t},zs=i=>i.reduce((e,t)=>e.concat(t),[]),Nv=i=>{if(!i.length)return[];const e=[];for(let t=0;t<i.length;t++)e.push(i[t]);return e},NA=(i,e)=>i.reduce((t,n,r)=>(n[e]&&t.push(r),t),[]),MA=(i,e)=>Lv(i.reduce((t,n)=>(n.forEach(r=>{t[e(r)]=r}),t),{}));var Ws={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const Po=({baseUrl:i="",source:e="",range:t="",indexRange:n=""})=>{const r={uri:e,resolvedUri:Hf(i||"",e)};if(t||n){const a=(t||n).split("-");let o=D.BigInt?D.BigInt(a[0]):parseInt(a[0],10),u=D.BigInt?D.BigInt(a[1]):parseInt(a[1],10);o<Number.MAX_SAFE_INTEGER&&typeof o=="bigint"&&(o=Number(o)),u<Number.MAX_SAFE_INTEGER&&typeof u=="bigint"&&(u=Number(u));let c;typeof u=="bigint"||typeof o=="bigint"?c=D.BigInt(u)-D.BigInt(o)+D.BigInt(1):c=u-o+1,typeof c=="bigint"&&c<Number.MAX_SAFE_INTEGER&&(c=Number(c)),r.byterange={length:c,offset:o}}return r},FA=i=>{let e;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=D.BigInt(i.offset)+D.BigInt(i.length)-D.BigInt(1):e=i.offset+i.length-1,`${i.offset}-${e}`},f0=i=>(i&&typeof i!="number"&&(i=parseInt(i,10)),isNaN(i)?null:i),BA={static(i){const{duration:e,timescale:t=1,sourceDuration:n,periodDuration:r}=i,s=f0(i.endNumber),a=e/t;return typeof s=="number"?{start:0,end:s}:typeof r=="number"?{start:0,end:r/a}:{start:0,end:n/a}},dynamic(i){const{NOW:e,clientOffset:t,availabilityStartTime:n,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:u=1/0}=i,c=f0(i.endNumber),h=(e+t)/1e3,g=n+a,v=h+o-g,T=Math.ceil(v*r/s),S=Math.floor((h-g-u)*r/s),A=Math.floor((h-g)*r/s);return{start:Math.max(0,S),end:typeof c=="number"?c:Math.min(T,A)}}},UA=i=>e=>{const{duration:t,timescale:n=1,periodStart:r,startNumber:s=1}=i;return{number:s+e,duration:t/n,timeline:r,time:e*t}},tp=i=>{const{type:e,duration:t,timescale:n=1,periodDuration:r,sourceDuration:s}=i,{start:a,end:o}=BA[e](i),u=LA(a,o).map(UA(i));if(e==="static"){const c=u.length-1,h=typeof r=="number"?r:s;u[c].duration=h-t/n*c}return u},Mv=i=>{const{baseUrl:e,initialization:t={},sourceDuration:n,indexRange:r="",periodStart:s,presentationTime:a,number:o=0,duration:u}=i;if(!e)throw new Error(Ws.NO_BASE_URL);const c=Po({baseUrl:e,source:t.sourceURL,range:t.range}),h=Po({baseUrl:e,source:e,indexRange:r});if(h.map=c,u){const g=tp(i);g.length&&(h.duration=g[0].duration,h.timeline=g[0].timeline)}else n&&(h.duration=n,h.timeline=s);return h.presentationTime=a||s,h.number=o,[h]},ip=(i,e,t)=>{const n=i.sidx.map?i.sidx.map:null,r=i.sidx.duration,s=i.timeline||0,a=i.sidx.byterange,o=a.offset+a.length,u=e.timescale,c=e.references.filter(A=>A.referenceType!==1),h=[],g=i.endList?"static":"dynamic",y=i.sidx.timeline;let v=y,T=i.mediaSequence||0,S;typeof e.firstOffset=="bigint"?S=D.BigInt(o)+e.firstOffset:S=o+e.firstOffset;for(let A=0;A<c.length;A++){const k=e.references[A],P=k.referencedSize,M=k.subsegmentDuration;let R;typeof S=="bigint"?R=S+D.BigInt(P)-D.BigInt(1):R=S+P-1;const O=`${S}-${R}`,z=Mv({baseUrl:t,timescale:u,timeline:s,periodStart:y,presentationTime:v,number:T,duration:M,sourceDuration:r,indexRange:O,type:g})[0];n&&(z.map=n),h.push(z),typeof S=="bigint"?S+=D.BigInt(P):S+=P,v+=M/u,T++}return i.segments=h,i},VA=["AUDIO","SUBTITLES"],jA=1/60,Fv=i=>MA(i,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1),$A=(i,e)=>{for(let t=0;t<i.length;t++)if(i[t].attributes.NAME===e)return i[t];return null},p0=i=>{let e=[];return nA(i,VA,(t,n,r,s)=>{e=e.concat(t.playlists||[])}),e},m0=({playlist:i,mediaSequence:e})=>{i.mediaSequence=e,i.segments.forEach((t,n)=>{t.number=i.mediaSequence+n})},qA=({oldPlaylists:i,newPlaylists:e,timelineStarts:t})=>{e.forEach(n=>{n.discontinuitySequence=t.findIndex(function({timeline:u}){return u===n.timeline});const r=$A(i,n.attributes.NAME);if(!r||n.sidx)return;const s=n.segments[0],a=r.segments.findIndex(function(u){return Math.abs(u.presentationTime-s.presentationTime)<jA});if(a===-1){m0({playlist:n,mediaSequence:r.mediaSequence+r.segments.length}),n.segments[0].discontinuity=!0,n.discontinuityStarts.unshift(0),(!r.segments.length&&n.timeline>r.timeline||r.segments.length&&n.timeline>r.segments[r.segments.length-1].timeline)&&n.discontinuitySequence--;return}r.segments[a].discontinuity&&!s.discontinuity&&(s.discontinuity=!0,n.discontinuityStarts.unshift(0),n.discontinuitySequence--),m0({playlist:n,mediaSequence:r.segments[a].number})})},HA=({oldManifest:i,newManifest:e})=>{const t=i.playlists.concat(p0(i)),n=e.playlists.concat(p0(e));return e.timelineStarts=Fv([i.timelineStarts,e.timelineStarts]),qA({oldPlaylists:t,newPlaylists:n,timelineStarts:e.timelineStarts}),e},mc=i=>i&&i.uri+"-"+FA(i.byterange),$h=i=>Lv(i.reduce((t,n)=>{const r=n.attributes.id+(n.attributes.lang||"");return t[r]?(n.segments&&(n.segments[0]&&(n.segments[0].discontinuity=!0),t[r].segments.push(...n.segments)),n.attributes.contentProtection&&(t[r].attributes.contentProtection=n.attributes.contentProtection)):(t[r]=n,t[r].attributes.timelineStarts=[]),t[r].attributes.timelineStarts.push({start:n.attributes.periodStart,timeline:n.attributes.periodStart}),t},{})).map(t=>(t.discontinuityStarts=NA(t.segments||[],"discontinuity"),t)),np=(i,e)=>{const t=mc(i.sidx),n=t&&e[t]&&e[t].sidx;return n&&ip(i,n,i.sidx.resolvedUri),i},GA=(i,e={})=>{if(!Object.keys(e).length)return i;for(const t in i)i[t]=np(i[t],e);return i},zA=({attributes:i,segments:e,sidx:t,mediaSequence:n,discontinuitySequence:r,discontinuityStarts:s},a)=>{const o={attributes:{NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:"",targetDuration:i.duration,discontinuitySequence:r,discontinuityStarts:s,timelineStarts:i.timelineStarts,mediaSequence:n,segments:e};return i.contentProtection&&(o.contentProtection=i.contentProtection),t&&(o.sidx=t),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o},WA=({attributes:i,segments:e,mediaSequence:t,discontinuityStarts:n,discontinuitySequence:r})=>{typeof e>"u"&&(e=[{uri:i.baseUrl,timeline:i.periodStart,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration);const s={NAME:i.id,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1};return i.codecs&&(s.CODECS=i.codecs),{attributes:s,uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,timelineStarts:i.timelineStarts,discontinuityStarts:n,discontinuitySequence:r,mediaSequence:t,segments:e}},KA=(i,e={},t=!1)=>{let n;const r=i.reduce((s,a)=>{const o=a.attributes.role&&a.attributes.role.value||"",u=a.attributes.lang||"";let c=a.attributes.label||"main";if(u&&!a.attributes.label){const g=o?` (${o})`:"";c=`${a.attributes.lang}${g}`}s[c]||(s[c]={language:u,autoselect:!0,default:o==="main",playlists:[],uri:""});const h=np(zA(a,t),e);return s[c].playlists.push(h),typeof n>"u"&&o==="main"&&(n=a,n.default=!0),s},{});if(!n){const s=Object.keys(r)[0];r[s].default=!0}return r},XA=(i,e={})=>i.reduce((t,n)=>{const r=n.attributes.label||n.attributes.lang||"text";return t[r]||(t[r]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),t[r].playlists.push(np(WA(n),e)),t},{}),YA=i=>i.reduce((e,t)=>(t&&t.forEach(n=>{const{channel:r,language:s}=n;e[s]={autoselect:!1,default:!1,instreamId:r,language:s},n.hasOwnProperty("aspectRatio")&&(e[s].aspectRatio=n.aspectRatio),n.hasOwnProperty("easyReader")&&(e[s].easyReader=n.easyReader),n.hasOwnProperty("3D")&&(e[s]["3D"]=n["3D"])}),e),{}),QA=({attributes:i,segments:e,sidx:t,discontinuityStarts:n})=>{const r={attributes:{NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:"",targetDuration:i.duration,discontinuityStarts:n,timelineStarts:i.timelineStarts,segments:e};return i.frameRate&&(r.attributes["FRAME-RATE"]=i.frameRate),i.contentProtection&&(r.contentProtection=i.contentProtection),t&&(r.sidx=t),r},JA=({attributes:i})=>i.mimeType==="video/mp4"||i.mimeType==="video/webm"||i.contentType==="video",ZA=({attributes:i})=>i.mimeType==="audio/mp4"||i.mimeType==="audio/webm"||i.contentType==="audio",eD=({attributes:i})=>i.mimeType==="text/vtt"||i.contentType==="text",tD=(i,e)=>{i.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=e.findIndex(function({timeline:n}){return n===t.timeline}),t.segments&&t.segments.forEach((n,r)=>{n.number=r})})},g0=i=>i?Object.keys(i).reduce((e,t)=>{const n=i[t];return e.concat(n.playlists)},[]):[],iD=({dashPlaylists:i,locations:e,sidxMapping:t={},previousManifest:n,eventStream:r})=>{if(!i.length)return{};const{sourceDuration:s,type:a,suggestedPresentationDelay:o,minimumUpdatePeriod:u}=i[0].attributes,c=$h(i.filter(JA)).map(QA),h=$h(i.filter(ZA)),g=$h(i.filter(eD)),y=i.map(M=>M.attributes.captionServices).filter(Boolean),v={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:s,playlists:GA(c,t)};u>=0&&(v.minimumUpdatePeriod=u*1e3),e&&(v.locations=e),a==="dynamic"&&(v.suggestedPresentationDelay=o),r&&r.length>0&&(v.eventStream=r);const T=v.playlists.length===0,S=h.length?KA(h,t,T):null,A=g.length?XA(g,t):null,k=c.concat(g0(S),g0(A)),P=k.map(({timelineStarts:M})=>M);return v.timelineStarts=Fv(P),tD(k,v.timelineStarts),S&&(v.mediaGroups.AUDIO.audio=S),A&&(v.mediaGroups.SUBTITLES.subs=A),y.length&&(v.mediaGroups["CLOSED-CAPTIONS"].cc=YA(y)),n?HA({oldManifest:n,newManifest:v}):v},nD=(i,e,t)=>{const{NOW:n,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:u=0}=i,c=(n+r)/1e3,h=s+o,y=c+u-h;return Math.ceil((y*a-e)/t)},Bv=(i,e)=>{const{type:t,minimumUpdatePeriod:n=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:o=1,periodStart:u}=i,c=[];let h=-1;for(let g=0;g<e.length;g++){const y=e[g],v=y.d,T=y.r||0,S=y.t||0;h<0&&(h=S),S&&S>h&&(h=S);let A;if(T<0){const M=g+1;M===e.length?t==="dynamic"&&n>0&&r.indexOf("$Number$")>0?A=nD(i,h,v):A=(s*a-h)/v:A=(e[M].t-h)/v}else A=T+1;const k=o+c.length+A;let P=o+c.length;for(;P<k;)c.push({number:P,duration:v/a,time:h,timeline:u}),h+=v,P++}return c},rD=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,sD=i=>(e,t,n,r)=>{if(e==="$$")return"$";if(typeof i[t]>"u")return e;const s=""+i[t];return t==="RepresentationID"||(n?r=parseInt(r,10):r=1,s.length>=r)?s:`${new Array(r-s.length+1).join("0")}${s}`},_0=(i,e)=>i.replace(rD,sD(e)),aD=(i,e)=>!i.duration&&!e?[{number:i.startNumber||1,duration:i.sourceDuration,time:0,timeline:i.periodStart}]:i.duration?tp(i):Bv(i,e),oD=(i,e)=>{const t={RepresentationID:i.id,Bandwidth:i.bandwidth||0},{initialization:n={sourceURL:"",range:""}}=i,r=Po({baseUrl:i.baseUrl,source:_0(n.sourceURL,t),range:n.range});return aD(i,e).map(a=>{t.Number=a.number,t.Time=a.time;const o=_0(i.media||"",t),u=i.timescale||1,c=i.presentationTimeOffset||0,h=i.periodStart+(a.time-c)/u;return{uri:o,timeline:a.timeline,duration:a.duration,resolvedUri:Hf(i.baseUrl||"",o),map:r,number:a.number,presentationTime:h}})},uD=(i,e)=>{const{baseUrl:t,initialization:n={}}=i,r=Po({baseUrl:t,source:n.sourceURL,range:n.range}),s=Po({baseUrl:t,source:e.media,range:e.mediaRange});return s.map=r,s},lD=(i,e)=>{const{duration:t,segmentUrls:n=[],periodStart:r}=i;if(!t&&!e||t&&e)throw new Error(Ws.SEGMENT_TIME_UNSPECIFIED);const s=n.map(u=>uD(i,u));let a;return t&&(a=tp(i)),e&&(a=Bv(i,e)),a.map((u,c)=>{if(s[c]){const h=s[c],g=i.timescale||1,y=i.presentationTimeOffset||0;return h.timeline=u.timeline,h.duration=u.duration,h.number=u.number,h.presentationTime=r+(u.time-y)/g,h}}).filter(u=>u)},cD=({attributes:i,segmentInfo:e})=>{let t,n;e.template?(n=oD,t=Gt(i,e.template)):e.base?(n=Mv,t=Gt(i,e.base)):e.list&&(n=lD,t=Gt(i,e.list));const r={attributes:i};if(!n)return r;const s=n(t,e.segmentTimeline);if(t.duration){const{duration:a,timescale:o=1}=t;t.duration=a/o}else s.length?t.duration=s.reduce((a,o)=>Math.max(a,Math.ceil(o.duration)),0):t.duration=0;return r.attributes=t,r.segments=s,e.base&&t.indexRange&&(r.sidx=s[0],r.segments=[]),r},hD=i=>i.map(cD),at=(i,e)=>Nv(i.childNodes).filter(({tagName:t})=>t===e),gc=i=>i.textContent.trim(),dD=i=>parseFloat(i.split("/").reduce((e,t)=>e/t)),fs=i=>{const o=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(i);if(!o)return 0;const[u,c,h,g,y,v]=o.slice(1);return parseFloat(u||0)*31536e3+parseFloat(c||0)*2592e3+parseFloat(h||0)*86400+parseFloat(g||0)*3600+parseFloat(y||0)*60+parseFloat(v||0)},fD=i=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(i)&&(i+="Z"),Date.parse(i)),y0={mediaPresentationDuration(i){return fs(i)},availabilityStartTime(i){return fD(i)/1e3},minimumUpdatePeriod(i){return fs(i)},suggestedPresentationDelay(i){return fs(i)},type(i){return i},timeShiftBufferDepth(i){return fs(i)},start(i){return fs(i)},width(i){return parseInt(i,10)},height(i){return parseInt(i,10)},bandwidth(i){return parseInt(i,10)},frameRate(i){return dD(i)},startNumber(i){return parseInt(i,10)},timescale(i){return parseInt(i,10)},presentationTimeOffset(i){return parseInt(i,10)},duration(i){const e=parseInt(i,10);return isNaN(e)?fs(i):e},d(i){return parseInt(i,10)},t(i){return parseInt(i,10)},r(i){return parseInt(i,10)},presentationTime(i){return parseInt(i,10)},DEFAULT(i){return i}},wt=i=>i&&i.attributes?Nv(i.attributes).reduce((e,t)=>{const n=y0[t.name]||y0.DEFAULT;return e[t.name]=n(t.value),e},{}):{},pD={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},_c=(i,e)=>e.length?zs(i.map(function(t){return e.map(function(n){return Hf(t,gc(n))})})):i,rp=i=>{const e=at(i,"SegmentTemplate")[0],t=at(i,"SegmentList")[0],n=t&&at(t,"SegmentURL").map(g=>Gt({tag:"SegmentURL"},wt(g))),r=at(i,"SegmentBase")[0],s=t||e,a=s&&at(s,"SegmentTimeline")[0],o=t||r||e,u=o&&at(o,"Initialization")[0],c=e&&wt(e);c&&u?c.initialization=u&&wt(u):c&&c.initialization&&(c.initialization={sourceURL:c.initialization});const h={template:c,segmentTimeline:a&&at(a,"S").map(g=>wt(g)),list:t&&Gt(wt(t),{segmentUrls:n,initialization:wt(u)}),base:r&&Gt(wt(r),{initialization:wt(u)})};return Object.keys(h).forEach(g=>{h[g]||delete h[g]}),h},mD=(i,e,t)=>n=>{const r=at(n,"BaseURL"),s=_c(e,r),a=Gt(i,wt(n)),o=rp(n);return s.map(u=>({segmentInfo:Gt(t,o),attributes:Gt(a,{baseUrl:u})}))},gD=i=>i.reduce((e,t)=>{const n=wt(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const r=pD[n.schemeIdUri];if(r){e[r]={attributes:n};const s=at(t,"cenc:pssh")[0];if(s){const a=gc(s);e[r].pssh=a&&sA(a)}}return e},{}),_D=i=>{if(i.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{let n,r;return r=t,/^CC\d=/.test(t)?[n,r]=t.split("="):/^CC\d$/.test(t)&&(n=t),{channel:n,language:r}});if(i.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{const n={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[r,s=""]=t.split("=");n.channel=r,n.language=t,s.split(",").forEach(a=>{const[o,u]=a.split(":");o==="lang"?n.language=u:o==="er"?n.easyReader=Number(u):o==="war"?n.aspectRatio=Number(u):o==="3D"&&(n["3D"]=Number(u))})}else n.language=t;return n.channel&&(n.channel="SERVICE"+n.channel),n})},yD=i=>zs(at(i.node,"EventStream").map(e=>{const t=wt(e),n=t.schemeIdUri;return at(e,"Event").map(r=>{const s=wt(r),a=s.presentationTime||0,o=t.timescale||1,u=s.duration||0,c=a/o+i.attributes.start;return{schemeIdUri:n,value:t.value,id:s.id,start:c,end:c+u/o,messageData:gc(r)||s.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),vD=(i,e,t)=>n=>{const r=wt(n),s=_c(e,at(n,"BaseURL")),a=at(n,"Role")[0],o={role:wt(a)};let u=Gt(i,r,o);const c=at(n,"Accessibility")[0],h=_D(wt(c));h&&(u=Gt(u,{captionServices:h}));const g=at(n,"Label")[0];if(g&&g.childNodes.length){const A=g.childNodes[0].nodeValue.trim();u=Gt(u,{label:A})}const y=gD(at(n,"ContentProtection"));Object.keys(y).length&&(u=Gt(u,{contentProtection:y}));const v=rp(n),T=at(n,"Representation"),S=Gt(t,v);return zs(T.map(mD(u,s,S)))},TD=(i,e)=>(t,n)=>{const r=_c(e,at(t.node,"BaseURL")),s=Gt(i,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(s.periodDuration=t.attributes.duration);const a=at(t.node,"AdaptationSet"),o=rp(t.node);return zs(a.map(vD(s,r,o)))},bD=({attributes:i,priorPeriodAttributes:e,mpdType:t})=>typeof i.start=="number"?i.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&t==="static"?0:null,ED=(i,e={})=>{const{manifestUri:t="",NOW:n=Date.now(),clientOffset:r=0}=e,s=at(i,"Period");if(!s.length)throw new Error(Ws.INVALID_NUMBER_OF_PERIOD);const a=at(i,"Location"),o=wt(i),u=_c([t],at(i,"BaseURL"));o.type=o.type||"static",o.sourceDuration=o.mediaPresentationDuration||0,o.NOW=n,o.clientOffset=r,a.length&&(o.locations=a.map(gc));const c=[];return s.forEach((h,g)=>{const y=wt(h),v=c[g-1];y.start=bD({attributes:y,priorPeriodAttributes:v?v.attributes:null,mpdType:o.type}),c.push({node:h,attributes:y})}),{locations:o.locations,representationInfo:zs(c.map(TD(o,u))),eventStream:zs(c.map(yD))}},Uv=i=>{if(i==="")throw new Error(Ws.DASH_EMPTY_MANIFEST);const e=new OA;let t,n;try{t=e.parseFromString(i,"application/xml"),n=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error(Ws.DASH_INVALID_XML);return n},SD=i=>{const e=at(i,"UTCTiming")[0];if(!e)return null;const t=wt(e);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(Ws.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},xD=(i,e={})=>{const t=ED(Uv(i),e),n=hD(t.representationInfo);return iD({dashPlaylists:n,locations:t.locations,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:t.eventStream})},CD=i=>SD(Uv(i));var Vv=Math.pow(2,32),wD=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t;return e.getBigUint64?(t=e.getBigUint64(0),t<Number.MAX_SAFE_INTEGER?Number(t):t):e.getUint32(0)*Vv+e.getUint32(4)},AD={getUint64:wD,MAX_UINT32:Vv},v0=AD.getUint64,DD=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t={version:i[0],flags:new Uint8Array(i.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},n=12;t.version===0?(t.earliestPresentationTime=e.getUint32(n),t.firstOffset=e.getUint32(n+4),n+=8):(t.earliestPresentationTime=v0(i.subarray(n)),t.firstOffset=v0(i.subarray(n+8)),n+=16),n+=2;var r=e.getUint16(n);for(n+=2;r>0;n+=12,r--)t.references.push({referenceType:(i[n]&128)>>>7,referencedSize:e.getUint32(n)&2147483647,subsegmentDuration:e.getUint32(n+4),startsWithSap:!!(i[n+8]&128),sapType:(i[n+8]&112)>>>4,sapDeltaTime:e.getUint32(n+8)&268435455});return t},ID=DD;const kD=hr(ID);var PD=ue([73,68,51]),RD=function(e,t){t===void 0&&(t=0),e=ue(e);var n=e[t+5],r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],s=(n&16)>>4;return s?r+20:r+10},no=function i(e,t){return t===void 0&&(t=0),e=ue(e),e.length-t<10||!nt(e,PD,{offset:t})?t:(t+=RD(e,t),i(e,t))},T0=function(e){return typeof e=="string"?rv(e):e},OD=function(e){return Array.isArray(e)?e.map(function(t){return T0(t)}):[T0(e)]},LD=function i(e,t,n){n===void 0&&(n=!1),t=OD(t),e=ue(e);var r=[];if(!t.length)return r;for(var s=0;s<e.length;){var a=(e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3])>>>0,o=e.subarray(s+4,s+8);if(a===0)break;var u=s+a;if(u>e.length){if(n)break;u=e.length}var c=e.subarray(s+8,u);nt(o,t[0])&&(t.length===1?r.push(c):r.push.apply(r,i(c,t.slice(1),n))),s=u}return r},Gu={EBML:ue([26,69,223,163]),DocType:ue([66,130]),Segment:ue([24,83,128,103]),SegmentInfo:ue([21,73,169,102]),Tracks:ue([22,84,174,107]),Track:ue([174]),TrackNumber:ue([215]),DefaultDuration:ue([35,227,131]),TrackEntry:ue([174]),TrackType:ue([131]),FlagDefault:ue([136]),CodecID:ue([134]),CodecPrivate:ue([99,162]),VideoTrack:ue([224]),AudioTrack:ue([225]),Cluster:ue([31,67,182,117]),Timestamp:ue([231]),TimestampScale:ue([42,215,177]),BlockGroup:ue([160]),BlockDuration:ue([155]),Block:ue([161]),SimpleBlock:ue([163])},Nd=[128,64,32,16,8,4,2,1],ND=function(e){for(var t=1,n=0;n<Nd.length&&!(e&Nd[n]);n++)t++;return t},kl=function(e,t,n,r){n===void 0&&(n=!0),r===void 0&&(r=!1);var s=ND(e[t]),a=e.subarray(t,t+s);return n&&(a=Array.prototype.slice.call(e,t,t+s),a[0]^=Nd[s-1]),{length:s,value:eA(a,{signed:r}),bytes:a}},b0=function i(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(t){return i(t)}):typeof e=="number"?tA(e):e},MD=function(e){return Array.isArray(e)?e.map(function(t){return b0(t)}):[b0(e)]},FD=function i(e,t,n){if(n>=t.length)return t.length;var r=kl(t,n,!1);if(nt(e.bytes,r.bytes))return n;var s=kl(t,n+r.length);return i(e,t,n+s.length+s.value+r.length)},E0=function i(e,t){t=MD(t),e=ue(e);var n=[];if(!t.length)return n;for(var r=0;r<e.length;){var s=kl(e,r,!1),a=kl(e,r+s.length),o=r+s.length+a.length;a.value===127&&(a.value=FD(s,e,o),a.value!==e.length&&(a.value-=o));var u=o+a.value>e.length?e.length:o+a.value,c=e.subarray(o,u);nt(t[0],s.bytes)&&(t.length===1?n.push(c):n=n.concat(i(c,t.slice(1))));var h=s.length+a.length+c.length;r+=h}return n},BD=ue([0,0,0,1]),UD=ue([0,0,1]),VD=ue([0,0,3]),jD=function(e){for(var t=[],n=1;n<e.length-2;)nt(e.subarray(n,n+3),VD)&&(t.push(n+2),n++),n++;if(t.length===0)return e;var r=e.length-t.length,s=new Uint8Array(r),a=0;for(n=0;n<r;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=e[a];return s},jv=function(e,t,n,r){r===void 0&&(r=1/0),e=ue(e),n=[].concat(n);for(var s=0,a,o=0;s<e.length&&(o<r||a);){var u=void 0;if(nt(e.subarray(s),BD)?u=4:nt(e.subarray(s),UD)&&(u=3),!u){s++;continue}if(o++,a)return jD(e.subarray(a,s));var c=void 0;t==="h264"?c=e[s+u]&31:t==="h265"&&(c=e[s+u]>>1&63),n.indexOf(c)!==-1&&(a=s+u),s+=u+(t==="h264"?1:2)}return e.subarray(0,0)},$D=function(e,t,n){return jv(e,"h264",t,n)},qD=function(e,t,n){return jv(e,"h265",t,n)},ii={webm:ue([119,101,98,109]),matroska:ue([109,97,116,114,111,115,107,97]),flac:ue([102,76,97,67]),ogg:ue([79,103,103,83]),ac3:ue([11,119]),riff:ue([82,73,70,70]),avi:ue([65,86,73]),wav:ue([87,65,86,69]),"3gp":ue([102,116,121,112,51,103]),mp4:ue([102,116,121,112]),fmp4:ue([115,116,121,112]),mov:ue([102,116,121,112,113,116]),moov:ue([109,111,111,118]),moof:ue([109,111,111,102])},Ks={aac:function(e){var t=no(e);return nt(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=no(e);return nt(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=E0(e,[Gu.EBML,Gu.DocType])[0];return nt(t,ii.webm)},mkv:function(e){var t=E0(e,[Gu.EBML,Gu.DocType])[0];return nt(t,ii.matroska)},mp4:function(e){if(Ks["3gp"](e)||Ks.mov(e))return!1;if(nt(e,ii.mp4,{offset:4})||nt(e,ii.fmp4,{offset:4})||nt(e,ii.moof,{offset:4})||nt(e,ii.moov,{offset:4}))return!0},mov:function(e){return nt(e,ii.mov,{offset:4})},"3gp":function(e){return nt(e,ii["3gp"],{offset:4})},ac3:function(e){var t=no(e);return nt(e,ii.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var t=0;t+188<e.length&&t<188;){if(e[t]===71&&e[t+188]===71)return!0;t+=1}return!1},flac:function(e){var t=no(e);return nt(e,ii.flac,{offset:t})},ogg:function(e){return nt(e,ii.ogg)},avi:function(e){return nt(e,ii.riff)&&nt(e,ii.avi,{offset:8})},wav:function(e){return nt(e,ii.riff)&&nt(e,ii.wav,{offset:8})},h264:function(e){return $D(e,7,3).length},h265:function(e){return qD(e,[32,33],3).length}},Md=Object.keys(Ks).filter(function(i){return i!=="ts"&&i!=="h264"&&i!=="h265"}).concat(["ts","h264","h265"]);Md.forEach(function(i){var e=Ks[i];Ks[i]=function(t){return e(ue(t))}});var HD=Ks,sp=function(e){e=ue(e);for(var t=0;t<Md.length;t++){var n=Md[t];if(HD[n](e))return n}return""},GD=function(e){return LD(e,["moof"]).length>0},ap=9e4,op,up,yc,lp,$v,qv,Hv;op=function(i){return i*ap};up=function(i,e){return i*e};yc=function(i){return i/ap};lp=function(i,e){return i/e};$v=function(i,e){return op(lp(i,e))};qv=function(i,e){return up(yc(i),e)};Hv=function(i,e,t){return yc(t?i:i-e)};var Pl={ONE_SECOND_IN_TS:ap,secondsToVideoTs:op,secondsToAudioTs:up,videoTsToSeconds:yc,audioTsToSeconds:lp,audioTsToVideoTs:$v,videoTsToAudioTs:qv,metadataTsToSeconds:Hv};/**
 * @license
 * Video.js 8.3.0 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */var Gv="8.3.0";const An={},sr=function(i,e){return An[i]=An[i]||[],e&&(An[i]=An[i].concat(e)),An[i]},zD=function(i,e){sr(i,e)},zv=function(i,e){const t=sr(i).indexOf(e);return t<=-1?!1:(An[i]=An[i].slice(),An[i].splice(t,1),!0)},WD=function(i,e){sr(i,[].concat(e).map(t=>{const n=(...r)=>(zv(i,n),t(...r));return n}))},Rl={prefixed:!0},hl=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],S0=hl[0];let ro;for(let i=0;i<hl.length;i++)if(hl[i][1]in W){ro=hl[i];break}if(ro){for(let i=0;i<ro.length;i++)Rl[S0[i]]=ro[i];Rl.prefixed=ro[0]!==S0[0]}let pi=[];const KD=(i,e)=>(t,n,r)=>{const s=e.levels[n],a=new RegExp(`^(${s})$`);if(t!=="log"&&r.unshift(t.toUpperCase()+":"),r.unshift(i+":"),pi){pi.push([].concat(r));const u=pi.length-1e3;pi.splice(0,u>0?u:0)}if(!D.console)return;let o=D.console[t];!o&&t==="debug"&&(o=D.console.info||D.console.log),!(!o||!s||!a.test(t))&&o[Array.isArray(r)?"apply":"call"](D.console,r)};function Wv(i){let e="info",t;const n=function(...r){t("log",e,r)};return t=KD(i,n),n.createLogger=r=>Wv(i+": "+r),n.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:e},n.level=r=>{if(typeof r=="string"){if(!n.levels.hasOwnProperty(r))throw new Error(`"${r}" in not a valid log level`);e=r}return e},n.history=()=>pi?[].concat(pi):[],n.history.filter=r=>(pi||[]).filter(s=>new RegExp(`.*${r}.*`).test(s[0])),n.history.clear=()=>{pi&&(pi.length=0)},n.history.disable=()=>{pi!==null&&(pi.length=0,pi=null)},n.history.enable=()=>{pi===null&&(pi=[])},n.error=(...r)=>t("error",e,r),n.warn=(...r)=>t("warn",e,r),n.debug=(...r)=>t("debug",e,r),n}const Ie=Wv("VIDEOJS"),Kv=Ie.createLogger,XD=Object.prototype.toString,Xv=function(i){return gn(i)?Object.keys(i):[]};function Ds(i,e){Xv(i).forEach(t=>e(i[t],t))}function Yv(i,e,t=0){return Xv(i).reduce((n,r)=>e(n,i[r],r),t)}function gn(i){return!!i&&typeof i=="object"}function Xs(i){return gn(i)&&XD.call(i)==="[object Object]"&&i.constructor===Object}function Ke(...i){const e={};return i.forEach(t=>{t&&Ds(t,(n,r)=>{if(!Xs(n)){e[r]=n;return}Xs(e[r])||(e[r]={}),e[r]=Ke(e[r],n)})}),e}function vc(i,e,t,n=!0){const r=a=>Object.defineProperty(i,e,{value:a,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const a=t();return r(a),a}};return n&&(s.set=r),Object.defineProperty(i,e,s)}var YD=Object.freeze({__proto__:null,each:Ds,reduce:Yv,isObject:gn,isPlain:Xs,merge:Ke,defineLazyProperty:vc});let cp=!1,Qv=null,_n=!1,Jv,Zv=!1,Is=!1,ks=!1,yn=!1,hp=null,Tc=null,eT=null,Ol=!1,bc=!1,Ll=!1,Ec=!1;const Ro=!!(da()&&("ontouchstart"in D||D.navigator.maxTouchPoints||D.DocumentTouch&&D.document instanceof D.DocumentTouch)),ps=D.navigator&&D.navigator.userAgentData;ps&&(_n=ps.platform==="Android",Is=!!ps.brands.find(i=>i.brand==="Microsoft Edge"),ks=!!ps.brands.find(i=>i.brand==="Chromium"),yn=!Is&&ks,hp=Tc=(ps.brands.find(i=>i.brand==="Chromium")||{}).version||null,bc=ps.platform==="Windows");if(!ks){const i=D.navigator&&D.navigator.userAgent||"";cp=/iPod/i.test(i),Qv=function(){const e=i.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),_n=/Android/i.test(i),Jv=function(){const e=i.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),Zv=/Firefox/i.test(i),Is=/Edg/i.test(i),ks=/Chrome/i.test(i)||/CriOS/i.test(i),yn=!Is&&ks,hp=Tc=function(){const e=i.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),eT=function(){const e=/MSIE\s(\d+)\.\d/.exec(i);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(i)&&/rv:11.0/.test(i)&&(t=11),t}(),Ol=/Safari/i.test(i)&&!yn&&!_n&&!Is,bc=/Windows/i.test(i),Ll=/iPad/i.test(i)||Ol&&Ro&&!/iPhone/i.test(i),Ec=/iPhone/i.test(i)&&!Ll}const fi=Ec||Ll||cp,Sc=(Ol||fi)&&!yn;var QD=Object.freeze({__proto__:null,get IS_IPOD(){return cp},get IOS_VERSION(){return Qv},get IS_ANDROID(){return _n},get ANDROID_VERSION(){return Jv},get IS_FIREFOX(){return Zv},get IS_EDGE(){return Is},get IS_CHROMIUM(){return ks},get IS_CHROME(){return yn},get CHROMIUM_VERSION(){return hp},get CHROME_VERSION(){return Tc},get IE_VERSION(){return eT},get IS_SAFARI(){return Ol},get IS_WINDOWS(){return bc},get IS_IPAD(){return Ll},get IS_IPHONE(){return Ec},TOUCH_ENABLED:Ro,IS_IOS:fi,IS_ANY_SAFARI:Sc});function x0(i){return typeof i=="string"&&!!i.trim()}function JD(i){if(i.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function da(){return W===D.document}function fa(i){return gn(i)&&i.nodeType===1}function tT(){try{return D.parent!==D.self}catch{return!0}}function iT(i){return function(e,t){if(!x0(e))return W[i](null);x0(t)&&(t=W.querySelector(t));const n=fa(t)?t:W;return n[i]&&n[i](e)}}function Ce(i="div",e={},t={},n){const r=W.createElement(i);return Object.getOwnPropertyNames(e).forEach(function(s){const a=e[s];s==="textContent"?fr(r,a):(r[s]!==a||s==="tabIndex")&&(r[s]=a)}),Object.getOwnPropertyNames(t).forEach(function(s){r.setAttribute(s,t[s])}),n&&dp(r,n),r}function fr(i,e){return typeof i.textContent>"u"?i.innerText=e:i.textContent=e,i}function Fd(i,e){e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}function fo(i,e){return JD(e),i.classList.contains(e)}function Nr(i,...e){return i.classList.add(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i}function xc(i,...e){return i?(i.classList.remove(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i):(Ie.warn("removeClass was called with an element that doesn't exist"),null)}function nT(i,e,t){return typeof t=="function"&&(t=t(i,e)),typeof t!="boolean"&&(t=void 0),e.split(/\s+/).forEach(n=>i.classList.toggle(n,t)),i}function rT(i,e){Object.getOwnPropertyNames(e).forEach(function(t){const n=e[t];n===null||typeof n>"u"||n===!1?i.removeAttribute(t):i.setAttribute(t,n===!0?"":n)})}function Qn(i){const e={},t=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(i&&i.attributes&&i.attributes.length>0){const n=i.attributes;for(let r=n.length-1;r>=0;r--){const s=n[r].name;let a=n[r].value;(typeof i[s]=="boolean"||t.indexOf(","+s+",")!==-1)&&(a=a!==null),e[s]=a}}return e}function sT(i,e){return i.getAttribute(e)}function Ys(i,e,t){i.setAttribute(e,t)}function Cc(i,e){i.removeAttribute(e)}function aT(){W.body.focus(),W.onselectstart=function(){return!1}}function oT(){W.onselectstart=function(){return!0}}function Qs(i){if(i&&i.getBoundingClientRect&&i.parentNode){const e=i.getBoundingClientRect(),t={};return["bottom","height","left","right","top","width"].forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t.height||(t.height=parseFloat(Js(i,"height"))),t.width||(t.width=parseFloat(Js(i,"width"))),t}}function Oo(i){if(!i||i&&!i.offsetParent)return{left:0,top:0,width:0,height:0};const e=i.offsetWidth,t=i.offsetHeight;let n=0,r=0;for(;i.offsetParent&&i!==W[Rl.fullscreenElement];)n+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;return{left:n,top:r,width:e,height:t}}function wc(i,e){const t={x:0,y:0};if(fi){let h=i;for(;h&&h.nodeName.toLowerCase()!=="html";){const g=Js(h,"transform");if(/^matrix/.test(g)){const y=g.slice(7,-1).split(/,\s/).map(Number);t.x+=y[4],t.y+=y[5]}else if(/^matrix3d/.test(g)){const y=g.slice(9,-1).split(/,\s/).map(Number);t.x+=y[12],t.y+=y[13]}h=h.parentNode}}const n={},r=Oo(e.target),s=Oo(i),a=s.width,o=s.height;let u=e.offsetY-(s.top-r.top),c=e.offsetX-(s.left-r.left);return e.changedTouches&&(c=e.changedTouches[0].pageX-s.left,u=e.changedTouches[0].pageY+s.top,fi&&(c-=t.x,u-=t.y)),n.y=1-Math.max(0,Math.min(1,u/o)),n.x=Math.max(0,Math.min(1,c/a)),n}function uT(i){return gn(i)&&i.nodeType===3}function Ac(i){for(;i.firstChild;)i.removeChild(i.firstChild);return i}function lT(i){return typeof i=="function"&&(i=i()),(Array.isArray(i)?i:[i]).map(e=>{if(typeof e=="function"&&(e=e()),fa(e)||uT(e))return e;if(typeof e=="string"&&/\S/.test(e))return W.createTextNode(e)}).filter(e=>e)}function dp(i,e){return lT(e).forEach(t=>i.appendChild(t)),i}function cT(i,e){return dp(Ac(i),e)}function Lo(i){return i.button===void 0&&i.buttons===void 0||i.button===0&&i.buttons===void 0||i.type==="mouseup"&&i.button===0&&i.buttons===0?!0:!(i.button!==0||i.buttons!==1)}const ar=iT("querySelector"),hT=iT("querySelectorAll");function Js(i,e){if(!i||!e)return"";if(typeof D.getComputedStyle=="function"){let t;try{t=D.getComputedStyle(i)}catch{return""}return t?t.getPropertyValue(e)||t[e]:""}return""}var dT=Object.freeze({__proto__:null,isReal:da,isEl:fa,isInFrame:tT,createEl:Ce,textContent:fr,prependTo:Fd,hasClass:fo,addClass:Nr,removeClass:xc,toggleClass:nT,setAttributes:rT,getAttributes:Qn,getAttribute:sT,setAttribute:Ys,removeAttribute:Cc,blockTextSelection:aT,unblockTextSelection:oT,getBoundingClientRect:Qs,findPosition:Oo,getPointerPosition:wc,isTextNode:uT,emptyEl:Ac,normalizeContent:lT,appendContent:dp,insertContent:cT,isSingleLeftClick:Lo,$:ar,$$:hT,computedStyle:Js});let fT=!1,Bd;const ZD=function(){if(Bd.options.autoSetup===!1)return;const i=Array.prototype.slice.call(W.getElementsByTagName("video")),e=Array.prototype.slice.call(W.getElementsByTagName("audio")),t=Array.prototype.slice.call(W.getElementsByTagName("video-js")),n=i.concat(e,t);if(n&&n.length>0)for(let r=0,s=n.length;r<s;r++){const a=n[r];if(a&&a.getAttribute)a.player===void 0&&a.getAttribute("data-setup")!==null&&Bd(a);else{Ud(1);break}}else fT||Ud(1)};function Ud(i,e){da()&&(e&&(Bd=e),D.setTimeout(ZD,i))}function Vd(){fT=!0,D.removeEventListener("load",Vd)}da()&&(W.readyState==="complete"?Vd():D.addEventListener("load",Vd));const pT=function(i){const e=W.createElement("style");return e.className=i,e},mT=function(i,e){i.styleSheet?i.styleSheet.cssText=e:i.textContent=e};var ui=new WeakMap;const eI=3;let tI=eI;function vn(){return tI++}function C0(i,e){if(!ui.has(i))return;const t=ui.get(i);t.handlers[e].length===0&&(delete t.handlers[e],i.removeEventListener?i.removeEventListener(e,t.dispatcher,!1):i.detachEvent&&i.detachEvent("on"+e,t.dispatcher)),Object.getOwnPropertyNames(t.handlers).length<=0&&(delete t.handlers,delete t.dispatcher,delete t.disabled),Object.getOwnPropertyNames(t).length===0&&ui.delete(i)}function fp(i,e,t,n){t.forEach(function(r){i(e,r,n)})}function Dc(i){if(i.fixed_)return i;function e(){return!0}function t(){return!1}if(!i||!i.isPropagationStopped||!i.isImmediatePropagationStopped){const n=i||D.event;i={};for(const r in n)r!=="layerX"&&r!=="layerY"&&r!=="keyLocation"&&r!=="webkitMovementX"&&r!=="webkitMovementY"&&r!=="path"&&(r==="returnValue"&&n.preventDefault||(i[r]=n[r]));if(i.target||(i.target=i.srcElement||W),i.relatedTarget||(i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement),i.preventDefault=function(){n.preventDefault&&n.preventDefault(),i.returnValue=!1,n.returnValue=!1,i.defaultPrevented=!0},i.defaultPrevented=!1,i.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),i.cancelBubble=!0,n.cancelBubble=!0,i.isPropagationStopped=e},i.isPropagationStopped=t,i.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),i.isImmediatePropagationStopped=e,i.stopPropagation()},i.isImmediatePropagationStopped=t,i.clientX!==null&&i.clientX!==void 0){const r=W.documentElement,s=W.body;i.pageX=i.clientX+(r&&r.scrollLeft||s&&s.scrollLeft||0)-(r&&r.clientLeft||s&&s.clientLeft||0),i.pageY=i.clientY+(r&&r.scrollTop||s&&s.scrollTop||0)-(r&&r.clientTop||s&&s.clientTop||0)}i.which=i.charCode||i.keyCode,i.button!==null&&i.button!==void 0&&(i.button=i.button&1?0:i.button&4?1:i.button&2?2:0)}return i.fixed_=!0,i}let zu;const iI=function(){if(typeof zu!="boolean"){zu=!1;try{const i=Object.defineProperty({},"passive",{get(){zu=!0}});D.addEventListener("test",null,i),D.removeEventListener("test",null,i)}catch{}}return zu},nI=["touchstart","touchmove"];function Ii(i,e,t){if(Array.isArray(e))return fp(Ii,i,e,t);ui.has(i)||ui.set(i,{});const n=ui.get(i);if(n.handlers||(n.handlers={}),n.handlers[e]||(n.handlers[e]=[]),t.guid||(t.guid=vn()),n.handlers[e].push(t),n.dispatcher||(n.disabled=!1,n.dispatcher=function(r,s){if(n.disabled)return;r=Dc(r);const a=n.handlers[r.type];if(a){const o=a.slice(0);for(let u=0,c=o.length;u<c&&!r.isImmediatePropagationStopped();u++)try{o[u].call(i,r,s)}catch(h){Ie.error(h)}}}),n.handlers[e].length===1)if(i.addEventListener){let r=!1;iI()&&nI.indexOf(e)>-1&&(r={passive:!0}),i.addEventListener(e,n.dispatcher,r)}else i.attachEvent&&i.attachEvent("on"+e,n.dispatcher)}function Wt(i,e,t){if(!ui.has(i))return;const n=ui.get(i);if(!n.handlers)return;if(Array.isArray(e))return fp(Wt,i,e,t);const r=function(a,o){n.handlers[o]=[],C0(a,o)};if(e===void 0){for(const a in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},a)&&r(i,a);return}const s=n.handlers[e];if(s){if(!t){r(i,e);return}if(t.guid)for(let a=0;a<s.length;a++)s[a].guid===t.guid&&s.splice(a--,1);C0(i,e)}}function pa(i,e,t){const n=ui.has(i)?ui.get(i):{},r=i.parentNode||i.ownerDocument;if(typeof e=="string"?e={type:e,target:i}:e.target||(e.target=i),e=Dc(e),n.dispatcher&&n.dispatcher.call(i,e,t),r&&!e.isPropagationStopped()&&e.bubbles===!0)pa.call(null,r,e,t);else if(!r&&!e.defaultPrevented&&e.target&&e.target[e.type]){ui.has(e.target)||ui.set(e.target,{});const s=ui.get(e.target);e.target[e.type]&&(s.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),s.disabled=!1)}return!e.defaultPrevented}function Ic(i,e,t){if(Array.isArray(e))return fp(Ic,i,e,t);const n=function(){Wt(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||vn(),Ii(i,e,n)}function pp(i,e,t){const n=function(){Wt(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||vn(),Ii(i,e,n)}var rI=Object.freeze({__proto__:null,fixEvent:Dc,on:Ii,off:Wt,trigger:pa,one:Ic,any:pp});const $i=30,Xe=function(i,e,t){e.guid||(e.guid=vn());const n=e.bind(i);return n.guid=t?t+"_"+e.guid:e.guid,n},Tn=function(i,e){let t=D.performance.now();return function(...r){const s=D.performance.now();s-t>=e&&(i(...r),t=s)}},gT=function(i,e,t,n=D){let r;const s=()=>{n.clearTimeout(r),r=null},a=function(){const o=this,u=arguments;let c=function(){r=null,c=null,t||i.apply(o,u)};!r&&t&&i.apply(o,u),n.clearTimeout(r),r=n.setTimeout(c,e)};return a.cancel=s,a};var sI=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:$i,bind_:Xe,throttle:Tn,debounce:gT});let Xa;class qi{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Ii(this,e,t),this.addEventListener=n}off(e,t){Wt(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Ic(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},pp(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;typeof e=="string"&&(e={type:t}),e=Dc(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),pa(this,e)}queueTrigger(e){Xa||(Xa=new Map);const t=e.type||e;let n=Xa.get(this);n||(n=new Map,Xa.set(this,n));const r=n.get(t);n.delete(t),D.clearTimeout(r);const s=D.setTimeout(()=>{n.delete(t),n.size===0&&(n=null,Xa.delete(this)),this.trigger(e)},0);n.set(t,s)}}qi.prototype.allowedEvents_={};qi.prototype.addEventListener=qi.prototype.on;qi.prototype.removeEventListener=qi.prototype.off;qi.prototype.dispatchEvent=qi.prototype.trigger;const kc=i=>typeof i.name=="function"?i.name():typeof i.name=="string"?i.name:i.name_?i.name_:i.constructor&&i.constructor.name?i.constructor.name:typeof i,Rn=i=>i instanceof qi||!!i.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof i[e]=="function"),aI=(i,e)=>{Rn(i)?e():(i.eventedCallbacks||(i.eventedCallbacks=[]),i.eventedCallbacks.push(e))},jd=i=>typeof i=="string"&&/\S/.test(i)||Array.isArray(i)&&!!i.length,Nl=(i,e,t)=>{if(!i||!i.nodeName&&!Rn(i))throw new Error(`Invalid target for ${kc(e)}#${t}; must be a DOM node or evented object.`)},_T=(i,e,t)=>{if(!jd(i))throw new Error(`Invalid event type for ${kc(e)}#${t}; must be a non-empty string or array.`)},yT=(i,e,t)=>{if(typeof i!="function")throw new Error(`Invalid listener for ${kc(e)}#${t}; must be a function.`)},qh=(i,e,t)=>{const n=e.length<3||e[0]===i||e[0]===i.eventBusEl_;let r,s,a;return n?(r=i.eventBusEl_,e.length>=3&&e.shift(),[s,a]=e):[r,s,a]=e,Nl(r,i,t),_T(s,i,t),yT(a,i,t),a=Xe(i,a),{isTargetingSelf:n,target:r,type:s,listener:a}},xr=(i,e,t,n)=>{Nl(i,i,e),i.nodeName?rI[e](i,t,n):i[e](t,n)},oI={on(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=qh(this,i,"on");if(xr(t,"on",n,r),!e){const s=()=>this.off(t,n,r);s.guid=r.guid;const a=()=>this.off("dispose",s);a.guid=r.guid,xr(this,"on","dispose",s),xr(t,"on","dispose",a)}},one(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=qh(this,i,"one");if(e)xr(t,"one",n,r);else{const s=(...a)=>{this.off(t,n,s),r.apply(null,a)};s.guid=r.guid,xr(t,"one",n,s)}},any(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=qh(this,i,"any");if(e)xr(t,"any",n,r);else{const s=(...a)=>{this.off(t,n,s),r.apply(null,a)};s.guid=r.guid,xr(t,"any",n,s)}},off(i,e,t){if(!i||jd(i))Wt(this.eventBusEl_,i,e);else{const n=i,r=e;Nl(n,this,"off"),_T(r,this,"off"),yT(t,this,"off"),t=Xe(this,t),this.off("dispose",t),n.nodeName?(Wt(n,r,t),Wt(n,"dispose",t)):Rn(n)&&(n.off(r,t),n.off("dispose",t))}},trigger(i,e){Nl(this.eventBusEl_,this,"trigger");const t=i&&typeof i!="string"?i.type:i;if(!jd(t))throw new Error(`Invalid event type for ${kc(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return pa(this.eventBusEl_,i,e)}};function mp(i,e={}){const{eventBusKey:t}=e;if(t){if(!i[t].nodeName)throw new Error(`The eventBusKey "${t}" does not refer to an element.`);i.eventBusEl_=i[t]}else i.eventBusEl_=Ce("span",{className:"vjs-event-bus"});return Object.assign(i,oI),i.eventedCallbacks&&i.eventedCallbacks.forEach(n=>{n()}),i.on("dispose",()=>{i.off(),[i,i.el_,i.eventBusEl_].forEach(function(n){n&&ui.has(n)&&ui.delete(n)}),D.setTimeout(()=>{i.eventBusEl_=null},0)}),i}const uI={state:{},setState(i){typeof i=="function"&&(i=i());let e;return Ds(i,(t,n)=>{this.state[n]!==t&&(e=e||{},e[n]={from:this.state[n],to:t}),this.state[n]=t}),e&&Rn(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function vT(i,e){return Object.assign(i,uI),i.state=Object.assign({},i.state,e),typeof i.handleStateChanged=="function"&&Rn(i)&&i.on("statechanged",i.handleStateChanged),i}const po=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toLowerCase())},ot=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},TT=function(i,e){return ot(i)===ot(e)};var lI=Object.freeze({__proto__:null,toLowerCase:po,toTitleCase:ot,titleCaseEquals:TT});class V{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Ke({},this.options_),t=this.options_=Ke(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const r=e&&e.id&&e.id()||"no_player";this.id_=`${r}_component_${vn()}`}this.name_=t.name||null,t.el?this.el_=t.el:t.createEl!==!1&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(r=>this.addClass(r)),["on","off","one","any","trigger"].forEach(r=>{this[r]=void 0}),t.evented!==!1&&(mp(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),vT(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,t.initChildren!==!1&&this.initChildren(),this.ready(n),t.reportTouchActivity!==!1&&this.enableTouchActivity()}on(e,t){}off(e,t){}one(e,t){}any(e,t){}trigger(e){}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return!!this.isDisposed_}player(){return this.player_}options(e){return e?(this.options_=Ke(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return Ce(e,t,n)}localize(e,t,n=e){const r=this.player_.language&&this.player_.language(),s=this.player_.languages&&this.player_.languages(),a=s&&s[r],o=r&&r.split("-")[0],u=s&&s[o];let c=n;return a&&a[e]?c=a[e]:u&&u[e]&&(c=u[e]),t&&(c=c.replace(/\{(\d+)\}/g,function(h,g){const y=t[g-1];let v=y;return typeof y>"u"&&(v=h),v})),c}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((n,r)=>n.concat(r),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}addChild(e,t={},n=this.children_.length){let r,s;if(typeof e=="string"){s=ot(e);const a=t.componentClass||s;t.name=s;const o=V.getComponent(a);if(!o)throw new Error(`Component ${a} does not exist`);if(typeof o!="function")return null;r=new o(this.player_||this,t)}else r=e;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,typeof r.id=="function"&&(this.childIndex_[r.id()]=r),s=s||r.name&&ot(r.name()),s&&(this.childNameIndex_[s]=r,this.childNameIndex_[po(s)]=r),typeof r.el=="function"&&r.el()){let a=null;this.children_[n+1]&&(this.children_[n+1].el_?a=this.children_[n+1].el_:fa(this.children_[n+1])&&(a=this.children_[n+1])),this.contentEl().insertBefore(r.el(),a)}return r}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let r=this.children_.length-1;r>=0;r--)if(this.children_[r]===e){t=!0,this.children_.splice(r,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[ot(e.name())]=null,this.childNameIndex_[po(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=a=>{const o=a.name;let u=a.opts;if(t[o]!==void 0&&(u=t[o]),u===!1)return;u===!0&&(u={}),u.playerOptions=this.options_.playerOptions;const c=this.addChild(o,u);c&&(this[o]=c)};let r;const s=V.getComponent("Tech");Array.isArray(e)?r=e:r=Object.keys(e),r.concat(Object.keys(this.options_).filter(function(a){return!r.some(function(o){return typeof o=="string"?a===o:a===o.name})})).map(a=>{let o,u;return typeof a=="string"?(o=a,u=e[o]||this.options_[o]||{}):(o=a.name,u=a),{name:o,opts:u}}).filter(a=>{const o=V.getComponent(a.opts.componentClass||ot(a.name));return o&&!s.isTech(o)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}t?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)}$(e,t){return ar(e,t||this.contentEl())}$$(e,t){return hT(e,t||this.contentEl())}hasClass(e){return fo(this.el_,e)}addClass(...e){Nr(this.el_,...e)}removeClass(...e){xc(this.el_,...e)}toggleClass(e,t){nT(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return sT(this.el_,e)}setAttribute(e,t){Ys(this.el_,e,t)}removeAttribute(e){Cc(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(t!==void 0){(t===null||t!==t)&&(t=0),(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",n||this.trigger("componentresize");return}if(!this.el_)return 0;const r=this.el_.style[e],s=r.indexOf("px");return parseInt(s!==-1?r.slice(0,s):this.el_["offset"+ot(e)],10)}currentDimension(e){let t=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(t=Js(this.el_,e),t=parseFloat(t),t===0||isNaN(t)){const n=`offset${ot(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(me.isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const n=10,r=200;let s;this.on("touchstart",function(o){o.touches.length===1&&(t={pageX:o.touches[0].pageX,pageY:o.touches[0].pageY},e=D.performance.now(),s=!0)}),this.on("touchmove",function(o){if(o.touches.length>1)s=!1;else if(t){const u=o.touches[0].pageX-t.pageX,c=o.touches[0].pageY-t.pageY;Math.sqrt(u*u+c*c)>n&&(s=!1)}});const a=function(){s=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",function(o){t=null,s===!0&&D.performance.now()-e<r&&(o.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=Xe(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(r){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=Xe(this,e),this.clearTimersOnDispose_(),n=D.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),D.clearTimeout(e)),e}setInterval(e,t){e=Xe(this,e),this.clearTimersOnDispose_();const n=D.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),D.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var t;return e=Xe(this,e),t=D.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){if(this.namedRafs_.has(e))return;this.clearTimersOnDispose_(),t=Xe(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),D.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((n,r)=>this[t](r))}),this.clearingTimersOnDispose_=!1}))}static registerComponent(e,t){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=V.getComponent("Tech"),r=n&&n.isTech(t),s=V===t||V.prototype.isPrototypeOf(t.prototype);if(r||!s){let o;throw r?o="techs must be registered using Tech.registerTech()":o="must be a Component subclass",new Error(`Illegal component, "${e}"; ${o}.`)}e=ot(e),V.components_||(V.components_={});const a=V.getComponent("Player");if(e==="Player"&&a&&a.players){const o=a.players,u=Object.keys(o);if(o&&u.length>0&&u.map(c=>o[c]).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return V.components_[e]=t,V.components_[po(e)]=t,t}static getComponent(e){if(!(!e||!V.components_))return V.components_[e]}}V.registerComponent("Component",V);function cI(i,e,t){if(typeof e!="number"||e<0||e>t)throw new Error(`Failed to execute '${i}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${t}).`)}function w0(i,e,t,n){return cI(i,n,t.length-1),t[n][e]}function Hh(i){let e;return i===void 0||i.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:i.length,start:w0.bind(null,"start",0,i),end:w0.bind(null,"end",1,i)},D.Symbol&&D.Symbol.iterator&&(e[D.Symbol.iterator]=()=>(i||[]).values()),e}function mn(i,e){return Array.isArray(i)?Hh(i):i===void 0||e===void 0?Hh():Hh([[i,e]])}const bT=function(i,e){i=i<0?0:i;let t=Math.floor(i%60),n=Math.floor(i/60%60),r=Math.floor(i/3600);const s=Math.floor(e/60%60),a=Math.floor(e/3600);return(isNaN(i)||i===1/0)&&(r=n=t="-"),r=r>0||a>0?r+":":"",n=((r||s>=10)&&n<10?"0"+n:n)+":",t=t<10?"0"+t:t,r+n+t};let gp=bT;function ET(i){gp=i}function ST(){gp=bT}function jr(i,e=i){return gp(i,e)}var hI=Object.freeze({__proto__:null,createTimeRanges:mn,createTimeRange:mn,setFormatTime:ET,resetFormatTime:ST,formatTime:jr});function xT(i,e){let t=0,n,r;if(!e)return 0;(!i||!i.length)&&(i=mn(0,0));for(let s=0;s<i.length;s++)n=i.start(s),r=i.end(s),r>e&&(r=e),t+=r-n;return t/e}function li(i){if(i instanceof li)return i;typeof i=="number"?this.code=i:typeof i=="string"?this.message=i:gn(i)&&(typeof i.code=="number"&&(this.code=i.code),Object.assign(this,i)),this.message||(this.message=li.defaultMessages[this.code]||"")}li.prototype.code=0;li.prototype.message="";li.prototype.status=null;li.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];li.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(let i=0;i<li.errorTypes.length;i++)li[li.errorTypes[i]]=i,li.prototype[li.errorTypes[i]]=i;function mo(i){return i!=null&&typeof i.then=="function"}function on(i){mo(i)&&i.then(null,e=>{})}const $d=function(i){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,r)=>(i[n]&&(t[n]=i[n]),t),{cues:i.cues&&Array.prototype.map.call(i.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})},dI=function(i){const e=i.$$("track"),t=Array.prototype.map.call(e,r=>r.track);return Array.prototype.map.call(e,function(r){const s=$d(r.track);return r.src&&(s.src=r.src),s}).concat(Array.prototype.filter.call(i.textTracks(),function(r){return t.indexOf(r)===-1}).map($d))},fI=function(i,e){return i.forEach(function(t){const n=e.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(r=>n.addCue(r))}),e.textTracks()};var A0={textTracksToJson:dI,jsonToTextTracks:fI,trackToJson_:$d};const Gh="vjs-modal-dialog";class ma extends V{constructor(e,t){super(e,t),this.handleKeyDown_=n=>this.handleKeyDown(n),this.close_=n=>this.close(n),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=Ce("div",{className:`${Gh}-content`},{role:"document"}),this.descEl_=Ce("p",{className:`${Gh}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),fr(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${Gh} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(!this.opened_){const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const r=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=r,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,r=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),cT(t,e),this.trigger("modalfill"),r?n.insertBefore(t,r):n.appendChild(t);const s=this.getChild("closeButton");s&&n.appendChild(s.el_)}empty(){this.trigger("beforemodalempty"),Ac(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=W.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(e.stopPropagation(),me.isEventKey(e,"Escape")&&this.closeable()){e.preventDefault(),this.close();return}if(!me.isEventKey(e,"Tab"))return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let r;for(let s=0;s<t.length;s++)if(n===t[s]){r=s;break}W.activeElement===this.el_&&(r=0),e.shiftKey&&r===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&r===t.length-1&&(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,t=>(t instanceof D.HTMLAnchorElement||t instanceof D.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof D.HTMLInputElement||t instanceof D.HTMLSelectElement||t instanceof D.HTMLTextAreaElement||t instanceof D.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof D.HTMLIFrameElement||t instanceof D.HTMLObjectElement||t instanceof D.HTMLEmbedElement||t.hasAttribute("tabindex")&&t.getAttribute("tabindex")!==-1||t.hasAttribute("contenteditable"))}}ma.prototype.options_={pauseOnOpen:!0,temporary:!0};V.registerComponent("ModalDialog",ma);class Zs extends qi{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},Rn(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const s=this[n];if(s.id===e){t=s;break}}return t}}Zs.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const i in Zs.prototype.allowedEvents_)Zs.prototype["on"+i]=null;const zh=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].enabled=!1)};class pI extends Zs{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){zh(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&zh(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,zh(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const Wh=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].selected=!1)};class mI extends Zs{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){Wh(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set(){}})}addTrack(e){e.selected&&Wh(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,Wh(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class CT extends Zs{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class gI{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,r=this.trackElements_.length;n<r;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&typeof this.trackElements_[t].track.off=="function"&&this.trackElements_[t].track.off(),typeof this.trackElements_[t].off=="function"&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class Ml{constructor(e){Ml.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const r=e.length;this.cues_=e,this.length_=e.length;const s=function(a){""+a in this||Object.defineProperty(this,""+a,{get(){return this.cues_[a]}})};if(t<r)for(n=t;n<r;n++)s.call(this,n)}getCueById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const s=this[n];if(s.id===e){t=s;break}}return t}}const _I={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},yI={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},vI={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},D0={disabled:"disabled",hidden:"hidden",showing:"showing"};class _p extends qi{constructor(e={}){super();const t={id:e.id||"vjs_track_"+vn(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const r in t)Object.defineProperty(this,r,{get(){return t[r]},set(){}});Object.defineProperty(this,"label",{get(){return n},set(r){r!==n&&(n=r,this.trigger("labelchange"))}})}}const yp=function(i){const e=["protocol","hostname","port","pathname","search","hash","host"],t=W.createElement("a");t.href=i;const n={};for(let r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n.protocol==="http:"&&(n.host=n.host.replace(/:80$/,"")),n.protocol==="https:"&&(n.host=n.host.replace(/:443$/,"")),n.protocol||(n.protocol=D.location.protocol),n.host||(n.host=D.location.host),n},wT=function(i){if(!i.match(/^https?:\/\//)){const e=W.createElement("a");e.href=i,i=e.href}return i},vp=function(i){if(typeof i=="string"){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(i);if(t)return t.pop().toLowerCase()}return""},Pc=function(i,e=D.location){const t=yp(i);return(t.protocol===":"?e.protocol:t.protocol)+t.host!==e.protocol+e.host};var TI=Object.freeze({__proto__:null,parseUrl:yp,getAbsoluteURL:wT,getFileExtension:vp,isCrossOrigin:Pc});const I0=function(i,e){const t=new D.WebVTT.Parser(D,D.vttjs,D.WebVTT.StringDecoder()),n=[];t.oncue=function(r){e.addCue(r)},t.onparsingerror=function(r){n.push(r)},t.onflush=function(){e.trigger({type:"loadeddata",target:e})},t.parse(i),n.length>0&&(D.console&&D.console.groupCollapsed&&D.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),n.forEach(r=>Ie.error(r)),D.console&&D.console.groupEnd&&D.console.groupEnd()),t.flush()},k0=function(i,e){const t={uri:i},n=Pc(i);n&&(t.cors=n);const r=e.tech_.crossOrigin()==="use-credentials";r&&(t.withCredentials=r),Xy(t,Xe(this,function(s,a,o){if(s)return Ie.error(s,a);e.loaded_=!0,typeof D.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],u=>{if(u.type==="vttjserror"){Ie.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return I0(o,e)}):I0(o,e)}))};class iu extends _p{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=Ke(e,{kind:vI[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=D0[t.mode]||"disabled";const r=t.default;(t.kind==="metadata"||t.kind==="chapters")&&(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const s=new Ml(this.cues_),a=new Ml(this.activeCues_);let o=!1;this.timeupdateHandler=Xe(this,function(c={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){c.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,o&&(this.trigger("cuechange"),o=!1),c.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const u=()=>{this.stopTracking()};this.tech_.one("dispose",u),n!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return r},set(){}},mode:{get(){return n},set(c){D0[c]&&n!==c&&(n=c,!this.preload_&&n!=="disabled"&&this.cues.length===0&&k0(this.src,this),this.stopTracking(),n!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?s:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return a;const c=this.tech_.currentTime(),h=[];for(let g=0,y=this.cues.length;g<y;g++){const v=this.cues[g];v.startTime<=c&&v.endTime>=c&&h.push(v)}if(o=!1,h.length!==this.activeCues_.length)o=!0;else for(let g=0;g<h.length;g++)this.activeCues_.indexOf(h[g])===-1&&(o=!0);return this.activeCues_=h,a.setCues_(this.activeCues_),a},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||t.kind!=="subtitles"&&t.kind!=="captions")&&k0(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(D.vttjs&&!(e instanceof D.vttjs.VTTCue)){t=new D.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const r in e)r in t||(t[r]=e[r]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}iu.prototype.allowedEvents_={cuechange:"cuechange"};class AT extends _p{constructor(e={}){const t=Ke(e,{kind:yI[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get(){return n},set(r){typeof r!="boolean"||r===n||(n=r,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class DT extends _p{constructor(e={}){const t=Ke(e,{kind:_I[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get(){return n},set(r){typeof r!="boolean"||r===n||(n=r,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class Fn extends qi{constructor(e={}){super();let t;const n=new iu(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return n}}}),t=Fn.NONE,n.addEventListener("loadeddata",()=>{t=Fn.LOADED,this.trigger({type:"load",target:this})})}}Fn.prototype.allowedEvents_={load:"load"};Fn.NONE=0;Fn.LOADING=1;Fn.LOADED=2;Fn.ERROR=3;const ji={audio:{ListClass:pI,TrackClass:AT,capitalName:"Audio"},video:{ListClass:mI,TrackClass:DT,capitalName:"Video"},text:{ListClass:CT,TrackClass:iu,capitalName:"Text"}};Object.keys(ji).forEach(function(i){ji[i].getterName=`${i}Tracks`,ji[i].privateName=`${i}Tracks_`});const ea={remoteText:{ListClass:CT,TrackClass:iu,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:gI,TrackClass:Fn,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ai=Object.assign({},ji,ea);ea.names=Object.keys(ea);ji.names=Object.keys(ji);ai.names=[].concat(ea.names).concat(ji.names);function bI(i,e,t,n,r={}){const s=i.textTracks();r.kind=e,t&&(r.label=t),n&&(r.language=n),r.tech=i;const a=new ai.text.TrackClass(r);return s.addTrack(a),a}class ye extends V{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=n=>this.onDurationChange(n),this.trackProgress_=n=>this.trackProgress(n),this.trackCurrentTime_=n=>this.trackCurrentTime(n),this.stopTrackingCurrentTime_=n=>this.stopTrackingCurrentTime(n),this.disposeSourceHandler_=n=>this.disposeSourceHandler(n),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),ai.names.forEach(n=>{const r=ai[n];e&&e[r.getterName]&&(this[r.privateName]=e[r.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(n=>{e[`native${n}Tracks`]===!1&&(this[`featuresNative${n}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new ai.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Xe(this,function(){const t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,t===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return mn(0,0)}bufferedPercent(){return xT(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(ji.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(t=>{const n=this[`${t}Tracks`]()||[];let r=n.length;for(;r--;){const s=n[r];t==="text"&&this.removeRemoteTextTrack(s),n.removeTrack(s)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new li(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?mn(0,0):mn()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){ji.names.forEach(e=>{const t=ji[e],n=()=>{this.trigger(`${e}trackchange`)},r=this[t.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),this.on("dispose",()=>{r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!D.WebVTT)if(W.body.contains(this.el())){if(!this.options_["vtt.js"]&&Xs(Wg)&&Object.keys(Wg).length>0){this.trigger("vttjsloaded");return}const e=W.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),D.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=o=>e.addTrack(o.track),r=o=>e.removeTrack(o.track);t.on("addtrack",n),t.on("removetrack",r),this.addWebVttScript_();const s=()=>this.trigger("texttrackchange"),a=()=>{s();for(let o=0;o<e.length;o++){const u=e[o];u.removeEventListener("cuechange",s),u.mode==="showing"&&u.addEventListener("cuechange",s)}};a(),e.addEventListener("change",a),e.addEventListener("addtrack",a),e.addEventListener("removetrack",a),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",r),e.removeEventListener("change",a),e.removeEventListener("addtrack",a),e.removeEventListener("removetrack",a);for(let o=0;o<e.length;o++)e[o].removeEventListener("cuechange",s)})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return bI(this,e,t,n)}createRemoteTextTrack(e){const t=Ke(e,{tech:this});return new ea.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return typeof t!="boolean"&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),t===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=vn();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return ye.canPlayType(e.type)}static isTech(e){return e.prototype instanceof ye||e instanceof ye||e===ye}static registerTech(e,t){if(ye.techs_||(ye.techs_={}),!ye.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!ye.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!ye.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=ot(e),ye.techs_[e]=t,ye.techs_[po(e)]=t,e!=="Tech"&&ye.defaultTechOrder_.push(e),t}static getTech(e){if(e){if(ye.techs_&&ye.techs_[e])return ye.techs_[e];if(e=ot(e),D&&D.videojs&&D.videojs[e])return Ie.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),D.videojs[e]}}}ai.names.forEach(function(i){const e=ai[i];ye.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}});ye.prototype.featuresVolumeControl=!0;ye.prototype.featuresMuteControl=!0;ye.prototype.featuresFullscreenResize=!1;ye.prototype.featuresPlaybackRate=!1;ye.prototype.featuresProgressEvents=!1;ye.prototype.featuresSourceset=!1;ye.prototype.featuresTimeupdateEvents=!1;ye.prototype.featuresNativeTextTracks=!1;ye.prototype.featuresVideoFrameCallback=!1;ye.withSourceHandlers=function(i){i.registerSourceHandler=function(t,n){let r=i.sourceHandlers;r||(r=i.sourceHandlers=[]),n===void 0&&(n=r.length),r.splice(n,0,t)},i.canPlayType=function(t){const n=i.sourceHandlers||[];let r;for(let s=0;s<n.length;s++)if(r=n[s].canPlayType(t),r)return r;return""},i.selectSourceHandler=function(t,n){const r=i.sourceHandlers||[];let s;for(let a=0;a<r.length;a++)if(s=r[a].canHandleSource(t,n),s)return r[a];return null},i.canPlaySource=function(t,n){const r=i.selectSourceHandler(t,n);return r?r.canHandleSource(t,n):""},["seekable","seeking","duration"].forEach(function(t){const n=this[t];typeof n=="function"&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):n.apply(this,arguments)})},i.prototype),i.prototype.setSource=function(t){let n=i.selectSourceHandler(t,this.options_);n||(i.nativeSourceHandler?n=i.nativeSourceHandler:Ie.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==i.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},i.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};V.registerComponent("Tech",ye);ye.registerTech("Tech",ye);ye.defaultTechOrder_=[];const Mr={},qd={},Fl={};function EI(i,e){Mr[i]=Mr[i]||[],Mr[i].push(e)}function SI(i,e,t){i.setTimeout(()=>wr(e,Mr[e.type],t,i),1)}function xI(i,e){i.forEach(t=>t.setTech&&t.setTech(e))}function CI(i,e,t){return i.reduceRight(Tp(t),e[t]())}function wI(i,e,t,n){return e[t](i.reduce(Tp(t),n))}function P0(i,e,t,n=null){const r="call"+ot(t),s=i.reduce(Tp(r),n),a=s===Fl,o=a?null:e[t](s);return II(i,t,o,a),o}const AI={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},DI={setCurrentTime:1,setMuted:1,setVolume:1},R0={play:1,pause:1};function Tp(i){return(e,t)=>e===Fl?Fl:t[i]?t[i](e):e}function II(i,e,t,n){for(let r=i.length-1;r>=0;r--){const s=i[r];s[e]&&s[e](n,t)}}function kI(i){qd[i.id()]=null}function PI(i,e){const t=qd[i.id()];let n=null;if(t==null)return n=e(i),qd[i.id()]=[[e,n]],n;for(let r=0;r<t.length;r++){const[s,a]=t[r];s===e&&(n=a)}return n===null&&(n=e(i),t.push([e,n])),n}function wr(i={},e=[],t,n,r=[],s=!1){const[a,...o]=e;if(typeof a=="string")wr(i,Mr[a],t,n,r,s);else if(a){const u=PI(n,a);if(!u.setSource)return r.push(u),wr(i,o,t,n,r,s);u.setSource(Object.assign({},i),function(c,h){if(c)return wr(i,o,t,n,r,s);r.push(u),wr(h,i.type===h.type?o:Mr[h.type],t,n,r,s)})}else o.length?wr(i,o,t,n,r,s):s?t(i,r):wr(i,Mr["*"],t,n,r,!0)}const RI={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Bl=function(i=""){const e=vp(i);return RI[e.toLowerCase()]||""},OI=(i,e)=>{if(!e)return"";if(i.cache_.source.src===e&&i.cache_.source.type)return i.cache_.source.type;const t=i.cache_.sources.filter(r=>r.src===e);if(t.length)return t[0].type;const n=i.$$("source");for(let r=0;r<n.length;r++){const s=n[r];if(s.type&&s.src&&s.src===e)return s.type}return Bl(e)},IT=function(i){if(Array.isArray(i)){let e=[];i.forEach(function(t){t=IT(t),Array.isArray(t)?e=e.concat(t):gn(t)&&e.push(t)}),i=e}else typeof i=="string"&&i.trim()?i=[O0({src:i})]:gn(i)&&typeof i.src=="string"&&i.src&&i.src.trim()?i=[O0(i)]:i=[];return i};function O0(i){if(!i.type){const e=Bl(i.src);e&&(i.type=e)}return i}class LI extends V{constructor(e,t,n){const r=Ke({createEl:!1},t);if(super(e,r,n),!t.playerOptions.sources||t.playerOptions.sources.length===0)for(let s=0,a=t.playerOptions.techOrder;s<a.length;s++){const o=ot(a[s]);let u=ye.getTech(o);if(o||(u=V.getComponent(o)),u&&u.isSupported()){e.loadTech_(o);break}}else e.src(t.playerOptions.sources)}}V.registerComponent("MediaLoader",LI);class Rc extends V{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=n=>this.handleMouseOver(n),this.handleMouseOut_=n=>this.handleMouseOut(n),this.handleClick_=n=>this.handleClick(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),e==="button"&&Ie.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const r=Ce(e,t,n);return r.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=Ce("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(e===void 0)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,fr(this.controlTextEl_,n),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){me.isEventKey(e,"Space")||me.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}V.registerComponent("ClickableComponent",Rc);class Hd extends Rc{constructor(e,t){super(e,t),this.update(),this.update_=n=>this.update(n),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return Ce("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(Ce("picture",{className:"vjs-poster",tabIndex:-1},{},Ce("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?on(this.player_.play()):this.player_.pause())}}Hd.prototype.crossorigin=Hd.prototype.crossOrigin;V.registerComponent("PosterImage",Hd);const Ni="#222",L0="#ccc",NI={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Kh(i,e){let t;if(i.length===4)t=i[1]+i[1]+i[2]+i[2]+i[3]+i[3];else if(i.length===7)t=i.slice(1);else throw new Error("Invalid color code provided, "+i+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+e+")"}function Xh(i,e,t){try{i.style[e]=t}catch{return}}class MI extends V{constructor(e,t,n){super(e,t,n);const r=s=>this.updateDisplay(s);e.on("loadstart",s=>this.toggleDisplay(s)),e.on("texttrackchange",r),e.on("loadedmetadata",s=>this.preselectTrack(s)),e.ready(Xe(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",r),e.on("playerresize",r);const s=D.screen.orientation||D,a=D.screen.orientation?"change":"orientationchange";s.addEventListener(a,r),e.on("dispose",()=>s.removeEventListener(a,r));const o=this.options_.playerOptions.tracks||[];for(let u=0;u<o.length;u++)this.player_.addRemoteTextTrack(o[u],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let r,s,a;for(let o=0;o<t.length;o++){const u=t[o];n&&n.enabled&&n.language&&n.language===u.language&&u.kind in e?u.kind===n.kind?a=u:a||(a=u):n&&!n.enabled?(a=null,r=null,s=null):u.default&&(u.kind==="descriptions"&&!r?r=u:u.kind in e&&!s&&(s=u))}a?a.mode="showing":s?s.mode="showing":r&&(r.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof D.WebVTT=="function"&&D.WebVTT.processCues(D,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const a=[];for(let o=0;o<e.length;++o){const u=e[o];u.mode==="showing"&&a.push(u)}this.updateForTrack(a);return}let n=null,r=null,s=e.length;for(;s--;){const a=e[s];a.mode==="showing"&&(a.kind==="descriptions"?n=a:r=a)}r?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(r)):n&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let r=n.length;for(;r--;){const s=n[r];if(!s)continue;const a=s.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&Xh(a.firstChild,"color",Kh(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Xh(a.firstChild,"backgroundColor",Kh(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Xh(a,"backgroundColor",Kh(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&(t.edgeStyle==="dropshadow"?a.firstChild.style.textShadow=`2px 2px 3px ${Ni}, 2px 2px 4px ${Ni}, 2px 2px 5px ${Ni}`:t.edgeStyle==="raised"?a.firstChild.style.textShadow=`1px 1px ${Ni}, 2px 2px ${Ni}, 3px 3px ${Ni}`:t.edgeStyle==="depressed"?a.firstChild.style.textShadow=`1px 1px ${L0}, 0 1px ${L0}, -1px -1px ${Ni}, 0 -1px ${Ni}`:t.edgeStyle==="uniform"&&(a.firstChild.style.textShadow=`0 0 4px ${Ni}, 0 0 4px ${Ni}, 0 0 4px ${Ni}, 0 0 4px ${Ni}`)),t.fontPercent&&t.fontPercent!==1){const o=D.parseFloat(a.style.fontSize);a.style.fontSize=o*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&t.fontFamily!=="default"&&(t.fontFamily==="small-caps"?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=NI[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof D.WebVTT!="function"||e.every(n=>!n.activeCues))return;const t=[];for(let n=0;n<e.length;++n){const r=e[n];for(let s=0;s<r.activeCues.length;++s)t.push(r.activeCues[s])}D.WebVTT.processCues(D,t,this.el_);for(let n=0;n<e.length;++n){const r=e[n];for(let s=0;s<r.activeCues.length;++s){const a=r.activeCues[s].displayState;Nr(a,"vjs-text-track-cue","vjs-text-track-cue-"+(r.language?r.language:n)),r.language&&Ys(a,"lang",r.language)}this.player_.textTrackSettings&&this.updateDisplayState(r)}}}V.registerComponent("TextTrackDisplay",MI);class FI extends V{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=Ce("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),r=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}V.registerComponent("LoadingSpinner",FI);class Ai extends Rc{createEl(e,t={},n={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n);const r=Ce(e,t,n);return r.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}addChild(e,t={}){const n=this.constructor.name;return Ie.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),V.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(me.isEventKey(e,"Space")||me.isEventKey(e,"Enter")){e.stopPropagation();return}super.handleKeyDown(e)}}V.registerComponent("Button",Ai);class kT extends Ai{constructor(e,t){super(e,t),this.mouseused_=!1,this.on("mousedown",n=>this.handleMouseDown(n))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){on(t),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(!r){this.player_.tech(!0).focus();return}const s=()=>r.focus();mo(t)?t.then(s,()=>{}):this.setTimeout(s,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}kT.prototype.controlText_="Play Video";V.registerComponent("BigPlayButton",kT);class BI extends Ai{constructor(e,t){super(e,t),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){me.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}V.registerComponent("CloseButton",BI);class PT extends Ai{constructor(e,t={}){super(e,t),t.replay=t.replay===void 0||t.replay,this.on(e,"play",n=>this.handlePlay(n)),this.on(e,"pause",n=>this.handlePause(n)),t.replay&&this.on(e,"ended",n=>this.handleEnded(n))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?on(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",t=>this.handleSeeked(t))}}PT.prototype.controlText_="Play";V.registerComponent("PlayToggle",PT);class ga extends V{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended"],n=>this.updateContent(n)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=Ce("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)} `},{role:"presentation"});return t.appendChild(n),this.contentEl_=Ce("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}updateTextNode_(e=0){e=jr(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let t=this.textNode_;t&&this.contentEl_.firstChild!==t&&(t=null,Ie.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=W.createTextNode(this.formattedTime_),this.textNode_&&(t?this.contentEl_.replaceChild(this.textNode_,t):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}ga.prototype.labelText_="Time";ga.prototype.controlText_="Time";V.registerComponent("TimeDisplay",ga);class bp extends ga{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;this.player_.ended()?t=this.player_.duration():t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}bp.prototype.labelText_="Current Time";bp.prototype.controlText_="Current Time";V.registerComponent("CurrentTimeDisplay",bp);class Ep extends ga{constructor(e,t){super(e,t);const n=r=>this.updateContent(r);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}Ep.prototype.labelText_="Duration";Ep.prototype.controlText_="Duration";V.registerComponent("DurationDisplay",Ep);class UI extends V{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}}V.registerComponent("TimeDivider",UI);class Sp extends ga{constructor(e,t){super(e,t),this.on(e,"durationchange",n=>this.updateContent(n))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(Ce("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let t;this.player_.ended()?t=0:this.player_.remainingTimeDisplay?t=this.player_.remainingTimeDisplay():t=this.player_.remainingTime(),this.updateTextNode_(t)}}Sp.prototype.labelText_="Remaining Time";Sp.prototype.controlText_="Remaining Time";V.registerComponent("RemainingTimeDisplay",Sp);class VI extends V{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",n=>this.updateShowing(n))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Ce("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Ce("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(W.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}V.registerComponent("LiveDisplay",VI);class RT extends Ai{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=n=>this.updateLiveEdgeStatus(n),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Ce("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}RT.prototype.controlText_="Seek to live, currently playing live";V.registerComponent("SeekToLive",RT);function nu(i,e,t){return i=Number(i),Math.min(t,Math.max(e,isNaN(i)?e:i))}var jI=Object.freeze({__proto__:null,clamp:nu});let xp=class extends V{constructor(e,t){super(e,t),this.handleMouseDown_=n=>this.handleMouseDown(n),this.handleMouseUp_=n=>this.handleMouseUp(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.handleClick_=n=>this.handleClick(n),this.handleMouseMove_=n=>this.handleMouseMove(n),this.update_=n=>this.update(n),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!yn&&e.preventDefault(),aT(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;oT(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(nu(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=wc(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){me.isEventKey(e,"Left")||me.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):me.isEventKey(e,"Right")||me.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}};V.registerComponent("Slider",xp);const Yh=(i,e)=>nu(i/e*100,0,100).toFixed(2)+"%";class $I extends V{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",n=>this.update(n))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=Ce("span",{className:"vjs-control-text"}),n=Ce("span",{textContent:this.localize("Loaded")}),r=W.createTextNode(": ");return this.percentageEl_=Ce("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const t=this.player_.liveTracker,n=this.player_.buffered(),r=t&&t.isLive()?t.seekableEnd():this.player_.duration(),s=this.player_.bufferedEnd(),a=this.partEls_,o=Yh(s,r);this.percent_!==o&&(this.el_.style.width=o,fr(this.percentageEl_,o),this.percent_=o);for(let u=0;u<n.length;u++){const c=n.start(u),h=n.end(u);let g=a[u];g||(g=this.el_.appendChild(Ce()),a[u]=g),!(g.dataset.start===c&&g.dataset.end===h)&&(g.dataset.start=c,g.dataset.end=h,g.style.left=Yh(c,s),g.style.width=Yh(h-c,s))}for(let u=a.length;u>n.length;u--)this.el_.removeChild(a[u-1]);a.length=n.length})}}V.registerComponent("LoadProgressBar",$I);class qI extends V{constructor(e,t){super(e,t),this.update=Tn(Xe(this,this.update),$i)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const r=Oo(this.el_),s=Qs(this.player_.el()),a=e.width*t;if(!s||!r)return;const o=e.left-s.left+a,u=e.width-a+(s.right-e.right);let c=r.width/2;o<c?c+=c-o:u<c&&(c=u),c<0?c=0:c>r.width&&(c=r.width),c=Math.round(c),this.el_.style.right=`-${c}px`,this.write(n)}write(e){fr(this.el_,e)}updateTime(e,t,n,r){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let s;const a=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const o=this.player_.liveTracker.liveWindow(),u=o-t*o;s=(u<1?"":"-")+jr(u,o)}else s=jr(n,a);this.update(e,t,s),r&&r()})}}V.registerComponent("TimeTooltip",qI);class Cp extends V{constructor(e,t){super(e,t),this.update=Tn(Xe(this,this.update),$i)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const n=this.getChild("timeTooltip");if(!n)return;const r=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,r)}}Cp.prototype.options_={children:[]};!fi&&!_n&&Cp.prototype.options_.children.push("timeTooltip");V.registerComponent("PlayProgressBar",Cp);class OT extends V{constructor(e,t){super(e,t),this.update=Tn(Xe(this,this.update),$i)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left=`${e.width*t}px`})}}OT.prototype.options_={children:["timeTooltip"]};V.registerComponent("MouseTimeDisplay",OT);const Wu=5,N0=12;class wp extends xp{constructor(e,t){super(e,t),this.setEventHandlers_()}setEventHandlers_(){this.update_=Xe(this,this.update),this.update=Tn(this.update_,$i),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in W&&"visibilityState"in W&&this.on(W,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){W.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,$i))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(W.visibilityState==="hidden")return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),r=this.player_.liveTracker;let s=this.player_.duration();r&&r.isLive()&&(s=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(t*100).toFixed(2)),this.percent_=t),(this.currentTime_!==n||this.duration_!==s)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[jr(n,s),jr(s,s)],"{1} of {2}")),this.currentTime_=n,this.duration_=s),this.bar&&this.bar.update(Qs(this.el()),this.getProgress())}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){Lo(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!Lo(e))return;!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let n;const r=this.calculateDistance(e),s=this.player_.liveTracker;if(!s||!s.isLive())n=r*this.player_.duration(),n===this.player_.duration()&&(n=n-.1);else{if(r>=.99){s.seekToLiveEdge();return}const a=s.seekableStart(),o=s.liveCurrentTime();if(n=a+r*s.liveWindow(),n>=o&&(n=o),n<=a&&(n=a+.1),n===1/0)return}this.userSeek_(n)}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?on(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+Wu)}stepBack(){this.userSeek_(this.player_.currentTime()-Wu)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(me.isEventKey(e,"Space")||me.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(me.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(me.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(me(e))){e.preventDefault(),e.stopPropagation();const n=(me.codes[me(e)]-me.codes[0])*10/100;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else me.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-Wu*N0)):me.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+Wu*N0)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in W&&"visibilityState"in W&&this.off(W,"visibilitychange",this.toggleVisibility_),super.dispose()}}wp.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"};!fi&&!_n&&wp.prototype.options_.children.splice(1,0,"mouseTimeDisplay");V.registerComponent("SeekBar",wp);class LT extends V{constructor(e,t){super(e,t),this.handleMouseMove=Tn(Xe(this,this.handleMouseMove),$i),this.throttledHandleMouseSeek=Tn(Xe(this,this.handleMouseSeek),$i),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.handleMouseDownHandler_=n=>this.handleMouseDown(n),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),r=t.getChild("mouseTimeDisplay");if(!n&&!r)return;const s=t.el(),a=Oo(s);let o=wc(s,e).x;o=nu(o,0,1),r&&r.update(a,o),n&&n.update(a,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&on(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}LT.prototype.options_={children:["seekBar"]};V.registerComponent("ProgressControl",LT);class NT extends Ai{constructor(e,t){super(e,t),this.on(e,["enterpictureinpicture","leavepictureinpicture"],n=>this.handlePictureInPictureChange(n)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],n=>this.handlePictureInPictureEnabledChange(n)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>{e.currentType().substring(0,5)==="audio"||e.audioPosterMode()||e.audioOnlyMode()?(e.isInPictureInPicture()&&e.exitPictureInPicture(),this.hide()):this.show()}),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control ${super.buildCSSClass()}`}handlePictureInPictureEnabledChange(){W.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in D?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}}NT.prototype.controlText_="Picture-in-Picture";V.registerComponent("PictureInPictureToggle",NT);class MT extends Ai{constructor(e,t){super(e,t),this.on(e,"fullscreenchange",n=>this.handleFullscreenChange(n)),W[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?this.controlText("Exit Fullscreen"):this.controlText("Fullscreen")}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}MT.prototype.controlText_="Fullscreen";V.registerComponent("FullscreenToggle",MT);const HI=function(i,e){e.tech_&&!e.tech_.featuresVolumeControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class GI extends V{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}V.registerComponent("VolumeLevel",GI);class zI extends V{constructor(e,t){super(e,t),this.update=Tn(Xe(this,this.update),$i)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,r){if(!n){const s=Qs(this.el_),a=Qs(this.player_.el()),o=e.width*t;if(!a||!s)return;const u=e.left-a.left+o,c=e.width-o+(a.right-e.right);let h=s.width/2;u<h?h+=h-u:c<h&&(h=c),h<0?h=0:h>s.width&&(h=s.width),this.el_.style.right=`-${h}px`}this.write(`${r}%`)}write(e){fr(this.el_,e)}updateVolume(e,t,n,r,s){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,r.toFixed(0)),s&&s()})}}V.registerComponent("VolumeLevelTooltip",zI);class FT extends V{constructor(e,t){super(e,t),this.update=Tn(Xe(this,this.update),$i)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,r,()=>{n?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}FT.prototype.options_={children:["volumeLevelTooltip"]};V.registerComponent("MouseVolumeLevelDisplay",FT);class Oc extends xp{constructor(e,t){super(e,t),this.on("slideractive",n=>this.updateLastVolume_(n)),this.on(e,"volumechange",n=>this.updateARIAAttributes(n)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){Lo(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),r=Qs(n),s=this.vertical();let a=wc(n,e);a=s?a.y:a.x,a=nu(a,0,1),t.update(r,a,s)}Lo(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}Oc.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!fi&&!_n&&Oc.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");Oc.prototype.playerEvent="volumechange";V.registerComponent("VolumeBar",Oc);class BT extends V{constructor(e,t={}){t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||Xs(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),HI(this,e),this.throttledHandleMouseMove=Tn(Xe(this,this.handleMouseMove),$i),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.on("mousedown",n=>this.handleMouseDown(n)),this.on("touchstart",n=>this.handleMouseDown(n)),this.on("mousemove",n=>this.handleMouseMove(n)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}BT.prototype.options_={children:["volumeBar"]};V.registerComponent("VolumeControl",BT);const WI=function(i,e){e.tech_&&!e.tech_.featuresMuteControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresMuteControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class UT extends Ai{constructor(e,t){super(e,t),WI(this,e),this.on(e,["loadstart","volumechange"],n=>this.update(n))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(t===0){const r=n<.1?.1:n;this.player_.volume(r),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;fi&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2),xc(this.el_,[0,1,2,3].reduce((n,r)=>n+`${r?" ":""}vjs-vol-${r}`,"")),Nr(this.el_,`vjs-vol-${t}`)}updateControlText_(){const t=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}UT.prototype.controlText_="Mute";V.registerComponent("MuteToggle",UT);class VT extends V{constructor(e,t={}){typeof t.inline<"u"?t.inline=t.inline:t.inline=!0,(typeof t.volumeControl>"u"||Xs(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=n=>this.handleKeyPress(n),this.on(e,["loadstart"],n=>this.volumePanelState_(n)),this.on(this.muteToggle,"keyup",n=>this.handleKeyPress(n)),this.on(this.volumeControl,"keyup",n=>this.handleVolumeControlKeyUp(n)),this.on("keydown",n=>this.handleKeyPress(n)),this.on("mouseover",n=>this.handleMouseOver(n)),this.on("mouseout",n=>this.handleMouseOut(n)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){me.isEventKey(e,"Esc")&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),Ii(W,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),Wt(W,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){me.isEventKey(e,"Esc")&&this.handleMouseOut()}}VT.prototype.options_={children:["muteToggle","volumeControl"]};V.registerComponent("VolumePanel",VT);class KI extends Ai{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()?n.seekableEnd():this.player_.duration();let s;t+this.skipTime<=r?s=t+this.skipTime:s=r,this.player_.currentTime(s)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}V.registerComponent("SkipForward",KI);class jT extends Ai{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()&&n.seekableStart();let s;r&&t-this.skipTime<=r?s=r:t>=this.skipTime?s=t-this.skipTime:s=0,this.player_.currentTime(s)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}jT.prototype.controlText_="Skip Backward";V.registerComponent("SkipBackward",jT);class $T extends V{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",n=>this.handleKeyDown(n)),this.boundHandleBlur_=n=>this.handleBlur(n),this.boundHandleTapClick_=n=>this.handleTapClick(n)}addEventListenerForItem(e){e instanceof V&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof V&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=Ce(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),Ii(t,"click",function(n){n.preventDefault(),n.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||W.activeElement;if(!this.children().some(n=>n.el()===t)){const n=this.menuButton_;n&&n.buttonPressed_&&t!==n.el().firstChild&&n.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(r=>r.el()===e.target)[0];if(!n)return;n.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){me.isEventKey(e,"Left")||me.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(me.isEventKey(e,"Right")||me.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}V.registerComponent("Menu",$T);class Ap extends V{constructor(e,t={}){super(e,t),this.menuButton_=new Ai(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Ai.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const r=s=>this.handleClick(s);this.handleMenuKeyUp_=s=>this.handleMenuKeyUp(s),this.on(this.menuButton_,"tap",r),this.on(this.menuButton_,"click",r),this.on(this.menuButton_,"keydown",s=>this.handleKeyDown(s)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),Ii(W,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",s=>this.handleMouseLeave(s)),this.on("keydown",s=>this.handleSubmenuKeyDown(s))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new $T(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=Ce("li",{className:"vjs-menu-title",textContent:ot(this.options_.title),tabIndex:-1}),n=new V(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const t=Ai.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),Wt(W,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){me.isEventKey(e,"Esc")||me.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),me.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(me.isEventKey(e,"Up")||me.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(me.isEventKey(e,"Esc")||me.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(me.isEventKey(e,"Esc")||me.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),me.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),fi&&tT())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}V.registerComponent("MenuButton",Ap);class Dp extends Ap{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const r=Xe(this,this.update);n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),n.addEventListener("labelchange",r),this.player_.on("ready",r),this.player_.on("dispose",function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r),n.removeEventListener("labelchange",r)})}}V.registerComponent("TrackButton",Dp);const XI=["Tab","Esc","Up","Down","Right","Left"];class ru extends Rc{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const r=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n);return r.replaceChild(Ce("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),r.querySelector(".vjs-icon-placeholder")),r}handleKeyDown(e){XI.some(t=>me.isEventKey(e,t))||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}V.registerComponent("MenuItem",ru);class su extends ru{constructor(e,t){const n=t.track,r=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected=n.mode==="showing",super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const s=(...o)=>{this.handleTracksChange.apply(this,o)},a=(...o)=>{this.handleSelectedLanguageChange.apply(this,o)};if(e.on(["loadstart","texttrackchange"],s),r.addEventListener("change",s),r.addEventListener("selectedlanguagechange",a),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],s),r.removeEventListener("change",s),r.removeEventListener("selectedlanguagechange",a)}),r.onchange===void 0){let o;this.on(["tap","click"],function(){if(typeof D.Event!="object")try{o=new D.Event("change")}catch{}o||(o=W.createEvent("Event"),o.initEvent("change",!0,!0)),r.dispatchEvent(o)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),!!n)for(let r=0;r<n.length;r++){const s=n[r];this.kinds.indexOf(s.kind)!==-1&&(s===t?s.mode!=="showing"&&(s.mode="showing"):s.mode!=="disabled"&&(s.mode="disabled"))}}handleTracksChange(e){const t=this.track.mode==="showing";t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}V.registerComponent("TextTrackMenuItem",su);class qT extends su{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(this.options_.kinds.indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}V.registerComponent("OffTextTrackMenuItem",qT);class _a extends Dp{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=su){let n;this.label_&&(n=`${this.label_} off`),e.push(new qT(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const r=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let s=0;s<r.length;s++){const a=r[s];if(this.kinds_.indexOf(a.kind)>-1){const o=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});o.addClass(`vjs-${a.kind}-menu-item`),e.push(o)}}return e}}V.registerComponent("TextTrackButton",_a);class HT extends ru{constructor(e,t){const n=t.track,r=t.cue,s=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=r.text,t.selected=r.startTime<=s&&s<r.endTime,super(e,t),this.track=n,this.cue=r}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}V.registerComponent("ChaptersTrackMenuItem",HT);class Ip extends _a{constructor(e,t,n){super(e,t,n),this.selectCurrentItem_=()=>{this.items.forEach(r=>{r.selected(this.track_.activeCues[0]===r.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(ot(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,r=t.length;n<r;n++){const s=t[n],a=new HT(this.player_,{track:this.track_,cue:s});e.push(a)}return e}}Ip.prototype.kind_="chapters";Ip.prototype.controlText_="Chapters";V.registerComponent("ChaptersButton",Ip);class kp extends _a{constructor(e,t,n){super(e,t,n);const r=e.textTracks(),s=Xe(this,this.handleTracksChange);r.addEventListener("change",s),this.on("dispose",function(){r.removeEventListener("change",s)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(a.kind!==this.kind_&&a.mode==="showing"){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}kp.prototype.kind_="descriptions";kp.prototype.controlText_="Descriptions";V.registerComponent("DescriptionsButton",kp);class Pp extends _a{constructor(e,t,n){super(e,t,n)}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}Pp.prototype.kind_="subtitles";Pp.prototype.controlText_="Subtitles";V.registerComponent("SubtitlesButton",Pp);class Rp extends su{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}V.registerComponent("CaptionSettingsMenuItem",Rp);class Op extends _a{constructor(e,t,n){super(e,t,n)}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Rp(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}Op.prototype.kind_="captions";Op.prototype.controlText_="Captions";V.registerComponent("CaptionsButton",Op);class GT extends su{createEl(e,t,n){const r=super.createEl(e,t,n),s=r.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(s.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(Ce("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),r}}V.registerComponent("SubsCapsMenuItem",GT);class Lp extends _a{constructor(e,t={}){super(e,t),this.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions"),this.menuButton_.controlText(ot(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Rp(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,GT),e}}Lp.prototype.kinds_=["captions","subtitles"];Lp.prototype.controlText_="Subtitles";V.registerComponent("SubsCapsButton",Lp);class zT extends ru{constructor(e,t){const n=t.track,r=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const s=(...a)=>{this.handleTracksChange.apply(this,a)};r.addEventListener("change",s),this.on("dispose",()=>{r.removeEventListener("change",s)})}createEl(e,t,n){const r=super.createEl(e,t,n),s=r.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="main-desc"&&(s.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(Ce("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),r}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];r!==this.track&&(r.enabled=r===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}V.registerComponent("AudioTrackMenuItem",zT);class WT extends Dp{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t)}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];e.push(new zT(this.player_,{track:r,selectable:!0,multiSelectable:!1}))}return e}}WT.prototype.controlText_="Audio Track";V.registerComponent("AudioTrackButton",WT);class Np extends ru{constructor(e,t){const n=t.rate,r=parseFloat(n,10);t.label=n,t.selected=r===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=r,this.on(e,"ratechange",s=>this.update(s))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}Np.prototype.contentElType="button";V.registerComponent("PlaybackRateMenuItem",Np);class KT extends Ap{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",n=>this.updateVisibility(n)),this.on(e,"ratechange",n=>this.updateLabel(n)),this.on(e,"playbackrateschange",n=>this.handlePlaybackRateschange(n))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Ce("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new Np(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}KT.prototype.controlText_="Playback Rate";V.registerComponent("PlaybackRateMenuButton",KT);class XT extends V{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}V.registerComponent("Spacer",XT);class YI extends XT{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:" "})}}V.registerComponent("CustomControlSpacer",YI);class Ul extends V{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}Ul.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]};"exitPictureInPicture"in W&&Ul.prototype.options_.children.splice(Ul.prototype.options_.children.length-1,0,"pictureInPictureToggle");V.registerComponent("ControlBar",Ul);class YT extends ma{constructor(e,t){super(e,t),this.on(e,"error",n=>this.open(n))}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}YT.prototype.options_=Object.assign({},ma.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});V.registerComponent("ErrorDisplay",YT);const Qh="vjs-text-track-settings",M0=["#000","Black"],F0=["#00F","Blue"],B0=["#0FF","Cyan"],U0=["#0F0","Green"],V0=["#F0F","Magenta"],j0=["#F00","Red"],$0=["#FFF","White"],q0=["#FF0","Yellow"],Jh=["1","Opaque"],Zh=["0.5","Semi-Transparent"],H0=["0","Transparent"],Ar={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[M0,$0,j0,U0,F0,q0,V0,B0]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Jh,Zh,H0]},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[$0,M0,j0,U0,F0,q0,V0,B0]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:i=>i==="1.00"?null:Number(i)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Jh,Zh]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[H0,Zh,Jh]}};Ar.windowColor.options=Ar.backgroundColor.options;function QT(i,e){if(e&&(i=e(i)),i&&i!=="none")return i}function QI(i,e){const t=i.options[i.options.selectedIndex].value;return QT(t,e)}function JI(i,e,t){if(e){for(let n=0;n<i.options.length;n++)if(QT(i.options[n].value,t)===e){i.selectedIndex=n;break}}}class ZI extends ma{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.endDialog=Ce("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),t.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.on(this.$(".vjs-done-button"),"click",()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),"click",()=>{this.setDefaults(),this.updateDisplay()}),Ds(Ar,n=>{this.on(this.$(n.selector),"change",this.updateDisplay)}),this.options_.persistTextTrackSettings&&this.restoreSettings()}dispose(){this.endDialog=null,super.dispose()}createElSelect_(e,t="",n="label"){const r=Ar[e],s=r.id.replace("%s",this.id_),a=[t,s].join(" ").trim();return[`<${n} id="${s}" class="${n==="label"?"vjs-label":""}">`,this.localize(r.label),`</${n}>`,`<select aria-labelledby="${a}">`].concat(r.options.map(o=>{const u=s+"-"+o[1].replace(/\W+/g,"");return[`<option id="${u}" value="${o[0]}" `,`aria-labelledby="${a} ${u}">`,this.localize(o[1]),"</option>"].join("")})).concat("</select>").join("")}createElFgColor_(){const e=`captions-text-legend-${this.id_}`;return['<fieldset class="vjs-fg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text"),"</legend>",'<span class="vjs-text-color">',this.createElSelect_("color",e),"</span>",'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")}createElBgColor_(){const e=`captions-background-${this.id_}`;return['<fieldset class="vjs-bg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text Background"),"</legend>",'<span class="vjs-bg-color">',this.createElSelect_("backgroundColor",e),"</span>",'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")}createElWinColor_(){const e=`captions-window-${this.id_}`;return['<fieldset class="vjs-window vjs-track-setting">',`<legend id="${e}">`,this.localize("Caption Area Background"),"</legend>",'<span class="vjs-window-color">',this.createElSelect_("windowColor",e),"</span>",'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")}createElColors_(){return Ce("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})}createElFont_(){return Ce("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})}createElControls_(){const e=this.localize("restore all settings to the default values");return Ce("div",{className:"vjs-track-settings-controls",innerHTML:[`<button type="button" class="vjs-default-button" title="${e}">`,this.localize("Reset"),`<span class="vjs-control-text"> ${e}</span>`,"</button>",`<button type="button" class="vjs-done-button">${this.localize("Done")}</button>`].join("")})}content(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return Yv(Ar,(e,t,n)=>{const r=QI(this.$(t.selector),t.parser);return r!==void 0&&(e[n]=r),e},{})}setValues(e){Ds(Ar,(t,n)=>{JI(this.$(t.selector),e[n],t.parser)})}setDefaults(){Ds(Ar,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(D.localStorage.getItem(Qh))}catch(t){Ie.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?D.localStorage.setItem(Qh,JSON.stringify(e)):D.localStorage.removeItem(Qh)}catch(t){Ie.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}conditionalBlur_(){this.previouslyActiveEl_=null;const e=this.player_.controlBar,t=e&&e.subsCapsButton,n=e&&e.captionsButton;t?t.focus():n&&n.focus()}handleLanguagechange(){this.fill()}}V.registerComponent("TextTrackSettings",ZI);class ek extends V{constructor(e,t){let n=t.ResizeObserver||D.ResizeObserver;t.ResizeObserver===null&&(n=!1);const r=Ke({createEl:!n,reportTouchActivity:!1},t);super(e,r),this.ResizeObserver=t.ResizeObserver||D.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=gT(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const s=this.debouncedHandler_;let a=this.unloadListener_=function(){Wt(this,"resize",s),Wt(this,"unload",a),a=null};Ii(this.el_.contentWindow,"unload",a),Ii(this.el_.contentWindow,"resize",s)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}V.registerComponent("ResizeManager",ek);const tk={trackingThreshold:20,liveTolerance:15};class ik extends V{constructor(e,t){const n=Ke(tk,t,{createEl:!1});super(e,n),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=r=>this.handlePlay(r),this.handleFirstTimeupdate_=r=>this.handleFirstTimeupdate(r),this.handleSeeked_=r=>this.handleSeeked(r),this.seekToLiveEdge_=r=>this.seekToLiveEdge(r),this.reset_(),this.on(this.player_,"durationchange",r=>this.handleDurationchange(r)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(D.performance.now().toFixed(4)),n=this.lastTime_===-1?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const r=this.liveCurrentTime(),s=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(r-s)>this.options_.liveTolerance;(!this.timeupdateSeen_||r===1/0)&&(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,$i),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}V.registerComponent("LiveTracker",ik);class nk extends V{constructor(e,t){super(e,t),this.on("statechanged",n=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:Ce("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${vn()}`}),description:Ce("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${vn()}`})},Ce("div",{className:"vjs-title-bar"},{},Object.values(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(r=>{const s=this.state[r],a=this.els[r],o=n[r];Ac(a),s&&fr(a,s),t&&(t.removeAttribute(o),s&&t.setAttribute(o,a.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}V.registerComponent("TitleBar",nk);const Gd=i=>{const e=i.el();if(e.hasAttribute("src"))return i.triggerSourceset(e.src),!0;const t=i.$$("source"),n=[];let r="";if(!t.length)return!1;for(let s=0;s<t.length;s++){const a=t[s].src;a&&n.indexOf(a)===-1&&n.push(a)}return n.length?(n.length===1&&(r=n[0]),i.triggerSourceset(r),!0):!1},rk=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(i){const e=W.createElement(this.nodeName.toLowerCase());e.innerHTML=i;const t=W.createDocumentFragment();for(;e.childNodes.length;)t.appendChild(e.childNodes[0]);return this.innerText="",D.Element.prototype.appendChild.call(this,t),this.innerHTML}}),JT=(i,e)=>{let t={};for(let n=0;n<i.length&&(t=Object.getOwnPropertyDescriptor(i[n],e),!(t&&t.set&&t.get));n++);return t.enumerable=!0,t.configurable=!0,t},sk=i=>JT([i.el(),D.HTMLMediaElement.prototype,D.Element.prototype,rk],"innerHTML"),G0=function(i){const e=i.el();if(e.resetSourceWatch_)return;const t={},n=sk(i),r=s=>(...a)=>{const o=s.apply(e,a);return Gd(i),o};["append","appendChild","insertAdjacentHTML"].forEach(s=>{e[s]&&(t[s]=e[s],e[s]=r(t[s]))}),Object.defineProperty(e,"innerHTML",Ke(n,{set:r(n.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(t).forEach(s=>{e[s]=t[s]}),Object.defineProperty(e,"innerHTML",n)},i.one("sourceset",e.resetSourceWatch_)},ak=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?wT(D.Element.prototype.getAttribute.call(this,"src")):""},set(i){return D.Element.prototype.setAttribute.call(this,"src",i),i}}),ok=i=>JT([i.el(),D.HTMLMediaElement.prototype,ak],"src"),uk=function(i){if(!i.featuresSourceset)return;const e=i.el();if(e.resetSourceset_)return;const t=ok(i),n=e.setAttribute,r=e.load;Object.defineProperty(e,"src",Ke(t,{set:s=>{const a=t.set.call(e,s);return i.triggerSourceset(e.src),a}})),e.setAttribute=(s,a)=>{const o=n.call(e,s,a);return/src/i.test(s)&&i.triggerSourceset(e.src),o},e.load=()=>{const s=r.call(e);return Gd(i)||(i.triggerSourceset(""),G0(i)),s},e.currentSrc?i.triggerSourceset(e.currentSrc):Gd(i)||G0(i),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=r,e.setAttribute=n,Object.defineProperty(e,"src",t),e.resetSourceWatch_&&e.resetSourceWatch_()}};class Z extends ye{constructor(e,t){super(e,t);const n=e.source;let r=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",n&&(this.el_.currentSrc!==n.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const s=this.el_.childNodes;let a=s.length;const o=[];for(;a--;){const u=s[a];u.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(u),this.remoteTextTracks().addTrack(u.track),this.textTracks().addTrack(u.track),!r&&!this.el_.hasAttribute("crossorigin")&&Pc(u.src)&&(r=!0)):o.push(u))}for(let u=0;u<o.length;u++)this.el_.removeChild(o[u])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&r&&Ie.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(Ro||Ec)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),Z.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){uk(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let s=0;s<e.length;s++){const a=e[s];a.kind==="metadata"&&t.push({track:a,storedMode:a.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const r=()=>{for(let s=0;s<t.length;s++){const a=t[s];a.track.mode==="disabled"&&a.track.mode!==a.storedMode&&(a.track.mode=a.storedMode)}e.removeEventListener("change",r)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",r),e.addEventListener("change",r)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",r)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(r=>{this.el()[`${n}Tracks`].removeEventListener(r,this[`${n}TracksListeners_`][r])}),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=ji[e],n=this.el()[t.getterName],r=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const s={change:o=>{const u={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(u),e==="text"&&this[ea.remoteText.getterName]().trigger(u)},addtrack(o){r.addTrack(o.track)},removetrack(o){r.removeTrack(o.track)}},a=function(){const o=[];for(let u=0;u<r.length;u++){let c=!1;for(let h=0;h<n.length;h++)if(n[h]===r[u]){c=!0;break}c||o.push(r[u])}for(;o.length;)r.removeTrack(o.shift())};this[t.getterName+"Listeners_"]=s,Object.keys(s).forEach(o=>{const u=s[o];n.addEventListener(o,u),this.on("dispose",c=>n.removeEventListener(o,u))}),this.on("loadstart",a),this.on("dispose",o=>this.off("loadstart",a))}proxyNativeTracks_(){ji.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const n=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(n,e),Z.disposeMediaElement(e),e=n}else{e=W.createElement("video");const n=this.options_.tag&&Qn(this.options_.tag),r=Ke({},n);(!Ro||this.options_.nativeControlsForTouch!==!0)&&delete r.controls,rT(e,Object.assign(r,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&Ys(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const r=t[n],s=this.options_[r];typeof s<"u"&&(s?Ys(e,r,r):Cc(e,r),e[r]=s)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let n=!1;const r=function(){n=!0};this.on("loadstart",r);const s=function(){n||this.trigger("loadstart")};this.on("loadedmetadata",s),this.ready(function(){this.off("loadstart",r),this.off("loadedmetadata",s),n||this.trigger("loadstart")});return}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(n){this.trigger(n)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&Sc?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){Ie(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&_n&&yn&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)on(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}reset(){Z.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=W.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)(e===t[n]||e===t[n].track)&&this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),D.performance&&(e.creationTime=D.performance.now()),e}}vc(Z,"TEST_VID",function(){if(!da())return;const i=W.createElement("video"),e=W.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",i.appendChild(e),i});Z.isSupported=function(){try{Z.TEST_VID.volume=.5}catch{return!1}return!!(Z.TEST_VID&&Z.TEST_VID.canPlayType)};Z.canPlayType=function(i){return Z.TEST_VID.canPlayType(i)};Z.canPlaySource=function(i,e){return Z.canPlayType(i.type)};Z.canControlVolume=function(){try{const i=Z.TEST_VID.volume;Z.TEST_VID.volume=i/2+.1;const e=i!==Z.TEST_VID.volume;return e&&fi?(D.setTimeout(()=>{Z&&Z.prototype&&(Z.prototype.featuresVolumeControl=i!==Z.TEST_VID.volume)}),!1):e}catch{return!1}};Z.canMuteVolume=function(){try{const i=Z.TEST_VID.muted;return Z.TEST_VID.muted=!i,Z.TEST_VID.muted?Ys(Z.TEST_VID,"muted","muted"):Cc(Z.TEST_VID,"muted","muted"),i!==Z.TEST_VID.muted}catch{return!1}};Z.canControlPlaybackRate=function(){if(_n&&yn&&Tc<58)return!1;try{const i=Z.TEST_VID.playbackRate;return Z.TEST_VID.playbackRate=i/2+.1,i!==Z.TEST_VID.playbackRate}catch{return!1}};Z.canOverrideAttributes=function(){try{const i=()=>{};Object.defineProperty(W.createElement("video"),"src",{get:i,set:i}),Object.defineProperty(W.createElement("audio"),"src",{get:i,set:i}),Object.defineProperty(W.createElement("video"),"innerHTML",{get:i,set:i}),Object.defineProperty(W.createElement("audio"),"innerHTML",{get:i,set:i})}catch{return!1}return!0};Z.supportsNativeTextTracks=function(){return Sc||fi&&yn};Z.supportsNativeVideoTracks=function(){return!!(Z.TEST_VID&&Z.TEST_VID.videoTracks)};Z.supportsNativeAudioTracks=function(){return!!(Z.TEST_VID&&Z.TEST_VID.audioTracks)};Z.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([i,e]){vc(Z.prototype,i,()=>Z[e](),!0)});Z.prototype.featuresVolumeControl=Z.canControlVolume();Z.prototype.movingMediaElementInDOM=!fi;Z.prototype.featuresFullscreenResize=!0;Z.prototype.featuresProgressEvents=!0;Z.prototype.featuresTimeupdateEvents=!0;Z.prototype.featuresVideoFrameCallback=!!(Z.TEST_VID&&Z.TEST_VID.requestVideoFrameCallback);Z.disposeMediaElement=function(i){if(i){for(i.parentNode&&i.parentNode.removeChild(i);i.hasChildNodes();)i.removeChild(i.firstChild);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()}};Z.resetMediaElement=function(i){if(!i)return;const e=i.querySelectorAll("source");let t=e.length;for(;t--;)i.removeChild(e[t]);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(i){Z.prototype[i]=function(){return this.el_[i]||this.el_.hasAttribute(i)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(i){Z.prototype["set"+ot(i)]=function(e){this.el_[i]=e,e?this.el_.setAttribute(i,i):this.el_.removeAttribute(i)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(i){Z.prototype[i]=function(){return this.el_[i]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(i){Z.prototype["set"+ot(i)]=function(e){this.el_[i]=e}});["pause","load","play"].forEach(function(i){Z.prototype[i]=function(){return this.el_[i]()}});ye.withSourceHandlers(Z);Z.nativeSourceHandler={};Z.nativeSourceHandler.canPlayType=function(i){try{return Z.TEST_VID.canPlayType(i)}catch{return""}};Z.nativeSourceHandler.canHandleSource=function(i,e){if(i.type)return Z.nativeSourceHandler.canPlayType(i.type);if(i.src){const t=vp(i.src);return Z.nativeSourceHandler.canPlayType(`video/${t}`)}return""};Z.nativeSourceHandler.handleSource=function(i,e,t){e.setSrc(i.src)};Z.nativeSourceHandler.dispose=function(){};Z.registerSourceHandler(Z.nativeSourceHandler);ye.registerTech("Html5",Z);const ZT=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],ed={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},zd=["tiny","xsmall","small","medium","large","xlarge","huge"],dl={};zd.forEach(i=>{const e=i.charAt(0)==="x"?`x-${i.substring(1)}`:i;dl[i]=`vjs-layout-${e}`});const lk={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};let bt=class ys extends V{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${vn()}`,t=Object.assign(ys.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const a=e.closest("[lang]");a&&(t.language=a.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=a=>this.documentFullscreenChange_(a),this.boundFullWindowOnEscKey_=a=>this.fullWindowOnEscKey(a),this.boundUpdateStyleEl_=a=>this.updateStyleEl_(a),this.boundApplyInitTime_=a=>this.applyInitTime_(a),this.boundUpdateCurrentBreakpoint_=a=>this.updateCurrentBreakpoint_(a),this.boundHandleTechClick_=a=>this.handleTechClick_(a),this.boundHandleTechDoubleClick_=a=>this.handleTechDoubleClick_(a),this.boundHandleTechTouchStart_=a=>this.handleTechTouchStart_(a),this.boundHandleTechTouchMove_=a=>this.handleTechTouchMove_(a),this.boundHandleTechTouchEnd_=a=>this.handleTechTouchEnd_(a),this.boundHandleTechTap_=a=>this.handleTechTap_(a),this.isFullscreen_=!1,this.log=Kv(this.id_),this.fsApi_=Rl,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&Qn(e),this.language(this.options_.language),t.languages){const a={};Object.getOwnPropertyNames(t.languages).forEach(function(o){a[o.toLowerCase()]=t.languages[o]}),this.languages_=a}else this.languages_=ys.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(a=>{if(typeof this[a]!="function")throw new Error(`plugin "${a}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),mp(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(Ii(W,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=Ke(this.options_);t.plugins&&Object.keys(t.plugins).forEach(a=>{this[a](t.plugins[a])}),t.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(t.playbackRates),this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),Ro&&this.addClass("vjs-touch-enabled"),fi||this.addClass("vjs-workinghover"),ys.players[this.id_]=this;const s=Gv.split(".")[0];this.addClass(`vjs-v${s}`),this.userActive(!0),this.reportUserActivity(),this.one("play",a=>this.listenForUserActivity_(a)),this.on("keydown",a=>this.handleKeyDown(a)),this.on("languagechange",a=>this.handleLanguagechange(a)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),Wt(W,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Wt(W,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),ys.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),kI(this),ai.names.forEach(e=>{const t=ai[e],n=this[t.getterName]();n&&n.off&&n.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,t,n=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const r=this.tag.tagName.toLowerCase()==="video-js";n?t=this.el_=e.parentNode:r||(t=this.el_=super.createEl("div"));const s=Qn(e);if(r){for(t=this.el_=e,e=this.tag=W.createElement("video");t.children.length;)e.appendChild(t.firstChild);fo(t,"video-js")||Nr(t,"video-js"),t.appendChild(e),n=this.playerElIngest_=t,Object.keys(t).forEach(o=>{try{e[o]=t[o]}catch{}})}if(e.setAttribute("tabindex","-1"),s.tabindex="-1",yn&&bc&&(e.setAttribute("role","application"),s.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(o){r&&o==="class"||t.setAttribute(o,s[o]),r&&e.setAttribute(o,s[o])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused"),D.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=pT("vjs-styles-dimensions");const o=ar(".vjs-styles-defaults"),u=ar("head");u.insertBefore(this.styleEl_,o?o.nextSibling:u.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const a=e.getElementsByTagName("a");for(let o=0;o<a.length;o++){const u=a.item(o);Nr(u,"vjs-hidden"),u.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!n&&e.parentNode.insertBefore(t,e),Fd(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){Ie.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(t===void 0)return this[n]||0;if(t===""||t==="auto"){this[n]=void 0,this.updateStyleEl_();return}const r=parseFloat(t);if(isNaN(r)){Ie.error(`Improper value "${t}" supplied for for ${e}`);return}this[n]=r,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,Rn(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),aI(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(D.VIDEOJS_NO_DYNAMIC_STYLE===!0){const o=typeof this.width_=="number"?this.width_:this.options_.width,u=typeof this.height_=="number"?this.height_:this.options_.height,c=this.tech_&&this.tech_.el();c&&(o>=0&&(c.width=o),u>=0&&(c.height=u));return}let e,t,n,r;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?n=this.aspectRatio_:this.videoWidth()>0?n=this.videoWidth()+":"+this.videoHeight():n="16:9";const s=n.split(":"),a=s[1]/s[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/a:e=this.videoWidth()||300,this.height_!==void 0?t=this.height_:t=e*a,/^[^a-zA-Z]/.test(this.id())?r="dimensions-"+this.id():r=this.id()+"-dimensions",this.addClass(r),mT(this.styleEl_,`
      .${r} {
        width: ${e}px;
        height: ${t}px;
      }

      .${r}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${a*100}%;
      }
    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=ot(e),r=e.charAt(0).toLowerCase()+e.slice(1);n!=="Html5"&&this.tag&&(ye.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let s=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(s=!1);const a={source:t,autoplay:s,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${r}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};ai.names.forEach(u=>{const c=ai[u];a[c.getterName]=this[c.privateName]}),Object.assign(a,this.options_[n]),Object.assign(a,this.options_[r]),Object.assign(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);const o=ye.getTech(e);if(!o)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new o(a),this.tech_.ready(Xe(this,this.handleTechReady_),!0),A0.jsonToTextTracks(this.textTracksJson_||[],this.tech_),ZT.forEach(u=>{this.on(this.tech_,u,c=>this[`handleTech${ot(u)}_`](c))}),Object.keys(ed).forEach(u=>{this.on(this.tech_,u,c=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${ed[u]}_`].bind(this),event:c});return}this[`handleTech${ed[u]}_`](c)})}),this.on(this.tech_,"loadstart",u=>this.handleTechLoadStart_(u)),this.on(this.tech_,"sourceset",u=>this.handleTechSourceset_(u)),this.on(this.tech_,"waiting",u=>this.handleTechWaiting_(u)),this.on(this.tech_,"ended",u=>this.handleTechEnded_(u)),this.on(this.tech_,"seeking",u=>this.handleTechSeeking_(u)),this.on(this.tech_,"play",u=>this.handleTechPlay_(u)),this.on(this.tech_,"pause",u=>this.handleTechPause_(u)),this.on(this.tech_,"durationchange",u=>this.handleTechDurationChange_(u)),this.on(this.tech_,"fullscreenchange",(u,c)=>this.handleTechFullscreenChange_(u,c)),this.on(this.tech_,"fullscreenerror",(u,c)=>this.handleTechFullscreenError_(u,c)),this.on(this.tech_,"enterpictureinpicture",u=>this.handleTechEnterPictureInPicture_(u)),this.on(this.tech_,"leavepictureinpicture",u=>this.handleTechLeavePictureInPicture_(u)),this.on(this.tech_,"error",u=>this.handleTechError_(u)),this.on(this.tech_,"posterchange",u=>this.handleTechPosterChange_(u)),this.on(this.tech_,"textdata",u=>this.handleTechTextData_(u)),this.on(this.tech_,"ratechange",u=>this.handleTechRateChange_(u)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(n!=="Html5"||!this.tag)&&Fd(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){ai.names.forEach(e=>{const t=ai[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=A0.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&Ie.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const t=()=>{const r=this.muted();this.muted(!0);const s=()=>{this.muted(r)};this.playTerminatedQueue_.push(s);const a=this.play();if(mo(a))return a.catch(o=>{throw s(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${o||""}`)})};let n;if(e==="any"&&!this.muted()?(n=this.play(),mo(n)&&(n=n.catch(t))):e==="muted"&&!this.muted()?n=t():n=this.play(),!!mo(n))return n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let t=e,n="";typeof t!="string"&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=OI(this,t)),this.cache_.source=Ke({},e,{src:t,type:n});const r=this.cache_.sources.filter(u=>u.src&&u.src===t),s=[],a=this.$$("source"),o=[];for(let u=0;u<a.length;u++){const c=Qn(a[u]);s.push(c),c.src&&c.src===t&&o.push(c.src)}o.length&&!r.length?this.cache_.sources=s:r.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=s=>this.updateSourceCaches_(s);const n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(t=()=>{}),t(r),e.src||this.tech_.any(["sourceset","loadstart"],s=>{if(s.type==="sourceset")return;const a=this.techGet("currentSrc");this.lastSource_.tech=a,this.updateSourceCaches_(a)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?on(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),n=>n.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let r=W[this.fsApi_.fullscreenElement]===n;!r&&n.matches?r=n.matches(":"+this.fsApi_.fullscreen):!r&&n.msMatchesSelector&&(r=n.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in DI)return wI(this.middleware_,this.tech_,e,t);if(e in R0)return P0(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(n){throw Ie(n),n}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in AI)return CI(this.middleware_,this.tech_,e);if(e in R0)return P0(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw this.tech_[e]===void 0?(Ie(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t):t.name==="TypeError"?(Ie(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t):(Ie(t),t)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=on){this.playCallbacks_.push(e);const t=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),n=!!(Sc||fi);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t){this.waitToPlay_=a=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!t&&n&&this.load();return}const r=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),r===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(r)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(n){n(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||mn(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(typeof e<"u"){if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0;return}return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=mn(0,0)),e}bufferedPercent(){return xT(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;if(e!==void 0){t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),t>0&&this.lastVolume_(t);return}return t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const t=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,r)=>{function s(){t.off("fullscreenerror",o),t.off("fullscreenchange",a)}function a(){s(),n()}function o(c,h){s(),r(h)}t.one("fullscreenchange",a),t.one("fullscreenerror",o);const u=t.requestFullscreenHelper_(e);u&&(u.then(s,s),u.then(n,r))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(t=e)),this.fsApi_.requestFullscreen){const n=this.el_[this.fsApi_.requestFullscreen](t);return n&&n.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),n}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function r(){e.off("fullscreenerror",a),e.off("fullscreenchange",s)}function s(){r(),t()}function a(u,c){r(),n(c)}e.one("fullscreenchange",s),e.one("fullscreenerror",a);const o=e.exitFullscreenHelper_();o&&(o.then(r,r),o.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=W[this.fsApi_.exitFullscreen]();return e&&on(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=W.documentElement.style.overflow,Ii(W,"keydown",this.boundFullWindowOnEscKey_),W.documentElement.style.overflow="hidden",Nr(W.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){me.isEventKey(e,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,Wt(W,"keydown",this.boundFullWindowOnEscKey_),W.documentElement.style.overflow=this.docOrigOverflow,xc(W.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&D.documentPictureInPicture){const e=W.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(Ce("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),D.documentPictureInPicture.requestWindow({initialAspectRatio:this.videoWidth()/this.videoHeight(),copyStyleSheets:!0}).then(t=>(this.el_.parentNode.insertBefore(e,this.el_),t.document.body.append(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger("enterpictureinpicture"),t.addEventListener("unload",n=>{const r=n.target.querySelector(".video-js");e.replaceWith(r),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in W&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if(D.documentPictureInPicture&&D.documentPictureInPicture.window)return D.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in W)return W.exitPictureInPicture()}handleKeyDown(e){const{userActions:t}=this.options_;!t||!t.hotkeys||(r=>{const s=r.tagName.toLowerCase();if(r.isContentEditable)return!0;const a=["button","checkbox","hidden","radio","reset","submit"];return s==="input"?a.indexOf(r.type)===-1:["textarea"].indexOf(s)!==-1})(this.el_.ownerDocument.activeElement)||(typeof t.hotkeys=="function"?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=a=>me.isEventKey(a,"f"),muteKey:r=a=>me.isEventKey(a,"m"),playPauseKey:s=a=>me.isEventKey(a,"k")||me.isEventKey(a,"Space")}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const a=V.getComponent("FullscreenToggle");W[this.fsApi_.fullscreenEnabled]!==!1&&a.prototype.handleClick.call(this,e)}else r.call(this,e)?(e.preventDefault(),e.stopPropagation(),V.getComponent("MuteToggle").prototype.handleClick.call(this,e)):s.call(this,e)&&(e.preventDefault(),e.stopPropagation(),V.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let n=0,r=this.options_.techOrder;n<r.length;n++){const s=r[n];let a=ye.getTech(s);if(a||(a=V.getComponent(s)),!a){Ie.error(`The "${s}" tech is undefined. Skipped browser support check for that tech.`);continue}if(a.isSupported()&&(t=a.canPlayType(e),t))return t}return""}selectSource(e){const t=this.options_.techOrder.map(o=>[o,ye.getTech(o)]).filter(([o,u])=>u?u.isSupported():(Ie.error(`The "${o}" tech is undefined. Skipped browser support check for that tech.`),!1)),n=function(o,u,c){let h;return o.some(g=>u.some(y=>{if(h=c(g,y),h)return!0})),h};let r;const s=o=>(u,c)=>o(c,u),a=([o,u],c)=>{if(u.canPlaySource(c,this.options_[o.toLowerCase()]))return{source:c,tech:o}};return this.options_.sourceOrder?r=n(e,t,s(a)):r=n(t,e,a),r||!1}handleSrc_(e,t){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=IT(e);if(!n.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),SI(this,n[0],(r,s)=>{if(this.middleware_=s,t||(this.cache_.sources=n),this.updateSourceCaches_(r),this.src_(r)){if(n.length>1)return this.handleSrc_(n.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}xI(s,this.tech_)}),n.length>1){const r=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},s=()=>{this.off("error",r)};this.one("error",r),this.one("playing",s),this.resetRetryOnError_=()=>{this.off("error",r),this.off("playing",s)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return t?TT(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}load(){this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();on(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Rn(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:r}=this.controlBar||{},{seekBar:s}=n||{};e&&e.updateContent(),t&&t.updateContent(),r&&r.updateContent(),s&&(s.update(),s.loadProgressBar&&s.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return Object.keys(e).length!==0&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let t;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),t=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return e!==void 0?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(sr("beforeerror").forEach(t=>{const n=t(this,e);if(!(gn(n)&&!Array.isArray(n)||typeof n=="string"||typeof n=="number"||n===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=n}),this.options_.suppressNotSupportedError&&e&&e.code===4){const t=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),this.one("loadstart",function(){this.off(["click","touchstart"],t)});return}if(e===null){this.error_=e,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new li(e),this.addClass("vjs-error"),Ie.error(`(CODE:${this.error_.code} ${li.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),sr("error").forEach(t=>t(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const r=Xe(this,this.reportUserActivity),s=function(h){(h.screenX!==t||h.screenY!==n)&&(t=h.screenX,n=h.screenY,r())},a=function(){r(),this.clearInterval(e),e=this.setInterval(r,250)},o=function(h){r(),this.clearInterval(e)};this.on("mousedown",a),this.on("mousemove",s),this.on("mouseup",o),this.on("mouseleave",o);const u=this.getChild("controlBar");u&&!fi&&!_n&&(u.on("mouseenter",function(h){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),u.on("mouseleave",function(h){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",r),this.on("keyup",r);let c;this.setInterval(function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(c);const h=this.options_.inactivityTimeout;h<=0||(c=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},h))},250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(r=>{r!==t&&r.el_&&!r.hasClass("vjs-hidden")&&(r.hide(),this.audioOnlyCache_.hiddenChildren.push(r))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const t=[];return this.isInPictureInPicture()&&t.push(this.exitPictureInPicture()),this.isFullscreen()&&t.push(this.exitFullscreen()),this.audioPosterMode()&&t.push(this.audioPosterMode(!1)),Promise.all(t).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Rn(this)&&this.trigger("languagechange"))}languages(){return Ke(ys.prototype.options_.languages,this.languages_)}toJSON(){const e=Ke(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let r=t[n];r=Ke(r),r.player=void 0,e.tracks[n]=r}return e}createModal(e,t){t=t||{},t.content=e||"";const n=new ma(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<zd.length;n++){const r=zd[n],s=this.breakpoints_[r];if(t<=s){if(e===r)return;e&&this.removeClass(dl[e]),this.addClass(dl[r]),this.breakpoint_=r;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},lk,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=!!e;const t=this.responsive_;if(e!==t)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return dl[this.breakpoint_]||""}loadMedia(e,t){if(!e||typeof e!="object")return;this.reset(),this.cache_.media=Ke(e);const{artist:n,artwork:r,description:s,poster:a,src:o,textTracks:u,title:c}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:Bl(a)}]),o&&this.src(o),a&&this.poster(a),Array.isArray(u)&&u.forEach(h=>this.addRemoteTextTrack(h,!1)),this.titleBar&&this.titleBar.update({title:c,description:s||n||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),n=Array.prototype.map.call(this.remoteTextTracks(),s=>({kind:s.kind,label:s.label,language:s.language,src:s.src})),r={src:t,textTracks:n};return e&&(r.poster=e,r.artwork=[{src:r.poster,type:Bl(r.poster)}]),r}return Ke(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=Qn(e),r=n["data-setup"];if(fo(e,"vjs-fill")&&(n.fill=!0),fo(e,"vjs-fluid")&&(n.fluid=!0),r!==null){const[s,a]=zC(r||"{}");s&&Ie.error(s),Object.assign(n,a)}if(Object.assign(t,n),e.hasChildNodes()){const s=e.childNodes;for(let a=0,o=s.length;a<o;a++){const u=s[a],c=u.nodeName.toLowerCase();c==="source"?t.sources.push(Qn(u)):c==="track"&&t.tracks.push(Qn(u))}}return t}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(t=>typeof t=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}};ai.names.forEach(function(i){const e=ai[i];bt.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}});bt.prototype.crossorigin=bt.prototype.crossOrigin;bt.players={};const Ya=D.navigator;bt.prototype.options_={techOrder:ye.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Ya&&(Ya.languages&&Ya.languages[0]||Ya.userLanguage||Ya.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1};["ended","seeking","seekable","networkState","readyState"].forEach(function(i){bt.prototype[i]=function(){return this.techGet_(i)}});ZT.forEach(function(i){bt.prototype[`handleTech${ot(i)}_`]=function(){return this.trigger(i)}});V.registerComponent("Player",bt);const Vl="plugin",Ps="activePlugins_",Es={},jl=i=>Es.hasOwnProperty(i),fl=i=>jl(i)?Es[i]:void 0,eb=(i,e)=>{i[Ps]=i[Ps]||{},i[Ps][e]=!0},$l=(i,e,t)=>{const n=(t?"before":"")+"pluginsetup";i.trigger(n,e),i.trigger(n+":"+e.name,e)},ck=function(i,e){const t=function(){$l(this,{name:i,plugin:e,instance:null},!0);const n=e.apply(this,arguments);return eb(this,i),$l(this,{name:i,plugin:e,instance:n}),n};return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},z0=(i,e)=>(e.prototype.name=i,function(...t){$l(this,{name:i,plugin:e,instance:null},!0);const n=new e(this,...t);return this[i]=()=>n,$l(this,n.getEventHash()),n});class vi{constructor(e){if(this.constructor===vi)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),mp(this),delete this.trigger,vT(this,this.constructor.defaultState),eb(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return pa(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[Ps][e]=!1,this.player=this.state=null,t[e]=z0(e,Es[e])}static isBasic(e){const t=typeof e=="string"?fl(e):e;return typeof t=="function"&&!vi.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(jl(e))Ie.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(bt.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof t!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return Es[e]=t,e!==Vl&&(vi.isBasic(t)?bt.prototype[e]=ck(e,t):bt.prototype[e]=z0(e,t)),t}static deregisterPlugin(e){if(e===Vl)throw new Error("Cannot de-register base plugin.");jl(e)&&(delete Es[e],delete bt.prototype[e])}static getPlugins(e=Object.keys(Es)){let t;return e.forEach(n=>{const r=fl(n);r&&(t=t||{},t[n]=r)}),t}static getPluginVersion(e){const t=fl(e);return t&&t.VERSION||""}}vi.getPlugin=fl;vi.BASE_PLUGIN_NAME=Vl;vi.registerPlugin(Vl,vi);bt.prototype.usingPlugin=function(i){return!!this[Ps]&&this[Ps][i]===!0};bt.prototype.hasPlugin=function(i){return!!jl(i)};function hk(i,e){let t=!1;return function(...n){return t||Ie.warn(i),t=!0,e.apply(this,n)}}function Qi(i,e,t,n){return hk(`${e} is deprecated and will be removed in ${i}.0; please use ${t} instead.`,n)}const tb=i=>i.indexOf("#")===0?i.slice(1):i;function F(i,e,t){let n=F.getPlayer(i);if(n)return e&&Ie.warn(`Player "${i}" is already initialised. Options will not be applied.`),t&&n.ready(t),n;const r=typeof i=="string"?ar("#"+tb(i)):i;if(!fa(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!r.ownerDocument.defaultView||!r.ownerDocument.body.contains(r))&&Ie.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(r.parentNode&&r.parentNode.hasAttribute("data-vjs-player")?r.parentNode:r).cloneNode(!0)),sr("beforesetup").forEach(a=>{const o=a(r,Ke(e));if(!gn(o)||Array.isArray(o)){Ie.error("please return an object in beforesetup hooks");return}e=Ke(e,o)});const s=V.getComponent("Player");return n=new s(r,e,t),sr("setup").forEach(a=>a(n)),n}F.hooks_=An;F.hooks=sr;F.hook=zD;F.hookOnce=WD;F.removeHook=zv;if(D.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&da()){let i=ar(".vjs-styles-defaults");if(!i){i=pT("vjs-styles-defaults");const e=ar("head");e&&e.insertBefore(i,e.firstChild),mT(i,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}Ud(1,F);F.VERSION=Gv;F.options=bt.prototype.options_;F.getPlayers=()=>bt.players;F.getPlayer=i=>{const e=bt.players;let t;if(typeof i=="string"){const n=tb(i),r=e[n];if(r)return r;t=ar("#"+n)}else t=i;if(fa(t)){const{player:n,playerId:r}=t;if(n||e[r])return n||e[r]}};F.getAllPlayers=()=>Object.keys(bt.players).map(i=>bt.players[i]).filter(Boolean);F.players=bt.players;F.getComponent=V.getComponent;F.registerComponent=(i,e)=>{ye.isTech(e)&&Ie.warn(`The ${i} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),V.registerComponent.call(V,i,e)};F.getTech=ye.getTech;F.registerTech=ye.registerTech;F.use=EI;Object.defineProperty(F,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(F.middleware,"TERMINATOR",{value:Fl,writeable:!1,enumerable:!0});F.browser=QD;F.obj=YD;F.mergeOptions=Qi(9,"videojs.mergeOptions","videojs.obj.merge",Ke);F.defineLazyProperty=Qi(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",vc);F.bind=Qi(9,"videojs.bind","native Function.prototype.bind",Xe);F.registerPlugin=vi.registerPlugin;F.deregisterPlugin=vi.deregisterPlugin;F.plugin=(i,e)=>(Ie.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),vi.registerPlugin(i,e));F.getPlugins=vi.getPlugins;F.getPlugin=vi.getPlugin;F.getPluginVersion=vi.getPluginVersion;F.addLanguage=function(i,e){return i=(""+i).toLowerCase(),F.options.languages=Ke(F.options.languages,{[i]:e}),F.options.languages[i]};F.log=Ie;F.createLogger=Kv;F.time=hI;F.createTimeRange=Qi(9,"videojs.createTimeRange","videojs.time.createTimeRanges",mn);F.createTimeRanges=Qi(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",mn);F.formatTime=Qi(9,"videojs.formatTime","videojs.time.formatTime",jr);F.setFormatTime=Qi(9,"videojs.setFormatTime","videojs.time.setFormatTime",ET);F.resetFormatTime=Qi(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",ST);F.parseUrl=Qi(9,"videojs.parseUrl","videojs.url.parseUrl",yp);F.isCrossOrigin=Qi(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Pc);F.EventTarget=qi;F.any=pp;F.on=Ii;F.one=Ic;F.off=Wt;F.trigger=pa;F.xhr=Xy;F.TextTrack=iu;F.AudioTrack=AT;F.VideoTrack=DT;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(i=>{F[i]=function(){return Ie.warn(`videojs.${i}() is deprecated; use videojs.dom.${i}() instead`),dT[i].apply(null,arguments)}});F.computedStyle=Qi(9,"videojs.computedStyle","videojs.dom.computedStyle",Js);F.dom=dT;F.fn=sI;F.num=jI;F.str=lI;F.url=TI;/*! @name videojs-contrib-quality-levels @version 3.0.0 @license Apache-2.0 */class dk{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get(){return t.enabled_()},set(n){t.enabled_(n)}}),t}}class ql extends F.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new dk(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const r=this[t];if(r.id===e)return r}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}ql.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const i in ql.prototype.allowedEvents_)ql.prototype["on"+i]=null;var ib="3.0.0";const fk=F.registerPlugin||F.plugin,pk=function(i,e){const t=i.qualityLevels,n=new ql,r=function(){n.dispose(),i.qualityLevels=t,i.off("dispose",r)};return i.on("dispose",r),i.qualityLevels=()=>n,i.qualityLevels.VERSION=ib,n},nb=function(i){return pk(this,F.mergeOptions({},i))};fk("qualityLevels",nb);nb.VERSION=ib;/*! @name @videojs/http-streaming @version 3.0.2 @license Apache-2.0 */const Wi=Mw,Hl=(i,e)=>e&&e.responseURL&&i!==e.responseURL?e.responseURL:i,Ji=i=>F.log.debug?F.log.debug.bind(F,"VHS:",`${i} >`):function(){};function Ye(...i){const e=F.obj||F;return(e.merge||e.mergeOptions).apply(e,i)}function zt(...i){const e=F.time||F;return(e.createTimeRanges||e.createTimeRanges).apply(e,i)}const or=1/30,un=or*3,rb=function(i,e){const t=[];let n;if(i&&i.length)for(n=0;n<i.length;n++)e(i.start(n),i.end(n))&&t.push([i.start(n),i.end(n)]);return zt(t)},Ss=function(i,e){return rb(i,function(t,n){return t-un<=e&&n+un>=e})},Ku=function(i,e){return rb(i,function(t){return t-or>=e})},mk=function(i){if(i.length<2)return zt();const e=[];for(let t=1;t<i.length;t++){const n=i.end(t-1),r=i.start(t);e.push([n,r])}return zt(e)},gk=function(i,e){let t=null,n=null,r=0;const s=[],a=[];if(!i||!i.length||!e||!e.length)return zt();let o=i.length;for(;o--;)s.push({time:i.start(o),type:"start"}),s.push({time:i.end(o),type:"end"});for(o=e.length;o--;)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});for(s.sort(function(u,c){return u.time-c.time}),o=0;o<s.length;o++)s[o].type==="start"?(r++,r===2&&(t=s[o].time)):s[o].type==="end"&&(r--,r===1&&(n=s[o].time)),t!==null&&n!==null&&(a.push([t,n]),t=null,n=null);return zt(a)},sb=i=>{const e=[];if(!i||!i.length)return"";for(let t=0;t<i.length;t++)e.push(i.start(t)+" => "+i.end(t));return e.join(", ")},_k=function(i,e,t=1){return((i.length?i.end(i.length-1):0)-e)/t},kr=i=>{const e=[];for(let t=0;t<i.length;t++)e.push({start:i.start(t),end:i.end(t)});return e},yk=function(i,e){if(i===e)return!1;if(!i&&e||!e&&i||i.length!==e.length)return!0;for(let t=0;t<i.length;t++)if(i.start(t)!==e.start(t)||i.end(t)!==e.end(t))return!0;return!1},W0=function(i){if(!(!i||!i.length||!i.end))return i.end(i.length-1)},Mp=function(i,e){let t=0;if(!i||!i.length)return t;for(let n=0;n<i.length;n++){const r=i.start(n),s=i.end(n);if(!(e>s)){if(e>r&&e<=s){t+=s-e;continue}t+=s-r}}return t},Fp=(i,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(n){t+=n.duration}),(e.preloadHints||[]).forEach(function(n){n.type==="PART"&&(t+=i.partTargetDuration)}),t},Wd=i=>(i.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(r,s){e.push({duration:r.duration,segmentIndex:n,partIndex:s,part:r,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),ab=i=>{const e=i.segments&&i.segments.length&&i.segments[i.segments.length-1];return e&&e.parts||[]},ob=({preloadSegment:i})=>{if(!i)return;const{parts:e,preloadHints:t}=i;let n=(t||[]).reduce((r,s)=>r+(s.type==="PART"?1:0),0);return n+=e&&e.length?e.length:0,n},ub=(i,e)=>{if(e.endList)return 0;if(i&&i.suggestedPresentationDelay)return i.suggestedPresentationDelay;const t=ab(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},vk=function(i,e){let t=0,n=e-i.mediaSequence,r=i.segments[n];if(r){if(typeof r.start<"u")return{result:r.start,precise:!0};if(typeof r.end<"u")return{result:r.end-r.duration,precise:!0}}for(;n--;){if(r=i.segments[n],typeof r.end<"u")return{result:t+r.end,precise:!0};if(t+=Fp(i,r),typeof r.start<"u")return{result:t+r.start,precise:!0}}return{result:t,precise:!1}},Tk=function(i,e){let t=0,n,r=e-i.mediaSequence;for(;r<i.segments.length;r++){if(n=i.segments[r],typeof n.start<"u")return{result:n.start-t,precise:!0};if(t+=Fp(i,n),typeof n.end<"u")return{result:n.end-t,precise:!0}}return{result:-1,precise:!1}},lb=function(i,e,t){if(typeof e>"u"&&(e=i.mediaSequence+i.segments.length),e<i.mediaSequence)return 0;const n=vk(i,e);if(n.precise)return n.result;const r=Tk(i,e);return r.precise?r.result:n.result+t},cb=function(i,e,t){if(!i)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(i.totalDuration)return i.totalDuration;if(!i.endList)return D.Infinity}return lb(i,e,t)},go=function({defaultDuration:i,durationList:e,startIndex:t,endIndex:n}){let r=0;if(t>n&&([t,n]=[n,t]),t<0){for(let s=t;s<Math.min(0,n);s++)r+=i;t=0}for(let s=t;s<n;s++)r+=e[s].duration;return r},hb=function(i,e,t,n){if(!i||!i.segments)return null;if(i.endList)return cb(i);if(e===null)return null;e=e||0;let r=lb(i,i.mediaSequence+i.segments.length,e);return t&&(n=typeof n=="number"?n:ub(null,i),r-=n),Math.max(0,r)},bk=function(i,e,t){const r=e||0,s=hb(i,e,!0,t);return s===null?zt():zt(r,s)},Ek=function({playlist:i,currentTime:e,startingSegmentIndex:t,startingPartIndex:n,startTime:r,exactManifestTimings:s}){let a=e-r;const o=Wd(i);let u=0;for(let c=0;c<o.length;c++){const h=o[c];if(t===h.segmentIndex&&!(typeof n=="number"&&typeof h.partIndex=="number"&&n!==h.partIndex)){u=c;break}}if(a<0){if(u>0)for(let c=u-1;c>=0;c--){const h=o[c];if(a+=h.duration,s){if(a<0)continue}else if(a+or<=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:r-go({defaultDuration:i.targetDuration,durationList:o,startIndex:u,endIndex:c})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e}}if(u<0){for(let c=u;c<0;c++)if(a-=i.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e};u=0}for(let c=u;c<o.length;c++){const h=o[c];if(a-=h.duration,s){if(a>0)continue}else if(a-or>=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:r+go({defaultDuration:i.targetDuration,durationList:o,startIndex:u,endIndex:c})}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:e}},db=function(i){return i.excludeUntil&&i.excludeUntil>Date.now()},Bp=function(i){return i.excludeUntil&&i.excludeUntil===1/0},Lc=function(i){const e=db(i);return!i.disabled&&!e},Sk=function(i){return i.disabled},xk=function(i){for(let e=0;e<i.segments.length;e++)if(i.segments[e].key)return!0;return!1},fb=function(i,e){return e.attributes&&e.attributes[i]},Ck=function(i,e,t,n=0){return fb("BANDWIDTH",t)?(i*t.attributes.BANDWIDTH-n*8)/e:NaN},Kd=(i,e)=>{if(i.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return i.playlists.filter(n=>Lc(n)?(n.attributes.BANDWIDTH||0)<t:!1).length===0},Up=(i,e)=>!i&&!e||!i&&e||i&&!e?!1:!!(i===e||i.id&&e.id&&i.id===e.id||i.resolvedUri&&e.resolvedUri&&i.resolvedUri===e.resolvedUri||i.uri&&e.uri&&i.uri===e.uri),K0=function(i,e){const t=i&&i.mediaGroups&&i.mediaGroups.AUDIO||{};let n=!1;for(const r in t){for(const s in t[r])if(n=e(t[r][s]),n)break;if(n)break}return!!n},au=i=>{if(!i||!i.playlists||!i.playlists.length)return K0(i,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<i.playlists.length;e++){const t=i.playlists[e],n=t.attributes&&t.attributes.CODECS;if(!(n&&n.split(",").every(s=>tv(s))||K0(i,s=>Up(t,s))))return!1}return!0};var yi={liveEdgeDelay:ub,duration:cb,seekable:bk,getMediaInfoForTime:Ek,isEnabled:Lc,isDisabled:Sk,isExcluded:db,isIncompatible:Bp,playlistEnd:hb,isAes:xk,hasAttribute:fb,estimateSegmentRequestTime:Ck,isLowestEnabledRendition:Kd,isAudioOnly:au,playlistMatch:Up,segmentDurationWithParts:Fp};const{log:pb}=F,Vp=(i,e)=>`${i}-${e}`,wk=(i,e,t)=>`placeholder-uri-${i}-${e}-${t}`,Ak=({onwarn:i,oninfo:e,manifestString:t,customTagParsers:n=[],customTagMappers:r=[],llhls:s})=>{const a=new Hw;i&&a.on("warn",i),e&&a.on("info",e),n.forEach(c=>a.addParser(c)),r.forEach(c=>a.addTagMapper(c)),a.push(t),a.end();const o=a.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(c){o.hasOwnProperty(c)&&delete o[c]}),o.segments&&o.segments.forEach(function(c){["parts","preloadHints"].forEach(function(h){c.hasOwnProperty(h)&&delete c[h]})})),!o.targetDuration){let c=10;o.segments&&o.segments.length&&(c=o.segments.reduce((h,g)=>Math.max(h,g.duration),0)),i&&i(`manifest has no targetDuration defaulting to ${c}`),o.targetDuration=c}const u=ab(o);if(u.length&&!o.partTargetDuration){const c=u.reduce((h,g)=>Math.max(h,g.duration),0);i&&(i(`manifest has no partTargetDuration defaulting to ${c}`),pb.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=c}return o},ya=(i,e)=>{i.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(i.mediaGroups[t])for(const n in i.mediaGroups[t])for(const r in i.mediaGroups[t][n]){const s=i.mediaGroups[t][n][r];e(s,t,n,r)}})},mb=({playlist:i,uri:e,id:t})=>{i.id=t,i.playlistErrors_=0,e&&(i.uri=e),i.attributes=i.attributes||{}},Dk=i=>{let e=i.playlists.length;for(;e--;){const t=i.playlists[e];mb({playlist:t,id:Vp(e,t.uri)}),t.resolvedUri=Wi(i.uri,t.uri),i.playlists[t.id]=t,i.playlists[t.uri]=t,t.attributes.BANDWIDTH||pb.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},Ik=i=>{ya(i,e=>{e.uri&&(e.resolvedUri=Wi(i.uri,e.uri))})},kk=(i,e)=>{const t=Vp(0,e),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:D.location.href,resolvedUri:D.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return n.playlists[t]=n.playlists[0],n.playlists[e]=n.playlists[0],n},gb=(i,e,t=wk)=>{i.uri=e;for(let r=0;r<i.playlists.length;r++)if(!i.playlists[r].uri){const s=`placeholder-uri-${r}`;i.playlists[r].uri=s}const n=au(i);ya(i,(r,s,a,o)=>{if(!r.playlists||!r.playlists.length){if(n&&s==="AUDIO"&&!r.uri)for(let u=0;u<i.playlists.length;u++){const c=i.playlists[u];if(c.attributes&&c.attributes.AUDIO&&c.attributes.AUDIO===a)return}r.playlists=[On({},r)]}r.playlists.forEach(function(u,c){const h=t(s,a,o,u),g=Vp(c,h);u.uri?u.resolvedUri=u.resolvedUri||Wi(i.uri,u.uri):(u.uri=c===0?h:g,u.resolvedUri=u.uri),u.id=u.id||g,u.attributes=u.attributes||{},i.playlists[u.id]=u,i.playlists[u.uri]=u})}),Dk(i),Ik(i)},{EventTarget:Pk}=F,Rk=(i,e)=>{if(e.endList||!e.serverControl)return i;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:n}=e;let r=e.mediaSequence+e.segments.length;if(n){const s=n.parts||[],a=ob(e)-1;a>-1&&a!==s.length-1&&(t._HLS_part=a),(a>-1||s.length)&&r--}t._HLS_msn=r}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const n=new D.URL(i);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(r){t.hasOwnProperty(r)&&n.searchParams.set(r,t[r])}),i=n.toString()}return i},Ok=(i,e)=>{if(!i)return e;const t=Ye(i,e);if(i.preloadHints&&!e.preloadHints&&delete t.preloadHints,i.parts&&!e.parts)delete t.parts;else if(i.parts&&e.parts)for(let n=0;n<e.parts.length;n++)i.parts&&i.parts[n]&&(t.parts[n]=Ye(i.parts[n],e.parts[n]));return!i.skipped&&e.skipped&&(t.skipped=!1),i.preload&&!e.preload&&(t.preload=!1),t},Lk=(i,e,t)=>{const n=i.slice(),r=e.slice();t=t||0;const s=[];let a;for(let o=0;o<r.length;o++){const u=n[o+t],c=r[o];u?(a=u.map||a,s.push(Ok(u,c))):(a&&!c.map&&(c.map=a),s.push(c))}return s},_b=(i,e)=>{!i.resolvedUri&&i.uri&&(i.resolvedUri=Wi(e,i.uri)),i.key&&!i.key.resolvedUri&&(i.key.resolvedUri=Wi(e,i.key.uri)),i.map&&!i.map.resolvedUri&&(i.map.resolvedUri=Wi(e,i.map.uri)),i.map&&i.map.key&&!i.map.key.resolvedUri&&(i.map.key.resolvedUri=Wi(e,i.map.key.uri)),i.parts&&i.parts.length&&i.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=Wi(e,t.uri))}),i.preloadHints&&i.preloadHints.length&&i.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=Wi(e,t.uri))})},yb=function(i){const e=i.segments||[],t=i.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let n=0;n<t.preloadHints.length;n++)if(t.preloadHints[n].type==="MAP")return e}t.duration=i.targetDuration,t.preload=!0,e.push(t)}return e},vb=(i,e)=>i===e||i.segments&&e.segments&&i.segments.length===e.segments.length&&i.endList===e.endList&&i.mediaSequence===e.mediaSequence&&i.preloadSegment===e.preloadSegment,Xd=(i,e,t=vb)=>{const n=Ye(i,{}),r=n.playlists[e.id];if(!r||t(r,e))return null;e.segments=yb(e);const s=Ye(r,e);if(s.preloadSegment&&!e.preloadSegment&&delete s.preloadSegment,r.segments){if(e.skip){e.segments=e.segments||[];for(let a=0;a<e.skip.skippedSegments;a++)e.segments.unshift({skipped:!0})}s.segments=Lk(r.segments,e.segments,e.mediaSequence-r.mediaSequence)}s.segments.forEach(a=>{_b(a,s.resolvedUri)});for(let a=0;a<n.playlists.length;a++)n.playlists[a].id===e.id&&(n.playlists[a]=s);return n.playlists[e.id]=s,n.playlists[e.uri]=s,ya(i,(a,o,u,c)=>{if(a.playlists)for(let h=0;h<a.playlists.length;h++)e.id===a.playlists[h].id&&(a.playlists[h]=s)}),n},Yd=(i,e)=>{const t=i.segments||[],n=t[t.length-1],r=n&&n.parts&&n.parts[n.parts.length-1],s=r&&r.duration||n&&n.duration;return e&&s?s*1e3:(i.partTargetDuration||i.targetDuration||10)*500};class xs extends Pk{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=Ji("PlaylistLoader");const{withCredentials:r=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=r;const s=t.options_;this.customTagParsers=s&&s.customTagParsers||[],this.customTagMappers=s&&s.customTagMappers||[],this.llhls=s&&s.llhls,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=Wi(this.main.uri,e.uri);this.llhls&&(t=Rk(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials},(n,r)=>{if(this.request){if(n)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,n){const{uri:r,id:s}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[s],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}parseManifest_({url:e,manifestString:t}){return Ak({onwarn:({message:n})=>this.logger_(`m3u8-parser warn for ${e}: ${n}`),oninfo:({message:n})=>this.logger_(`m3u8-parser info for ${e}: ${n}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:r}){this.request=null,this.state="HAVE_METADATA";const s=t||this.parseManifest_({url:n,manifestString:e});s.lastRequest=Date.now(),mb({playlist:s,uri:n,id:r});const a=Xd(this.main,s);this.targetDuration=s.partTargetDuration||s.targetDuration,this.pendingMedia_=null,a?(this.main=a,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Yd(this.media(),!!a)),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),D.clearTimeout(this.mediaUpdateTimeout),D.clearTimeout(this.finalRenditionTimeout),this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(D.clearTimeout(this.finalRenditionTimeout),t){const a=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=D.setTimeout(this.media.bind(this,e,!1),a);return}const n=this.state,r=!this.media_||e.id!==this.media_.id,s=this.main.playlists[e.id];if(s&&s.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,r&&(this.trigger("mediachanging"),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(Yd(e,!0)),!!r){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},(a,o)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=Hl(e.resolvedUri,o),a)return this.playlistRequestError(this.request,e,n);this.haveMetadata({playlistString:o.responseText,url:e.uri,id:e.id}),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}}pause(){this.mediaUpdateTimeout&&(D.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(D.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const n=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=D.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},n);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(D.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=D.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=D.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},(e,t)=>{if(!this.request)return;if(this.request=null,e)return this.error={status:t.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:t.responseText,code:2},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.src=Hl(this.src,t);const n=this.parseManifest_({manifestString:t.responseText,url:this.src});this.setupInitialPlaylist(n)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,gb(this.main,this.srcUri()),e.playlists.forEach(n=>{n.segments=yb(n),n.segments.forEach(r=>{_b(r,n.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||D.location.href;this.main=kk(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}}const{xhr:Nk}=F,Qd=function(i,e,t,n){const r=i.responseType==="arraybuffer"?i.response:i.responseText;!e&&r&&(i.responseTime=Date.now(),i.roundTripTime=i.responseTime-i.requestTime,i.bytesReceived=r.byteLength||r.length,i.bandwidth||(i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3))),t.headers&&(i.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(i.timedout=!0),!e&&!i.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(i&&(r||i.responseText)))),n(e,i)},Tb=function(){const i=function e(t,n){t=Ye({timeout:45e3},t);const r=e.beforeRequest||F.Vhs.xhr.beforeRequest;if(r&&typeof r=="function"){const u=r(t);u&&(t=u)}const a=(F.Vhs.xhr.original===!0?Nk:F.Vhs.xhr)(t,function(u,c){return Qd(a,u,c,n)}),o=a.abort;return a.abort=function(){return a.aborted=!0,o.apply(a,arguments)},a.uri=t.uri,a.requestTime=Date.now(),a};return i.original=!0,i},Mk=function(i){let e;const t=i.offset;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=D.BigInt(i.offset)+D.BigInt(i.length)-D.BigInt(1):e=i.offset+i.length-1,"bytes="+t+"-"+e},Jd=function(i){const e={};return i.byterange&&(e.Range=Mk(i.byterange)),e},Fk=function(i,e){return i.start(e)+"-"+i.end(e)},Bk=function(i,e){const t=i.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},Uk=function(i){return i>=32&&i<126?String.fromCharCode(i):"."},bb=function(i){const e={};return Object.keys(i).forEach(t=>{const n=i[t];nv(n)?e[t]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[t]=n}),e},Gl=function(i){const e=i.byterange||{length:1/0,offset:0};return[e.length,e.offset,i.resolvedUri].join(",")},Eb=function(i){return i.resolvedUri},Sb=i=>{const e=Array.prototype.slice.call(i),t=16;let n="",r,s;for(let a=0;a<e.length/t;a++)r=e.slice(a*t,a*t+t).map(Bk).join(""),s=e.slice(a*t,a*t+t).map(Uk).join(""),n+=r+" "+s+`
`;return n},Vk=({bytes:i})=>Sb(i),jk=i=>{let e="",t;for(t=0;t<i.length;t++)e+=Fk(i,t)+" ";return e};var $k=Object.freeze({__proto__:null,createTransferableMessage:bb,initSegmentId:Gl,segmentKeyId:Eb,hexDump:Sb,tagDump:Vk,textRanges:jk});const xb=.25,qk=(i,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,r=e.videoTimingInfo.transmuxedPresentationStart+t,s=i-r;return new Date(e.dateTimeObject.getTime()+s*1e3)},Hk=i=>i.transmuxedPresentationEnd-i.transmuxedPresentationStart-i.transmuxerPrependedSeconds,Gk=(i,e)=>{let t;try{t=new Date(i)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let n=e.segments[0];if(t<n.dateTimeObject)return null;for(let u=0;u<e.segments.length-1;u++){n=e.segments[u];const c=e.segments[u+1].dateTimeObject;if(t<c)break}const r=e.segments[e.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?Hk(r.videoTimingInfo):r.duration+r.duration*xb,o=new Date(s.getTime()+a*1e3);return t>o?null:(t>s&&(n=r),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:yi.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},zk=(i,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,n;for(let s=0;s<e.segments.length&&(n=e.segments[s],t=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:t+n.duration,!(i<=t));s++);const r=e.segments[e.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<i)return null;if(i>t){if(i>t+r.duration*xb)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:t-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},Wk=(i,e)=>{let t,n;try{t=new Date(i),n=new Date(e)}catch{}const r=t.getTime();return(n.getTime()-r)/1e3},Kk=i=>{if(!i.segments||i.segments.length===0)return!1;for(let e=0;e<i.segments.length;e++)if(!i.segments[e].dateTimeObject)return!1;return!0},Xk=({playlist:i,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!i||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const n=zk(e,i);if(!n)return t({message:"valid programTime was not found"});if(n.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const r={mediaSeconds:e},s=qk(e,n.segment);return s&&(r.programDateTime=s.toISOString()),t(null,r)},Cb=({programTime:i,playlist:e,retryCount:t=2,seekTo:n,pauseAfterSeek:r=!0,tech:s,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(typeof i>"u"||!e||!n)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!s.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!Kk(e))return a({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const o=Gk(i,e);if(!o)return a({message:`${i} was not found in the stream`});const u=o.segment,c=Wk(u.dateTimeObject,i);if(o.type==="estimate"){if(t===0)return a({message:`${i} is not buffered yet. Try again`});n(o.estimatedStart+c),s.one("seeked",()=>{Cb({programTime:i,playlist:e,retryCount:t-1,seekTo:n,pauseAfterSeek:r,tech:s,callback:a})});return}const h=u.start+c,g=()=>a(null,s.currentTime());s.one("seeked",g),r&&s.pause(),n(h)},td=(i,e)=>{if(i.readyState===4)return e()},Yk=(i,e,t)=>{let n=[],r,s=!1;const a=function(h,g,y,v){return g.abort(),s=!0,t(h,g,y,v)},o=function(h,g){if(s)return;if(h)return a(h,g,"",n);const y=g.responseText.substring(n&&n.byteLength||0,g.responseText.length);if(n=iA(n,rv(y,!0)),r=r||no(n),n.length<10||r&&n.length<r+2)return td(g,()=>a(h,g,"",n));const v=sp(n);return v==="ts"&&n.length<188?td(g,()=>a(h,g,"",n)):!v&&n.length<376?td(g,()=>a(h,g,"",n)):a(null,g,v,n)},c=e({uri:i,beforeSend(h){h.overrideMimeType("text/plain; charset=x-user-defined"),h.addEventListener("progress",function({total:g,loaded:y}){return Qd(h,null,{statusCode:h.status},o)})}},function(h,g){return Qd(c,h,g,o)});return c},{EventTarget:Qk}=F,X0=function(i,e){if(!vb(i,e)||i.sidx&&e.sidx&&(i.sidx.offset!==e.sidx.offset||i.sidx.length!==e.sidx.length))return!1;if(!i.sidx&&e.sidx||i.sidx&&!e.sidx||i.segments&&!e.segments||!i.segments&&e.segments)return!1;if(!i.segments&&!e.segments)return!0;for(let t=0;t<i.segments.length;t++){const n=i.segments[t],r=e.segments[t];if(n.uri!==r.uri)return!1;if(!n.byterange&&!r.byterange)continue;const s=n.byterange,a=r.byterange;if(s&&!a||!s&&a||s.offset!==a.offset||s.length!==a.length)return!1}return!0},Jk=(i,e,t,n)=>{const r=n.attributes.NAME||t;return`placeholder-uri-${i}-${e}-${r}`},Zk=({mainXml:i,srcUrl:e,clientOffset:t,sidxMapping:n,previousManifest:r})=>{const s=xD(i,{manifestUri:e,clientOffset:t,sidxMapping:n,previousManifest:r});return gb(s,e,Jk),s},eP=(i,e)=>{ya(i,(t,n,r,s)=>{s in e.mediaGroups[n][r]||delete i.mediaGroups[n][r][s]})},tP=(i,e,t)=>{let n=!0,r=Ye(i,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let s=0;s<e.playlists.length;s++){const a=e.playlists[s];if(a.sidx){const u=mc(a.sidx);t&&t[u]&&t[u].sidx&&ip(a,t[u].sidx,a.sidx.resolvedUri)}const o=Xd(r,a,X0);o&&(r=o,n=!1)}return ya(e,(s,a,o,u)=>{if(s.playlists&&s.playlists.length){const c=s.playlists[0].id,h=Xd(r,s.playlists[0],X0);h&&(r=h,u in r.mediaGroups[a][o]||(r.mediaGroups[a][o][u]=s),r.mediaGroups[a][o][u].playlists[0]=r.playlists[c],n=!1)}}),eP(r,e),e.minimumUpdatePeriod!==i.minimumUpdatePeriod&&(n=!1),n?null:r},iP=(i,e)=>(!i.map&&!e.map||!!(i.map&&e.map&&i.map.byterange.offset===e.map.byterange.offset&&i.map.byterange.length===e.map.byterange.length))&&i.uri===e.uri&&i.byterange.offset===e.byterange.offset&&i.byterange.length===e.byterange.length,Y0=(i,e)=>{const t={};for(const n in i){const s=i[n].sidx;if(s){const a=mc(s);if(!e[a])break;const o=e[a].sidxInfo;iP(o,s)&&(t[a]=e[a])}}return t},nP=(i,e)=>{let n=Y0(i.playlists,e);return ya(i,(r,s,a,o)=>{if(r.playlists&&r.playlists.length){const u=r.playlists;n=Ye(n,Y0(u,e))}}),n};class Zd extends Qk{constructor(e,t,n={},r){super(),this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:s=!1}=n;if(this.vhs_=t,this.withCredentials=s,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=Ji("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}requestErrored_(e,t,n){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2},n&&(this.state=n),this.trigger("error"),!0}addSidxSegments_(e,t,n){const r=e.sidx&&mc(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r]){this.mediaRequest_=D.setTimeout(()=>n(!1),0);return}const s=Hl(e.sidx.resolvedUri),a=(o,u)=>{if(this.requestErrored_(o,u,t))return;const c=this.mainPlaylistLoader_.sidxMapping_;let h;try{h=kD(ue(u.response).subarray(8))}catch(g){this.requestErrored_(g,u,t);return}return c[r]={sidxInfo:e.sidx,sidx:h},ip(e,h,e.sidx.resolvedUri),n(!0)};this.request=Yk(s,this.vhs_.xhr,(o,u,c,h)=>{if(o)return a(o,u);if(!c||c!=="mp4")return a({status:u.status,message:`Unsupported ${c||"unknown"} container type for sidx segment at URL: ${s}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},u);const{offset:g,length:y}=e.sidx.byterange;if(h.length>=y+g)return a(o,{response:h.subarray(g,g+y),status:u.status,uri:u.uri});this.request=this.vhs_.xhr({uri:s,responseType:"arraybuffer",headers:Jd({byterange:e.sidx.byterange})},a)})}dispose(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},D.clearTimeout(this.minimumUpdatePeriodTimeout_),D.clearTimeout(this.mediaRequest_),D.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,n&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,r=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),D.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(D.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){D.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const n=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=D.setTimeout(()=>this.load(),n);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){this.mediaRequest_=D.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},(t,n)=>{if(this.requestErrored_(t,n)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}const r=n.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?this.mainLoaded_=Date.parse(n.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=Hl(this.mainPlaylistLoader_.srcUrl,n),r){this.handleMain_(),this.syncClientServerClock_(()=>e(n,r));return}return e(n,r)})}syncClientServerClock_(e){const t=CD(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Wi(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials},(n,r)=>{if(!this.request)return;if(n)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();let s;t.method==="HEAD"?!r.responseHeaders||!r.responseHeaders.date?s=this.mainLoaded_:s=Date.parse(r.responseHeaders.date):s=Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=s-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main;let t=Zk({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(t=tP(e,t,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=t||e;const n=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];return n&&n!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=n),(!e||t&&t.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),!!t}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(D.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=D.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=nP(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,n=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const r=()=>{this.media().endList||(this.mediaUpdateTimeout=D.setTimeout(()=>{this.trigger("mediaupdatetimeout"),r()},Yd(this.media(),!!n)))};r()}this.trigger("loadedplaylist")}}var At={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const rP=i=>{const e=new Uint8Array(new ArrayBuffer(i.length));for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer},wb=function(i){return i.on=i.addEventListener,i.off=i.removeEventListener,i},sP=function(i){try{return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(i),URL.createObjectURL(t.getBlob())}},Ab=function(i){return function(){const e=sP(i),t=wb(new Worker(e));t.objURL=e;const n=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),n.call(this)},t}},Db=function(i){return`var browserWorkerPolyFill = ${wb.toString()};
browserWorkerPolyFill(self);
`+i},Ib=function(i){return i.toString().replace(/^function.+?{/,"").slice(0,-1)},aP=Db(Ib(function(){var i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var l={};this.on=function(d,p){l[d]||(l[d]=[]),l[d]=l[d].concat(p)},this.off=function(d,p){var f;return l[d]?(f=l[d].indexOf(p),l[d]=l[d].slice(),l[d].splice(f,1),f>-1):!1},this.trigger=function(d){var p,f,m,_;if(p=l[d],!!p)if(arguments.length===2)for(m=p.length,f=0;f<m;++f)p[f].call(this,arguments[1]);else{for(_=[],f=arguments.length,f=1;f<arguments.length;++f)_.push(arguments[f]);for(m=p.length,f=0;f<m;++f)p[f].apply(this,_)}},this.dispose=function(){l={}}}};e.prototype.pipe=function(l){return this.on("data",function(d){l.push(d)}),this.on("done",function(d){l.flush(d)}),this.on("partialdone",function(d){l.partialFlush(d)}),this.on("endedtimeline",function(d){l.endTimeline(d)}),this.on("reset",function(d){l.reset(d)}),l},e.prototype.push=function(l){this.trigger("data",l)},e.prototype.flush=function(l){this.trigger("done",l)},e.prototype.partialFlush=function(l){this.trigger("partialdone",l)},e.prototype.endTimeline=function(l){this.trigger("endedtimeline",l)},e.prototype.reset=function(l){this.trigger("reset",l)};var t=e,n=Math.pow(2,32),r=function(l){var d=new DataView(l.buffer,l.byteOffset,l.byteLength),p;return d.getBigUint64?(p=d.getBigUint64(0),p<Number.MAX_SAFE_INTEGER?Number(p):p):d.getUint32(0)*n+d.getUint32(4)},s={getUint64:r,MAX_UINT32:n},a=s.MAX_UINT32,o,u,c,h,g,y,v,T,S,A,k,P,M,R,O,j,z,ee,K,oe,pe,we,X,ge,rt,Ee,Fe,He,pt,mt,xt,gt,Pi,Gn,ae,Pe;(function(){var l;if(X={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(l in X)X.hasOwnProperty(l)&&(X[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)]);ge=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Ee=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),rt=new Uint8Array([0,0,0,1]),Fe=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),He=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),pt={video:Fe,audio:He},gt=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),xt=new Uint8Array([0,0,0,0,0,0,0,0]),Pi=new Uint8Array([0,0,0,0,0,0,0,0]),Gn=Pi,ae=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Pe=Pi,mt=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),o=function(l){var d=[],p=0,f,m,_;for(f=1;f<arguments.length;f++)d.push(arguments[f]);for(f=d.length;f--;)p+=d[f].byteLength;for(m=new Uint8Array(p+8),_=new DataView(m.buffer,m.byteOffset,m.byteLength),_.setUint32(0,m.byteLength),m.set(l,4),f=0,p=8;f<d.length;f++)m.set(d[f],p),p+=d[f].byteLength;return m},u=function(){return o(X.dinf,o(X.dref,gt))},c=function(l){return o(X.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,l.audioobjecttype<<3|l.samplingfrequencyindex>>>1,l.samplingfrequencyindex<<7|l.channelcount<<3,6,1,2]))},h=function(){return o(X.ftyp,ge,rt,ge,Ee)},j=function(l){return o(X.hdlr,pt[l])},g=function(l){return o(X.mdat,l)},O=function(l){var d=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,l.duration>>>24&255,l.duration>>>16&255,l.duration>>>8&255,l.duration&255,85,196,0,0]);return l.samplerate&&(d[12]=l.samplerate>>>24&255,d[13]=l.samplerate>>>16&255,d[14]=l.samplerate>>>8&255,d[15]=l.samplerate&255),o(X.mdhd,d)},R=function(l){return o(X.mdia,O(l),j(l.type),v(l))},y=function(l){return o(X.mfhd,new Uint8Array([0,0,0,0,(l&4278190080)>>24,(l&16711680)>>16,(l&65280)>>8,l&255]))},v=function(l){return o(X.minf,l.type==="video"?o(X.vmhd,mt):o(X.smhd,xt),u(),ee(l))},T=function(l,d){for(var p=[],f=d.length;f--;)p[f]=oe(d[f]);return o.apply(null,[X.moof,y(l)].concat(p))},S=function(l){for(var d=l.length,p=[];d--;)p[d]=P(l[d]);return o.apply(null,[X.moov,k(4294967295)].concat(p).concat(A(l)))},A=function(l){for(var d=l.length,p=[];d--;)p[d]=pe(l[d]);return o.apply(null,[X.mvex].concat(p))},k=function(l){var d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(l&4278190080)>>24,(l&16711680)>>16,(l&65280)>>8,l&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o(X.mvhd,d)},z=function(l){var d=l.samples||[],p=new Uint8Array(4+d.length),f,m;for(m=0;m<d.length;m++)f=d[m].flags,p[m+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return o(X.sdtp,p)},ee=function(l){return o(X.stbl,K(l),o(X.stts,Pe),o(X.stsc,Gn),o(X.stsz,ae),o(X.stco,Pi))},function(){var l,d;K=function(p){return o(X.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),p.type==="video"?l(p):d(p))},l=function(p){var f=p.sps||[],m=p.pps||[],_=[],b=[],x,w;for(x=0;x<f.length;x++)_.push((f[x].byteLength&65280)>>>8),_.push(f[x].byteLength&255),_=_.concat(Array.prototype.slice.call(f[x]));for(x=0;x<m.length;x++)b.push((m[x].byteLength&65280)>>>8),b.push(m[x].byteLength&255),b=b.concat(Array.prototype.slice.call(m[x]));if(w=[X.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(p.width&65280)>>8,p.width&255,(p.height&65280)>>8,p.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o(X.avcC,new Uint8Array([1,p.profileIdc,p.profileCompatibility,p.levelIdc,255].concat([f.length],_,[m.length],b))),o(X.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],p.sarRatio){var I=p.sarRatio[0],L=p.sarRatio[1];w.push(o(X.pasp,new Uint8Array([(I&4278190080)>>24,(I&16711680)>>16,(I&65280)>>8,I&255,(L&4278190080)>>24,(L&16711680)>>16,(L&65280)>>8,L&255])))}return o.apply(null,w)},d=function(p){return o(X.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(p.channelcount&65280)>>8,p.channelcount&255,(p.samplesize&65280)>>8,p.samplesize&255,0,0,0,0,(p.samplerate&65280)>>8,p.samplerate&255,0,0]),c(p))}}(),M=function(l){var d=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(l.id&4278190080)>>24,(l.id&16711680)>>16,(l.id&65280)>>8,l.id&255,0,0,0,0,(l.duration&4278190080)>>24,(l.duration&16711680)>>16,(l.duration&65280)>>8,l.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(l.width&65280)>>8,l.width&255,0,0,(l.height&65280)>>8,l.height&255,0,0]);return o(X.tkhd,d)},oe=function(l){var d,p,f,m,_,b,x;return d=o(X.tfhd,new Uint8Array([0,0,0,58,(l.id&4278190080)>>24,(l.id&16711680)>>16,(l.id&65280)>>8,l.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),b=Math.floor(l.baseMediaDecodeTime/a),x=Math.floor(l.baseMediaDecodeTime%a),p=o(X.tfdt,new Uint8Array([1,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,b&255,x>>>24&255,x>>>16&255,x>>>8&255,x&255])),_=32+20+8+16+8+8,l.type==="audio"?(f=we(l,_),o(X.traf,d,p,f)):(m=z(l),f=we(l,m.length+_),o(X.traf,d,p,f,m))},P=function(l){return l.duration=l.duration||4294967295,o(X.trak,M(l),R(l))},pe=function(l){var d=new Uint8Array([0,0,0,0,(l.id&4278190080)>>24,(l.id&16711680)>>16,(l.id&65280)>>8,l.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return l.type!=="video"&&(d[d.length-1]=0),o(X.trex,d)},function(){var l,d,p;p=function(f,m){var _=0,b=0,x=0,w=0;return f.length&&(f[0].duration!==void 0&&(_=1),f[0].size!==void 0&&(b=2),f[0].flags!==void 0&&(x=4),f[0].compositionTimeOffset!==void 0&&(w=8)),[0,0,_|b|x|w,1,(f.length&4278190080)>>>24,(f.length&16711680)>>>16,(f.length&65280)>>>8,f.length&255,(m&4278190080)>>>24,(m&16711680)>>>16,(m&65280)>>>8,m&255]},d=function(f,m){var _,b,x,w,I,L;for(w=f.samples||[],m+=8+12+16*w.length,x=p(w,m),b=new Uint8Array(x.length+w.length*16),b.set(x),_=x.length,L=0;L<w.length;L++)I=w[L],b[_++]=(I.duration&4278190080)>>>24,b[_++]=(I.duration&16711680)>>>16,b[_++]=(I.duration&65280)>>>8,b[_++]=I.duration&255,b[_++]=(I.size&4278190080)>>>24,b[_++]=(I.size&16711680)>>>16,b[_++]=(I.size&65280)>>>8,b[_++]=I.size&255,b[_++]=I.flags.isLeading<<2|I.flags.dependsOn,b[_++]=I.flags.isDependedOn<<6|I.flags.hasRedundancy<<4|I.flags.paddingValue<<1|I.flags.isNonSyncSample,b[_++]=I.flags.degradationPriority&61440,b[_++]=I.flags.degradationPriority&15,b[_++]=(I.compositionTimeOffset&4278190080)>>>24,b[_++]=(I.compositionTimeOffset&16711680)>>>16,b[_++]=(I.compositionTimeOffset&65280)>>>8,b[_++]=I.compositionTimeOffset&255;return o(X.trun,b)},l=function(f,m){var _,b,x,w,I,L;for(w=f.samples||[],m+=8+12+8*w.length,x=p(w,m),_=new Uint8Array(x.length+w.length*8),_.set(x),b=x.length,L=0;L<w.length;L++)I=w[L],_[b++]=(I.duration&4278190080)>>>24,_[b++]=(I.duration&16711680)>>>16,_[b++]=(I.duration&65280)>>>8,_[b++]=I.duration&255,_[b++]=(I.size&4278190080)>>>24,_[b++]=(I.size&16711680)>>>16,_[b++]=(I.size&65280)>>>8,_[b++]=I.size&255;return o(X.trun,_)},we=function(f,m){return f.type==="audio"?l(f,m):d(f,m)}}();var De={ftyp:h,mdat:g,moof:T,moov:S,initSegment:function(l){var d=h(),p=S(l),f;return f=new Uint8Array(d.byteLength+p.byteLength),f.set(d),f.set(p,d.byteLength),f}},Qe=function(l){var d,p,f=[],m=[];for(m.byteLength=0,m.nalCount=0,m.duration=0,f.byteLength=0,d=0;d<l.length;d++)p=l[d],p.nalUnitType==="access_unit_delimiter_rbsp"?(f.length&&(f.duration=p.dts-f.dts,m.byteLength+=f.byteLength,m.nalCount+=f.length,m.duration+=f.duration,m.push(f)),f=[p],f.byteLength=p.data.byteLength,f.pts=p.pts,f.dts=p.dts):(p.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(f.keyFrame=!0),f.duration=p.dts-f.dts,f.byteLength+=p.data.byteLength,f.push(p));return m.length&&(!f.duration||f.duration<=0)&&(f.duration=m[m.length-1].duration),m.byteLength+=f.byteLength,m.nalCount+=f.length,m.duration+=f.duration,m.push(f),m},Ut=function(l){var d,p,f=[],m=[];for(f.byteLength=0,f.nalCount=0,f.duration=0,f.pts=l[0].pts,f.dts=l[0].dts,m.byteLength=0,m.nalCount=0,m.duration=0,m.pts=l[0].pts,m.dts=l[0].dts,d=0;d<l.length;d++)p=l[d],p.keyFrame?(f.length&&(m.push(f),m.byteLength+=f.byteLength,m.nalCount+=f.nalCount,m.duration+=f.duration),f=[p],f.nalCount=p.length,f.byteLength=p.byteLength,f.pts=p.pts,f.dts=p.dts,f.duration=p.duration):(f.duration+=p.duration,f.nalCount+=p.length,f.byteLength+=p.byteLength,f.push(p));return m.length&&f.duration<=0&&(f.duration=m[m.length-1].duration),m.byteLength+=f.byteLength,m.nalCount+=f.nalCount,m.duration+=f.duration,m.push(f),m},Rt=function(l){var d;return!l[0][0].keyFrame&&l.length>1&&(d=l.shift(),l.byteLength-=d.byteLength,l.nalCount-=d.nalCount,l[0][0].dts=d.dts,l[0][0].pts=d.pts,l[0][0].duration+=d.duration),l},st=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},En=function(l,d){var p=st();return p.dataOffset=d,p.compositionTimeOffset=l.pts-l.dts,p.duration=l.duration,p.size=4*l.length,p.size+=l.byteLength,l.keyFrame&&(p.flags.dependsOn=2,p.flags.isNonSyncSample=0),p},Xr=function(l,d){var p,f,m,_,b,x=d||0,w=[];for(p=0;p<l.length;p++)for(_=l[p],f=0;f<_.length;f++)b=_[f],m=En(b,x),x+=m.size,w.push(m);return w},Ca=function(l){var d,p,f,m,_,b,x=0,w=l.byteLength,I=l.nalCount,L=w+4*I,B=new Uint8Array(L),Q=new DataView(B.buffer);for(d=0;d<l.length;d++)for(m=l[d],p=0;p<m.length;p++)for(_=m[p],f=0;f<_.length;f++)b=_[f],Q.setUint32(x,b.data.byteLength),x+=4,B.set(b.data,x),x+=b.data.byteLength;return B},gr=function(l,d){var p,f=d||0,m=[];return p=En(l,f),m.push(p),m},wa=function(l){var d,p,f=0,m=l.byteLength,_=l.length,b=m+4*_,x=new Uint8Array(b),w=new DataView(x.buffer);for(d=0;d<l.length;d++)p=l[d],w.setUint32(f,p.data.byteLength),f+=4,x.set(p.data,f),f+=p.data.byteLength;return x},_r={groupNalsIntoFrames:Qe,groupFramesIntoGops:Ut,extendFirstKeyFrame:Rt,generateSampleTable:Xr,concatenateNalData:Ca,generateSampleTableForFrame:gr,concatenateNalDataForFrame:wa},ie=[33,16,5,32,164,27],Je=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],xe=function(l){for(var d=[];l--;)d.push(0);return d},Yr=function(l){return Object.keys(l).reduce(function(d,p){return d[p]=new Uint8Array(l[p].reduce(function(f,m){return f.concat(m)},[])),d},{})},Sn,zn=function(){if(!Sn){var l={96e3:[ie,[227,64],xe(154),[56]],88200:[ie,[231],xe(170),[56]],64e3:[ie,[248,192],xe(240),[56]],48e3:[ie,[255,192],xe(268),[55,148,128],xe(54),[112]],44100:[ie,[255,192],xe(268),[55,163,128],xe(84),[112]],32e3:[ie,[255,192],xe(268),[55,234],xe(226),[112]],24e3:[ie,[255,192],xe(268),[55,255,128],xe(268),[111,112],xe(126),[224]],16e3:[ie,[255,192],xe(268),[55,255,128],xe(268),[111,255],xe(269),[223,108],xe(195),[1,192]],12e3:[Je,xe(268),[3,127,248],xe(268),[6,255,240],xe(268),[13,255,224],xe(268),[27,253,128],xe(259),[56]],11025:[Je,xe(268),[3,127,248],xe(268),[6,255,240],xe(268),[13,255,224],xe(268),[27,255,192],xe(268),[55,175,128],xe(108),[112]],8e3:[Je,xe(268),[3,121,16],xe(47),[7]]};Sn=Yr(l)}return Sn},Qr=9e4,Wn,Aa,yr,Da,Ia,bu,Eu;Wn=function(l){return l*Qr},Aa=function(l,d){return l*d},yr=function(l){return l/Qr},Da=function(l,d){return l/d},Ia=function(l,d){return Wn(Da(l,d))},bu=function(l,d){return Aa(yr(l),d)},Eu=function(l,d,p){return yr(p?l:l-d)};var Ge={ONE_SECOND_IN_TS:Qr,secondsToVideoTs:Wn,secondsToAudioTs:Aa,videoTsToSeconds:yr,audioTsToSeconds:Da,audioTsToVideoTs:Ia,videoTsToAudioTs:bu,metadataTsToSeconds:Eu},lh=zn,Jr=Ge,Ze=function(l){var d,p,f=0;for(d=0;d<l.length;d++)p=l[d],f+=p.data.byteLength;return f},ka=function(l,d,p,f){var m,_=0,b=0,x=0,w=0,I,L,B;if(d.length&&(m=Jr.audioTsToVideoTs(l.baseMediaDecodeTime,l.samplerate),_=Math.ceil(Jr.ONE_SECOND_IN_TS/(l.samplerate/1024)),p&&f&&(b=m-Math.max(p,f),x=Math.floor(b/_),w=x*_),!(x<1||w>Jr.ONE_SECOND_IN_TS/2))){for(I=lh()[l.samplerate],I||(I=d[0].data),L=0;L<x;L++)B=d[0],d.splice(0,0,{data:I,dts:B.dts-_,pts:B.pts-_});return l.baseMediaDecodeTime-=Math.floor(Jr.videoTsToAudioTs(w,l.samplerate)),w}},Pa=function(l,d,p){return d.minSegmentDts>=p?l:(d.minSegmentDts=1/0,l.filter(function(f){return f.dts>=p?(d.minSegmentDts=Math.min(d.minSegmentDts,f.dts),d.minSegmentPts=d.minSegmentDts,!0):!1}))},ch=function(l){var d,p,f=[];for(d=0;d<l.length;d++)p=l[d],f.push({size:p.data.byteLength,duration:1024});return f},Zr=function(l){var d,p,f=0,m=new Uint8Array(Ze(l));for(d=0;d<l.length;d++)p=l[d],m.set(p.data,f),f+=p.data.byteLength;return m},Ra={prefixWithSilence:ka,trimAdtsFramesByEarliestDts:Pa,generateSampleTable:ch,concatenateFrameData:Zr},Hi=Ge.ONE_SECOND_IN_TS,hh=function(l,d){typeof d.pts=="number"&&(l.timelineStartInfo.pts===void 0&&(l.timelineStartInfo.pts=d.pts),l.minSegmentPts===void 0?l.minSegmentPts=d.pts:l.minSegmentPts=Math.min(l.minSegmentPts,d.pts),l.maxSegmentPts===void 0?l.maxSegmentPts=d.pts:l.maxSegmentPts=Math.max(l.maxSegmentPts,d.pts)),typeof d.dts=="number"&&(l.timelineStartInfo.dts===void 0&&(l.timelineStartInfo.dts=d.dts),l.minSegmentDts===void 0?l.minSegmentDts=d.dts:l.minSegmentDts=Math.min(l.minSegmentDts,d.dts),l.maxSegmentDts===void 0?l.maxSegmentDts=d.dts:l.maxSegmentDts=Math.max(l.maxSegmentDts,d.dts))},dh=function(l){delete l.minSegmentDts,delete l.maxSegmentDts,delete l.minSegmentPts,delete l.maxSegmentPts},E=function(l,d){var p,f,m=l.minSegmentDts;return d||(m-=l.timelineStartInfo.dts),p=l.timelineStartInfo.baseMediaDecodeTime,p+=m,p=Math.max(0,p),l.type==="audio"&&(f=l.samplerate/Hi,p*=f,p=Math.floor(p)),p},C={clearDtsInfo:dh,calculateTrackBaseMediaDecodeTime:E,collectDtsInfo:hh},N=4,U=128,G=function(l){for(var d=0,p={payloadType:-1,payloadSize:0},f=0,m=0;d<l.byteLength&&l[d]!==U;){for(;l[d]===255;)f+=255,d++;for(f+=l[d++];l[d]===255;)m+=255,d++;if(m+=l[d++],!p.payload&&f===N){var _=String.fromCharCode(l[d+3],l[d+4],l[d+5],l[d+6]);if(_==="GA94"){p.payloadType=f,p.payloadSize=m,p.payload=l.subarray(d,d+m);break}else p.payload=void 0}d+=m,f=0,m=0}return p},J=function(l){return l.payload[0]!==181||(l.payload[1]<<8|l.payload[2])!==49||String.fromCharCode(l.payload[3],l.payload[4],l.payload[5],l.payload[6])!=="GA94"||l.payload[7]!==3?null:l.payload.subarray(8,l.payload.length-1)},_e=function(l,d){var p=[],f,m,_,b;if(!(d[0]&64))return p;for(m=d[0]&31,f=0;f<m;f++)_=f*3,b={type:d[_+2]&3,pts:l},d[_+2]&4&&(b.ccData=d[_+3]<<8|d[_+4],p.push(b));return p},re=function(l){for(var d=l.byteLength,p=[],f=1,m,_;f<d-2;)l[f]===0&&l[f+1]===0&&l[f+2]===3?(p.push(f+2),f+=2):f++;if(p.length===0)return l;m=d-p.length,_=new Uint8Array(m);var b=0;for(f=0;f<m;b++,f++)b===p[0]&&(b++,p.shift()),_[f]=l[b];return _},Se={parseSei:G,parseUserData:J,parseCaptionPackets:_e,discardEmulationPreventionBytes:re,USER_DATA_REGISTERED_ITU_T_T35:N},ne=t,ce=Se,Te=function(l){l=l||{},Te.prototype.init.call(this),this.parse708captions_=typeof l.parse708captions=="boolean"?l.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new We(0,0),new We(0,1),new We(1,0),new We(1,1)],this.parse708captions_&&(this.cc708Stream_=new Ne({captionServices:l.captionServices})),this.reset(),this.ccStreams_.forEach(function(d){d.on("data",this.trigger.bind(this,"data")),d.on("partialdone",this.trigger.bind(this,"partialdone")),d.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Te.prototype=new ne,Te.prototype.push=function(l){var d,p,f;if(l.nalUnitType==="sei_rbsp"&&(d=ce.parseSei(l.escapedRBSP),!!d.payload&&d.payloadType===ce.USER_DATA_REGISTERED_ITU_T_T35&&(p=ce.parseUserData(d),!!p))){if(l.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(l.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}f=ce.parseCaptionPackets(l.pts,p),this.captionPackets_=this.captionPackets_.concat(f),this.latestDts_!==l.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=l.dts}},Te.prototype.flushCCStreams=function(l){this.ccStreams_.forEach(function(d){return l==="flush"?d.flush():d.partialFlush()},this)},Te.prototype.flushStream=function(l){if(!this.captionPackets_.length){this.flushCCStreams(l);return}this.captionPackets_.forEach(function(d,p){d.presortIndex=p}),this.captionPackets_.sort(function(d,p){return d.pts===p.pts?d.presortIndex-p.presortIndex:d.pts-p.pts}),this.captionPackets_.forEach(function(d){d.type<2?this.dispatchCea608Packet(d):this.dispatchCea708Packet(d)},this),this.captionPackets_.length=0,this.flushCCStreams(l)},Te.prototype.flush=function(){return this.flushStream("flush")},Te.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Te.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(l){l.reset()})},Te.prototype.dispatchCea608Packet=function(l){this.setsTextOrXDSActive(l)?this.activeCea608Channel_[l.type]=null:this.setsChannel1Active(l)?this.activeCea608Channel_[l.type]=0:this.setsChannel2Active(l)&&(this.activeCea608Channel_[l.type]=1),this.activeCea608Channel_[l.type]!==null&&this.ccStreams_[(l.type<<1)+this.activeCea608Channel_[l.type]].push(l)},Te.prototype.setsChannel1Active=function(l){return(l.ccData&30720)===4096},Te.prototype.setsChannel2Active=function(l){return(l.ccData&30720)===6144},Te.prototype.setsTextOrXDSActive=function(l){return(l.ccData&28928)===256||(l.ccData&30974)===4138||(l.ccData&30974)===6186},Te.prototype.dispatchCea708Packet=function(l){this.parse708captions_&&this.cc708Stream_.push(l)};var Ri={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},ei=function(l){var d=Ri[l]||l;return l&4096&&l===d?"":String.fromCharCode(d)},Zi=function(l){return 32<=l&&l<=127||160<=l&&l<=255},Vt=function(l){this.windowNum=l,this.reset()};Vt.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Vt.prototype.getText=function(){return this.rows.join(`
`)},Vt.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Vt.prototype.newLine=function(l){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(l),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Vt.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Vt.prototype.addText=function(l){this.rows[this.rowIdx]+=l},Vt.prototype.backspace=function(){if(!this.isEmpty()){var l=this.rows[this.rowIdx];this.rows[this.rowIdx]=l.substr(0,l.length-1)}};var es=function(l,d,p){this.serviceNum=l,this.text="",this.currentWindow=new Vt(-1),this.windows=[],this.stream=p,typeof d=="string"&&this.createTextDecoder(d)};es.prototype.init=function(l,d){this.startPts=l;for(var p=0;p<8;p++)this.windows[p]=new Vt(p),typeof d=="function"&&(this.windows[p].beforeRowOverflow=d)},es.prototype.setCurrentWindow=function(l){this.currentWindow=this.windows[l]},es.prototype.createTextDecoder=function(l){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(l)}catch(d){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+l+" encoding. "+d})}};var Ne=function(l){l=l||{},Ne.prototype.init.call(this);var d=this,p=l.captionServices||{},f={},m;Object.keys(p).forEach(_=>{m=p[_],/^SERVICE/.test(_)&&(f[_]=m.encoding)}),this.serviceEncodings=f,this.current708Packet=null,this.services={},this.push=function(_){_.type===3?(d.new708Packet(),d.add708Bytes(_)):(d.current708Packet===null&&d.new708Packet(),d.add708Bytes(_))}};Ne.prototype=new ne,Ne.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Ne.prototype.add708Bytes=function(l){var d=l.ccData,p=d>>>8,f=d&255;this.current708Packet.ptsVals.push(l.pts),this.current708Packet.data.push(p),this.current708Packet.data.push(f)},Ne.prototype.push708Packet=function(){var l=this.current708Packet,d=l.data,p=null,f=null,m=0,_=d[m++];for(l.seq=_>>6,l.sizeCode=_&63;m<d.length;m++)_=d[m++],p=_>>5,f=_&31,p===7&&f>0&&(_=d[m++],p=_),this.pushServiceBlock(p,m,f),f>0&&(m+=f-1)},Ne.prototype.pushServiceBlock=function(l,d,p){var f,m=d,_=this.current708Packet.data,b=this.services[l];for(b||(b=this.initService(l,m));m<d+p&&m<_.length;m++)f=_[m],Zi(f)?m=this.handleText(m,b):f===24?m=this.multiByteCharacter(m,b):f===16?m=this.extendedCommands(m,b):128<=f&&f<=135?m=this.setCurrentWindow(m,b):152<=f&&f<=159?m=this.defineWindow(m,b):f===136?m=this.clearWindows(m,b):f===140?m=this.deleteWindows(m,b):f===137?m=this.displayWindows(m,b):f===138?m=this.hideWindows(m,b):f===139?m=this.toggleWindows(m,b):f===151?m=this.setWindowAttributes(m,b):f===144?m=this.setPenAttributes(m,b):f===145?m=this.setPenColor(m,b):f===146?m=this.setPenLocation(m,b):f===143?b=this.reset(m,b):f===8?b.currentWindow.backspace():f===12?b.currentWindow.clearText():f===13?b.currentWindow.pendingNewLine=!0:f===14?b.currentWindow.clearText():f===141&&m++},Ne.prototype.extendedCommands=function(l,d){var p=this.current708Packet.data,f=p[++l];return Zi(f)&&(l=this.handleText(l,d,{isExtended:!0})),l},Ne.prototype.getPts=function(l){return this.current708Packet.ptsVals[Math.floor(l/2)]},Ne.prototype.initService=function(l,d){var f="SERVICE"+l,p=this,f,m;return f in this.serviceEncodings&&(m=this.serviceEncodings[f]),this.services[l]=new es(l,m,p),this.services[l].init(this.getPts(d),function(_){p.flushDisplayed(_,p.services[l])}),this.services[l]},Ne.prototype.handleText=function(l,d,p){var f=p&&p.isExtended,m=p&&p.isMultiByte,_=this.current708Packet.data,b=f?4096:0,x=_[l],w=_[l+1],I=d.currentWindow,L,B;return d.textDecoder_&&!f?(m?(B=[x,w],l++):B=[x],L=d.textDecoder_.decode(new Uint8Array(B))):L=ei(b|x),I.pendingNewLine&&!I.isEmpty()&&I.newLine(this.getPts(l)),I.pendingNewLine=!1,I.addText(L),l},Ne.prototype.multiByteCharacter=function(l,d){var p=this.current708Packet.data,f=p[l+1],m=p[l+2];return Zi(f)&&Zi(m)&&(l=this.handleText(++l,d,{isMultiByte:!0})),l},Ne.prototype.setCurrentWindow=function(l,d){var p=this.current708Packet.data,f=p[l],m=f&7;return d.setCurrentWindow(m),l},Ne.prototype.defineWindow=function(l,d){var p=this.current708Packet.data,f=p[l],m=f&7;d.setCurrentWindow(m);var _=d.currentWindow;return f=p[++l],_.visible=(f&32)>>5,_.rowLock=(f&16)>>4,_.columnLock=(f&8)>>3,_.priority=f&7,f=p[++l],_.relativePositioning=(f&128)>>7,_.anchorVertical=f&127,f=p[++l],_.anchorHorizontal=f,f=p[++l],_.anchorPoint=(f&240)>>4,_.rowCount=f&15,f=p[++l],_.columnCount=f&63,f=p[++l],_.windowStyle=(f&56)>>3,_.penStyle=f&7,_.virtualRowCount=_.rowCount+1,l},Ne.prototype.setWindowAttributes=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.winAttr;return f=p[++l],m.fillOpacity=(f&192)>>6,m.fillRed=(f&48)>>4,m.fillGreen=(f&12)>>2,m.fillBlue=f&3,f=p[++l],m.borderType=(f&192)>>6,m.borderRed=(f&48)>>4,m.borderGreen=(f&12)>>2,m.borderBlue=f&3,f=p[++l],m.borderType+=(f&128)>>5,m.wordWrap=(f&64)>>6,m.printDirection=(f&48)>>4,m.scrollDirection=(f&12)>>2,m.justify=f&3,f=p[++l],m.effectSpeed=(f&240)>>4,m.effectDirection=(f&12)>>2,m.displayEffect=f&3,l},Ne.prototype.flushDisplayed=function(l,d){for(var p=[],f=0;f<8;f++)d.windows[f].visible&&!d.windows[f].isEmpty()&&p.push(d.windows[f].getText());d.endPts=l,d.text=p.join(`

`),this.pushCaption(d),d.startPts=l},Ne.prototype.pushCaption=function(l){l.text!==""&&(this.trigger("data",{startPts:l.startPts,endPts:l.endPts,text:l.text,stream:"cc708_"+l.serviceNum}),l.text="",l.startPts=l.endPts)},Ne.prototype.displayWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&(d.windows[_].visible=1);return l},Ne.prototype.hideWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&(d.windows[_].visible=0);return l},Ne.prototype.toggleWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&(d.windows[_].visible^=1);return l},Ne.prototype.clearWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&d.windows[_].clearText();return l},Ne.prototype.deleteWindows=function(l,d){var p=this.current708Packet.data,f=p[++l],m=this.getPts(l);this.flushDisplayed(m,d);for(var _=0;_<8;_++)f&1<<_&&d.windows[_].reset();return l},Ne.prototype.setPenAttributes=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.penAttr;return f=p[++l],m.textTag=(f&240)>>4,m.offset=(f&12)>>2,m.penSize=f&3,f=p[++l],m.italics=(f&128)>>7,m.underline=(f&64)>>6,m.edgeType=(f&56)>>3,m.fontStyle=f&7,l},Ne.prototype.setPenColor=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.penColor;return f=p[++l],m.fgOpacity=(f&192)>>6,m.fgRed=(f&48)>>4,m.fgGreen=(f&12)>>2,m.fgBlue=f&3,f=p[++l],m.bgOpacity=(f&192)>>6,m.bgRed=(f&48)>>4,m.bgGreen=(f&12)>>2,m.bgBlue=f&3,f=p[++l],m.edgeRed=(f&48)>>4,m.edgeGreen=(f&12)>>2,m.edgeBlue=f&3,l},Ne.prototype.setPenLocation=function(l,d){var p=this.current708Packet.data,f=p[l],m=d.currentWindow.penLoc;return d.currentWindow.pendingNewLine=!0,f=p[++l],m.row=f&15,f=p[++l],m.column=f&63,l},Ne.prototype.reset=function(l,d){var p=this.getPts(l);return this.flushDisplayed(p,d),this.initService(d.serviceNum,l)};var fh={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ts=function(l){return l===null?"":(l=fh[l]||l,String.fromCharCode(l))},is=14,ph=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],xn=function(){for(var l=[],d=is+1;d--;)l.push("");return l},We=function(l,d){We.prototype.init.call(this),this.field_=l||0,this.dataChannel_=d||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(p){var f,m,_,b,x;if(f=p.ccData&32639,f===this.lastControlCode_){this.lastControlCode_=null;return}if((f&61440)===4096?this.lastControlCode_=f:f!==this.PADDING_&&(this.lastControlCode_=null),_=f>>>8,b=f&255,f!==this.PADDING_)if(f===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(f===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(p.pts),this.flushDisplayed(p.pts),m=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=m,this.startPts_=p.pts;else if(f===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(p.pts);else if(f===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(p.pts);else if(f===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(p.pts);else if(f===this.CARRIAGE_RETURN_)this.clearFormatting(p.pts),this.flushDisplayed(p.pts),this.shiftRowsUp_(),this.startPts_=p.pts;else if(f===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(f===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(p.pts),this.displayed_=xn();else if(f===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=xn();else if(f===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(p.pts),this.displayed_=xn()),this.mode_="paintOn",this.startPts_=p.pts;else if(this.isSpecialCharacter(_,b))_=(_&3)<<8,x=ts(_|b),this[this.mode_](p.pts,x),this.column_++;else if(this.isExtCharacter(_,b))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),_=(_&3)<<8,x=ts(_|b),this[this.mode_](p.pts,x),this.column_++;else if(this.isMidRowCode(_,b))this.clearFormatting(p.pts),this[this.mode_](p.pts," "),this.column_++,(b&14)===14&&this.addFormatting(p.pts,["i"]),(b&1)===1&&this.addFormatting(p.pts,["u"]);else if(this.isOffsetControlCode(_,b))this.column_+=b&3;else if(this.isPAC(_,b)){var w=ph.indexOf(f&7968);this.mode_==="rollUp"&&(w-this.rollUpRows_+1<0&&(w=this.rollUpRows_-1),this.setRollUp(p.pts,w)),w!==this.row_&&(this.clearFormatting(p.pts),this.row_=w),b&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(p.pts,["u"]),(f&16)===16&&(this.column_=((f&14)>>1)*4),this.isColorPAC(b)&&(b&14)===14&&this.addFormatting(p.pts,["i"])}else this.isNormalChar(_)&&(b===0&&(b=null),x=ts(_),x+=ts(b),this[this.mode_](p.pts,x),this.column_+=x.length)}};We.prototype=new ne,We.prototype.flushDisplayed=function(l){var d=this.displayed_.map(function(p,f){try{return p.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+f+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");d.length&&this.trigger("data",{startPts:this.startPts_,endPts:l,text:d,stream:this.name_})},We.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=xn(),this.nonDisplayed_=xn(),this.lastControlCode_=null,this.column_=0,this.row_=is,this.rollUpRows_=2,this.formatting_=[]},We.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},We.prototype.isSpecialCharacter=function(l,d){return l===this.EXT_&&d>=48&&d<=63},We.prototype.isExtCharacter=function(l,d){return(l===this.EXT_+1||l===this.EXT_+2)&&d>=32&&d<=63},We.prototype.isMidRowCode=function(l,d){return l===this.EXT_&&d>=32&&d<=47},We.prototype.isOffsetControlCode=function(l,d){return l===this.OFFSET_&&d>=33&&d<=35},We.prototype.isPAC=function(l,d){return l>=this.BASE_&&l<this.BASE_+8&&d>=64&&d<=127},We.prototype.isColorPAC=function(l){return l>=64&&l<=79||l>=96&&l<=127},We.prototype.isNormalChar=function(l){return l>=32&&l<=127},We.prototype.setRollUp=function(l,d){if(this.mode_!=="rollUp"&&(this.row_=is,this.mode_="rollUp",this.flushDisplayed(l),this.nonDisplayed_=xn(),this.displayed_=xn()),d!==void 0&&d!==this.row_)for(var p=0;p<this.rollUpRows_;p++)this.displayed_[d-p]=this.displayed_[this.row_-p],this.displayed_[this.row_-p]="";d===void 0&&(d=this.row_),this.topRow_=d-this.rollUpRows_+1},We.prototype.addFormatting=function(l,d){this.formatting_=this.formatting_.concat(d);var p=d.reduce(function(f,m){return f+"<"+m+">"},"");this[this.mode_](l,p)},We.prototype.clearFormatting=function(l){if(this.formatting_.length){var d=this.formatting_.reverse().reduce(function(p,f){return p+"</"+f+">"},"");this.formatting_=[],this[this.mode_](l,d)}},We.prototype.popOn=function(l,d){var p=this.nonDisplayed_[this.row_];p+=d,this.nonDisplayed_[this.row_]=p},We.prototype.rollUp=function(l,d){var p=this.displayed_[this.row_];p+=d,this.displayed_[this.row_]=p},We.prototype.shiftRowsUp_=function(){var l;for(l=0;l<this.topRow_;l++)this.displayed_[l]="";for(l=this.row_+1;l<is+1;l++)this.displayed_[l]="";for(l=this.topRow_;l<this.row_;l++)this.displayed_[l]=this.displayed_[l+1];this.displayed_[this.row_]=""},We.prototype.paintOn=function(l,d){var p=this.displayed_[this.row_];p+=d,this.displayed_[this.row_]=p};var Su={CaptionStream:Te,Cea608Stream:We,Cea708Stream:Ne},ns={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},fS=t,pS=8589934592,mS=4294967296,jm="shared",mh=function(l,d){var p=1;for(l>d&&(p=-1);Math.abs(d-l)>mS;)l+=p*pS;return l},gh=function(l){var d,p;gh.prototype.init.call(this),this.type_=l||jm,this.push=function(f){this.type_!==jm&&f.type!==this.type_||(p===void 0&&(p=f.dts),f.dts=mh(f.dts,p),f.pts=mh(f.pts,p),d=f.dts,this.trigger("data",f))},this.flush=function(){p=d,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){p=void 0,d=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};gh.prototype=new fS;var $m={TimestampRolloverStream:gh,handleRollover:mh},gS=(l,d,p)=>{if(!l)return-1;for(var f=p;f<l.length;f++)if(l[f]===d)return f;return-1},_S={typedArrayIndexOf:gS},xu=_S.typedArrayIndexOf,Cu={Iso88591:0,Utf16:1,Utf16be:2,Utf8:3},qm=function(l,d,p){var f,m="";for(f=d;f<p;f++)m+="%"+("00"+l[f].toString(16)).slice(-2);return m},Oa=function(l,d,p){return decodeURIComponent(qm(l,d,p))},La=function(l,d,p){return unescape(qm(l,d,p))},Na=function(l){return l[0]<<21|l[1]<<14|l[2]<<7|l[3]},Ma={APIC:function(l){var d=1,p,f,m="-->";l.data[0]===Cu.Utf8&&(p=xu(l.data,0,d),!(p<0)&&(l.mimeType=La(l.data,d,p),d=p+1,l.pictureType=l.data[d],d++,f=xu(l.data,0,d),!(f<0)&&(l.description=Oa(l.data,d,f),d=f+1,l.mimeType===m?l.url=La(l.data,d,l.data.length):l.pictureData=l.data.subarray(d,l.data.length))))},"T*":function(l){l.data[0]===Cu.Utf8&&(l.value=Oa(l.data,1,l.data.length).replace(/\0*$/,""),l.values=l.value.split("\0"))},TXXX:function(l){var d;l.data[0]===Cu.Utf8&&(d=xu(l.data,0,1),d!==-1&&(l.description=Oa(l.data,1,d),l.value=Oa(l.data,d+1,l.data.length).replace(/\0*$/,""),l.data=l.value))},"W*":function(l){l.url=La(l.data,0,l.data.length).replace(/\0.*$/,"")},WXXX:function(l){var d;l.data[0]===Cu.Utf8&&(d=xu(l.data,0,1),d!==-1&&(l.description=Oa(l.data,1,d),l.url=La(l.data,d+1,l.data.length).replace(/\0.*$/,"")))},PRIV:function(l){var d;for(d=0;d<l.data.length;d++)if(l.data[d]===0){l.owner=La(l.data,0,d);break}l.privateData=l.data.subarray(d+1),l.data=l.privateData}},yS=function(l){var d,p,f=10,m=0,_=[];if(!(l.length<10||l[0]!=="I".charCodeAt(0)||l[1]!=="D".charCodeAt(0)||l[2]!=="3".charCodeAt(0))){m=Na(l.subarray(6,10)),m+=10;var b=l[5]&64;b&&(f+=4,f+=Na(l.subarray(10,14)),m-=Na(l.subarray(16,20)));do{if(d=Na(l.subarray(f+4,f+8)),d<1)break;p=String.fromCharCode(l[f],l[f+1],l[f+2],l[f+3]);var x={id:p,data:l.subarray(f+10,f+d+10)};x.key=x.id,Ma[x.id]?Ma[x.id](x):x.id[0]==="T"?Ma["T*"](x):x.id[0]==="W"&&Ma["W*"](x),_.push(x),f+=10,f+=d}while(f<m);return _}},Hm={parseId3Frames:yS,parseSyncSafeInteger:Na,frameParsers:Ma},vS=t,TS=ns,Kn=Hm,wu;wu=function(l){var d={descriptor:l&&l.descriptor},p=0,f=[],m=0,_;if(wu.prototype.init.call(this),this.dispatchType=TS.METADATA_STREAM_TYPE.toString(16),d.descriptor)for(_=0;_<d.descriptor.length;_++)this.dispatchType+=("00"+d.descriptor[_].toString(16)).slice(-2);this.push=function(b){var x,w,I,L,B,Q;if(b.type==="timed-metadata"){if(b.dataAlignmentIndicator&&(m=0,f.length=0),f.length===0&&(b.data.length<10||b.data[0]!=="I".charCodeAt(0)||b.data[1]!=="D".charCodeAt(0)||b.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(f.push(b),m+=b.data.byteLength,f.length===1&&(p=Kn.parseSyncSafeInteger(b.data.subarray(6,10)),p+=10),!(m<p)){for(x={data:new Uint8Array(p),frames:[],pts:f[0].pts,dts:f[0].dts},B=0;B<p;)x.data.set(f[0].data.subarray(0,p-B),B),B+=f[0].data.byteLength,m-=f[0].data.byteLength,f.shift();w=10,x.data[5]&64&&(w+=4,w+=Kn.parseSyncSafeInteger(x.data.subarray(10,14)),p-=Kn.parseSyncSafeInteger(x.data.subarray(16,20)));do{if(I=Kn.parseSyncSafeInteger(x.data.subarray(w+4,w+8)),I<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(Q=String.fromCharCode(x.data[w],x.data[w+1],x.data[w+2],x.data[w+3]),L={id:Q,data:x.data.subarray(w+10,w+I+10)},L.key=L.id,Kn.frameParsers[L.id]?Kn.frameParsers[L.id](L):L.id[0]==="T"?Kn.frameParsers["T*"](L):L.id[0]==="W"&&Kn.frameParsers["W*"](L),L.owner==="com.apple.streaming.transportStreamTimestamp"){var $=L.data,he=($[3]&1)<<30|$[4]<<22|$[5]<<14|$[6]<<6|$[7]>>>2;he*=4,he+=$[7]&3,L.timeStamp=he,x.pts===void 0&&x.dts===void 0&&(x.pts=L.timeStamp,x.dts=L.timeStamp),this.trigger("timestamp",L)}x.frames.push(L),w+=10,w+=I}while(w<p);this.trigger("data",x)}}}},wu.prototype=new vS;var bS=wu,_h=t,yh=Su,Gi=ns,ES=$m.TimestampRolloverStream,Au,Fa,Du,rs=188,vh=71;Au=function(){var l=new Uint8Array(rs),d=0;Au.prototype.init.call(this),this.push=function(p){var f=0,m=rs,_;for(d?(_=new Uint8Array(p.byteLength+d),_.set(l.subarray(0,d)),_.set(p,d),d=0):_=p;m<_.byteLength;){if(_[f]===vh&&_[m]===vh){this.trigger("data",_.subarray(f,m)),f+=rs,m+=rs;continue}f++,m++}f<_.byteLength&&(l.set(_.subarray(f),0),d=_.byteLength-f)},this.flush=function(){d===rs&&l[0]===vh&&(this.trigger("data",l),d=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){d=0,this.trigger("reset")}},Au.prototype=new _h,Fa=function(){var l,d,p,f;Fa.prototype.init.call(this),f=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,l=function(m,_){var b=0;_.payloadUnitStartIndicator&&(b+=m[b]+1),_.type==="pat"?d(m.subarray(b),_):p(m.subarray(b),_)},d=function(m,_){_.section_number=m[7],_.last_section_number=m[8],f.pmtPid=(m[10]&31)<<8|m[11],_.pmtPid=f.pmtPid},p=function(m,_){var b,x,w,I;if(m[5]&1){for(f.programMapTable={video:null,audio:null,"timed-metadata":{}},b=(m[1]&15)<<8|m[2],x=3+b-4,w=(m[10]&15)<<8|m[11],I=12+w;I<x;){var L=m[I],B=(m[I+1]&31)<<8|m[I+2];L===Gi.H264_STREAM_TYPE&&f.programMapTable.video===null?f.programMapTable.video=B:L===Gi.ADTS_STREAM_TYPE&&f.programMapTable.audio===null?f.programMapTable.audio=B:L===Gi.METADATA_STREAM_TYPE&&(f.programMapTable["timed-metadata"][B]=L),I+=((m[I+3]&15)<<8|m[I+4])+5}_.programMapTable=f.programMapTable}},this.push=function(m){var _={},b=4;if(_.payloadUnitStartIndicator=!!(m[1]&64),_.pid=m[1]&31,_.pid<<=8,_.pid|=m[2],(m[3]&48)>>>4>1&&(b+=m[b]+1),_.pid===0)_.type="pat",l(m.subarray(b),_),this.trigger("data",_);else if(_.pid===this.pmtPid)for(_.type="pmt",l(m.subarray(b),_),this.trigger("data",_);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([m,b,_]):this.processPes_(m,b,_)},this.processPes_=function(m,_,b){b.pid===this.programMapTable.video?b.streamType=Gi.H264_STREAM_TYPE:b.pid===this.programMapTable.audio?b.streamType=Gi.ADTS_STREAM_TYPE:b.streamType=this.programMapTable["timed-metadata"][b.pid],b.type="pes",b.data=m.subarray(_),this.trigger("data",b)}},Fa.prototype=new _h,Fa.STREAM_TYPES={h264:27,adts:15},Du=function(){var l=this,d=!1,p={data:[],size:0},f={data:[],size:0},m={data:[],size:0},_,b=function(w,I){var L;const B=w[0]<<16|w[1]<<8|w[2];I.data=new Uint8Array,B===1&&(I.packetLength=6+(w[4]<<8|w[5]),I.dataAlignmentIndicator=(w[6]&4)!==0,L=w[7],L&192&&(I.pts=(w[9]&14)<<27|(w[10]&255)<<20|(w[11]&254)<<12|(w[12]&255)<<5|(w[13]&254)>>>3,I.pts*=4,I.pts+=(w[13]&6)>>>1,I.dts=I.pts,L&64&&(I.dts=(w[14]&14)<<27|(w[15]&255)<<20|(w[16]&254)<<12|(w[17]&255)<<5|(w[18]&254)>>>3,I.dts*=4,I.dts+=(w[18]&6)>>>1)),I.data=w.subarray(9+w[8]))},x=function(w,I,L){var B=new Uint8Array(w.size),Q={type:I},$=0,he=0,de=!1,Et;if(!(!w.data.length||w.size<9)){for(Q.trackId=w.data[0].pid,$=0;$<w.data.length;$++)Et=w.data[$],B.set(Et.data,he),he+=Et.data.byteLength;b(B,Q),de=I==="video"||Q.packetLength<=w.size,(L||de)&&(w.size=0,w.data.length=0),de&&l.trigger("data",Q)}};Du.prototype.init.call(this),this.push=function(w){({pat:function(){},pes:function(){var I,L;switch(w.streamType){case Gi.H264_STREAM_TYPE:I=p,L="video";break;case Gi.ADTS_STREAM_TYPE:I=f,L="audio";break;case Gi.METADATA_STREAM_TYPE:I=m,L="timed-metadata";break;default:return}w.payloadUnitStartIndicator&&x(I,L,!0),I.data.push(w),I.size+=w.data.byteLength},pmt:function(){var I={type:"metadata",tracks:[]};_=w.programMapTable,_.video!==null&&I.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.video,codec:"avc",type:"video"}),_.audio!==null&&I.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.audio,codec:"adts",type:"audio"}),d=!0,l.trigger("data",I)}})[w.type]()},this.reset=function(){p.size=0,p.data.length=0,f.size=0,f.data.length=0,this.trigger("reset")},this.flushStreams_=function(){x(p,"video"),x(f,"audio"),x(m,"timed-metadata")},this.flush=function(){if(!d&&_){var w={type:"metadata",tracks:[]};_.video!==null&&w.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.video,codec:"avc",type:"video"}),_.audio!==null&&w.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+_.audio,codec:"adts",type:"audio"}),l.trigger("data",w)}d=!1,this.flushStreams_(),this.trigger("done")}},Du.prototype=new _h;var Gm={PAT_PID:0,MP2T_PACKET_LENGTH:rs,TransportPacketStream:Au,TransportParseStream:Fa,ElementaryStream:Du,TimestampRolloverStream:ES,CaptionStream:yh.CaptionStream,Cea608Stream:yh.Cea608Stream,Cea708Stream:yh.Cea708Stream,MetadataStream:bS};for(var Th in Gi)Gi.hasOwnProperty(Th)&&(Gm[Th]=Gi[Th]);var SS=Gm,xS=t,CS=Ge.ONE_SECOND_IN_TS,Iu,zm=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Iu=function(l){var d,p=0;Iu.prototype.init.call(this),this.skipWarn_=function(f,m){this.trigger("log",{level:"warn",message:`adts skiping bytes ${f} to ${m} in frame ${p} outside syncword`})},this.push=function(f){var m=0,_,b,x,w,I;if(l||(p=0),f.type==="audio"){d&&d.length?(x=d,d=new Uint8Array(x.byteLength+f.data.byteLength),d.set(x),d.set(f.data,x.byteLength)):d=f.data;for(var L;m+7<d.length;){if(d[m]!==255||(d[m+1]&246)!==240){typeof L!="number"&&(L=m),m++;continue}if(typeof L=="number"&&(this.skipWarn_(L,m),L=null),b=(~d[m+1]&1)*2,_=(d[m+3]&3)<<11|d[m+4]<<3|(d[m+5]&224)>>5,w=((d[m+6]&3)+1)*1024,I=w*CS/zm[(d[m+2]&60)>>>2],d.byteLength-m<_)break;this.trigger("data",{pts:f.pts+p*I,dts:f.dts+p*I,sampleCount:w,audioobjecttype:(d[m+2]>>>6&3)+1,channelcount:(d[m+2]&1)<<2|(d[m+3]&192)>>>6,samplerate:zm[(d[m+2]&60)>>>2],samplingfrequencyindex:(d[m+2]&60)>>>2,samplesize:16,data:d.subarray(m+7+b,m+_)}),p++,m+=_}typeof L=="number"&&(this.skipWarn_(L,m),L=null),d=d.subarray(m)}},this.flush=function(){p=0,this.trigger("done")},this.reset=function(){d=void 0,this.trigger("reset")},this.endTimeline=function(){d=void 0,this.trigger("endedtimeline")}},Iu.prototype=new xS;var wS=Iu,Wm;Wm=function(l){var d=l.byteLength,p=0,f=0;this.length=function(){return 8*d},this.bitsAvailable=function(){return 8*d+f},this.loadWord=function(){var m=l.byteLength-d,_=new Uint8Array(4),b=Math.min(4,d);if(b===0)throw new Error("no bytes available");_.set(l.subarray(m,m+b)),p=new DataView(_.buffer).getUint32(0),f=b*8,d-=b},this.skipBits=function(m){var _;f>m?(p<<=m,f-=m):(m-=f,_=Math.floor(m/8),m-=_*8,d-=_,this.loadWord(),p<<=m,f-=m)},this.readBits=function(m){var _=Math.min(f,m),b=p>>>32-_;return f-=_,f>0?p<<=_:d>0&&this.loadWord(),_=m-_,_>0?b<<_|this.readBits(_):b},this.skipLeadingZeros=function(){var m;for(m=0;m<f;++m)if(p&2147483648>>>m)return p<<=m,f-=m,m;return this.loadWord(),m+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var m=this.skipLeadingZeros();return this.readBits(m+1)-1},this.readExpGolomb=function(){var m=this.readUnsignedExpGolomb();return 1&m?1+m>>>1:-1*(m>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var AS=Wm,Km=t,DS=AS,ku,Ba,Xm;Ba=function(){var l=0,d,p;Ba.prototype.init.call(this),this.push=function(f){var m;p?(m=new Uint8Array(p.byteLength+f.data.byteLength),m.set(p),m.set(f.data,p.byteLength),p=m):p=f.data;for(var _=p.byteLength;l<_-3;l++)if(p[l+2]===1){d=l+5;break}for(;d<_;)switch(p[d]){case 0:if(p[d-1]!==0){d+=2;break}else if(p[d-2]!==0){d++;break}l+3!==d-2&&this.trigger("data",p.subarray(l+3,d-2));do d++;while(p[d]!==1&&d<_);l=d-2,d+=3;break;case 1:if(p[d-1]!==0||p[d-2]!==0){d+=3;break}this.trigger("data",p.subarray(l+3,d-2)),l=d-2,d+=3;break;default:d+=3;break}p=p.subarray(l),d-=l,l=0},this.reset=function(){p=null,l=0,this.trigger("reset")},this.flush=function(){p&&p.byteLength>3&&this.trigger("data",p.subarray(l+3)),p=null,l=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Ba.prototype=new Km,Xm={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},ku=function(){var l=new Ba,d,p,f,m,_,b,x;ku.prototype.init.call(this),d=this,this.push=function(w){w.type==="video"&&(p=w.trackId,f=w.pts,m=w.dts,l.push(w))},l.on("data",function(w){var I={trackId:p,pts:f,dts:m,data:w,nalUnitTypeCode:w[0]&31};switch(I.nalUnitTypeCode){case 5:I.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:I.nalUnitType="sei_rbsp",I.escapedRBSP=_(w.subarray(1));break;case 7:I.nalUnitType="seq_parameter_set_rbsp",I.escapedRBSP=_(w.subarray(1)),I.config=b(I.escapedRBSP);break;case 8:I.nalUnitType="pic_parameter_set_rbsp";break;case 9:I.nalUnitType="access_unit_delimiter_rbsp";break}d.trigger("data",I)}),l.on("done",function(){d.trigger("done")}),l.on("partialdone",function(){d.trigger("partialdone")}),l.on("reset",function(){d.trigger("reset")}),l.on("endedtimeline",function(){d.trigger("endedtimeline")}),this.flush=function(){l.flush()},this.partialFlush=function(){l.partialFlush()},this.reset=function(){l.reset()},this.endTimeline=function(){l.endTimeline()},x=function(w,I){var L=8,B=8,Q,$;for(Q=0;Q<w;Q++)B!==0&&($=I.readExpGolomb(),B=(L+$+256)%256),L=B===0?L:B},_=function(w){for(var I=w.byteLength,L=[],B=1,Q,$;B<I-2;)w[B]===0&&w[B+1]===0&&w[B+2]===3?(L.push(B+2),B+=2):B++;if(L.length===0)return w;Q=I-L.length,$=new Uint8Array(Q);var he=0;for(B=0;B<Q;he++,B++)he===L[0]&&(he++,L.shift()),$[B]=w[he];return $},b=function(w){var I=0,L=0,B=0,Q=0,$,he,de,Et,Oi,br,xg,Cg,wg,kh,Ag,ht=[1,1],Dg,Er;if($=new DS(w),he=$.readUnsignedByte(),Et=$.readUnsignedByte(),de=$.readUnsignedByte(),$.skipUnsignedExpGolomb(),Xm[he]&&(Oi=$.readUnsignedExpGolomb(),Oi===3&&$.skipBits(1),$.skipUnsignedExpGolomb(),$.skipUnsignedExpGolomb(),$.skipBits(1),$.readBoolean()))for(Ag=Oi!==3?8:12,Er=0;Er<Ag;Er++)$.readBoolean()&&(Er<6?x(16,$):x(64,$));if($.skipUnsignedExpGolomb(),br=$.readUnsignedExpGolomb(),br===0)$.readUnsignedExpGolomb();else if(br===1)for($.skipBits(1),$.skipExpGolomb(),$.skipExpGolomb(),xg=$.readUnsignedExpGolomb(),Er=0;Er<xg;Er++)$.skipExpGolomb();if($.skipUnsignedExpGolomb(),$.skipBits(1),Cg=$.readUnsignedExpGolomb(),wg=$.readUnsignedExpGolomb(),kh=$.readBits(1),kh===0&&$.skipBits(1),$.skipBits(1),$.readBoolean()&&(I=$.readUnsignedExpGolomb(),L=$.readUnsignedExpGolomb(),B=$.readUnsignedExpGolomb(),Q=$.readUnsignedExpGolomb()),$.readBoolean()&&$.readBoolean()){switch(Dg=$.readUnsignedByte(),Dg){case 1:ht=[1,1];break;case 2:ht=[12,11];break;case 3:ht=[10,11];break;case 4:ht=[16,11];break;case 5:ht=[40,33];break;case 6:ht=[24,11];break;case 7:ht=[20,11];break;case 8:ht=[32,11];break;case 9:ht=[80,33];break;case 10:ht=[18,11];break;case 11:ht=[15,11];break;case 12:ht=[64,33];break;case 13:ht=[160,99];break;case 14:ht=[4,3];break;case 15:ht=[3,2];break;case 16:ht=[2,1];break;case 255:{ht=[$.readUnsignedByte()<<8|$.readUnsignedByte(),$.readUnsignedByte()<<8|$.readUnsignedByte()];break}}ht&&ht[0]/ht[1]}return{profileIdc:he,levelIdc:de,profileCompatibility:Et,width:(Cg+1)*16-I*2-L*2,height:(2-kh)*(wg+1)*16-B*2-Q*2,sarRatio:ht}}},ku.prototype=new Km;var IS={H264Stream:ku,NalByteStream:Ba},kS=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ym=function(l,d){var p=l[d+6]<<21|l[d+7]<<14|l[d+8]<<7|l[d+9],f=l[d+5],m=(f&16)>>4;return p=p>=0?p:0,m?p+20:p+10},Qm=function(l,d){return l.length-d<10||l[d]!=="I".charCodeAt(0)||l[d+1]!=="D".charCodeAt(0)||l[d+2]!=="3".charCodeAt(0)?d:(d+=Ym(l,d),Qm(l,d))},PS=function(l){var d=Qm(l,0);return l.length>=d+2&&(l[d]&255)===255&&(l[d+1]&240)===240&&(l[d+1]&22)===16},Jm=function(l){return l[0]<<21|l[1]<<14|l[2]<<7|l[3]},RS=function(l,d,p){var f,m="";for(f=d;f<p;f++)m+="%"+("00"+l[f].toString(16)).slice(-2);return m},OS=function(l,d,p){return unescape(RS(l,d,p))},LS=function(l,d){var p=(l[d+5]&224)>>5,f=l[d+4]<<3,m=l[d+3]&6144;return m|f|p},NS=function(l,d){return l[d]==="I".charCodeAt(0)&&l[d+1]==="D".charCodeAt(0)&&l[d+2]==="3".charCodeAt(0)?"timed-metadata":l[d]&!0&&(l[d+1]&240)===240?"audio":null},MS=function(l){for(var d=0;d+5<l.length;){if(l[d]!==255||(l[d+1]&246)!==240){d++;continue}return kS[(l[d+2]&60)>>>2]}return null},FS=function(l){var d,p,f,m;d=10,l[5]&64&&(d+=4,d+=Jm(l.subarray(10,14)));do{if(p=Jm(l.subarray(d+4,d+8)),p<1)return null;if(m=String.fromCharCode(l[d],l[d+1],l[d+2],l[d+3]),m==="PRIV"){f=l.subarray(d+10,d+p+10);for(var _=0;_<f.byteLength;_++)if(f[_]===0){var b=OS(f,0,_);if(b==="com.apple.streaming.transportStreamTimestamp"){var x=f.subarray(_+1),w=(x[3]&1)<<30|x[4]<<22|x[5]<<14|x[6]<<6|x[7]>>>2;return w*=4,w+=x[7]&3,w}break}}d+=10,d+=p}while(d<l.byteLength);return null},bh={isLikelyAacData:PS,parseId3TagSize:Ym,parseAdtsSize:LS,parseType:NS,parseSampleRate:MS,parseAacTimestamp:FS},BS=t,Zm=bh,Pu;Pu=function(){var l=new Uint8Array,d=0;Pu.prototype.init.call(this),this.setTimestamp=function(p){d=p},this.push=function(p){var f=0,m=0,_,b,x,w;for(l.length?(w=l.length,l=new Uint8Array(p.byteLength+w),l.set(l.subarray(0,w)),l.set(p,w)):l=p;l.length-m>=3;){if(l[m]==="I".charCodeAt(0)&&l[m+1]==="D".charCodeAt(0)&&l[m+2]==="3".charCodeAt(0)){if(l.length-m<10||(f=Zm.parseId3TagSize(l,m),m+f>l.length))break;b={type:"timed-metadata",data:l.subarray(m,m+f)},this.trigger("data",b),m+=f;continue}else if((l[m]&255)===255&&(l[m+1]&240)===240){if(l.length-m<7||(f=Zm.parseAdtsSize(l,m),m+f>l.length))break;x={type:"audio",data:l.subarray(m,m+f),pts:d,dts:d},this.trigger("data",x),m+=f;continue}m++}_=l.length-m,_>0?l=l.subarray(m):l=new Uint8Array},this.reset=function(){l=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){l=new Uint8Array,this.trigger("endedtimeline")}},Pu.prototype=new BS;var US=Pu,VS=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],jS=VS,$S=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],qS=$S,Ru=t,Ua=De,Va=_r,Ou=Ra,zi=C,Cn=SS,Lu=Ge,eg=wS,HS=IS.H264Stream,GS=US,zS=bh.isLikelyAacData,WS=Ge.ONE_SECOND_IN_TS,Eh=jS,Sh=qS,ja,ss,Nu,vr,KS=function(l,d){d.stream=l,this.trigger("log",d)},tg=function(l,d){for(var p=Object.keys(d),f=0;f<p.length;f++){var m=p[f];m==="headOfPipeline"||!d[m].on||d[m].on("log",KS.bind(l,m))}},ig=function(l,d){var p;if(l.length!==d.length)return!1;for(p=0;p<l.length;p++)if(l[p]!==d[p])return!1;return!0},xh=function(l,d,p,f,m,_){var b=p-d,x=f-d,w=m-p;return{start:{dts:l,pts:l+b},end:{dts:l+x,pts:l+w},prependedContentDuration:_,baseMediaDecodeTime:l}};ss=function(l,d){var p=[],f,m=0,_=0,b=1/0;d=d||{},f=d.firstSequenceNumber||0,ss.prototype.init.call(this),this.push=function(x){zi.collectDtsInfo(l,x),l&&Eh.forEach(function(w){l[w]=x[w]}),p.push(x)},this.setEarliestDts=function(x){m=x},this.setVideoBaseMediaDecodeTime=function(x){b=x},this.setAudioAppendStart=function(x){_=x},this.flush=function(){var x,w,I,L,B,Q,$;if(p.length===0){this.trigger("done","AudioSegmentStream");return}x=Ou.trimAdtsFramesByEarliestDts(p,l,m),l.baseMediaDecodeTime=zi.calculateTrackBaseMediaDecodeTime(l,d.keepOriginalTimestamps),$=Ou.prefixWithSilence(l,x,_,b),l.samples=Ou.generateSampleTable(x),I=Ua.mdat(Ou.concatenateFrameData(x)),p=[],w=Ua.moof(f,[l]),L=new Uint8Array(w.byteLength+I.byteLength),f++,L.set(w),L.set(I,w.byteLength),zi.clearDtsInfo(l),B=Math.ceil(WS*1024/l.samplerate),x.length&&(Q=x.length*B,this.trigger("segmentTimingInfo",xh(Lu.audioTsToVideoTs(l.baseMediaDecodeTime,l.samplerate),x[0].dts,x[0].pts,x[0].dts+Q,x[0].pts+Q,$||0)),this.trigger("timingInfo",{start:x[0].pts,end:x[0].pts+Q})),this.trigger("data",{track:l,boxes:L}),this.trigger("done","AudioSegmentStream")},this.reset=function(){zi.clearDtsInfo(l),p=[],this.trigger("reset")}},ss.prototype=new Ru,ja=function(l,d){var p,f=[],m=[],_,b;d=d||{},p=d.firstSequenceNumber||0,ja.prototype.init.call(this),delete l.minPTS,this.gopCache_=[],this.push=function(x){zi.collectDtsInfo(l,x),x.nalUnitType==="seq_parameter_set_rbsp"&&!_&&(_=x.config,l.sps=[x.data],Sh.forEach(function(w){l[w]=_[w]},this)),x.nalUnitType==="pic_parameter_set_rbsp"&&!b&&(b=x.data,l.pps=[x.data]),f.push(x)},this.flush=function(){for(var x,w,I,L,B,Q,$=0,he,de;f.length&&f[0].nalUnitType!=="access_unit_delimiter_rbsp";)f.shift();if(f.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(x=Va.groupNalsIntoFrames(f),I=Va.groupFramesIntoGops(x),I[0][0].keyFrame||(w=this.getGopForFusion_(f[0],l),w?($=w.duration,I.unshift(w),I.byteLength+=w.byteLength,I.nalCount+=w.nalCount,I.pts=w.pts,I.dts=w.dts,I.duration+=w.duration):I=Va.extendFirstKeyFrame(I)),m.length){var Et;if(d.alignGopsAtEnd?Et=this.alignGopsAtEnd_(I):Et=this.alignGopsAtStart_(I),!Et){this.gopCache_.unshift({gop:I.pop(),pps:l.pps,sps:l.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),f=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}zi.clearDtsInfo(l),I=Et}zi.collectDtsInfo(l,I),l.samples=Va.generateSampleTable(I),B=Ua.mdat(Va.concatenateNalData(I)),l.baseMediaDecodeTime=zi.calculateTrackBaseMediaDecodeTime(l,d.keepOriginalTimestamps),this.trigger("processedGopsInfo",I.map(function(Oi){return{pts:Oi.pts,dts:Oi.dts,byteLength:Oi.byteLength}})),he=I[0],de=I[I.length-1],this.trigger("segmentTimingInfo",xh(l.baseMediaDecodeTime,he.dts,he.pts,de.dts+de.duration,de.pts+de.duration,$)),this.trigger("timingInfo",{start:I[0].pts,end:I[I.length-1].pts+I[I.length-1].duration}),this.gopCache_.unshift({gop:I.pop(),pps:l.pps,sps:l.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),f=[],this.trigger("baseMediaDecodeTime",l.baseMediaDecodeTime),this.trigger("timelineStartInfo",l.timelineStartInfo),L=Ua.moof(p,[l]),Q=new Uint8Array(L.byteLength+B.byteLength),p++,Q.set(L),Q.set(B,L.byteLength),this.trigger("data",{track:l,boxes:Q}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),f=[],this.gopCache_.length=0,m.length=0,this.trigger("reset")},this.resetStream_=function(){zi.clearDtsInfo(l),_=void 0,b=void 0},this.getGopForFusion_=function(x){var w=45e3,I=1e4,L=1/0,B,Q,$,he,de;for(de=0;de<this.gopCache_.length;de++)he=this.gopCache_[de],$=he.gop,!(!(l.pps&&ig(l.pps[0],he.pps[0]))||!(l.sps&&ig(l.sps[0],he.sps[0])))&&($.dts<l.timelineStartInfo.dts||(B=x.dts-$.dts-$.duration,B>=-I&&B<=w&&(!Q||L>B)&&(Q=he,L=B)));return Q?Q.gop:null},this.alignGopsAtStart_=function(x){var w,I,L,B,Q,$,he,de;for(Q=x.byteLength,$=x.nalCount,he=x.duration,w=I=0;w<m.length&&I<x.length&&(L=m[w],B=x[I],L.pts!==B.pts);){if(B.pts>L.pts){w++;continue}I++,Q-=B.byteLength,$-=B.nalCount,he-=B.duration}return I===0?x:I===x.length?null:(de=x.slice(I),de.byteLength=Q,de.duration=he,de.nalCount=$,de.pts=de[0].pts,de.dts=de[0].dts,de)},this.alignGopsAtEnd_=function(x){var w,I,L,B,Q,$;for(w=m.length-1,I=x.length-1,Q=null,$=!1;w>=0&&I>=0;){if(L=m[w],B=x[I],L.pts===B.pts){$=!0;break}if(L.pts>B.pts){w--;continue}w===m.length-1&&(Q=I),I--}if(!$&&Q===null)return null;var he;if($?he=I:he=Q,he===0)return x;var de=x.slice(he),Et=de.reduce(function(Oi,br){return Oi.byteLength+=br.byteLength,Oi.duration+=br.duration,Oi.nalCount+=br.nalCount,Oi},{byteLength:0,duration:0,nalCount:0});return de.byteLength=Et.byteLength,de.duration=Et.duration,de.nalCount=Et.nalCount,de.pts=de[0].pts,de.dts=de[0].dts,de},this.alignGopsWith=function(x){m=x}},ja.prototype=new Ru,vr=function(l,d){this.numberOfTracks=0,this.metadataStream=d,l=l||{},typeof l.remux<"u"?this.remuxTracks=!!l.remux:this.remuxTracks=!0,typeof l.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=l.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,vr.prototype.init.call(this),this.push=function(p){if(p.text)return this.pendingCaptions.push(p);if(p.frames)return this.pendingMetadata.push(p);this.pendingTracks.push(p.track),this.pendingBytes+=p.boxes.byteLength,p.track.type==="video"&&(this.videoTrack=p.track,this.pendingBoxes.push(p.boxes)),p.track.type==="audio"&&(this.audioTrack=p.track,this.pendingBoxes.unshift(p.boxes))}},vr.prototype=new Ru,vr.prototype.flush=function(l){var d=0,p={captions:[],captionStreams:{},metadata:[],info:{}},f,m,_,b=0,x;if(this.pendingTracks.length<this.numberOfTracks){if(l!=="VideoSegmentStream"&&l!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(b=this.videoTrack.timelineStartInfo.pts,Sh.forEach(function(w){p.info[w]=this.videoTrack[w]},this)):this.audioTrack&&(b=this.audioTrack.timelineStartInfo.pts,Eh.forEach(function(w){p.info[w]=this.audioTrack[w]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?p.type=this.pendingTracks[0].type:p.type="combined",this.emittedTracks+=this.pendingTracks.length,_=Ua.initSegment(this.pendingTracks),p.initSegment=new Uint8Array(_.byteLength),p.initSegment.set(_),p.data=new Uint8Array(this.pendingBytes),x=0;x<this.pendingBoxes.length;x++)p.data.set(this.pendingBoxes[x],d),d+=this.pendingBoxes[x].byteLength;for(x=0;x<this.pendingCaptions.length;x++)f=this.pendingCaptions[x],f.startTime=Lu.metadataTsToSeconds(f.startPts,b,this.keepOriginalTimestamps),f.endTime=Lu.metadataTsToSeconds(f.endPts,b,this.keepOriginalTimestamps),p.captionStreams[f.stream]=!0,p.captions.push(f);for(x=0;x<this.pendingMetadata.length;x++)m=this.pendingMetadata[x],m.cueTime=Lu.metadataTsToSeconds(m.pts,b,this.keepOriginalTimestamps),p.metadata.push(m);for(p.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",p),x=0;x<p.captions.length;x++)f=p.captions[x],this.trigger("caption",f);for(x=0;x<p.metadata.length;x++)m=p.metadata[x],this.trigger("id3Frame",m)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},vr.prototype.setRemux=function(l){this.remuxTracks=l},Nu=function(l){var d=this,p=!0,f,m;Nu.prototype.init.call(this),l=l||{},this.baseMediaDecodeTime=l.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var _={};this.transmuxPipeline_=_,_.type="aac",_.metadataStream=new Cn.MetadataStream,_.aacStream=new GS,_.audioTimestampRolloverStream=new Cn.TimestampRolloverStream("audio"),_.timedMetadataTimestampRolloverStream=new Cn.TimestampRolloverStream("timed-metadata"),_.adtsStream=new eg,_.coalesceStream=new vr(l,_.metadataStream),_.headOfPipeline=_.aacStream,_.aacStream.pipe(_.audioTimestampRolloverStream).pipe(_.adtsStream),_.aacStream.pipe(_.timedMetadataTimestampRolloverStream).pipe(_.metadataStream).pipe(_.coalesceStream),_.metadataStream.on("timestamp",function(b){_.aacStream.setTimestamp(b.timeStamp)}),_.aacStream.on("data",function(b){b.type!=="timed-metadata"&&b.type!=="audio"||_.audioSegmentStream||(m=m||{timelineStartInfo:{baseMediaDecodeTime:d.baseMediaDecodeTime},codec:"adts",type:"audio"},_.coalesceStream.numberOfTracks++,_.audioSegmentStream=new ss(m,l),_.audioSegmentStream.on("log",d.getLogTrigger_("audioSegmentStream")),_.audioSegmentStream.on("timingInfo",d.trigger.bind(d,"audioTimingInfo")),_.adtsStream.pipe(_.audioSegmentStream).pipe(_.coalesceStream),d.trigger("trackinfo",{hasAudio:!!m,hasVideo:!!f}))}),_.coalesceStream.on("data",this.trigger.bind(this,"data")),_.coalesceStream.on("done",this.trigger.bind(this,"done")),tg(this,_)},this.setupTsPipeline=function(){var _={};this.transmuxPipeline_=_,_.type="ts",_.metadataStream=new Cn.MetadataStream,_.packetStream=new Cn.TransportPacketStream,_.parseStream=new Cn.TransportParseStream,_.elementaryStream=new Cn.ElementaryStream,_.timestampRolloverStream=new Cn.TimestampRolloverStream,_.adtsStream=new eg,_.h264Stream=new HS,_.captionStream=new Cn.CaptionStream(l),_.coalesceStream=new vr(l,_.metadataStream),_.headOfPipeline=_.packetStream,_.packetStream.pipe(_.parseStream).pipe(_.elementaryStream).pipe(_.timestampRolloverStream),_.timestampRolloverStream.pipe(_.h264Stream),_.timestampRolloverStream.pipe(_.adtsStream),_.timestampRolloverStream.pipe(_.metadataStream).pipe(_.coalesceStream),_.h264Stream.pipe(_.captionStream).pipe(_.coalesceStream),_.elementaryStream.on("data",function(b){var x;if(b.type==="metadata"){for(x=b.tracks.length;x--;)!f&&b.tracks[x].type==="video"?(f=b.tracks[x],f.timelineStartInfo.baseMediaDecodeTime=d.baseMediaDecodeTime):!m&&b.tracks[x].type==="audio"&&(m=b.tracks[x],m.timelineStartInfo.baseMediaDecodeTime=d.baseMediaDecodeTime);f&&!_.videoSegmentStream&&(_.coalesceStream.numberOfTracks++,_.videoSegmentStream=new ja(f,l),_.videoSegmentStream.on("log",d.getLogTrigger_("videoSegmentStream")),_.videoSegmentStream.on("timelineStartInfo",function(w){m&&!l.keepOriginalTimestamps&&(m.timelineStartInfo=w,_.audioSegmentStream.setEarliestDts(w.dts-d.baseMediaDecodeTime))}),_.videoSegmentStream.on("processedGopsInfo",d.trigger.bind(d,"gopInfo")),_.videoSegmentStream.on("segmentTimingInfo",d.trigger.bind(d,"videoSegmentTimingInfo")),_.videoSegmentStream.on("baseMediaDecodeTime",function(w){m&&_.audioSegmentStream.setVideoBaseMediaDecodeTime(w)}),_.videoSegmentStream.on("timingInfo",d.trigger.bind(d,"videoTimingInfo")),_.h264Stream.pipe(_.videoSegmentStream).pipe(_.coalesceStream)),m&&!_.audioSegmentStream&&(_.coalesceStream.numberOfTracks++,_.audioSegmentStream=new ss(m,l),_.audioSegmentStream.on("log",d.getLogTrigger_("audioSegmentStream")),_.audioSegmentStream.on("timingInfo",d.trigger.bind(d,"audioTimingInfo")),_.audioSegmentStream.on("segmentTimingInfo",d.trigger.bind(d,"audioSegmentTimingInfo")),_.adtsStream.pipe(_.audioSegmentStream).pipe(_.coalesceStream)),d.trigger("trackinfo",{hasAudio:!!m,hasVideo:!!f})}}),_.coalesceStream.on("data",this.trigger.bind(this,"data")),_.coalesceStream.on("id3Frame",function(b){b.dispatchType=_.metadataStream.dispatchType,d.trigger("id3Frame",b)}),_.coalesceStream.on("caption",this.trigger.bind(this,"caption")),_.coalesceStream.on("done",this.trigger.bind(this,"done")),tg(this,_)},this.setBaseMediaDecodeTime=function(_){var b=this.transmuxPipeline_;l.keepOriginalTimestamps||(this.baseMediaDecodeTime=_),m&&(m.timelineStartInfo.dts=void 0,m.timelineStartInfo.pts=void 0,zi.clearDtsInfo(m),b.audioTimestampRolloverStream&&b.audioTimestampRolloverStream.discontinuity()),f&&(b.videoSegmentStream&&(b.videoSegmentStream.gopCache_=[]),f.timelineStartInfo.dts=void 0,f.timelineStartInfo.pts=void 0,zi.clearDtsInfo(f),b.captionStream.reset()),b.timestampRolloverStream&&b.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(_){m&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(_)},this.setRemux=function(_){var b=this.transmuxPipeline_;l.remux=_,b&&b.coalesceStream&&b.coalesceStream.setRemux(_)},this.alignGopsWith=function(_){f&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(_)},this.getLogTrigger_=function(_){var b=this;return function(x){x.stream=_,b.trigger("log",x)}},this.push=function(_){if(p){var b=zS(_);b&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!b&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),p=!1}this.transmuxPipeline_.headOfPipeline.push(_)},this.flush=function(){p=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Nu.prototype=new Ru;var XS={Transmuxer:Nu,VideoSegmentStream:ja,AudioSegmentStream:ss,AUDIO_PROPERTIES:Eh,VIDEO_PROPERTIES:Sh,generateSegmentTimingInfo:xh},YS=function(l){return l>>>0},QS=function(l){return("00"+l.toString(16)).slice(-2)},Mu={toUnsigned:YS,toHexString:QS},JS=function(l){var d="";return d+=String.fromCharCode(l[0]),d+=String.fromCharCode(l[1]),d+=String.fromCharCode(l[2]),d+=String.fromCharCode(l[3]),d},ng=JS,ZS=Mu.toUnsigned,e1=ng,rg=function(l,d){var p=[],f,m,_,b,x;if(!d.length)return null;for(f=0;f<l.byteLength;)m=ZS(l[f]<<24|l[f+1]<<16|l[f+2]<<8|l[f+3]),_=e1(l.subarray(f+4,f+8)),b=m>1?f+m:l.byteLength,_===d[0]&&(d.length===1?p.push(l.subarray(f+8,b)):(x=rg(l.subarray(f+8,b),d.slice(1)),x.length&&(p=p.concat(x)))),f=b;return p},sg=rg,t1=Mu.toUnsigned,i1=s.getUint64,n1=function(l){var d={version:l[0],flags:new Uint8Array(l.subarray(1,4))};return d.version===1?d.baseMediaDecodeTime=i1(l.subarray(4)):d.baseMediaDecodeTime=t1(l[4]<<24|l[5]<<16|l[6]<<8|l[7]),d},ag=n1,r1=function(l){return{isLeading:(l[0]&12)>>>2,dependsOn:l[0]&3,isDependedOn:(l[1]&192)>>>6,hasRedundancy:(l[1]&48)>>>4,paddingValue:(l[1]&14)>>>1,isNonSyncSample:l[1]&1,degradationPriority:l[2]<<8|l[3]}},s1=r1,og=s1,a1=function(l){var d={version:l[0],flags:new Uint8Array(l.subarray(1,4)),samples:[]},p=new DataView(l.buffer,l.byteOffset,l.byteLength),f=d.flags[2]&1,m=d.flags[2]&4,_=d.flags[1]&1,b=d.flags[1]&2,x=d.flags[1]&4,w=d.flags[1]&8,I=p.getUint32(4),L=8,B;for(f&&(d.dataOffset=p.getInt32(L),L+=4),m&&I&&(B={flags:og(l.subarray(L,L+4))},L+=4,_&&(B.duration=p.getUint32(L),L+=4),b&&(B.size=p.getUint32(L),L+=4),w&&(d.version===1?B.compositionTimeOffset=p.getInt32(L):B.compositionTimeOffset=p.getUint32(L),L+=4),d.samples.push(B),I--);I--;)B={},_&&(B.duration=p.getUint32(L),L+=4),b&&(B.size=p.getUint32(L),L+=4),x&&(B.flags=og(l.subarray(L,L+4)),L+=4),w&&(d.version===1?B.compositionTimeOffset=p.getInt32(L):B.compositionTimeOffset=p.getUint32(L),L+=4),d.samples.push(B);return d},ug=a1,o1=function(l){var d=new DataView(l.buffer,l.byteOffset,l.byteLength),p={version:l[0],flags:new Uint8Array(l.subarray(1,4)),trackId:d.getUint32(4)},f=p.flags[2]&1,m=p.flags[2]&2,_=p.flags[2]&8,b=p.flags[2]&16,x=p.flags[2]&32,w=p.flags[0]&65536,I=p.flags[0]&131072,L;return L=8,f&&(L+=4,p.baseDataOffset=d.getUint32(12),L+=4),m&&(p.sampleDescriptionIndex=d.getUint32(L),L+=4),_&&(p.defaultSampleDuration=d.getUint32(L),L+=4),b&&(p.defaultSampleSize=d.getUint32(L),L+=4),x&&(p.defaultSampleFlags=d.getUint32(L)),w&&(p.durationIsEmpty=!0),!f&&I&&(p.baseDataOffsetIsMoof=!0),p},lg=o1,$a;typeof window<"u"?$a=window:typeof i<"u"?$a=i:typeof self<"u"?$a=self:$a={};var cg=$a,u1=Se.discardEmulationPreventionBytes,l1=Su.CaptionStream,qa=sg,c1=ag,h1=ug,d1=lg,hg=cg,f1=function(l,d){for(var p=l,f=0;f<d.length;f++){var m=d[f];if(p<m.size)return m;p-=m.size}return null},p1=function(l,d,p){var f=new DataView(l.buffer,l.byteOffset,l.byteLength),m={logs:[],seiNals:[]},_,b,x,w;for(b=0;b+4<l.length;b+=x)if(x=f.getUint32(b),b+=4,!(x<=0))switch(l[b]&31){case 6:var I=l.subarray(b+1,b+1+x),L=f1(b,d);if(_={nalUnitType:"sei_rbsp",size:x,data:I,escapedRBSP:u1(I),trackId:p},L)_.pts=L.pts,_.dts=L.dts,w=L;else if(w)_.pts=w.pts,_.dts=w.dts;else{m.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+b+" for trackId "+p+". See mux.js#223."});break}m.seiNals.push(_);break}return m},m1=function(l,d,p){var f=d,m=p.defaultSampleDuration||0,_=p.defaultSampleSize||0,b=p.trackId,x=[];return l.forEach(function(w){var I=h1(w),L=I.samples;L.forEach(function(B){B.duration===void 0&&(B.duration=m),B.size===void 0&&(B.size=_),B.trackId=b,B.dts=f,B.compositionTimeOffset===void 0&&(B.compositionTimeOffset=0),typeof f=="bigint"?(B.pts=f+hg.BigInt(B.compositionTimeOffset),f+=hg.BigInt(B.duration)):(B.pts=f+B.compositionTimeOffset,f+=B.duration)}),x=x.concat(L)}),x},g1=function(l,d){var p=qa(l,["moof","traf"]),f=qa(l,["mdat"]),m={},_=[];return f.forEach(function(b,x){var w=p[x];_.push({mdat:b,traf:w})}),_.forEach(function(b){var x=b.mdat,w=b.traf,I=qa(w,["tfhd"]),L=d1(I[0]),B=L.trackId,Q=qa(w,["tfdt"]),$=Q.length>0?c1(Q[0]).baseMediaDecodeTime:0,he=qa(w,["trun"]),de,Et;d===B&&he.length>0&&(de=m1(he,$,L),Et=p1(x,de,B),m[B]||(m[B]={seiNals:[],logs:[]}),m[B].seiNals=m[B].seiNals.concat(Et.seiNals),m[B].logs=m[B].logs.concat(Et.logs))}),m},_1=function(l,d,p){var f;if(d===null)return null;f=g1(l,d);var m=f[d]||{};return{seiNals:m.seiNals,logs:m.logs,timescale:p}},y1=function(){var l=!1,d,p,f,m,_,b;this.isInitialized=function(){return l},this.init=function(x){d=new l1,l=!0,b=x?x.isPartial:!1,d.on("data",function(w){w.startTime=w.startPts/m,w.endTime=w.endPts/m,_.captions.push(w),_.captionStreams[w.stream]=!0}),d.on("log",function(w){_.logs.push(w)})},this.isNewInit=function(x,w){return x&&x.length===0||w&&typeof w=="object"&&Object.keys(w).length===0?!1:f!==x[0]||m!==w[f]},this.parse=function(x,w,I){var L;if(this.isInitialized()){if(!w||!I)return null;if(this.isNewInit(w,I))f=w[0],m=I[f];else if(f===null||!m)return p.push(x),null}else return null;for(;p.length>0;){var B=p.shift();this.parse(B,w,I)}return L=_1(x,f,m),L&&L.logs&&(_.logs=_.logs.concat(L.logs)),L===null||!L.seiNals?_.logs.length?{logs:_.logs,captions:[],captionStreams:[]}:null:(this.pushNals(L.seiNals),this.flushStream(),_)},this.pushNals=function(x){if(!this.isInitialized()||!x||x.length===0)return null;x.forEach(function(w){d.push(w)})},this.flushStream=function(){if(!this.isInitialized())return null;b?d.partialFlush():d.flush()},this.clearParsedCaptions=function(){_.captions=[],_.captionStreams={},_.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;d.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){p=[],f=null,m=null,_?this.clearParsedCaptions():_={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},v1=y1,T1=function(l){for(var d=0,p=String.fromCharCode(l[d]),f="";p!=="\0";)f+=p,d++,p=String.fromCharCode(l[d]);return f+=p,f},b1={uint8ToCString:T1},Fu=b1.uint8ToCString,E1=s.getUint64,S1=function(l){var d=4,p=l[0],f,m,_,b,x,w,I,L;if(p===0){f=Fu(l.subarray(d)),d+=f.length,m=Fu(l.subarray(d)),d+=m.length;var B=new DataView(l.buffer);_=B.getUint32(d),d+=4,x=B.getUint32(d),d+=4,w=B.getUint32(d),d+=4,I=B.getUint32(d),d+=4}else if(p===1){var B=new DataView(l.buffer);_=B.getUint32(d),d+=4,b=E1(l.subarray(d)),d+=8,w=B.getUint32(d),d+=4,I=B.getUint32(d),d+=4,f=Fu(l.subarray(d)),d+=f.length,m=Fu(l.subarray(d)),d+=m.length}L=new Uint8Array(l.subarray(d,l.byteLength));var Q={scheme_id_uri:f,value:m,timescale:_||1,presentation_time:b,presentation_time_delta:x,event_duration:w,id:I,message_data:L};return C1(p,Q)?Q:void 0},x1=function(l,d,p,f){return l||l===0?l/d:f+p/d},C1=function(l,d){var p=d.scheme_id_uri!=="\0",f=l===0&&dg(d.presentation_time_delta)&&p,m=l===1&&dg(d.presentation_time)&&p;return!(l>1)&&f||m},dg=function(l){return l!==void 0||l!==null},w1={parseEmsgBox:S1,scaleTime:x1},Bu=Mu.toUnsigned,Ha=Mu.toHexString,ct=sg,as=ng,Ch=w1,A1=lg,D1=ug,I1=ag,k1=s.getUint64,fg,pg,mg,gg,_g,wh,yg,Ah=cg,P1=Hm.parseId3Frames;fg=function(l){var d={},p=ct(l,["moov","trak"]);return p.reduce(function(f,m){var _,b,x,w,I;return _=ct(m,["tkhd"])[0],!_||(b=_[0],x=b===0?12:20,w=Bu(_[x]<<24|_[x+1]<<16|_[x+2]<<8|_[x+3]),I=ct(m,["mdia","mdhd"])[0],!I)?null:(b=I[0],x=b===0?12:20,f[w]=Bu(I[x]<<24|I[x+1]<<16|I[x+2]<<8|I[x+3]),f)},d)},pg=function(l,d){var p;p=ct(d,["moof","traf"]);var f=p.reduce(function(m,_){var b=ct(_,["tfhd"])[0],x=Bu(b[4]<<24|b[5]<<16|b[6]<<8|b[7]),w=l[x]||9e4,I=ct(_,["tfdt"])[0],L=new DataView(I.buffer,I.byteOffset,I.byteLength),B;I[0]===1?B=k1(I.subarray(4,12)):B=L.getUint32(4);let Q;return typeof B=="bigint"?Q=B/Ah.BigInt(w):typeof B=="number"&&!isNaN(B)&&(Q=B/w),Q<Number.MAX_SAFE_INTEGER&&(Q=Number(Q)),Q<m&&(m=Q),m},1/0);return typeof f=="bigint"||isFinite(f)?f:0},mg=function(l,d){var p=ct(d,["moof","traf"]),f=0,m=0,_;if(p&&p.length){var b=ct(p[0],["tfhd"])[0],x=ct(p[0],["trun"])[0],w=ct(p[0],["tfdt"])[0];if(b){var I=A1(b);_=I.trackId}if(w){var L=I1(w);f=L.baseMediaDecodeTime}if(x){var B=D1(x);B.samples&&B.samples.length&&(m=B.samples[0].compositionTimeOffset||0)}}var Q=l[_]||9e4;typeof f=="bigint"&&(m=Ah.BigInt(m),Q=Ah.BigInt(Q));var $=(f+m)/Q;return typeof $=="bigint"&&$<Number.MAX_SAFE_INTEGER&&($=Number($)),$},gg=function(l){var d=ct(l,["moov","trak"]),p=[];return d.forEach(function(f){var m=ct(f,["mdia","hdlr"]),_=ct(f,["tkhd"]);m.forEach(function(b,x){var w=as(b.subarray(8,12)),I=_[x],L,B,Q;w==="vide"&&(L=new DataView(I.buffer,I.byteOffset,I.byteLength),B=L.getUint8(0),Q=B===0?L.getUint32(12):L.getUint32(20),p.push(Q))})}),p},wh=function(l){var d=l[0],p=d===0?12:20;return Bu(l[p]<<24|l[p+1]<<16|l[p+2]<<8|l[p+3])},_g=function(l){var d=ct(l,["moov","trak"]),p=[];return d.forEach(function(f){var m={},_=ct(f,["tkhd"])[0],b,x;_&&(b=new DataView(_.buffer,_.byteOffset,_.byteLength),x=b.getUint8(0),m.id=x===0?b.getUint32(12):b.getUint32(20));var w=ct(f,["mdia","hdlr"])[0];if(w){var I=as(w.subarray(8,12));I==="vide"?m.type="video":I==="soun"?m.type="audio":m.type=I}var L=ct(f,["mdia","minf","stbl","stsd"])[0];if(L){var B=L.subarray(8);m.codec=as(B.subarray(4,8));var Q=ct(B,[m.codec])[0],$,he;Q&&(/^[asm]vc[1-9]$/i.test(m.codec)?($=Q.subarray(78),he=as($.subarray(4,8)),he==="avcC"&&$.length>11?(m.codec+=".",m.codec+=Ha($[9]),m.codec+=Ha($[10]),m.codec+=Ha($[11])):m.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(m.codec)?($=Q.subarray(28),he=as($.subarray(4,8)),he==="esds"&&$.length>20&&$[19]!==0?(m.codec+="."+Ha($[19]),m.codec+="."+Ha($[20]>>>2&63).replace(/^0/,"")):m.codec="mp4a.40.2"):m.codec=m.codec.toLowerCase())}var de=ct(f,["mdia","mdhd"])[0];de&&(m.timescale=wh(de)),p.push(m)}),p},yg=function(l,d=0){var p=ct(l,["emsg"]);return p.map(f=>{var m=Ch.parseEmsgBox(new Uint8Array(f)),_=P1(m.message_data);return{cueTime:Ch.scaleTime(m.presentation_time,m.timescale,m.presentation_time_delta,d),duration:Ch.scaleTime(m.event_duration,m.timescale),frames:_}})};var vg={findBox:ct,parseType:as,timescale:fg,startTime:pg,compositionStartTime:mg,videoTrackIds:gg,tracks:_g,getTimescaleFromMediaHeader:wh,getEmsgID3:yg},Dh=ns,Tg=function(l){var d=l[1]&31;return d<<=8,d|=l[2],d},Uu=function(l){return!!(l[1]&64)},Vu=function(l){var d=0;return(l[3]&48)>>>4>1&&(d+=l[4]+1),d},R1=function(l,d){var p=Tg(l);return p===0?"pat":p===d?"pmt":d?"pes":null},O1=function(l){var d=Uu(l),p=4+Vu(l);return d&&(p+=l[p]+1),(l[p+10]&31)<<8|l[p+11]},L1=function(l){var d={},p=Uu(l),f=4+Vu(l);if(p&&(f+=l[f]+1),!!(l[f+5]&1)){var m,_,b;m=(l[f+1]&15)<<8|l[f+2],_=3+m-4,b=(l[f+10]&15)<<8|l[f+11];for(var x=12+b;x<_;){var w=f+x;d[(l[w+1]&31)<<8|l[w+2]]=l[w],x+=((l[w+3]&15)<<8|l[w+4])+5}return d}},N1=function(l,d){var p=Tg(l),f=d[p];switch(f){case Dh.H264_STREAM_TYPE:return"video";case Dh.ADTS_STREAM_TYPE:return"audio";case Dh.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},M1=function(l){var d=Uu(l);if(!d)return null;var p=4+Vu(l);if(p>=l.byteLength)return null;var f=null,m;return m=l[p+7],m&192&&(f={},f.pts=(l[p+9]&14)<<27|(l[p+10]&255)<<20|(l[p+11]&254)<<12|(l[p+12]&255)<<5|(l[p+13]&254)>>>3,f.pts*=4,f.pts+=(l[p+13]&6)>>>1,f.dts=f.pts,m&64&&(f.dts=(l[p+14]&14)<<27|(l[p+15]&255)<<20|(l[p+16]&254)<<12|(l[p+17]&255)<<5|(l[p+18]&254)>>>3,f.dts*=4,f.dts+=(l[p+18]&6)>>>1)),f},Ih=function(l){switch(l){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},F1=function(l){for(var d=4+Vu(l),p=l.subarray(d),f=0,m=0,_=!1,b;m<p.byteLength-3;m++)if(p[m+2]===1){f=m+5;break}for(;f<p.byteLength;)switch(p[f]){case 0:if(p[f-1]!==0){f+=2;break}else if(p[f-2]!==0){f++;break}m+3!==f-2&&(b=Ih(p[m+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(_=!0));do f++;while(p[f]!==1&&f<p.length);m=f-2,f+=3;break;case 1:if(p[f-1]!==0||p[f-2]!==0){f+=3;break}b=Ih(p[m+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(_=!0),m=f-2,f+=3;break;default:f+=3;break}return p=p.subarray(m),f-=m,m=0,p&&p.byteLength>3&&(b=Ih(p[m+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(_=!0)),_},B1={parseType:R1,parsePat:O1,parsePmt:L1,parsePayloadUnitStartIndicator:Uu,parsePesType:N1,parsePesTime:M1,videoPacketContainsKeyFrame:F1},bg=ns,os=$m.handleRollover,Ve={};Ve.ts=B1,Ve.aac=bh;var Tr=Ge.ONE_SECOND_IN_TS,ti=188,en=71,U1=function(l,d){for(var p=0,f=ti,m,_;f<l.byteLength;){if(l[p]===en&&l[f]===en){switch(m=l.subarray(p,f),_=Ve.ts.parseType(m,d.pid),_){case"pat":d.pid=Ve.ts.parsePat(m);break;case"pmt":var b=Ve.ts.parsePmt(m);d.table=d.table||{},Object.keys(b).forEach(function(x){d.table[x]=b[x]});break}p+=ti,f+=ti;continue}p++,f++}},Eg=function(l,d,p){for(var f=0,m=ti,_,b,x,w,I,L=!1;m<=l.byteLength;){if(l[f]===en&&(l[m]===en||m===l.byteLength)){switch(_=l.subarray(f,m),b=Ve.ts.parseType(_,d.pid),b){case"pes":x=Ve.ts.parsePesType(_,d.table),w=Ve.ts.parsePayloadUnitStartIndicator(_),x==="audio"&&w&&(I=Ve.ts.parsePesTime(_),I&&(I.type="audio",p.audio.push(I),L=!0));break}if(L)break;f+=ti,m+=ti;continue}f++,m++}for(m=l.byteLength,f=m-ti,L=!1;f>=0;){if(l[f]===en&&(l[m]===en||m===l.byteLength)){switch(_=l.subarray(f,m),b=Ve.ts.parseType(_,d.pid),b){case"pes":x=Ve.ts.parsePesType(_,d.table),w=Ve.ts.parsePayloadUnitStartIndicator(_),x==="audio"&&w&&(I=Ve.ts.parsePesTime(_),I&&(I.type="audio",p.audio.push(I),L=!0));break}if(L)break;f-=ti,m-=ti;continue}f--,m--}},V1=function(l,d,p){for(var f=0,m=ti,_,b,x,w,I,L,B,Q,$=!1,he={data:[],size:0};m<l.byteLength;){if(l[f]===en&&l[m]===en){switch(_=l.subarray(f,m),b=Ve.ts.parseType(_,d.pid),b){case"pes":if(x=Ve.ts.parsePesType(_,d.table),w=Ve.ts.parsePayloadUnitStartIndicator(_),x==="video"&&(w&&!$&&(I=Ve.ts.parsePesTime(_),I&&(I.type="video",p.video.push(I),$=!0)),!p.firstKeyFrame)){if(w&&he.size!==0){for(L=new Uint8Array(he.size),B=0;he.data.length;)Q=he.data.shift(),L.set(Q,B),B+=Q.byteLength;if(Ve.ts.videoPacketContainsKeyFrame(L)){var de=Ve.ts.parsePesTime(L);de?(p.firstKeyFrame=de,p.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}he.size=0}he.data.push(_),he.size+=_.byteLength}break}if($&&p.firstKeyFrame)break;f+=ti,m+=ti;continue}f++,m++}for(m=l.byteLength,f=m-ti,$=!1;f>=0;){if(l[f]===en&&l[m]===en){switch(_=l.subarray(f,m),b=Ve.ts.parseType(_,d.pid),b){case"pes":x=Ve.ts.parsePesType(_,d.table),w=Ve.ts.parsePayloadUnitStartIndicator(_),x==="video"&&w&&(I=Ve.ts.parsePesTime(_),I&&(I.type="video",p.video.push(I),$=!0));break}if($)break;f-=ti,m-=ti;continue}f--,m--}},j1=function(l,d){if(l.audio&&l.audio.length){var p=d;(typeof p>"u"||isNaN(p))&&(p=l.audio[0].dts),l.audio.forEach(function(_){_.dts=os(_.dts,p),_.pts=os(_.pts,p),_.dtsTime=_.dts/Tr,_.ptsTime=_.pts/Tr})}if(l.video&&l.video.length){var f=d;if((typeof f>"u"||isNaN(f))&&(f=l.video[0].dts),l.video.forEach(function(_){_.dts=os(_.dts,f),_.pts=os(_.pts,f),_.dtsTime=_.dts/Tr,_.ptsTime=_.pts/Tr}),l.firstKeyFrame){var m=l.firstKeyFrame;m.dts=os(m.dts,f),m.pts=os(m.pts,f),m.dtsTime=m.dts/Tr,m.ptsTime=m.pts/Tr}}},$1=function(l){for(var d=!1,p=0,f=null,m=null,_=0,b=0,x;l.length-b>=3;){var w=Ve.aac.parseType(l,b);switch(w){case"timed-metadata":if(l.length-b<10){d=!0;break}if(_=Ve.aac.parseId3TagSize(l,b),_>l.length){d=!0;break}m===null&&(x=l.subarray(b,b+_),m=Ve.aac.parseAacTimestamp(x)),b+=_;break;case"audio":if(l.length-b<7){d=!0;break}if(_=Ve.aac.parseAdtsSize(l,b),_>l.length){d=!0;break}f===null&&(x=l.subarray(b,b+_),f=Ve.aac.parseSampleRate(x)),p++,b+=_;break;default:b++;break}if(d)return null}if(f===null||m===null)return null;var I=Tr/f,L={audio:[{type:"audio",dts:m,pts:m},{type:"audio",dts:m+p*1024*I,pts:m+p*1024*I}]};return L},q1=function(l){var d={pid:null,table:null},p={};U1(l,d);for(var f in d.table)if(d.table.hasOwnProperty(f)){var m=d.table[f];switch(m){case bg.H264_STREAM_TYPE:p.video=[],V1(l,d,p),p.video.length===0&&delete p.video;break;case bg.ADTS_STREAM_TYPE:p.audio=[],Eg(l,d,p),p.audio.length===0&&delete p.audio;break}}return p},H1=function(l,d){var p=Ve.aac.isLikelyAacData(l),f;return p?f=$1(l):f=q1(l),!f||!f.audio&&!f.video?null:(j1(f,d),f)},G1={inspect:H1,parseAudioPes_:Eg};const z1=function(l,d){d.on("data",function(p){const f=p.initSegment;p.initSegment={data:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength};const m=p.data;p.data=m.buffer,l.postMessage({action:"data",segment:p,byteOffset:m.byteOffset,byteLength:m.byteLength},[p.data])}),d.on("done",function(p){l.postMessage({action:"done"})}),d.on("gopInfo",function(p){l.postMessage({action:"gopInfo",gopInfo:p})}),d.on("videoSegmentTimingInfo",function(p){const f={start:{decode:Ge.videoTsToSeconds(p.start.dts),presentation:Ge.videoTsToSeconds(p.start.pts)},end:{decode:Ge.videoTsToSeconds(p.end.dts),presentation:Ge.videoTsToSeconds(p.end.pts)},baseMediaDecodeTime:Ge.videoTsToSeconds(p.baseMediaDecodeTime)};p.prependedContentDuration&&(f.prependedContentDuration=Ge.videoTsToSeconds(p.prependedContentDuration)),l.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:f})}),d.on("audioSegmentTimingInfo",function(p){const f={start:{decode:Ge.videoTsToSeconds(p.start.dts),presentation:Ge.videoTsToSeconds(p.start.pts)},end:{decode:Ge.videoTsToSeconds(p.end.dts),presentation:Ge.videoTsToSeconds(p.end.pts)},baseMediaDecodeTime:Ge.videoTsToSeconds(p.baseMediaDecodeTime)};p.prependedContentDuration&&(f.prependedContentDuration=Ge.videoTsToSeconds(p.prependedContentDuration)),l.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:f})}),d.on("id3Frame",function(p){l.postMessage({action:"id3Frame",id3Frame:p})}),d.on("caption",function(p){l.postMessage({action:"caption",caption:p})}),d.on("trackinfo",function(p){l.postMessage({action:"trackinfo",trackInfo:p})}),d.on("audioTimingInfo",function(p){l.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:Ge.videoTsToSeconds(p.start),end:Ge.videoTsToSeconds(p.end)}})}),d.on("videoTimingInfo",function(p){l.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:Ge.videoTsToSeconds(p.start),end:Ge.videoTsToSeconds(p.end)}})}),d.on("log",function(p){l.postMessage({action:"log",log:p})})};class Sg{constructor(d,p){this.options=p||{},this.self=d,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new XS.Transmuxer(this.options),z1(this.self,this.transmuxer)}pushMp4Captions(d){this.captionParser||(this.captionParser=new v1,this.captionParser.init());const p=new Uint8Array(d.data,d.byteOffset,d.byteLength),f=this.captionParser.parse(p,d.trackIds,d.timescales);this.self.postMessage({action:"mp4Captions",captions:f&&f.captions||[],logs:f&&f.logs||[],data:p.buffer},[p.buffer])}probeMp4StartTime({timescales:d,data:p}){const f=vg.startTime(d,p);this.self.postMessage({action:"probeMp4StartTime",startTime:f,data:p},[p.buffer])}probeMp4Tracks({data:d}){const p=vg.tracks(d);this.self.postMessage({action:"probeMp4Tracks",tracks:p,data:d},[d.buffer])}probeTs({data:d,baseStartTime:p}){const f=typeof p=="number"&&!isNaN(p)?p*Ge.ONE_SECOND_IN_TS:void 0,m=G1.inspect(d,f);let _=null;m&&(_={hasVideo:m.video&&m.video.length===2||!1,hasAudio:m.audio&&m.audio.length===2||!1},_.hasVideo&&(_.videoStart=m.video[0].ptsTime),_.hasAudio&&(_.audioStart=m.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:_,data:d},[d.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(d){const p=new Uint8Array(d.data,d.byteOffset,d.byteLength);this.transmuxer.push(p)}reset(){this.transmuxer.reset()}setTimestampOffset(d){const p=d.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(Ge.secondsToVideoTs(p)))}setAudioAppendStart(d){this.transmuxer.setAudioAppendStart(Math.ceil(Ge.secondsToVideoTs(d.appendStart)))}setRemux(d){this.transmuxer.setRemux(d.remux)}flush(d){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(d){this.transmuxer.alignGopsWith(d.gopsToAlignWith.slice())}}self.onmessage=function(l){if(l.data.action==="init"&&l.data.options){this.messageHandlers=new Sg(self,l.data.options);return}this.messageHandlers||(this.messageHandlers=new Sg(self)),l.data&&l.data.action&&l.data.action!=="init"&&this.messageHandlers[l.data.action]&&this.messageHandlers[l.data.action](l.data)}}));var oP=Ab(aP);const uP=(i,e,t)=>{const{type:n,initSegment:r,captions:s,captionStreams:a,metadata:o,videoFrameDtsTime:u,videoFramePtsTime:c}=i.data.segment;e.buffer.push({captions:s,captionStreams:a,metadata:o});const h=i.data.segment.boxes||{data:i.data.segment.data},g={type:n,data:new Uint8Array(h.data,h.data.byteOffset,h.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};typeof u<"u"&&(g.videoFrameDtsTime=u),typeof c<"u"&&(g.videoFramePtsTime=c),t(g)},lP=({transmuxedData:i,callback:e})=>{i.buffer=[],e(i)},cP=(i,e)=>{e.gopInfo=i.data.gopInfo},kb=i=>{const{transmuxer:e,bytes:t,audioAppendStart:n,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:o,onAudioTimingInfo:u,onVideoTimingInfo:c,onVideoSegmentTimingInfo:h,onAudioSegmentTimingInfo:g,onId3:y,onCaptions:v,onDone:T,onEndedTimeline:S,onTransmuxerLog:A,isEndOfTimeline:k}=i,P={buffer:[]};let M=k;const R=O=>{e.currentTransmux===i&&(O.data.action==="data"&&uP(O,P,a),O.data.action==="trackinfo"&&o(O.data.trackInfo),O.data.action==="gopInfo"&&cP(O,P),O.data.action==="audioTimingInfo"&&u(O.data.audioTimingInfo),O.data.action==="videoTimingInfo"&&c(O.data.videoTimingInfo),O.data.action==="videoSegmentTimingInfo"&&h(O.data.videoSegmentTimingInfo),O.data.action==="audioSegmentTimingInfo"&&g(O.data.audioSegmentTimingInfo),O.data.action==="id3Frame"&&y([O.data.id3Frame],O.data.id3Frame.dispatchType),O.data.action==="caption"&&v(O.data.caption),O.data.action==="endedtimeline"&&(M=!1,S()),O.data.action==="log"&&A(O.data.log),O.data.type==="transmuxed"&&(M||(e.onmessage=null,lP({transmuxedData:P,callback:T}),Pb(e))))};if(e.onmessage=R,n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),typeof s<"u"&&e.postMessage({action:"setRemux",remux:s}),t.byteLength){const O=t instanceof ArrayBuffer?t:t.buffer,j=t instanceof ArrayBuffer?0:t.byteOffset;e.postMessage({action:"push",data:O,byteOffset:j,byteLength:t.byteLength},[O])}k&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},Pb=i=>{i.currentTransmux=null,i.transmuxQueue.length&&(i.currentTransmux=i.transmuxQueue.shift(),typeof i.currentTransmux=="function"?i.currentTransmux():kb(i.currentTransmux))},Q0=(i,e)=>{i.postMessage({action:e}),Pb(i)},Rb=(i,e)=>{if(!e.currentTransmux){e.currentTransmux=i,Q0(e,i);return}e.transmuxQueue.push(Q0.bind(null,e,i))},hP=i=>{Rb("reset",i)},dP=i=>{Rb("endTimeline",i)},Ob=i=>{if(!i.transmuxer.currentTransmux){i.transmuxer.currentTransmux=i,kb(i);return}i.transmuxer.transmuxQueue.push(i)},fP=i=>{const e=new oP;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:i}),e};var id={reset:hP,endTimeline:dP,transmux:Ob,createTransmuxer:fP};const zl=function(i){const e=i.transmuxer,t=i.endAction||i.action,n=i.callback,r=On({},i,{endAction:null,transmuxer:null,callback:null}),s=a=>{a.data.action===t&&(e.removeEventListener("message",s),a.data.data&&(a.data.data=new Uint8Array(a.data.data,i.byteOffset||0,i.byteLength||a.data.data.byteLength),i.data&&(i.data=a.data.data)),n(a.data))};if(e.addEventListener("message",s),i.data){const a=i.data instanceof ArrayBuffer;r.byteOffset=a?0:i.data.byteOffset,r.byteLength=i.data.byteLength;const o=[a?i.data:i.data.buffer];e.postMessage(r,o)}else e.postMessage(r)},ln={FAILURE:2,TIMEOUT:-101,ABORTED:-102},ef=i=>{i.forEach(e=>{e.abort()})},pP=i=>({bandwidth:i.bandwidth,bytesReceived:i.bytesReceived||0,roundTripTime:i.roundTripTime||0}),mP=i=>{const e=i.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return n.bytesReceived=i.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},jp=(i,e)=>e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:ln.TIMEOUT,xhr:e}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:ln.ABORTED,xhr:e}:i?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:ln.FAILURE,xhr:e}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:ln.FAILURE,xhr:e}:null,J0=(i,e,t)=>(n,r)=>{const s=r.response,a=jp(n,r);if(a)return t(a,i);if(s.byteLength!==16)return t({status:r.status,message:"Invalid HLS key at URL: "+r.uri,code:ln.FAILURE,xhr:r},i);const o=new DataView(s),u=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);for(let c=0;c<e.length;c++)e[c].bytes=u;return t(null,i)},Lb=(i,e)=>{const t=sp(i.map.bytes);if(t!=="mp4"){const n=i.map.resolvedUri||i.map.uri;return e({internal:!0,message:`Found unsupported ${t||"unknown"} container for initialization segment at URL: ${n}`,code:ln.FAILURE})}zl({action:"probeMp4Tracks",data:i.map.bytes,transmuxer:i.transmuxer,callback:({tracks:n,data:r})=>(i.map.bytes=r,n.forEach(function(s){i.map.tracks=i.map.tracks||{},!i.map.tracks[s.type]&&(i.map.tracks[s.type]=s,typeof s.id=="number"&&s.timescale&&(i.map.timescales=i.map.timescales||{},i.map.timescales[s.id]=s.timescale))}),e(null))})},gP=({segment:i,finishProcessingFn:e})=>(t,n)=>{const r=jp(t,n);if(r)return e(r,i);const s=new Uint8Array(n.response);if(i.map.key)return i.map.encryptedBytes=s,e(null,i);i.map.bytes=s,Lb(i,function(a){if(a)return a.xhr=n,a.status=n.status,e(a,i);e(null,i)})},_P=({segment:i,finishProcessingFn:e,responseType:t})=>(n,r)=>{const s=jp(n,r);if(s)return e(s,i);const a=t==="arraybuffer"||!r.responseText?r.response:rP(r.responseText.substring(i.lastReachedChar||0));return i.stats=pP(r),i.key?i.encryptedBytes=new Uint8Array(a):i.bytes=new Uint8Array(a),e(null,i)},yP=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{const v=i.map&&i.map.tracks||{},T=!!(v.audio&&v.video);let S=n.bind(null,i,"audio","start");const A=n.bind(null,i,"audio","end");let k=n.bind(null,i,"video","start");const P=n.bind(null,i,"video","end"),M=()=>Ob({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,remux:T,onData:R=>{R.type=R.type==="combined"?"video":R.type,h(i,R)},onTrackInfo:R=>{t&&(T&&(R.isMuxed=!0),t(i,R))},onAudioTimingInfo:R=>{S&&typeof R.start<"u"&&(S(R.start),S=null),A&&typeof R.end<"u"&&A(R.end)},onVideoTimingInfo:R=>{k&&typeof R.start<"u"&&(k(R.start),k=null),P&&typeof R.end<"u"&&P(R.end)},onVideoSegmentTimingInfo:R=>{r(R)},onAudioSegmentTimingInfo:R=>{s(R)},onId3:(R,O)=>{a(i,R,O)},onCaptions:R=>{o(i,[R])},isEndOfTimeline:u,onEndedTimeline:()=>{c()},onTransmuxerLog:y,onDone:R=>{g&&(R.type=R.type==="combined"?"video":R.type,g(null,i,R))}});zl({action:"probeTs",transmuxer:i.transmuxer,data:e,baseStartTime:i.baseStartTime,callback:R=>{i.bytes=e=R.data;const O=R.result;O&&(t(i,{hasAudio:O.hasAudio,hasVideo:O.hasVideo,isMuxed:T}),t=null,O.hasAudio&&!T&&S(O.audioStart),O.hasVideo&&k(O.videoStart),S=null,k=null),M()}})},Nb=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{let v=new Uint8Array(e);if(GD(v)){i.isFmp4=!0;const{tracks:T}=i.map,S={isFmp4:!0,hasVideo:!!T.video,hasAudio:!!T.audio};T.audio&&T.audio.codec&&T.audio.codec!=="enca"&&(S.audioCodec=T.audio.codec),T.video&&T.video.codec&&T.video.codec!=="encv"&&(S.videoCodec=T.video.codec),T.video&&T.audio&&(S.isMuxed=!0),t(i,S);const A=k=>{h(i,{data:v,type:S.hasAudio&&!S.isMuxed?"audio":"video"}),k&&k.length&&o(i,k),g(null,i,{})};zl({action:"probeMp4StartTime",timescales:i.map.timescales,data:v,transmuxer:i.transmuxer,callback:({data:k,startTime:P})=>{if(e=k.buffer,i.bytes=v=k,S.hasAudio&&!S.isMuxed&&n(i,"audio","start",P),S.hasVideo&&n(i,"video","start",P),!T.video||!k.byteLength||!i.transmuxer){A();return}zl({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:i.transmuxer,data:v,timescales:i.map.timescales,trackIds:[T.video.id],callback:M=>{e=M.data.buffer,i.bytes=v=M.data,M.logs.forEach(function(R){y(Ye(R,{stream:"mp4CaptionParser"}))}),A(M.captions)}})}});return}if(!i.transmuxer){g(null,i,{});return}if(typeof i.container>"u"&&(i.container=sp(v)),i.container!=="ts"&&i.container!=="aac"){t(i,{hasAudio:!1,hasVideo:!1}),g(null,i,{});return}yP({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})},Mb=function({id:i,key:e,encryptedBytes:t,decryptionWorker:n},r){const s=o=>{if(o.data.source===i){n.removeEventListener("message",s);const u=o.data.decrypted;r(new Uint8Array(u.bytes,u.byteOffset,u.byteLength))}};n.addEventListener("message",s);let a;e.bytes.slice?a=e.bytes.slice():a=new Uint32Array(Array.prototype.slice.call(e.bytes)),n.postMessage(bb({source:i,encrypted:t,key:a,iv:e.iv}),[t.buffer,a.buffer])},vP=({decryptionWorker:i,segment:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{Mb({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:i},v=>{e.bytes=v,Nb({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})})},TP=({activeXhrs:i,decryptionWorker:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})=>{let v=0,T=!1;return(S,A)=>{if(!T){if(S)return T=!0,ef(i),g(S,A);if(v+=1,v===i.length){const k=function(){if(A.encryptedBytes)return vP({decryptionWorker:e,segment:A,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y});Nb({segment:A,bytes:A.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:g,onTransmuxerLog:y})};if(A.endOfAllRequests=Date.now(),A.map&&A.map.encryptedBytes&&!A.map.bytes)return Mb({decryptionWorker:e,id:A.requestId+"-init",encryptedBytes:A.map.encryptedBytes,key:A.map.key},P=>{A.map.bytes=P,Lb(A,M=>{if(M)return ef(i),g(M,A);k()})});k()}}}},bP=({loadendState:i,abortFn:e})=>t=>{t.target.aborted&&e&&!i.calledAbortFn&&(e(),i.calledAbortFn=!0)},EP=({segment:i,progressFn:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h})=>g=>{if(!g.target.aborted)return i.stats=Ye(i.stats,mP(g)),!i.stats.firstBytesReceivedAt&&i.stats.bytesReceived&&(i.stats.firstBytesReceivedAt=Date.now()),e(g,i)},SP=({xhr:i,xhrOptions:e,decryptionWorker:t,segment:n,abortFn:r,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:g,isEndOfTimeline:y,endedTimelineFn:v,dataFn:T,doneFn:S,onTransmuxerLog:A})=>{const k=[],P=TP({activeXhrs:k,decryptionWorker:t,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:g,isEndOfTimeline:y,endedTimelineFn:v,dataFn:T,doneFn:S,onTransmuxerLog:A});if(n.key&&!n.key.bytes){const z=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&z.push(n.map.key);const ee=Ye(e,{uri:n.key.resolvedUri,responseType:"arraybuffer"}),K=J0(n,z,P),oe=i(ee,K);k.push(oe)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const pe=Ye(e,{uri:n.map.key.resolvedUri,responseType:"arraybuffer"}),we=J0(n,[n.map.key],P),X=i(pe,we);k.push(X)}const ee=Ye(e,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:Jd(n.map)}),K=gP({segment:n,finishProcessingFn:P}),oe=i(ee,K);k.push(oe)}const M=Ye(e,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:Jd(n)}),R=_P({segment:n,finishProcessingFn:P,responseType:M.responseType}),O=i(M,R);O.addEventListener("progress",EP({segment:n,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:g,isEndOfTimeline:y,endedTimelineFn:v,dataFn:T})),k.push(O);const j={};return k.forEach(z=>{z.addEventListener("loadend",bP({loadendState:j,abortFn:r}))}),()=>ef(k)},xP=Ji("CodecUtils"),CP=function(i){const e=i.attributes||{};if(e.CODECS)return tn(e.CODECS)},Fb=(i,e)=>{const t=e.attributes||{};return i&&i.mediaGroups&&i.mediaGroups.AUDIO&&t.AUDIO&&i.mediaGroups.AUDIO[t.AUDIO]},wP=(i,e)=>{if(!Fb(i,e))return!0;const t=e.attributes||{},n=i.mediaGroups.AUDIO[t.AUDIO];for(const r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1},Wl=function(i){const e={};return i.forEach(({mediaType:t,type:n,details:r})=>{e[t]=e[t]||[],e[t].push(ev(`${n}${r}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){xP(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},Z0=function(i){let e=0;return i.audio&&e++,i.video&&e++,e},_o=function(i,e){const t=e.attributes||{},n=Wl(CP(e)||[]);if(Fb(i,e)&&!n.audio&&!wP(i,e)){const r=Wl(zw(i,t.AUDIO)||[]);r.audio&&(n.audio=r.audio)}return n},Xu=Ji("PlaylistSelector"),e_=function(i){if(!i||!i.playlist)return;const e=i.playlist;return JSON.stringify({id:e.id,bandwidth:i.bandwidth,width:i.width,height:i.height,codecs:e.attributes&&e.attributes.CODECS||""})},Kl=function(i,e){if(!i)return"";const t=D.getComputedStyle(i);return t?t[e]:""},Rs=function(i,e){const t=i.slice();i.sort(function(n,r){const s=e(n,r);return s===0?t.indexOf(n)-t.indexOf(r):s})},$p=function(i,e){let t,n;return i.attributes.BANDWIDTH&&(t=i.attributes.BANDWIDTH),t=t||D.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||D.Number.MAX_VALUE,t-n},AP=function(i,e){let t,n;return i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(t=i.attributes.RESOLUTION.width),t=t||D.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||D.Number.MAX_VALUE,t===n&&i.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?i.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-n};let Bb=function(i,e,t,n,r,s){if(!i)return;const a={bandwidth:e,width:t,height:n,limitRenditionByPlayerDimensions:r};let o=i.playlists;yi.isAudioOnly(i)&&(o=s.getAudioTrackPlaylists_(),a.audioOnly=!0);let u=o.map(O=>{let j;const z=O.attributes&&O.attributes.RESOLUTION&&O.attributes.RESOLUTION.width,ee=O.attributes&&O.attributes.RESOLUTION&&O.attributes.RESOLUTION.height;return j=O.attributes&&O.attributes.BANDWIDTH,j=j||D.Number.MAX_VALUE,{bandwidth:j,width:z,height:ee,playlist:O}});Rs(u,(O,j)=>O.bandwidth-j.bandwidth),u=u.filter(O=>!yi.isIncompatible(O.playlist));let c=u.filter(O=>yi.isEnabled(O.playlist));c.length||(c=u.filter(O=>!yi.isDisabled(O.playlist)));const h=c.filter(O=>O.bandwidth*At.BANDWIDTH_VARIANCE<e);let g=h[h.length-1];const y=h.filter(O=>O.bandwidth===g.bandwidth)[0];if(r===!1){const O=y||c[0]||u[0];if(O&&O.playlist){let j="sortedPlaylistReps";return y&&(j="bandwidthBestRep"),c[0]&&(j="enabledPlaylistReps"),Xu(`choosing ${e_(O)} using ${j} with options`,a),O.playlist}return Xu("could not choose a playlist with options",a),null}const v=h.filter(O=>O.width&&O.height);Rs(v,(O,j)=>O.width-j.width);const T=v.filter(O=>O.width===t&&O.height===n);g=T[T.length-1];const S=T.filter(O=>O.bandwidth===g.bandwidth)[0];let A,k,P;S||(A=v.filter(O=>O.width>t||O.height>n),k=A.filter(O=>O.width===A[0].width&&O.height===A[0].height),g=k[k.length-1],P=k.filter(O=>O.bandwidth===g.bandwidth)[0]);let M;if(s.leastPixelDiffSelector){const O=v.map(j=>(j.pixelDiff=Math.abs(j.width-t)+Math.abs(j.height-n),j));Rs(O,(j,z)=>j.pixelDiff===z.pixelDiff?z.bandwidth-j.bandwidth:j.pixelDiff-z.pixelDiff),M=O[0]}const R=M||P||S||y||c[0]||u[0];if(R&&R.playlist){let O="sortedPlaylistReps";return M?O="leastPixelDiffRep":P?O="resolutionPlusOneRep":S?O="resolutionBestRep":y?O="bandwidthBestRep":c[0]&&(O="enabledPlaylistReps"),Xu(`choosing ${e_(R)} using ${O} with options`,a),R.playlist}return Xu("could not choose a playlist with options",a),null};const t_=function(){const i=this.useDevicePixelRatio&&D.devicePixelRatio||1;return Bb(this.playlists.main,this.systemBandwidth,parseInt(Kl(this.tech_.el(),"width"),10)*i,parseInt(Kl(this.tech_.el(),"height"),10)*i,this.limitRenditionByPlayerDimensions,this.playlistController_)},DP=function(i){let e=-1,t=-1;if(i<0||i>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){const n=this.useDevicePixelRatio&&D.devicePixelRatio||1;return e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=i*this.systemBandwidth+(1-i)*e,t=this.systemBandwidth),Bb(this.playlists.main,e,parseInt(Kl(this.tech_.el(),"width"),10)*n,parseInt(Kl(this.tech_.el(),"height"),10)*n,this.limitRenditionByPlayerDimensions,this.playlistController_)}},IP=function(i){const{main:e,currentTime:t,bandwidth:n,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:o,syncController:u}=i,c=e.playlists.filter(T=>!yi.isIncompatible(T));let h=c.filter(yi.isEnabled);h.length||(h=c.filter(T=>!yi.isDisabled(T)));const y=h.filter(yi.hasAttribute.bind(null,"BANDWIDTH")).map(T=>{const A=u.getSyncPoint(T,r,o,t)?1:2,P=yi.estimateSegmentRequestTime(s,n,T)*A-a;return{playlist:T,rebufferingImpact:P}}),v=y.filter(T=>T.rebufferingImpact<=0);return Rs(v,(T,S)=>$p(S.playlist,T.playlist)),v.length?v[0]:(Rs(y,(T,S)=>T.rebufferingImpact-S.rebufferingImpact),y[0]||null)},kP=function(){const i=this.playlists.main.playlists.filter(yi.isEnabled);return Rs(i,(t,n)=>$p(t,n)),i.filter(t=>!!_o(this.playlists.main,t).video)[0]||null},PP=i=>{let e=0,t;return i.bytes&&(t=new Uint8Array(i.bytes),i.segments.forEach(n=>{t.set(n,e),e+=n.byteLength})),t},RP=function(i,e,t){if(!i[t]){e.trigger({type:"usage",name:"vhs-608"});let n=t;/^cc708_/.test(t)&&(n="SERVICE"+t.split("_")[1]);const r=e.textTracks().getTrackById(n);if(r)i[t]=r;else{const s=e.options_.vhs&&e.options_.vhs.captionServices||{};let a=t,o=t,u=!1;const c=s[n];c&&(a=c.label,o=c.language,u=c.default),i[t]=e.addRemoteTextTrack({kind:"captions",id:n,default:u,label:a,language:o},!1).track}}},OP=function({inbandTextTracks:i,captionArray:e,timestampOffset:t}){if(!e)return;const n=D.WebKitDataCue||D.VTTCue;e.forEach(r=>{const s=r.stream;i[s].addCue(new n(r.startTime+t,r.endTime+t,r.text))})},LP=function(i){Object.defineProperties(i.frame,{id:{get(){return F.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),i.value.key}},value:{get(){return F.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),i.value.data}},privateData:{get(){return F.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),i.value.data}}})},NP=({inbandTextTracks:i,metadataArray:e,timestampOffset:t,videoDuration:n})=>{if(!e)return;const r=D.WebKitDataCue||D.VTTCue,s=i.metadataTrack_;if(!s||(e.forEach(h=>{const g=h.cueTime+t;typeof g!="number"||D.isNaN(g)||g<0||!(g<1/0)||h.frames.forEach(y=>{const v=new r(g,g,y.value||y.url||y.data||"");v.frame=y,v.value=y,LP(v),s.addCue(v)})}),!s.cues||!s.cues.length))return;const a=s.cues,o=[];for(let h=0;h<a.length;h++)a[h]&&o.push(a[h]);const u=o.reduce((h,g)=>{const y=h[g.startTime]||[];return y.push(g),h[g.startTime]=y,h},{}),c=Object.keys(u).sort((h,g)=>Number(h)-Number(g));c.forEach((h,g)=>{const y=u[h],v=Number(c[g+1])||n;y.forEach(T=>{T.endTime=v})})},MP=(i,e,t)=>{i.metadataTrack_||(i.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,i.metadataTrack_.inBandMetadataTrackDispatchType=e)},so=function(i,e,t){let n,r;if(t&&t.cues)for(n=t.cues.length;n--;)r=t.cues[n],r.startTime>=i&&r.endTime<=e&&t.removeCue(r)},FP=function(i){const e=i.cues;if(e)for(let t=0;t<e.length;t++){const n=[];let r=0;for(let s=0;s<e.length;s++)e[t].startTime===e[s].startTime&&e[t].endTime===e[s].endTime&&e[t].text===e[s].text&&(r++,r>1&&n.push(e[s]));n.length&&n.forEach(s=>i.removeCue(s))}},BP=(i,e,t)=>{if(typeof e>"u"||e===null||!i.length)return[];const n=Math.ceil((e-t+3)*Pl.ONE_SECOND_IN_TS);let r;for(r=0;r<i.length&&!(i[r].pts>n);r++);return i.slice(r)},UP=(i,e,t)=>{if(!e.length)return i;if(t)return e.slice();const n=e[0].pts;let r=0;for(r;r<i.length&&!(i[r].pts>=n);r++);return i.slice(0,r).concat(e)},VP=(i,e,t,n)=>{const r=Math.ceil((e-n)*Pl.ONE_SECOND_IN_TS),s=Math.ceil((t-n)*Pl.ONE_SECOND_IN_TS),a=i.slice();let o=i.length;for(;o--&&!(i[o].pts<=s););if(o===-1)return a;let u=o+1;for(;u--&&!(i[u].pts<=r););return u=Math.max(u,0),a.splice(u,o-u+1),a},jP=function(i,e){if(!i&&!e||!i&&e||i&&!e)return!1;if(i===e)return!0;const t=Object.keys(i).sort(),n=Object.keys(e).sort();if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(s!==n[r]||i[s]!==e[s])return!1}return!0},Ub=22,$P=function(i,e,t){e=e||[];const n=[];let r=0;for(let s=0;s<e.length;s++){const a=e[s];if(i===a.timeline&&(n.push(s),r+=a.duration,r>t))return s}return n.length===0?0:n[n.length-1]},Qa=1,qP=500,i_=i=>typeof i=="number"&&isFinite(i),Yu=1/60,HP=(i,e,t)=>i!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,GP=(i,e,t)=>{let n=e-At.BACK_BUFFER_LENGTH;i.length&&(n=Math.max(n,i.start(0)));const r=e-t;return Math.min(r,n)},ms=i=>{const{startOfSegment:e,duration:t,segment:n,part:r,playlist:{mediaSequence:s,id:a,segments:o=[]},mediaIndex:u,partIndex:c,timeline:h}=i,g=o.length-1;let y="mediaIndex/partIndex increment";i.getMediaInfoForTime?y=`getMediaInfoForTime (${i.getMediaInfoForTime})`:i.isSyncRequest&&(y="getSyncSegmentCandidate (isSyncRequest)"),i.independent&&(y+=` with independent ${i.independent}`);const v=typeof c=="number",T=i.segment.uri?"segment":"pre-segment",S=v?ob({preloadSegment:n})-1:0;return`${T} [${s+u}/${s+g}]`+(v?` part [${c}/${S}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(v?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${h}] selected by [${y}] playlist [${a}]`},n_=i=>`${i}TimingInfo`,zP=({segmentTimeline:i,currentTimeline:e,startOfSegment:t,buffered:n,overrideCheck:r})=>!r&&i===e?null:i<e?t:n.length?n.end(n.length-1):t,r_=({timelineChangeController:i,currentTimeline:e,segmentTimeline:t,loaderType:n,audioDisabled:r})=>{if(e===t)return!1;if(n==="audio"){const s=i.lastTimelineChange({type:"main"});return!s||s.to!==t}if(n==="main"&&r){const s=i.pendingTimelineChange({type:"audio"});return!(s&&s.to===t)}return!1},WP=i=>{let e=0;return["video","audio"].forEach(function(t){const n=i[`${t}TimingInfo`];if(!n)return;const{start:r,end:s}=n;let a;typeof r=="bigint"||typeof s=="bigint"?a=D.BigInt(s)-D.BigInt(r):typeof r=="number"&&typeof s=="number"&&(a=s-r),typeof a<"u"&&a>e&&(e=a)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},s_=({segmentDuration:i,maxDuration:e})=>i?Math.round(i)>e+or:!1,KP=(i,e)=>{if(e!=="hls")return null;const t=WP({audioTimingInfo:i.audioTimingInfo,videoTimingInfo:i.videoTimingInfo});if(!t)return null;const n=i.playlist.targetDuration,r=s_({segmentDuration:t,maxDuration:n*2}),s=s_({segmentDuration:t,maxDuration:n}),a=`Segment with index ${i.mediaIndex} from playlist ${i.playlist.id} has a duration of ${t} when the reported duration is ${i.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||s?{severity:r?"warn":"info",message:a}:null};class tf extends F.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=F.browser.IE_VERSION>=11,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=Ji(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(n){n!==this.state_&&(this.logger_(`${this.state_} -> ${n}`),this.state_=n,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",()=>{this.hasEnoughInfoToLoad_()&&this.processLoadQueue_(),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})}createTransmuxer_(){return id.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&D.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,D.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&id.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return zt();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:n,isMuxed:r}=e;if(n&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=Gl(e);let r=this.initSegments_[n];return t&&!r&&e.bytes&&(this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const n=Eb(e);let r=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[n]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const s={resolvedUri:(r||e).resolvedUri};return r&&(s.bytes=r.bytes),s}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;const n=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let s=null;if(n&&(n.id?s=n.id:n.uri&&(s=n.uri)),this.logger_(`playlist update [${s} => ${e.id||e.uri}]`),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){this.mediaIndex!==null&&(e.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const a=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${a}]`),this.mediaIndex!==null)if(this.mediaIndex-=a,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const o=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!o.parts||!o.parts.length||!o.parts[this.partIndex])){const u=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=u}}r&&(r.mediaIndex-=a,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(D.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.resyncLoader()}resyncLoader(){this.transmuxer_&&id.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=()=>{},r=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let s=1;const a=()=>{s--,s===0&&n()};(r||!this.audioDisabled_)&&(s++,this.sourceUpdater_.removeAudio(e,t,a)),(r||this.loaderType_==="main")&&(this.gopBuffer_=VP(this.gopBuffer_,e,t,this.timeMapping_),s++,this.sourceUpdater_.removeVideo(e,t,a));for(const o in this.inbandTextTracks_)so(e,t,this.inbandTextTracks_[o]);so(e,t,this.segmentMetadataTrack_),a()}monitorBuffer_(){this.checkBufferTimeout_&&D.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=D.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&D.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=D.setTimeout(this.monitorBufferTick_.bind(this),qP)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();e&&(typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const r=typeof e=="number"&&t.segments[e],s=e+1===t.segments.length,a=!r||!r.parts||n+1===r.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&s&&a}chooseNextRequest_(){const e=this.buffered_(),t=W0(e)||0,n=Mp(e,this.currentTime_()),r=!this.hasPlayed_()&&n>=1,s=n>=this.goalBufferLength_(),a=this.playlist_.segments;if(!a.length||r||s)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());const o={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(o.isSyncRequest)o.mediaIndex=$P(this.currentTimeline_,a,t);else if(this.mediaIndex!==null){const g=a[this.mediaIndex],y=typeof this.partIndex=="number"?this.partIndex:-1;o.startOfSegment=g.end?g.end:t,g.parts&&g.parts[y+1]?(o.mediaIndex=this.mediaIndex,o.partIndex=y+1):o.mediaIndex=this.mediaIndex+1}else{const{segmentIndex:g,startTime:y,partIndex:v}=yi.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?t:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});o.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${t}`:`currentTime ${this.currentTime_()}`,o.mediaIndex=g,o.startOfSegment=y,o.partIndex=v}const u=a[o.mediaIndex];let c=u&&typeof o.partIndex=="number"&&u.parts&&u.parts[o.partIndex];if(!u||typeof o.partIndex=="number"&&!c)return null;if(typeof o.partIndex!="number"&&u.parts&&(o.partIndex=0,c=u.parts[0]),!n&&c&&!c.independent)if(o.partIndex===0){const g=a[o.mediaIndex-1],y=g.parts&&g.parts.length&&g.parts[g.parts.length-1];y&&y.independent&&(o.mediaIndex-=1,o.partIndex=g.parts.length-1,o.independent="previous segment")}else u.parts[o.partIndex-1].independent&&(o.partIndex-=1,o.independent="previous part");const h=this.mediaSource_&&this.mediaSource_.readyState==="ended";return o.mediaIndex>=a.length-1&&h&&!this.seeking_()?null:this.generateSegmentInfo_(o)}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:r,startOfSegment:s,isSyncRequest:a,partIndex:o,forceTimestampOffset:u,getMediaInfoForTime:c}=e,h=n.segments[r],g=typeof o=="number"&&h.parts[o],y={requestId:"segment-loader-"+Math.random(),uri:g&&g.resolvedUri||h.resolvedUri,mediaIndex:r,partIndex:g?o:null,isSyncRequest:a,startOfSegment:s,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:h.timeline,duration:g&&g.duration||h.duration,segment:h,part:g,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:c,independent:t},v=typeof u<"u"?u:this.isPendingTimestampOffset_;y.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:h.timeline,currentTimeline:this.currentTimeline_,startOfSegment:s,buffered:this.buffered_(),overrideCheck:v});const T=W0(this.sourceUpdater_.audioBuffered());return typeof T=="number"&&(y.audioAppendStart=T-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(y.gopsToAlignWith=BP(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),y}timestampOffsetForSegment_(e){return zP(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,s=yi.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),a=_k(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(s<=a)return;const o=IP({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!o)return;const c=s-a-o.rebufferingImpact;let h=.5;a<=or&&(h=1),!(!o.playlist||o.playlist.uri===this.playlist_.uri||c<h)&&(this.bandwidth=o.playlist.attributes.BANDWIDTH*At.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${ms(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},jP(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_())))}handleTimingInfo_(e,t,n,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const s=this.pendingSegment_,a=n_(t);s[a]=s[a]||{},s[a][n]=r,this.logger_(`timinginfo: ${t} - ${n} - ${r}`),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const r=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),s={};t.forEach(a=>{s[a.stream]=s[a.stream]||{startTime:1/0,captions:[],endTime:0};const o=s[a.stream];o.startTime=Math.min(o.startTime,a.startTime+r),o.endTime=Math.max(o.endTime,a.endTime+r),o.captions.push(a)}),Object.keys(s).forEach(a=>{const{startTime:o,endTime:u,captions:c}=s[a],h=this.inbandTextTracks_;this.logger_(`adding cues from ${o} -> ${u} for ${a}`),RP(h,this.vhs_.tech_,a),so(o,u,h[a]),OP({captionArray:c,inbandTextTracks:h,timestampOffset:r})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n));return}const s=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();MP(this.inbandTextTracks_,n,this.vhs_.tech_),NP({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:s,videoDuration:this.duration_()})}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!r_({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:r,isMuxed:s}=t;return!(r&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!s&&!e.audioTimingInfo||r_({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){this.callQueue_.push(this.handleData_.bind(this,e,t));return}const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[n_(t.type)].start;else{const r=this.getCurrentMediaInfo_(),s=this.loaderType_==="main"&&r&&r.hasVideo;let a;s&&(a=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:s,firstVideoFrameTimeForData:a,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:this.loaderType_==="main"});const r=this.chooseNextRequest_();if(r.mediaIndex!==n.mediaIndex||r.partIndex!==n.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:r}){if(n){const s=Gl(n);if(this.activeInitSegmentId_===s)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=s}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},r){const s=this.sourceUpdater_.audioBuffered(),a=this.sourceUpdater_.videoBuffered();s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+kr(s).join(", ")),a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+kr(a).join(", "));const o=s.length?s.start(0):0,u=s.length?s.end(s.length-1):0,c=a.length?a.start(0):0,h=a.length?a.end(a.length-1):0;if(u-o<=Qa&&h-c<=Qa){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${kr(s).join(", ")}, video buffer: ${kr(a).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const y=this.currentTime_()-Qa;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${y}`),this.remove(0,y,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${Qa}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=D.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},Qa*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},r){if(r){if(r.code===Ub){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error(`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:r,bytes:s}){if(!s){const a=[r];let o=r.byteLength;n&&(a.unshift(n),o+=n.byteLength),s=PP({bytes:o,segments:a})}this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:s},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:s}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,s=`${e}TimingInfo`;r[s]||(r[s]={}),r[s].transmuxerPrependedSeconds=n.prependedContentDuration||0,r[s].transmuxedPresentationStart=n.start.presentation,r[s].transmuxedDecodeStart=n.start.decode,r[s].transmuxedPresentationEnd=n.end.presentation,r[s].transmuxedDecodeEnd=n.end.decode,r[s].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:r}=t;if(!r||!r.byteLength||n==="audio"&&this.audioDisabled_)return;const s=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:s,data:r})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){this.loadQueue_.push(()=>{const t=On({},e,{forceTimestampOffset:!0});On(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=this.mediaIndex!==null,s=e.timeline!==this.currentTimeline_&&e.timeline>0,a=n||r&&s;this.logger_(`Requesting ${ms(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=SP({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:o,level:u,stream:c})=>{this.logger_(`${ms(e)} logged from transmuxer stream ${c} as a ${u}: ${o}`)}})}trimBackBuffer_(e){const t=GP(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,r={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},s=e.playlist.segments[e.mediaIndex-1];if(s&&s.timeline===t.timeline&&(s.videoTimingInfo?r.baseStartTime=s.videoTimingInfo.transmuxedDecodeEnd:s.audioTimingInfo&&(r.baseStartTime=s.audioTimingInfo.transmuxedDecodeEnd)),t.key){const a=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);r.key=this.segmentKey(t.key),r.key.iv=a}return t.map&&(r.map=this.initSegmentForMap(t.map)),r}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<Yu){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${Yu}`);return}this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===ln.ABORTED)return;if(this.pause(),e.code===ln.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=UP(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:s,useVideoTimingInfo:a,videoTimingInfo:o,audioTimingInfo:u}){if(typeof e<"u")return e;if(!a)return u.start;const c=t.segments[n-1];return n===0||!c||typeof c.start>"u"||c.end!==r+s?r:o.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:n,hasVideo:r,isMuxed:s}=t,a=this.loaderType_==="main"&&r,o=!this.audioDisabled_&&n&&!s;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}a&&e.waitingOnAppends++,o&&e.waitingOnAppends++,a&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),o&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=HP(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),r=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;r&&(e.timingInfo.end=typeof r.end=="number"?r.end:r.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=KP(e,this.sourceType_);if(t&&(t.severity==="warn"?F.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${ms(e)}`);return}this.logger_(`Appended ${ms(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,r=e.part,s=n.end&&this.currentTime_()-n.end>e.playlist.targetDuration*3,a=r&&r.end&&this.currentTime_()-r.end>e.playlist.partTargetDuration*3;if(s||a){this.logger_(`bad ${s?"segment":"part"} ${ms(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<Yu){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${Yu}`);return}const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,r=t.end;if(!i_(n)||!i_(r))return;so(n,r,this.segmentMetadataTrack_);const s=D.WebKitDataCue||D.VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:r},o=JSON.stringify(a),u=new s(n,r,o);u.value=a,this.segmentMetadataTrack_.addCue(u)}}function Dn(){}const Vb=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},XP=["video","audio"],nf=(i,e)=>{const t=e[`${i}Buffer`];return t&&t.updating||e.queuePending[i]},YP=(i,e)=>{for(let t=0;t<e.length;t++){const n=e[t];if(n.type==="mediaSource")return null;if(n.type===i)return t}return null},Os=(i,e)=>{if(e.queue.length===0)return;let t=0,n=e.queue[t];if(n.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),Os("audio",e),Os("video",e));return}if(i!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||nf(i,e))){if(n.type!==i){if(t=YP(i,e.queue),t===null)return;n=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[i]=n,n.action(i,e),!n.doneFn){e.queuePending[i]=null,Os(i,e);return}}},jb=(i,e)=>{const t=e[`${i}Buffer`],n=Vb(i);t&&(t.removeEventListener("updateend",e[`on${n}UpdateEnd_`]),t.removeEventListener("error",e[`on${n}Error_`]),e.codecs[i]=null,e[`${i}Buffer`]=null)},nn=(i,e)=>i&&e&&Array.prototype.indexOf.call(i.sourceBuffers,e)!==-1,Ei={appendBuffer:(i,e,t)=>(n,r)=>{const s=r[`${n}Buffer`];if(nn(r.mediaSource,s)){r.logger_(`Appending segment ${e.mediaIndex}'s ${i.length} bytes to ${n}Buffer`);try{s.appendBuffer(i)}catch(a){r.logger_(`Error with code ${a.code} `+(a.code===Ub?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${n}Buffer`),r.queuePending[n]=null,t(a)}}},remove:(i,e)=>(t,n)=>{const r=n[`${t}Buffer`];if(nn(n.mediaSource,r)){n.logger_(`Removing ${i} to ${e} from ${t}Buffer`);try{r.remove(i,e)}catch{n.logger_(`Remove ${i} to ${e} from ${t}Buffer failed`)}}},timestampOffset:i=>(e,t)=>{const n=t[`${e}Buffer`];nn(t.mediaSource,n)&&(t.logger_(`Setting ${e}timestampOffset to ${i}`),n.timestampOffset=i)},callback:i=>(e,t)=>{i()},endOfStream:i=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${i||""})`);try{e.mediaSource.endOfStream(i)}catch(t){F.log.warn("Failed to call media source endOfStream",t)}}},duration:i=>e=>{e.logger_(`Setting mediaSource duration to ${i}`);try{e.mediaSource.duration=i}catch(t){F.log.warn("Failed to set media source duration",t)}},abort:()=>(i,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${i}Buffer`];if(nn(e.mediaSource,t)){e.logger_(`calling abort on ${i}Buffer`);try{t.abort()}catch(n){F.log.warn(`Failed to abort on ${i}Buffer`,n)}}},addSourceBuffer:(i,e)=>t=>{const n=Vb(i),r=Ao(e);t.logger_(`Adding ${i}Buffer with codec ${e} to mediaSource`);const s=t.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",t[`on${n}UpdateEnd_`]),s.addEventListener("error",t[`on${n}Error_`]),t.codecs[i]=e,t[`${i}Buffer`]=s},removeSourceBuffer:i=>e=>{const t=e[`${i}Buffer`];if(jb(i,e),!!nn(e.mediaSource,t)){e.logger_(`Removing ${i}Buffer with codec ${e.codecs[i]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(n){F.log.warn(`Failed to removeSourceBuffer ${i}Buffer`,n)}}},changeType:i=>(e,t)=>{const n=t[`${e}Buffer`],r=Ao(i);nn(t.mediaSource,n)&&t.codecs[e]!==i&&(t.logger_(`changing ${e}Buffer codec from ${t.codecs[e]} to ${i}`),n.changeType(r),t.codecs[e]=i)}},Si=({type:i,sourceUpdater:e,action:t,doneFn:n,name:r})=>{e.queue.push({type:i,action:t,doneFn:n,name:r}),Os(i,e)},a_=(i,e)=>t=>{if(e.queuePending[i]){const n=e.queuePending[i].doneFn;e.queuePending[i]=null,n&&n(e[`${i}Error_`])}Os(i,e)};class $b extends F.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>Os("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=Ji("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=a_("video",this),this.onAudioUpdateEnd_=a_("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Si({type:"mediaSource",sourceUpdater:this,action:Ei.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){Si({type:e,sourceUpdater:this,action:Ei.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){F.log.error("removeSourceBuffer is not supported!");return}Si({type:"mediaSource",sourceUpdater:this,action:Ei.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!F.browser.IE_VERSION&&!F.browser.IS_FIREFOX&&D.MediaSource&&D.MediaSource.prototype&&typeof D.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return D.SourceBuffer&&D.SourceBuffer.prototype&&typeof D.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){F.log.error("changeType is not supported!");return}Si({type:e,sourceUpdater:this,action:Ei.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:r,bytes:s}=e;if(this.processedAppend_=!0,r==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${s.length} until video append`);return}const a=t;if(Si({type:r,sourceUpdater:this,action:Ei.appendBuffer(s,n||{mediaIndex:-1},a),doneFn:t,name:"appendBuffer"}),r==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const o=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${o.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,o.forEach(u=>{this.appendBuffer.apply(this,u)})}}audioBuffered(){return nn(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:zt()}videoBuffered(){return nn(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:zt()}buffered(){const e=nn(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=nn(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():gk(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=Dn){Si({type:"mediaSource",sourceUpdater:this,action:Ei.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=Dn){typeof e!="string"&&(e=void 0),Si({type:"mediaSource",sourceUpdater:this,action:Ei.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=Dn){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){n();return}Si({type:"audio",sourceUpdater:this,action:Ei.remove(e,t),doneFn:n,name:"remove"})}removeVideo(e,t,n=Dn){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){n();return}Si({type:"video",sourceUpdater:this,action:Ei.remove(e,t),doneFn:n,name:"remove"})}updating(){return!!(nf("audio",this)||nf("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Si({type:"audio",sourceUpdater:this,action:Ei.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset!==e&&(Si({type:"video",sourceUpdater:this,action:Ei.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Si({type:"audio",sourceUpdater:this,action:Ei.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Si({type:"video",sourceUpdater:this,action:Ei.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),XP.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>jb(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const o_=i=>decodeURIComponent(escape(String.fromCharCode.apply(null,i))),u_=new Uint8Array(`

`.split("").map(i=>i.charCodeAt(0)));class QP extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class JP extends tf{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.loaderType_="subtitle",this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}createTransmuxer_(){return null}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return zt();const e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return zt([[t,n]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=Gl(e);let r=this.initSegments_[n];if(t&&!r&&e.bytes){const s=u_.byteLength+e.bytes.byteLength,a=new Uint8Array(s);a.set(e.bytes),a.set(u_,e.bytes.byteLength),this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){so(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===ln.TIMEOUT&&this.handleTimeout_(),e.code===ln.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const s=r.segment;if(s.map&&(s.map.bytes=t.map.bytes),r.bytes=t.bytes,typeof D.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));return}s.requested=!0;try{this.parseVTTCues_(r)}catch(a){this.stopForError({message:a.message});return}if(this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,r.cues.forEach(a=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new D.VTTCue(a.startTime,a.endTime,a.text):a)}),FP(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(){}updateTimingInfoEnd_(){}parseVTTCues_(e){let t,n=!1;if(typeof D.WebVTT!="function")throw new QP;typeof D.TextDecoder=="function"?t=new D.TextDecoder("utf8"):(t=D.WebVTT.StringDecoder(),n=!0);const r=new D.WebVTT.Parser(D,D.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=a=>{e.timestampmap=a},r.onparsingerror=a=>{F.log.warn("Error encountered when parsing cues: "+a.message)},e.segment.map){let a=e.segment.map.bytes;n&&(a=o_(a)),r.parse(a)}let s=e.bytes;n&&(s=o_(s)),r.parse(s),r.flush()}updateTimeMapping_(e,t,n){const r=e.segment;if(!t)return;if(!e.cues.length){r.empty=!0;return}const s=e.timestampmap,a=s.MPEGTS/Pl.ONE_SECOND_IN_TS-s.LOCAL+t.mapping;if(e.cues.forEach(o=>{o.startTime+=a,o.endTime+=a}),!n.syncInfo){const o=e.cues[0].startTime,u=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(o,u-r.duration)}}}}const ZP=function(i,e){const t=i.cues;for(let n=0;n<t.length;n++){const r=t[n];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null},eR=function(i,e,t=0){if(!i.segments)return;let n=t,r;for(let s=0;s<i.segments.length;s++){const a=i.segments[s];if(r||(r=ZP(e,n+a.duration/2)),r){if("cueIn"in a){r.endTime=n,r.adEndTime=n,n+=a.duration,r=null;continue}if(n<r.endTime){n+=a.duration;continue}r.endTime+=a.duration}else if("cueOut"in a&&(r=new D.VTTCue(n,n+a.duration,a.cueOut),r.adStartTime=n,r.adEndTime=n+parseFloat(a.cueOut),e.addCue(r)),"cueOutCont"in a){const[o,u]=a.cueOutCont.split("/").map(parseFloat);r=new D.VTTCue(n,n+a.duration,""),r.adStartTime=n-o,r.adEndTime=r.adStartTime+u,e.addCue(r)}n+=a.duration}},tR=86400,l_=[{name:"VOD",run:(i,e,t,n,r)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"ProgramDateTime",run:(i,e,t,n,r)=>{if(!Object.keys(i.timelineToDatetimeMappings).length)return null;let s=null,a=null;const o=Wd(e);r=r||0;for(let u=0;u<o.length;u++){const c=e.endList||r===0?u:o.length-(u+1),h=o[c],g=h.segment,y=i.timelineToDatetimeMappings[g.timeline];if(!y||!g.dateTimeObject)continue;let T=g.dateTimeObject.getTime()/1e3+y;if(g.parts&&typeof h.partIndex=="number")for(let A=0;A<h.partIndex;A++)T+=g.parts[A].duration;const S=Math.abs(r-T);if(a!==null&&(S===0||a<S))break;a=S,s={time:T,segmentIndex:h.segmentIndex,partIndex:h.partIndex}}return s}},{name:"Segment",run:(i,e,t,n,r)=>{let s=null,a=null;r=r||0;const o=Wd(e);for(let u=0;u<o.length;u++){const c=e.endList||r===0?u:o.length-(u+1),h=o[c],g=h.segment,y=h.part&&h.part.start||g&&g.start;if(g.timeline===n&&typeof y<"u"){const v=Math.abs(r-y);if(a!==null&&a<v)break;(!s||a===null||a>=v)&&(a=v,s={time:y,segmentIndex:h.segmentIndex,partIndex:h.partIndex})}}return s}},{name:"Discontinuity",run:(i,e,t,n,r)=>{let s=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length){let a=null;for(let o=0;o<e.discontinuityStarts.length;o++){const u=e.discontinuityStarts[o],c=e.discontinuitySequence+o+1,h=i.discontinuities[c];if(h){const g=Math.abs(r-h.time);if(a!==null&&a<g)break;(!s||a===null||a>=g)&&(a=g,s={time:h.time,segmentIndex:u,partIndex:null})}}}return s}},{name:"Playlist",run:(i,e,t,n,r)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class iR extends F.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={},this.logger_=Ji("SyncController")}getSyncPoint(e,t,n,r){const s=this.runStrategies_(e,t,n,r);return s.length?this.selectSyncPoint_(s,{key:"time",value:r}):null}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+go({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,r){const s=[];for(let a=0;a<l_.length;a++){const o=l_[a],u=o.run(this,e,t,n,r);u&&(u.strategy=o.name,s.push({strategy:o.name,syncPoint:u}))}return s}selectSyncPoint_(e,t){let n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),s=e[0].strategy;for(let a=1;a<e.length;a++){const o=Math.abs(e[a].syncPoint[t.key]-t.value);o<r&&(r=o,n=e[a].syncPoint,s=e[a].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${s}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+(typeof n.partIndex=="number"?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>tR){F.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);return}for(let r=n-1;r>=0;r--){const s=e.segments[r];if(s&&typeof s.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+r,time:s.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const s=r.dateTimeObject;r.discontinuity&&t&&s&&(this.timelineToDatetimeMappings[r.timeline]=-(s.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const r=e.segment,s=e.part;let a=this.timelines[e.timeline],o,u;if(typeof e.timestampOffset=="number")a={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=a,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${a.time}] [mapping: ${a.mapping}]`)),o=e.startOfSegment,u=t.end+a.mapping;else if(a)o=t.start+a.mapping,u=t.end+a.mapping;else return!1;return s&&(s.start=o,s.end=u),(!r.start||o<r.start)&&(r.start=o),r.end=u,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const s=t.discontinuityStarts[r],a=t.discontinuitySequence+r+1,o=s-e.mediaIndex,u=Math.abs(o);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>u){let c;o<0?c=n.start-go({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:s}):c=n.end+go({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:s}),this.discontinuities[a]={time:c,accuracy:u}}}}dispose(){this.trigger("dispose"),this.off()}}class nR extends F.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e],this.trigger("timelinechange")),this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const rR=Db(Ib(function(){var i=function(){function S(){this.listeners={}}var A=S.prototype;return A.on=function(P,M){this.listeners[P]||(this.listeners[P]=[]),this.listeners[P].push(M)},A.off=function(P,M){if(!this.listeners[P])return!1;var R=this.listeners[P].indexOf(M);return this.listeners[P]=this.listeners[P].slice(0),this.listeners[P].splice(R,1),R>-1},A.trigger=function(P){var M=this.listeners[P];if(M)if(arguments.length===2)for(var R=M.length,O=0;O<R;++O)M[O].call(this,arguments[1]);else for(var j=Array.prototype.slice.call(arguments,1),z=M.length,ee=0;ee<z;++ee)M[ee].apply(this,j)},A.dispose=function(){this.listeners={}},A.pipe=function(P){this.on("data",function(M){P.push(M)})},S}();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function e(S){return S.subarray(0,S.byteLength-S[S.byteLength-1])}/*! @name aes-decrypter @version 4.0.1 @license Apache-2.0 */const t=function(){const S=[[[],[],[],[],[]],[[],[],[],[],[]]],A=S[0],k=S[1],P=A[4],M=k[4];let R,O,j;const z=[],ee=[];let K,oe,pe,we,X,ge;for(R=0;R<256;R++)ee[(z[R]=R<<1^(R>>7)*283)^R]=R;for(O=j=0;!P[O];O^=K||1,j=ee[j]||1)for(we=j^j<<1^j<<2^j<<3^j<<4,we=we>>8^we&255^99,P[O]=we,M[we]=O,pe=z[oe=z[K=z[O]]],ge=pe*16843009^oe*65537^K*257^O*16843008,X=z[we]*257^we*16843008,R=0;R<4;R++)A[R][O]=X=X<<24^X>>>8,k[R][we]=ge=ge<<24^ge>>>8;for(R=0;R<5;R++)A[R]=A[R].slice(0),k[R]=k[R].slice(0);return S};let n=null;class r{constructor(A){n||(n=t()),this._tables=[[n[0][0].slice(),n[0][1].slice(),n[0][2].slice(),n[0][3].slice(),n[0][4].slice()],[n[1][0].slice(),n[1][1].slice(),n[1][2].slice(),n[1][3].slice(),n[1][4].slice()]];let k,P,M;const R=this._tables[0][4],O=this._tables[1],j=A.length;let z=1;if(j!==4&&j!==6&&j!==8)throw new Error("Invalid aes key size");const ee=A.slice(0),K=[];for(this._key=[ee,K],k=j;k<4*j+28;k++)M=ee[k-1],(k%j===0||j===8&&k%j===4)&&(M=R[M>>>24]<<24^R[M>>16&255]<<16^R[M>>8&255]<<8^R[M&255],k%j===0&&(M=M<<8^M>>>24^z<<24,z=z<<1^(z>>7)*283)),ee[k]=ee[k-j]^M;for(P=0;k;P++,k--)M=ee[P&3?k:k-4],k<=4||P<4?K[P]=M:K[P]=O[0][R[M>>>24]]^O[1][R[M>>16&255]]^O[2][R[M>>8&255]]^O[3][R[M&255]]}decrypt(A,k,P,M,R,O){const j=this._key[1];let z=A^j[0],ee=M^j[1],K=P^j[2],oe=k^j[3],pe,we,X;const ge=j.length/4-2;let rt,Ee=4;const Fe=this._tables[1],He=Fe[0],pt=Fe[1],mt=Fe[2],xt=Fe[3],gt=Fe[4];for(rt=0;rt<ge;rt++)pe=He[z>>>24]^pt[ee>>16&255]^mt[K>>8&255]^xt[oe&255]^j[Ee],we=He[ee>>>24]^pt[K>>16&255]^mt[oe>>8&255]^xt[z&255]^j[Ee+1],X=He[K>>>24]^pt[oe>>16&255]^mt[z>>8&255]^xt[ee&255]^j[Ee+2],oe=He[oe>>>24]^pt[z>>16&255]^mt[ee>>8&255]^xt[K&255]^j[Ee+3],Ee+=4,z=pe,ee=we,K=X;for(rt=0;rt<4;rt++)R[(3&-rt)+O]=gt[z>>>24]<<24^gt[ee>>16&255]<<16^gt[K>>8&255]<<8^gt[oe&255]^j[Ee++],pe=z,z=ee,ee=K,K=oe,oe=pe}}class s extends i{constructor(){super(i),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(A){this.jobs.push(A),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const a=function(S){return S<<24|(S&65280)<<8|(S&16711680)>>8|S>>>24},o=function(S,A,k){const P=new Int32Array(S.buffer,S.byteOffset,S.byteLength>>2),M=new r(Array.prototype.slice.call(A)),R=new Uint8Array(S.byteLength),O=new Int32Array(R.buffer);let j,z,ee,K,oe,pe,we,X,ge;for(j=k[0],z=k[1],ee=k[2],K=k[3],ge=0;ge<P.length;ge+=4)oe=a(P[ge]),pe=a(P[ge+1]),we=a(P[ge+2]),X=a(P[ge+3]),M.decrypt(oe,pe,we,X,O,ge),O[ge]=a(O[ge]^j),O[ge+1]=a(O[ge+1]^z),O[ge+2]=a(O[ge+2]^ee),O[ge+3]=a(O[ge+3]^K),j=oe,z=pe,ee=we,K=X;return R};class u{constructor(A,k,P,M){const R=u.STEP,O=new Int32Array(A.buffer),j=new Uint8Array(A.byteLength);let z=0;for(this.asyncStream_=new s,this.asyncStream_.push(this.decryptChunk_(O.subarray(z,z+R),k,P,j)),z=R;z<O.length;z+=R)P=new Uint32Array([a(O[z-4]),a(O[z-3]),a(O[z-2]),a(O[z-1])]),this.asyncStream_.push(this.decryptChunk_(O.subarray(z,z+R),k,P,j));this.asyncStream_.push(function(){M(null,e(j))})}static get STEP(){return 32e3}decryptChunk_(A,k,P,M){return function(){const R=o(A,k,P);M.set(R,A.byteOffset)}}}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h;typeof window<"u"?h=window:typeof c<"u"?h=c:typeof self<"u"?h=self:h={};var g=h,y=function(A){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(A):A&&A.buffer instanceof ArrayBuffer},v=g.BigInt||Number;v("0x1"),v("0x100"),v("0x10000"),v("0x1000000"),v("0x100000000"),v("0x10000000000"),v("0x1000000000000"),v("0x100000000000000"),v("0x10000000000000000"),function(){var S=new Uint16Array([65484]),A=new Uint8Array(S.buffer,S.byteOffset,S.byteLength);return A[0]===255?"big":A[0]===204?"little":"unknown"}();const T=function(S){const A={};return Object.keys(S).forEach(k=>{const P=S[k];y(P)?A[k]={bytes:P.buffer,byteOffset:P.byteOffset,byteLength:P.byteLength}:A[k]=P}),A};self.onmessage=function(S){const A=S.data,k=new Uint8Array(A.encrypted.bytes,A.encrypted.byteOffset,A.encrypted.byteLength),P=new Uint32Array(A.key.bytes,A.key.byteOffset,A.key.byteLength/4),M=new Uint32Array(A.iv.bytes,A.iv.byteOffset,A.iv.byteLength/4);new u(k,P,M,function(R,O){self.postMessage(T({source:A.source,decrypted:O}),[O.buffer])})}}));var sR=Ab(rR);const aR=i=>{let e=i.default?"main":"alternative";return i.characteristics&&i.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},Xl=(i,e)=>{i.abort(),i.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},rf=(i,e)=>{e.activePlaylistLoader=i,i.load()},oR=(i,e)=>()=>{const{segmentLoaders:{[i]:t,main:n},mediaTypes:{[i]:r}}=e,s=r.activeTrack(),a=r.getActiveGroup(),o=r.activePlaylistLoader,u=r.lastGroup_;if(!(a&&u&&a.id===u.id)&&(r.lastGroup_=a,r.lastTrack_=s,Xl(t,r),!(!a||a.isMainPlaylist))){if(!a.playlistLoader){o&&n.resetEverything();return}t.resyncLoader(),rf(a.playlistLoader,r)}},uR=(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;n.lastGroup_=null,t.abort(),t.pause()},lR=(i,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[i]:n,main:r},mediaTypes:{[i]:s}}=e,a=s.activeTrack(),o=s.getActiveGroup(),u=s.activePlaylistLoader,c=s.lastTrack_;if(!(c&&a&&c.id===a.id)&&(s.lastGroup_=o,s.lastTrack_=a,Xl(n,s),!!o)){if(o.isMainPlaylist){if(!a||!c||a.id===c.id)return;const h=e.vhs.playlistController_,g=h.selectPlaylist();if(h.media()===g)return;s.logger_(`track change. Switching main audio from ${c.id} to ${a.id}`),t.pause(),r.resetEverything(),h.fastQualityChange_(g);return}if(i==="AUDIO"){if(!o.playlistLoader){r.setAudio(!0),r.resetEverything();return}n.setAudio(!0),r.setAudio(!1)}if(u===o.playlistLoader){rf(o.playlistLoader,s);return}n.track&&n.track(a),n.resetEverything(),rf(o.playlistLoader,s)}},Yl={AUDIO:(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n},excludePlaylist:r}=e;Xl(t,n);const s=n.activeTrack(),a=n.activeGroup(),o=(a.filter(c=>c.default)[0]||a[0]).id,u=n.tracks[o];if(s===u){r({error:{message:"Problem encountered loading the default audio track."}});return}F.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const c in n.tracks)n.tracks[c].enabled=n.tracks[c]===u;n.onTrackChanged()},SUBTITLES:(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;F.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),Xl(t,n);const r=n.activeTrack();r&&(r.mode="disabled"),n.onTrackChanged()}},c_={AUDIO:(i,e,t)=>{if(!e)return;const{tech:n,requestOptions:r,segmentLoaders:{[i]:s}}=t;e.on("loadedmetadata",()=>{const a=e.media();s.playlist(a,r),(!n.paused()||a.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",Yl[i](i,t))},SUBTITLES:(i,e,t)=>{const{tech:n,requestOptions:r,segmentLoaders:{[i]:s},mediaTypes:{[i]:a}}=t;e.on("loadedmetadata",()=>{const o=e.media();s.playlist(o,r),s.track(a.activeTrack()),(!n.paused()||o.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",Yl[i](i,t))}},cR={AUDIO:(i,e)=>{const{vhs:t,sourceType:n,segmentLoaders:{[i]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[i]:{groups:o,tracks:u,logger_:c}},mainPlaylistLoader:h}=e,g=au(h.main);(!a[i]||Object.keys(a[i]).length===0)&&(a[i]={main:{default:{default:!0}}},g&&(a[i].main.default.playlists=h.main.playlists));for(const y in a[i]){o[y]||(o[y]=[]);for(const v in a[i][y]){let T=a[i][y][v],S;if(g?(c(`AUDIO group '${y}' label '${v}' is a main playlist`),T.isMainPlaylist=!0,S=null):n==="vhs-json"&&T.playlists?S=new xs(T.playlists[0],t,s):T.resolvedUri?S=new xs(T.resolvedUri,t,s):T.playlists&&n==="dash"?S=new Zd(T.playlists[0],t,s,h):S=null,T=Ye({id:v,playlistLoader:S},T),c_[i](i,T.playlistLoader,e),o[y].push(T),typeof u[v]>"u"){const A=new F.AudioTrack({id:v,kind:aR(T),enabled:!1,language:T.language,default:T.default,label:v});u[v]=A}}}r.on("error",Yl[i](i,e))},SUBTITLES:(i,e)=>{const{tech:t,vhs:n,sourceType:r,segmentLoaders:{[i]:s},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[i]:{groups:u,tracks:c}},mainPlaylistLoader:h}=e;for(const g in o[i]){u[g]||(u[g]=[]);for(const y in o[i][g]){if(o[i][g][y].forced)continue;let v=o[i][g][y],T;if(r==="hls")T=new xs(v.resolvedUri,n,a);else if(r==="dash"){if(!v.playlists.filter(A=>A.excludeUntil!==1/0).length)return;T=new Zd(v.playlists[0],n,a,h)}else r==="vhs-json"&&(T=new xs(v.playlists?v.playlists[0]:v.resolvedUri,n,a));if(v=Ye({id:y,playlistLoader:T},v),c_[i](i,v.playlistLoader,e),u[g].push(v),typeof c[y]>"u"){const S=t.addRemoteTextTrack({id:y,kind:"subtitles",default:v.default&&v.autoselect,language:v.language,label:y},!1).track;c[y]=S}}}s.on("error",Yl[i](i,e))},"CLOSED-CAPTIONS":(i,e)=>{const{tech:t,main:{mediaGroups:n},mediaTypes:{[i]:{groups:r,tracks:s}}}=e;for(const a in n[i]){r[a]||(r[a]=[]);for(const o in n[i][a]){const u=n[i][a][o];if(!/^(?:CC|SERVICE)/.test(u.instreamId))continue;const c=t.options_.vhs&&t.options_.vhs.captionServices||{};let h={label:o,language:u.language,instreamId:u.instreamId,default:u.default&&u.autoselect};if(c[h.instreamId]&&(h=Ye(h,c[h.instreamId])),h.default===void 0&&delete h.default,r[a].push(Ye({id:o},u)),typeof s[o]>"u"){const g=t.addRemoteTextTrack({id:h.instreamId,kind:"captions",default:h.default,language:h.language,label:h.label},!1).track;s[o]=g}}}}},qb=(i,e)=>{for(let t=0;t<i.length;t++)if(Up(e,i[t])||i[t].playlists&&qb(i[t].playlists,e))return!0;return!1},hR=(i,e)=>t=>{const{mainPlaylistLoader:n,mediaTypes:{[i]:{groups:r}}}=e,s=n.media();if(!s)return null;let a=null;s.attributes[i]&&(a=r[s.attributes[i]]);const o=Object.keys(r);if(!a)if(i==="AUDIO"&&o.length>1&&au(e.main))for(let u=0;u<o.length;u++){const c=r[o[u]];if(qb(c,s)){a=c;break}}else r.main?a=r.main:o.length===1&&(a=r[o[0]]);return typeof t>"u"?a:t===null||!a?null:a.filter(u=>u.id===t.id)[0]||null},dR={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].enabled)return t[n];return null},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].mode==="showing"||t[n].mode==="hidden")return t[n];return null}},fR=(i,{mediaTypes:e})=>()=>{const t=e[i].activeTrack();return t?e[i].activeGroup(t):null},pR=i=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(c=>{cR[c](c,i)});const{mediaTypes:e,mainPlaylistLoader:t,tech:n,vhs:r,segmentLoaders:{["AUDIO"]:s,main:a}}=i;["AUDIO","SUBTITLES"].forEach(c=>{e[c].activeGroup=hR(c,i),e[c].activeTrack=dR[c](c,i),e[c].onGroupChanged=oR(c,i),e[c].onGroupChanging=uR(c,i),e[c].onTrackChanged=lR(c,i),e[c].getActiveGroup=fR(c,i)});const o=e.AUDIO.activeGroup();if(o){const c=(o.filter(g=>g.default)[0]||o[0]).id;e.AUDIO.tracks[c].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(c=>e[c].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(c=>e[c].onGroupChanging())});const u=()=>{e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",u),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),r.on("dispose",()=>{n.audioTracks().removeEventListener("change",u),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const c in e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[c])},mR=()=>{const i={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{i[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Dn,activeTrack:Dn,getActiveGroup:Dn,onGroupChanged:Dn,onTrackChanged:Dn,lastTrack_:null,logger_:Ji(`MediaGroups[${e}]`)}}),i},gR=60*2;let wn;const _R=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],yR=function(i){return this.audioSegmentLoader_[i]+this.mainSegmentLoader_[i]},vR=function({currentPlaylist:i,buffered:e,currentTime:t,nextPlaylist:n,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:a,bufferBasedABR:o,log:u}){if(!n)return F.log.warn("We received no playlist to switch to. Please check your stream."),!1;const c=`allowing switch ${i&&i.id||"null"} -> ${n.id}`;if(!i)return u(`${c} as current playlist is not set`),!0;if(n.id===i.id)return!1;const h=!!Ss(e,t).length;if(!i.endList)return!h&&typeof i.partTargetDuration=="number"?(u(`not ${c} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(u(`${c} as current playlist is live`),!0);const g=Mp(e,t),y=o?At.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:At.MAX_BUFFER_LOW_WATER_LINE;if(a<y)return u(`${c} as duration < max low water line (${a} < ${y})`),!0;const v=n.attributes.BANDWIDTH,T=i.attributes.BANDWIDTH;if(v<T&&(!o||g<s)){let S=`${c} as next bandwidth < current bandwidth (${v} < ${T})`;return o&&(S+=` and forwardBuffer < bufferHighWaterLine (${g} < ${s})`),u(S),!0}if((!o||v>T)&&g>=r){let S=`${c} as forwardBuffer >= bufferLowWaterLine (${g} >= ${r})`;return o&&(S+=` and next bandwidth > current bandwidth (${v} > ${T})`),u(S),!0}return u(`not ${c} as no switching criteria met`),!1};class TR extends F.EventTarget{constructor(e){super();const{src:t,withCredentials:n,tech:r,bandwidth:s,externVhs:a,useCueTags:o,playlistExclusionDuration:u,enableLowInitialPlaylist:c,sourceType:h,cacheEncryptionKeys:g,bufferBasedABR:y,leastPixelDiffSelector:v,captionServices:T}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:S}=e;(S===null||typeof S>"u")&&(S=1/0),wn=a,this.bufferBasedABR=!!y,this.leastPixelDiffSelector=!!v,this.withCredentials=n,this.tech_=r,this.vhs_=r.vhs,this.sourceType_=h,this.useCueTags_=o,this.playlistExclusionDuration=u,this.maxPlaylistRetries=S,this.enableLowInitialPlaylist=c,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:S,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=mR(),this.mediaSource=new D.MediaSource,this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.seekable_=zt(),this.hasPlayed_=!1,this.syncController_=new iR(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=new sR,this.sourceUpdater_=new $b(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new nR;const A={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:T,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:g,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings};this.mainPlaylistLoader_=this.sourceType_==="dash"?new Zd(t,this.vhs_,this.requestOptions_):new xs(t,this.vhs_,this.requestOptions_),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new tf(Ye(A,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new tf(Ye(A,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new JP(Ye(A,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((P,M)=>{function R(){r.off("vttjserror",O),P()}function O(){r.off("vttjsloaded",R),M()}r.one("vttjsloaded",R),r.one("vttjserror",O),r.addWebVttScript_()})}),e),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),_R.forEach(P=>{this[P+"_"]=yR.bind(this,P)}),this.logger_=Ji("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const k=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(k,()=>{const P=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-P,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const r=this.media(),s=r&&(r.id||r.uri),a=e.id||e.uri;s&&s!==a&&(this.logger_(`switch media ${s} -> ${a} from ${t}`),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})),this.mainPlaylistLoader_.media(e,n)}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=D.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(D.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,r=Object.keys(n);let s;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)s=this.mediaTypes_.AUDIO.activeTrack();else{const o=n.main||r.length&&n[r[0]];for(const u in o)if(o[u].default){s={label:u};break}}if(!s)return t;const a=[];for(const o in n)if(n[o][s.label]){const u=n[o][s.label];if(u.playlists&&u.playlists.length)a.push.apply(a,u.playlists);else if(u.uri)a.push(u);else if(e.playlists.length)for(let c=0;c<e.playlists.length;c++){const h=e.playlists[c];h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===o&&a.push(h)}}return a.length?a:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=e.targetDuration*1.5*1e3;Kd(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),pR({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){this.excludeUnsupportedVariants_();let t;if(this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t)||(this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=e.targetDuration*1.5*1e3;Kd(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if(e.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let r=!0;const s=Object.keys(n.AUDIO);for(const a in n.AUDIO)for(const o in n.AUDIO[a])n.AUDIO[a][o].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),wn.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),s.length&&Object.keys(n.AUDIO[s[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),r=this.bufferLowWaterLine(),s=this.bufferHighWaterLine(),a=this.tech_.buffered();return vR({buffered:a,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const t=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",t=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:gR}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const t=this.getCodecsOrExclude_();t&&this.sourceUpdater_.addOrChangeSourceBuffers(t)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}fastQualityChange_(e=this.selectPlaylist()){if(e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything(()=>{F.browser.IE_VERSION||F.browser.IS_EDGE?this.tech_.setCurrentTime(this.tech_.currentTime()+.04):this.tech_.setCurrentTime(this.tech_.currentTime())})}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList){const t=this.seekable();if(!t.length)return!1;if(F.browser.IE_VERSION&&this.tech_.readyState()===0)return this.tech_.one("loadedmetadata",()=>{this.trigger("firstplay"),this.tech_.setCurrentTime(t.end(0)),this.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(t.end(0))}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(n===null)return!1;const r=wn.Playlist.playlistEnd(e,n),s=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return r-s<=un;const o=a.end(a.length-1);return o-s<=un&&r-o<=un}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,s=r.filter(Lc),a=s.length===1&&s[0]===e;if(r.length===1&&n!==1/0)return F.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(a);if(a){let v=!1;r.forEach(T=>{if(T===e)return;const S=T.excludeUntil;typeof S<"u"&&S!==1/0&&(v=!0,delete T.excludeUntil)}),v&&(F.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let o;e.playlistErrors_>this.maxPlaylistRetries?o=1/0:o=Date.now()+n*1e3,e.excludeUntil=o,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const u=this.selectPlaylist();if(!u){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const c=t.internal?this.logger_:F.log.warn,h=t.message?" "+t.message:"";c(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${h} Switching to playlist ${u.id}.`),u.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),u.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const g=u.targetDuration/2*1e3||5*1e3,y=typeof u.lastRequest=="number"&&Date.now()-u.lastRequest<=g;return this.switchMedia_(u,"exclude",a||y)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],r=e==="all";(r||e==="main")&&n.push(this.mainPlaylistLoader_);const s=[];(r||e==="audio")&&s.push("AUDIO"),(r||e==="subtitle")&&(s.push("CLOSED-CAPTIONS"),s.push("SUBTITLES")),s.forEach(a=>{const o=this.mediaTypes_[a]&&this.mediaTypes_[a].activePlaylistLoader;o&&n.push(o)}),["main","audio","subtitle"].forEach(a=>{const o=this[`${a}SegmentLoader_`];o&&(e===a||e==="all")&&n.push(o)}),n.forEach(a=>t.forEach(o=>{typeof a[o]=="function"&&a[o]()}))}setCurrentTime(e){const t=Ss(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:wn.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}onSyncInfoUpdate_(){let e;if(!this.mainPlaylistLoader_)return;let t=this.mainPlaylistLoader_.media();if(!t)return;let n=this.syncController_.getExpiredTime(t,this.duration());if(n===null)return;const r=this.mainPlaylistLoader_.main,s=wn.Playlist.seekable(t,n,wn.Playlist.liveEdgeDelay(r,t));if(s.length===0||this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),n=this.syncController_.getExpiredTime(t,this.duration()),n===null||(e=wn.Playlist.seekable(t,n,wn.Playlist.liveEdgeDelay(r,t)),e.length===0)))return;let a,o;this.seekable_&&this.seekable_.length&&(a=this.seekable_.end(0),o=this.seekable_.start(0)),e?e.start(0)>s.end(0)||s.start(0)>e.end(0)?this.seekable_=s:this.seekable_=zt([[e.start(0)>s.start(0)?e.start(0):s.start(0),e.end(0)<s.end(0)?e.end(0):s.end(0)]]):this.seekable_=s,!(this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===a&&this.seekable_.start(0)===o)&&(this.logger_(`seekable updated [${sb(this.seekable_)}]`),this.tech_.trigger("seekablechanged"))}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const r=this.seekable();if(!r.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<r.end(r.length-1))&&this.sourceUpdater_.setDuration(r.end(r.length-1));return}const t=this.tech_.buffered();let n=wn.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(r=>{r.playlistLoader&&r.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=_o(this.main(),t),r={},s=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=n.video||e.main.videoCodec||Kw),e.main.isMuxed&&(r.video+=`,${n.audio||e.main.audioCodec||Yg}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||s)&&(r.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||Yg,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const a=(c,h)=>c?cl(h):Vh(h),o={};let u;if(["video","audio"].forEach(function(c){if(r.hasOwnProperty(c)&&!a(e[c].isFmp4,r[c])){const h=e[c].isFmp4?"browser":"muxer";o[h]=o[h]||[],o[h].push(r[c]),c==="audio"&&(u=h)}}),s&&u&&t.attributes.AUDIO){const c=t.attributes.AUDIO;this.main().playlists.forEach(h=>{(h.attributes&&h.attributes.AUDIO)===c&&h!==t&&(h.excludeUntil=1/0)}),this.logger_(`excluding audio group ${c} as ${u} does not support codec(s): "${r.audio}"`)}if(Object.keys(o).length){const c=Object.keys(o).reduce((h,g)=>(h&&(h+=", "),h+=`${g} does not support codec(s): "${o[g].join(",")}"`,h),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:c},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const c=[];if(["video","audio"].forEach(h=>{const g=(tn(this.sourceUpdater_.codecs[h]||"")[0]||{}).type,y=(tn(r[h]||"")[0]||{}).type;g&&y&&g.toLowerCase()!==y.toLowerCase()&&c.push(`"${this.sourceUpdater_.codecs[h]}" -> "${r[h]}"`)}),c.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${c.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return r}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const r=e[n];if(t.indexOf(r.id)!==-1)return;t.push(r.id);const s=_o(this.main,r),a=[];s.audio&&!Vh(s.audio)&&!cl(s.audio)&&a.push(`audio codec ${s.audio}`),s.video&&!Vh(s.video)&&!cl(s.video)&&a.push(`video codec ${s.video}`),s.text&&s.text==="stpp.ttml.im1t"&&a.push(`text codec ${s.text}`),a.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${a.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,r=Wl(tn(e)),s=Z0(r),a=r.video&&tn(r.video)[0]||null,o=r.audio&&tn(r.audio)[0]||null;Object.keys(n).forEach(u=>{const c=n[u];if(t.indexOf(c.id)!==-1||c.excludeUntil===1/0)return;t.push(c.id);const h=[],g=_o(this.mainPlaylistLoader_.main,c),y=Z0(g);if(!(!g.audio&&!g.video)){if(y!==s&&h.push(`codec count "${y}" !== "${s}"`),!this.sourceUpdater_.canChangeType()){const v=g.video&&tn(g.video)[0]||null,T=g.audio&&tn(g.audio)[0]||null;v&&a&&v.type.toLowerCase()!==a.type.toLowerCase()&&h.push(`video codec "${v.type}" !== "${a.type}"`),T&&o&&T.type.toLowerCase()!==o.type.toLowerCase()&&h.push(`audio codec "${T.type}" !== "${o.type}"`)}h.length&&(c.excludeUntil=1/0,this.logger_(`excluding ${c.id}: ${h.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),eR(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=At.GOAL_BUFFER_LENGTH,n=At.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,At.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=At.BUFFER_LOW_WATER_LINE,n=At.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,At.MAX_BUFFER_LOW_WATER_LINE),s=Math.max(t,At.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?s:r)}bufferHighWaterLine(){return At.BUFFER_HIGH_WATER_LINE}}const bR=(i,e,t)=>n=>{const r=i.main.playlists[e],s=Bp(r),a=Lc(r);return typeof n>"u"?a:(n?delete r.disabled:r.disabled=!0,n!==a&&!s&&(t(),n?i.trigger("renditionenabled"):i.trigger("renditiondisabled")),n)};class ER{constructor(e,t,n){const{playlistController_:r}=e,s=r.fastQualityChange_.bind(r);if(t.attributes){const a=t.attributes.RESOLUTION;this.width=a&&a.width,this.height=a&&a.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=_o(r.main(),t),this.playlist=t,this.id=n,this.enabled=bR(e.playlists,t.id,s)}}const SR=function(i){i.representations=()=>{const e=i.playlistController_.main(),t=au(e)?i.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(n=>!Bp(n)).map((n,r)=>new ER(i,n,n.id)):[]}},h_=["seeking","seeked","pause","playing","error"];class xR{constructor(e){this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=Ji("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),s=()=>this.resetTimeUpdate_(),a=this.playlistController_,o=["main","subtitle","audio"],u={};o.forEach(h=>{u[h]={reset:()=>this.resetSegmentDownloads_(h),updateend:()=>this.checkSegmentDownloads_(h)},a[`${h}SegmentLoader_`].on("appendsdone",u[h].updateend),a[`${h}SegmentLoader_`].on("playlistupdate",u[h].reset),this.tech_.on(["seeked","seeking"],u[h].reset)});const c=h=>{["main","audio"].forEach(g=>{a[`${g}SegmentLoader_`][h]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),c("off"))},this.clearSeekingAppendCheck_=()=>c("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),c("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(h_,s),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(h_,s),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach(h=>{a[`${h}SegmentLoader_`].off("appendsdone",u[h].updateend),a[`${h}SegmentLoader_`].off("playlistupdate",u[h].reset),this.tech_.off(["seeked","seeking"],u[h].reset)}),this.checkCurrentTimeTimeout_&&D.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&D.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=D.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],r=n.buffered_(),s=yk(this[`${e}Buffered_`],r);if(this[`${e}Buffered_`]=r,s){this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:kr(r)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+un>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),n=this.tech_.currentTime(),r=this.afterSeekableWindow_(t,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let s;if(r&&(s=t.end(t.length-1)),this.beforeSeekableWindow_(t,n)){const T=t.start(0);s=T+(T===t.end(0)?0:un)}if(typeof s<"u")return this.logger_(`Trying to seek outside of seekable at time ${n} with seekable range ${sb(t)}. Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0;const a=this.playlistController_.sourceUpdater_,o=this.tech_.buffered(),u=a.audioBuffer?a.audioBuffered():null,c=a.videoBuffer?a.videoBuffered():null,h=this.media(),g=h.partTargetDuration?h.partTargetDuration:(h.targetDuration-or)*2,y=[u,c];for(let T=0;T<y.length;T++){if(!y[T])continue;if(Mp(y[T],n)<g)return!1}const v=Ku(o,n);return v.length===0?!1:(s=v.start(0)+un,this.logger_(`Buffered region starts (${v.start(0)})  just beyond seek point (${n}). Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=Ss(t,e);if(n.length&&e+3<=n.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const o=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${o}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(o),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=Ku(r,t);return a.length>0?(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,n,r=!1){if(!e.length)return!1;let s=e.end(e.length-1)+un;return!n.endList&&r&&(s=e.end(e.length-1)+n.targetDuration*3),t>s}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let r;if(e.length&&t.length){const s=Ss(e,n-3),a=Ss(e,n),o=Ss(t,n);o.length&&!a.length&&s.length&&(r={start:s.end(0),end:o.end(0)})}else Ku(e,n).length||(r=this.gapFromVideoUnderflow_(e,n));return r?(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${n}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),r=Ku(t,n);this.resetTimeUpdate_(),!(r.length===0||n!==e)&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+or),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}))}gapFromVideoUnderflow_(e,t){const n=mk(e);for(let r=0;r<n.length;r++){const s=n.start(r),a=n.end(r);if(t-s<4&&t-s>2)return{start:s,end:a}}return null}}const CR={errorInterval:30,getSource(i){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return i(t)}},Hb=function(i,e){let t=0,n=0;const r=Ye(CR,e);i.ready(()=>{i.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){n&&i.currentTime(n)},a=function(h){h!=null&&(n=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",s),i.src(h),i.trigger({type:"usage",name:"vhs-error-reload"}),i.play())},o=function(){if(Date.now()-t<r.errorInterval*1e3){i.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!r.getSource||typeof r.getSource!="function"){F.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),r.getSource.call(i,a)},u=function(){i.off("loadedmetadata",s),i.off("error",o),i.off("dispose",u)},c=function(h){u(),Hb(i,h)};i.on("error",o),i.on("dispose",u),i.reloadSourceOnError=c},wR=function(i){Hb(this,i)};var Gb="3.0.2",AR="6.3.0",DR="1.0.1",IR="6.0.0",kR="4.0.1";const hi={PlaylistLoader:xs,Playlist:yi,utils:$k,STANDARD_PLAYLIST_SELECTOR:t_,INITIAL_PLAYLIST_SELECTOR:kP,lastBandwidthSelector:t_,movingAverageBandwidthSelector:DP,comparePlaylistBandwidth:$p,comparePlaylistResolution:AP,xhr:Tb()};Object.keys(At).forEach(i=>{Object.defineProperty(hi,i,{get(){return F.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),At[i]},set(e){if(F.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){F.log.warn(`value of Vhs.${i} must be greater than or equal to 0`);return}At[i]=e}})});const zb="videojs-vhs",Wb=function(i,e){const t=e.media();let n=-1;for(let r=0;r<i.length;r++)if(i[r].id===t.id){n=r;break}i.selectedIndex_=n,i.trigger({selectedIndex:n,type:"change"})},PR=function(i,e){e.representations().forEach(t=>{i.addQualityLevel(t)}),Wb(i,e.playlists)};hi.canPlaySource=function(){return F.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const RR=(i,e,t)=>{if(!i)return i;let n={};e&&e.attributes&&e.attributes.CODECS&&(n=Wl(tn(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(n.audio=t.attributes.CODECS);const r=Ao(n.video),s=Ao(n.audio),a={};for(const o in i)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),e.contentProtection&&e.contentProtection[o]&&e.contentProtection[o].pssh&&(a[o].pssh=e.contentProtection[o].pssh),typeof i[o]=="string"&&(a[o].url=i[o]);return Ye(i,a)},OR=(i,e)=>i.reduce((t,n)=>{if(!n.contentProtection)return t;const r=e.reduce((s,a)=>{const o=n.contentProtection[a];return o&&o.pssh&&(s[a]={pssh:o.pssh}),s},{});return Object.keys(r).length&&t.push(r),t},[]),LR=({player:i,sourceKeySystems:e,audioMedia:t,mainPlaylists:n})=>{if(!i.eme.initializeMediaKeys)return Promise.resolve();const r=t?n.concat([t]):n,s=OR(r,Object.keys(e)),a=[],o=[];return s.forEach(u=>{o.push(new Promise((c,h)=>{i.tech_.one("keysessioncreated",c)})),a.push(new Promise((c,h)=>{i.eme.initializeMediaKeys({keySystems:u},g=>{if(g){h(g);return}c()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},NR=({player:i,sourceKeySystems:e,media:t,audioMedia:n})=>{const r=RR(e,t,n);return r?(i.currentSource().keySystems=r,r&&!i.eme?(F.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},Kb=()=>{if(!D.localStorage)return null;const i=D.localStorage.getItem(zb);if(!i)return null;try{return JSON.parse(i)}catch{return null}},MR=i=>{if(!D.localStorage)return!1;let e=Kb();e=e?Ye(e,i):i;try{D.localStorage.setItem(zb,JSON.stringify(e))}catch{return!1}return e},FR=i=>i.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(i.substring(i.indexOf(",")+1)):i;hi.supportsNativeHls=function(){if(!W||!W.createElement)return!1;const i=W.createElement("video");return F.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(i.canPlayType(t))}):!1}();hi.supportsNativeDash=function(){return!W||!W.createElement||!F.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(W.createElement("video").canPlayType("application/dash+xml"))}();hi.supportsTypeNatively=i=>i==="hls"?hi.supportsNativeHls:i==="dash"?hi.supportsNativeDash:!1;hi.isSupported=function(){return F.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const BR=F.getComponent("Component");class Xb extends BR{constructor(e,t,n){if(super(t,n.vhs),typeof n.initialBandwidth=="number"&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=Ji("VhsHandler"),t.options_&&t.options_.playerId){const r=F.getPlayer(t.options_.playerId);this.player_=r}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(W,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],r=>{const s=W.fullscreenElement||W.webkitFullscreenElement||W.mozFullScreenElement||W.msFullscreenElement;s&&s.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(){if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=5*60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const e=Kb();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=At.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===At.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(e=>{typeof this.source_[e]<"u"&&(this.options_[e]=this.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=FR(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=hi,this.options_.sourceType=iv(t),this.options_.seekTo=s=>{this.tech_.setCurrentTime(s)},this.playlistController_=new TR(this.options_);const n=Ye({liveRangeSafeTimeDelta:un},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new xR(n),this.playlistController_.on("error",()=>{const s=F.players[this.tech_.options_.playerId];let a=this.playlistController_.error;typeof a=="object"&&!a.code?a.code=3:typeof a=="string"&&(a={message:a,code:3}),s.error(a)});const r=this.options_.bufferBasedABR?hi.movingAverageBandwidthSelector(.55):hi.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=hi.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(s){this.playlistController_.selectPlaylist=s.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(s){this.playlistController_.mainSegmentLoader_.throughput.rate=s,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let s=this.playlistController_.mainSegmentLoader_.bandwidth;const a=D.navigator.connection||D.navigator.mozConnection||D.navigator.webkitConnection,o=1e7;if(this.options_.useNetworkInformationApi&&a){const u=a.downlink*1e3*1e3;u>=o&&s>=o?s=Math.max(s,u):s=u}return s},set(s){this.playlistController_.mainSegmentLoader_.bandwidth=s,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const s=1/(this.bandwidth||1);let a;return this.throughput>0?a=1/this.throughput:a=0,Math.floor(1/(s+a))},set(){F.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>kr(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>kr(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&MR({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{SR(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=D.URL.createObjectURL(this.playlistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),LR({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=NR({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",n=>{if(n.status!=="output-restricted")return;const r=this.playlistController_.main();if(!r||!r.playlists)return;const s=[];r.playlists.forEach(a=>{a&&a.attributes&&a.attributes.RESOLUTION&&a.attributes.RESOLUTION.height>=720&&(!a.excludeUntil||a.excludeUntil<1/0)&&(a.excludeUntil=1/0,s.push(a))}),s.length&&(F.log.warn('DRM keystatus changed to "output-restricted." Removing the following HD playlists that will most likely fail to play and clearing the buffer. This may be due to HDCP restrictions on the stream and the capabilities of the current device.',...s),this.playlistController_.fastQualityChange_())}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),F.browser.IE_VERSION===11||!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=F.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{PR(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{Wb(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":Gb,"mux.js":AR,"mpd-parser":DR,"m3u8-parser":IR,"aes-decrypter":kR}}version(){return this.constructor.version()}canChangeType(){return $b.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&D.URL.revokeObjectURL&&(D.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return Xk({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,r=2){return Cb({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}}const Ql={name:"videojs-http-streaming",VERSION:Gb,canHandleSource(i,e={}){const t=Ye(F.options,e);return Ql.canPlayType(i.type,t)},handleSource(i,e,t={}){const n=Ye(F.options,t);return e.vhs=new Xb(i,e,n),e.vhs.xhr=Tb(),e.vhs.src(i.src,i.type),e.vhs},canPlayType(i,e){const t=iv(i);if(!t)return"";const n=Ql.getOverrideNative(e);return!hi.supportsTypeNatively(t)||n?"maybe":""},getOverrideNative(i={}){const{vhs:e={}}=i,t=!(F.browser.IS_ANY_SAFARI||F.browser.IS_IOS),{overrideNative:n=t}=e;return n}},UR=()=>cl("avc1.4d400d,mp4a.40.2");UR()&&F.getTech("Html5").registerSourceHandler(Ql,0);F.VhsHandler=Xb;F.VhsSourceHandler=Ql;F.Vhs=hi;F.use||F.registerComponent("Vhs",hi);F.options.vhs=F.options.vhs||{};(!F.getPlugin||!F.getPlugin("reloadSourceOnError"))&&F.registerPlugin("reloadSourceOnError",wR);function d_(i,e,t){const n=i.slice();return n[22]=e[t],n[24]=t,n}function f_(i){let e,t,n;return{c(){e=ze("div"),Ae(e,"style",t="flex : "+i[22]),Ae(e,"class",n="h-full "+(i[24]%2==(i[1]?0:1)?"bg-green-500":"bg-gray-300"))},m(r,s){Jt(r,e,s)},p(r,s){s&1&&t!==(t="flex : "+r[22])&&Ae(e,"style",t),s&2&&n!==(n="h-full "+(r[24]%2==(r[1]?0:1)?"bg-green-500":"bg-gray-300"))&&Ae(e,"class",n)},d(r){r&&Bt(e)}}}function VR(i){let e,t,n=i[6].toLocaleTimeString()+"",r,s,a,o,u,c,h,g=i[0],y=[];for(let v=0;v<g.length;v+=1)y[v]=f_(d_(i,g,v));return{c(){e=ze("div"),t=ze("div"),r=$s(n),a=Ui(),o=ze("div"),u=Ui();for(let v=0;v<y.length;v+=1)y[v].c();Ae(t,"class","h-full w-100 bg-gray-500 text-white rounded-md p-1 absolute pointer-events-none"),Ae(t,"id","cursor"),Xn(t,"left",i[3]+"px"),Xn(t,"top",i[4]+"px"),Xn(t,"visibility",i[8]),Ae(o,"class","h-full w-1 absolute bg-blue-500"),Ae(o,"id","blue"),Xn(o,"left",i[5]+"px"),Ae(e,"class","flex h-full relative flex-1"),Ae(e,"id","container")},m(v,T){Jt(v,e,T),Re(e,t),Re(t,r),i[17](t),s=rx.observe(t,i[18].bind(t)),Re(e,a),Re(e,o),Re(e,u);for(let S=0;S<y.length;S+=1)y[S]&&y[S].m(e,null);c||(h=[rn(e,"mousemove",i[9]),rn(e,"click",i[10]),rn(e,"mouseenter",i[19]),rn(e,"mouseleave",i[20]),rn(e,"keydown",jR)],c=!0)},p(v,[T]){if(T&64&&n!==(n=v[6].toLocaleTimeString()+"")&&bd(r,n),T&8&&Xn(t,"left",v[3]+"px"),T&16&&Xn(t,"top",v[4]+"px"),T&256&&Xn(t,"visibility",v[8]),T&32&&Xn(o,"left",v[5]+"px"),T&3){g=v[0];let S;for(S=0;S<g.length;S+=1){const A=d_(v,g,S);y[S]?y[S].p(A,T):(y[S]=f_(A),y[S].c(),y[S].m(e,null))}for(;S<y.length;S+=1)y[S].d(1);y.length=g.length}},i:ut,o:ut,d(v){v&&Bt(e),i[17](null),s(),Dy(y,v),c=!1,Gr(h)}}}const jR=()=>{};function $R(i,e,t){let{player:n}=e,{sessions:r}=e,{intervals:s}=e,{flag:a}=e,{now:o}=e,{t0:u}=e,{t1:c}=e,h=0,g=0,y=0,v=0,T=0,S,A=new Date,k,P="hidden";function M(K){const{left:oe,right:pe,top:we,bottom:X}=K.currentTarget.getBoundingClientRect();t(3,g=K.clientX-oe-(S.right-S.left)/2),t(4,y=we-X);const ge=K.clientX-oe,rt=pe-oe,Ee=c.getTime()-u.getTime(),Fe=ge/rt;t(6,A=new Date(u.getTime()+Fe*Ee));const He=r.filter(gt=>gt.time.getTime()<A.getTime()),pt=He[He.length-1],mt=He.slice(0,He.length-1).map(gt=>gt.segments.length*2e3).reduce((gt,Pi)=>gt+Pi,0);h=((pt?Math.min(A.getTime()-pt.time.getTime(),pt.segments.length*2e3):0)+mt)/1e3}function R(){n.currentTime(h)}function O(K){Ot[K?"unshift":"push"](()=>{k=K,t(7,k)})}function j(){var K;S=(K=Xo.entries.get(this))==null?void 0:K.contentRect,t(2,S)}const z=()=>t(8,P="visible"),ee=()=>t(8,P="hidden");return i.$$set=K=>{"player"in K&&t(11,n=K.player),"sessions"in K&&t(12,r=K.sessions),"intervals"in K&&t(0,s=K.intervals),"flag"in K&&t(1,a=K.flag),"now"in K&&t(13,o=K.now),"t0"in K&&t(14,u=K.t0),"t1"in K&&t(15,c=K.t1)},i.$$.update=()=>{if(i.$$.dirty&122880&&o!=null&&document.querySelector("#container")!=null){const K=o,{left:oe,right:pe}=document.querySelector("#container").getBoundingClientRect(),we=pe-oe,X=c.getTime()-u.getTime(),ge=(K.getTime()-u.getTime())/X;t(16,T=ge*we),t(5,v=T)}i.$$.dirty&4&&t(3,g=S?S.left:0)},[s,a,S,g,y,v,A,k,P,M,R,n,r,o,u,c,T,O,j,z,ee]}class qR extends qn{constructor(e){super(),$n(this,e,$R,VR,jn,{player:11,sessions:12,intervals:0,flag:1,now:13,t0:14,t1:15})}}class HR{constructor(e,t,n){ju(this,"id");ju(this,"time");ju(this,"segments");this.id=e,this.time=t,this.segments=n}get end(){return new Date(this.time.getTime()+this.segments.length*2e3)}}var GR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Y,qp=qp||{},fe=GR||self;function Nc(i){var e=typeof i;return e=e!="object"?e:i?Array.isArray(i)?"array":e:"null",e=="array"||e=="object"&&typeof i.length=="number"}function ou(i){var e=typeof i;return e=="object"&&i!=null||e=="function"}function zR(i){return Object.prototype.hasOwnProperty.call(i,nd)&&i[nd]||(i[nd]=++WR)}var nd="closure_uid_"+(1e9*Math.random()>>>0),WR=0;function KR(i,e,t){return i.call.apply(i.bind,arguments)}function XR(i,e,t){if(!i)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),i.apply(e,r)}}return function(){return i.apply(e,arguments)}}function Kt(i,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Kt=KR:Kt=XR,Kt.apply(null,arguments)}function Qu(i,e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=t.slice();return n.push.apply(n,arguments),i.apply(this,n)}}function Pt(i,e){function t(){}t.prototype=e.prototype,i.$=e.prototype,i.prototype=new t,i.prototype.constructor=i,i.ac=function(n,r,s){for(var a=Array(arguments.length-2),o=2;o<arguments.length;o++)a[o-2]=arguments[o];return e.prototype[r].apply(n,a)}}function pr(){this.s=this.s,this.o=this.o}var YR=0;pr.prototype.s=!1;pr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),YR!=0)&&zR(this)};pr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Yb=Array.prototype.indexOf?function(i,e){return Array.prototype.indexOf.call(i,e,void 0)}:function(i,e){if(typeof i=="string")return typeof e!="string"||e.length!=1?-1:i.indexOf(e,0);for(let t=0;t<i.length;t++)if(t in i&&i[t]===e)return t;return-1};function Hp(i){const e=i.length;if(0<e){const t=Array(e);for(let n=0;n<e;n++)t[n]=i[n];return t}return[]}function p_(i,e){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Nc(n)){const r=i.length||0,s=n.length||0;i.length=r+s;for(let a=0;a<s;a++)i[r+a]=n[a]}else i.push(n)}}function Xt(i,e){this.type=i,this.g=this.target=e,this.defaultPrevented=!1}Xt.prototype.h=function(){this.defaultPrevented=!0};var QR=function(){if(!fe.addEventListener||!Object.defineProperty)return!1;var i=!1,e=Object.defineProperty({},"passive",{get:function(){i=!0}});try{fe.addEventListener("test",()=>{},e),fe.removeEventListener("test",()=>{},e)}catch{}return i}();function No(i){return/^[\s\xa0]*$/.test(i)}function Mc(){var i=fe.navigator;return i&&(i=i.userAgent)?i:""}function sn(i){return Mc().indexOf(i)!=-1}function Gp(i){return Gp[" "](i),i}Gp[" "]=function(){};function JR(i,e){var t=HO;return Object.prototype.hasOwnProperty.call(t,i)?t[i]:t[i]=e(i)}var ZR=sn("Opera"),ta=sn("Trident")||sn("MSIE"),Qb=sn("Edge"),sf=Qb||ta,Jb=sn("Gecko")&&!(Mc().toLowerCase().indexOf("webkit")!=-1&&!sn("Edge"))&&!(sn("Trident")||sn("MSIE"))&&!sn("Edge"),eO=Mc().toLowerCase().indexOf("webkit")!=-1&&!sn("Edge");function Zb(){var i=fe.document;return i?i.documentMode:void 0}var af;e:{var rd="",sd=function(){var i=Mc();if(Jb)return/rv:([^\);]+)(\)|;)/.exec(i);if(Qb)return/Edge\/([\d\.]+)/.exec(i);if(ta)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(i);if(eO)return/WebKit\/(\S+)/.exec(i);if(ZR)return/(?:Version)[ \/]?(\S+)/.exec(i)}();if(sd&&(rd=sd?sd[1]:""),ta){var ad=Zb();if(ad!=null&&ad>parseFloat(rd)){af=String(ad);break e}}af=rd}var of;if(fe.document&&ta){var m_=Zb();of=m_||parseInt(af,10)||void 0}else of=void 0;var tO=of;function Mo(i,e){if(Xt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var t=this.type=i.type,n=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=e,e=i.relatedTarget){if(Jb){e:{try{Gp(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else t=="mouseover"?e=i.fromElement:t=="mouseout"&&(e=i.toElement);this.relatedTarget=e,n?(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:iO[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&Mo.$.h.call(this)}}Pt(Mo,Xt);var iO={2:"touch",3:"pen",4:"mouse"};Mo.prototype.h=function(){Mo.$.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var uu="closure_listenable_"+(1e6*Math.random()|0),nO=0;function rO(i,e,t,n,r){this.listener=i,this.proxy=null,this.src=e,this.type=t,this.capture=!!n,this.la=r,this.key=++nO,this.fa=this.ia=!1}function Fc(i){i.fa=!0,i.listener=null,i.proxy=null,i.src=null,i.la=null}function zp(i,e,t){for(const n in i)e.call(t,i[n],n,i)}function sO(i,e){for(const t in i)e.call(void 0,i[t],t,i)}function eE(i){const e={};for(const t in i)e[t]=i[t];return e}const g_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tE(i,e){let t,n;for(let r=1;r<arguments.length;r++){n=arguments[r];for(t in n)i[t]=n[t];for(let s=0;s<g_.length;s++)t=g_[s],Object.prototype.hasOwnProperty.call(n,t)&&(i[t]=n[t])}}function Bc(i){this.src=i,this.g={},this.h=0}Bc.prototype.add=function(i,e,t,n,r){var s=i.toString();i=this.g[s],i||(i=this.g[s]=[],this.h++);var a=lf(i,e,n,r);return-1<a?(e=i[a],t||(e.ia=!1)):(e=new rO(e,this.src,s,!!n,r),e.ia=t,i.push(e)),e};function uf(i,e){var t=e.type;if(t in i.g){var n=i.g[t],r=Yb(n,e),s;(s=0<=r)&&Array.prototype.splice.call(n,r,1),s&&(Fc(e),i.g[t].length==0&&(delete i.g[t],i.h--))}}function lf(i,e,t,n){for(var r=0;r<i.length;++r){var s=i[r];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==n)return r}return-1}var Wp="closure_lm_"+(1e6*Math.random()|0),od={};function iE(i,e,t,n,r){if(n&&n.once)return rE(i,e,t,n,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)iE(i,e[s],t,n,r);return null}return t=Yp(t),i&&i[uu]?i.O(e,t,ou(n)?!!n.capture:!!n,r):nE(i,e,t,!1,n,r)}function nE(i,e,t,n,r,s){if(!e)throw Error("Invalid event type");var a=ou(r)?!!r.capture:!!r,o=Xp(i);if(o||(i[Wp]=o=new Bc(i)),t=o.add(e,t,n,a,s),t.proxy)return t;if(n=aO(),t.proxy=n,n.src=i,n.listener=t,i.addEventListener)QR||(r=a),r===void 0&&(r=!1),i.addEventListener(e.toString(),n,r);else if(i.attachEvent)i.attachEvent(aE(e.toString()),n);else if(i.addListener&&i.removeListener)i.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return t}function aO(){function i(t){return e.call(i.src,i.listener,t)}const e=oO;return i}function rE(i,e,t,n,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)rE(i,e[s],t,n,r);return null}return t=Yp(t),i&&i[uu]?i.P(e,t,ou(n)?!!n.capture:!!n,r):nE(i,e,t,!0,n,r)}function sE(i,e,t,n,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)sE(i,e[s],t,n,r);else n=ou(n)?!!n.capture:!!n,t=Yp(t),i&&i[uu]?(i=i.i,e=String(e).toString(),e in i.g&&(s=i.g[e],t=lf(s,t,n,r),-1<t&&(Fc(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete i.g[e],i.h--)))):i&&(i=Xp(i))&&(e=i.g[e.toString()],i=-1,e&&(i=lf(e,t,n,r)),(t=-1<i?e[i]:null)&&Kp(t))}function Kp(i){if(typeof i!="number"&&i&&!i.fa){var e=i.src;if(e&&e[uu])uf(e.i,i);else{var t=i.type,n=i.proxy;e.removeEventListener?e.removeEventListener(t,n,i.capture):e.detachEvent?e.detachEvent(aE(t),n):e.addListener&&e.removeListener&&e.removeListener(n),(t=Xp(e))?(uf(t,i),t.h==0&&(t.src=null,e[Wp]=null)):Fc(i)}}}function aE(i){return i in od?od[i]:od[i]="on"+i}function oO(i,e){if(i.fa)i=!0;else{e=new Mo(e,this);var t=i.listener,n=i.la||i.src;i.ia&&Kp(i),i=t.call(n,e)}return i}function Xp(i){return i=i[Wp],i instanceof Bc?i:null}var ud="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yp(i){return typeof i=="function"?i:(i[ud]||(i[ud]=function(e){return i.handleEvent(e)}),i[ud])}function kt(){pr.call(this),this.i=new Bc(this),this.S=this,this.J=null}Pt(kt,pr);kt.prototype[uu]=!0;kt.prototype.removeEventListener=function(i,e,t,n){sE(this,i,e,t,n)};function Ft(i,e){var t,n=i.J;if(n)for(t=[];n;n=n.J)t.push(n);if(i=i.S,n=e.type||e,typeof e=="string")e=new Xt(e,i);else if(e instanceof Xt)e.target=e.target||i;else{var r=e;e=new Xt(n,i),tE(e,r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];r=Ju(a,n,!0,e)&&r}if(a=e.g=i,r=Ju(a,n,!0,e)&&r,r=Ju(a,n,!1,e)&&r,t)for(s=0;s<t.length;s++)a=e.g=t[s],r=Ju(a,n,!1,e)&&r}kt.prototype.N=function(){if(kt.$.N.call(this),this.i){var i=this.i,e;for(e in i.g){for(var t=i.g[e],n=0;n<t.length;n++)Fc(t[n]);delete i.g[e],i.h--}}this.J=null};kt.prototype.O=function(i,e,t,n){return this.i.add(String(i),e,!1,t,n)};kt.prototype.P=function(i,e,t,n){return this.i.add(String(i),e,!0,t,n)};function Ju(i,e,t,n){if(e=i.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var o=a.listener,u=a.la||a.src;a.ia&&uf(i.i,a),r=o.call(u,n)!==!1&&r}}return r&&!n.defaultPrevented}var Qp=fe.JSON.stringify;class uO{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function lO(){var i=Jp;let e=null;return i.g&&(e=i.g,i.g=i.g.next,i.g||(i.h=null),e.next=null),e}class cO{constructor(){this.h=this.g=null}add(e,t){const n=oE.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var oE=new uO(()=>new hO,i=>i.reset());class hO{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function dO(i){var e=1;i=i.split(":");const t=[];for(;0<e&&i.length;)t.push(i.shift()),e--;return i.length&&t.push(i.join(":")),t}function fO(i){fe.setTimeout(()=>{throw i},0)}let Fo,Bo=!1,Jp=new cO,uE=()=>{const i=fe.Promise.resolve(void 0);Fo=()=>{i.then(pO)}};var pO=()=>{for(var i;i=lO();){try{i.h.call(i.g)}catch(t){fO(t)}var e=oE;e.j(i),100>e.h&&(e.h++,i.next=e.g,e.g=i)}Bo=!1};function Uc(i,e){kt.call(this),this.h=i||1,this.g=e||fe,this.j=Kt(this.qb,this),this.l=Date.now()}Pt(Uc,kt);Y=Uc.prototype;Y.ga=!1;Y.T=null;Y.qb=function(){if(this.ga){var i=Date.now()-this.l;0<i&&i<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-i):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ft(this,"tick"),this.ga&&(Zp(this),this.start()))}};Y.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Zp(i){i.ga=!1,i.T&&(i.g.clearTimeout(i.T),i.T=null)}Y.N=function(){Uc.$.N.call(this),Zp(this),delete this.g};function em(i,e,t){if(typeof i=="function")t&&(i=Kt(i,t));else if(i&&typeof i.handleEvent=="function")i=Kt(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:fe.setTimeout(i,e||0)}function lE(i){i.g=em(()=>{i.g=null,i.i&&(i.i=!1,lE(i))},i.j);const e=i.h;i.h=null,i.m.apply(null,e)}class mO extends pr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:lE(this)}N(){super.N(),this.g&&(fe.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Uo(i){pr.call(this),this.h=i,this.g={}}Pt(Uo,pr);var __=[];function cE(i,e,t,n){Array.isArray(t)||(t&&(__[0]=t.toString()),t=__);for(var r=0;r<t.length;r++){var s=iE(e,t[r],n||i.handleEvent,!1,i.h||i);if(!s)break;i.g[s.key]=s}}function hE(i){zp(i.g,function(e,t){this.g.hasOwnProperty(t)&&Kp(e)},i),i.g={}}Uo.prototype.N=function(){Uo.$.N.call(this),hE(this)};Uo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Vc(){this.g=!0}Vc.prototype.Ea=function(){this.g=!1};function gO(i,e,t,n,r,s){i.info(function(){if(i.g)if(s)for(var a="",o=s.split("&"),u=0;u<o.length;u++){var c=o[u].split("=");if(1<c.length){var h=c[0];c=c[1];var g=h.split("_");a=2<=g.length&&g[1]=="type"?a+(h+"="+c+"&"):a+(h+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+e+`
`+t+`
`+a})}function _O(i,e,t,n,r,s,a){i.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+e+`
`+t+`
`+s+" "+a})}function Cs(i,e,t,n){i.info(function(){return"XMLHTTP TEXT ("+e+"): "+vO(i,t)+(n?" "+n:"")})}function yO(i,e){i.info(function(){return"TIMEOUT: "+e})}Vc.prototype.info=function(){};function vO(i,e){if(!i.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(i=0;i<t.length;i++)if(Array.isArray(t[i])){var n=t[i];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var a=1;a<r.length;a++)r[a]=""}}}}return Qp(t)}catch{return e}}var Wr={},y_=null;function jc(){return y_=y_||new kt}Wr.Ta="serverreachability";function dE(i){Xt.call(this,Wr.Ta,i)}Pt(dE,Xt);function Vo(i){const e=jc();Ft(e,new dE(e))}Wr.STAT_EVENT="statevent";function fE(i,e){Xt.call(this,Wr.STAT_EVENT,i),this.stat=e}Pt(fE,Xt);function di(i){const e=jc();Ft(e,new fE(e,i))}Wr.Ua="timingevent";function pE(i,e){Xt.call(this,Wr.Ua,i),this.size=e}Pt(pE,Xt);function lu(i,e){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return fe.setTimeout(function(){i()},e)}var $c={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},mE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function tm(){}tm.prototype.h=null;function v_(i){return i.h||(i.h=i.i())}function gE(){}var cu={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function im(){Xt.call(this,"d")}Pt(im,Xt);function nm(){Xt.call(this,"c")}Pt(nm,Xt);var cf;function qc(){}Pt(qc,tm);qc.prototype.g=function(){return new XMLHttpRequest};qc.prototype.i=function(){return{}};cf=new qc;function hu(i,e,t,n){this.l=i,this.j=e,this.m=t,this.W=n||1,this.U=new Uo(this),this.P=TO,i=sf?125:void 0,this.V=new Uc(i),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new _E}function _E(){this.i=null,this.g="",this.h=!1}var TO=45e3,hf={},Jl={};Y=hu.prototype;Y.setTimeout=function(i){this.P=i};function df(i,e,t){i.L=1,i.v=Gc(Bn(e)),i.s=t,i.S=!0,yE(i,null)}function yE(i,e){i.G=Date.now(),du(i),i.A=Bn(i.v);var t=i.A,n=i.W;Array.isArray(n)||(n=[String(n)]),wE(t.i,"t",n),i.C=0,t=i.l.J,i.h=new _E,i.g=WE(i.l,t?e:null,!i.s),0<i.O&&(i.M=new mO(Kt(i.Pa,i,i.g),i.O)),cE(i.U,i.g,"readystatechange",i.nb),e=i.I?eE(i.I):{},i.s?(i.u||(i.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",i.g.ha(i.A,i.u,i.s,e)):(i.u="GET",i.g.ha(i.A,i.u,null,e)),Vo(),gO(i.j,i.u,i.A,i.m,i.W,i.s)}Y.nb=function(i){i=i.target;const e=this.M;e&&cn(i)==3?e.l():this.Pa(i)};Y.Pa=function(i){try{if(i==this.g)e:{const h=cn(this.g);var e=this.g.Ia();const g=this.g.da();if(!(3>h)&&(h!=3||sf||this.g&&(this.h.h||this.g.ja()||S_(this.g)))){this.J||h!=4||e==7||(e==8||0>=g?Vo(3):Vo(2)),Hc(this);var t=this.g.da();this.ca=t;t:if(vE(this)){var n=S_(this.g);i="";var r=n.length,s=cn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Pr(this),yo(this);var a="";break t}this.h.i=new fe.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,i+=this.h.i.decode(n[e],{stream:s&&e==r-1});n.splice(0,r),this.h.g+=i,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=t==200,_O(this.j,this.u,this.A,this.m,this.W,h,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,u=this.g;if((o=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!No(o)){var c=o;break t}}c=null}if(t=c)Cs(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ff(this,t);else{this.i=!1,this.o=3,di(12),Pr(this),yo(this);break e}}this.S?(TE(this,h,a),sf&&this.i&&h==3&&(cE(this.U,this.V,"tick",this.mb),this.V.start())):(Cs(this.j,this.m,a,null),ff(this,a)),h==4&&Pr(this),this.i&&!this.J&&(h==4?qE(this.l,this):(this.i=!1,du(this)))}else jO(this.g),t==400&&0<a.indexOf("Unknown SID")?(this.o=3,di(12)):(this.o=0,di(13)),Pr(this),yo(this)}}}catch{}finally{}};function vE(i){return i.g?i.u=="GET"&&i.L!=2&&i.l.Ha:!1}function TE(i,e,t){let n=!0,r;for(;!i.J&&i.C<t.length;)if(r=bO(i,t),r==Jl){e==4&&(i.o=4,di(14),n=!1),Cs(i.j,i.m,null,"[Incomplete Response]");break}else if(r==hf){i.o=4,di(15),Cs(i.j,i.m,t,"[Invalid Chunk]"),n=!1;break}else Cs(i.j,i.m,r,null),ff(i,r);vE(i)&&r!=Jl&&r!=hf&&(i.h.g="",i.C=0),e!=4||t.length!=0||i.h.h||(i.o=1,di(16),n=!1),i.i=i.i&&n,n?0<t.length&&!i.ba&&(i.ba=!0,e=i.l,e.g==i&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),lm(e),e.M=!0,di(11))):(Cs(i.j,i.m,t,"[Invalid Chunked Response]"),Pr(i),yo(i))}Y.mb=function(){if(this.g){var i=cn(this.g),e=this.g.ja();this.C<e.length&&(Hc(this),TE(this,i,e),this.i&&i!=4&&du(this))}};function bO(i,e){var t=i.C,n=e.indexOf(`
`,t);return n==-1?Jl:(t=Number(e.substring(t,n)),isNaN(t)?hf:(n+=1,n+t>e.length?Jl:(e=e.slice(n,n+t),i.C=n+t,e)))}Y.cancel=function(){this.J=!0,Pr(this)};function du(i){i.Y=Date.now()+i.P,bE(i,i.P)}function bE(i,e){if(i.B!=null)throw Error("WatchDog timer not null");i.B=lu(Kt(i.lb,i),e)}function Hc(i){i.B&&(fe.clearTimeout(i.B),i.B=null)}Y.lb=function(){this.B=null;const i=Date.now();0<=i-this.Y?(yO(this.j,this.A),this.L!=2&&(Vo(),di(17)),Pr(this),this.o=2,yo(this)):bE(this,this.Y-i)};function yo(i){i.l.H==0||i.J||qE(i.l,i)}function Pr(i){Hc(i);var e=i.M;e&&typeof e.sa=="function"&&e.sa(),i.M=null,Zp(i.V),hE(i.U),i.g&&(e=i.g,i.g=null,e.abort(),e.sa())}function ff(i,e){try{var t=i.l;if(t.H!=0&&(t.g==i||pf(t.i,i))){if(!i.K&&pf(t.i,i)&&t.H==3){try{var n=t.Ja.g.parse(e)}catch{n=null}if(Array.isArray(n)&&n.length==3){var r=n;if(r[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<i.G)tc(t),Kc(t);else break e;um(t),di(18)}}else t.Fa=r[1],0<t.Fa-t.V&&37500>r[2]&&t.G&&t.A==0&&!t.v&&(t.v=lu(Kt(t.ib,t),6e3));if(1>=IE(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Rr(t,11)}else if((i.K||t.g==i)&&tc(t),!No(e))for(r=t.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];const h=c[3];h!=null&&(t.ra=h,t.l.info("VER="+t.ra));const g=c[4];g!=null&&(t.Ga=g,t.l.info("SVER="+t.Ga));const y=c[5];y!=null&&typeof y=="number"&&0<y&&(n=1.5*y,t.L=n,t.l.info("backChannelRequestTimeoutMs_="+n)),n=t;const v=i.g;if(v){const T=v.g?v.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(T){var s=n.i;s.g||T.indexOf("spdy")==-1&&T.indexOf("quic")==-1&&T.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(rm(s,s.h),s.h=null))}if(n.F){const S=v.g?v.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(n.Da=S,tt(n.I,n.F,S))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-i.G,t.l.info("Handshake RTT: "+t.S+"ms")),n=t;var a=i;if(n.wa=zE(n,n.J?n.pa:null,n.Y),a.K){kE(n.i,a);var o=a,u=n.L;u&&o.setTimeout(u),o.B&&(Hc(o),du(o)),n.g=a}else jE(n);0<t.j.length&&Xc(t)}else c[0]!="stop"&&c[0]!="close"||Rr(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Rr(t,7):om(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Vo(4)}catch{}}function EO(i){if(i.Z&&typeof i.Z=="function")return i.Z();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(Nc(i)){for(var e=[],t=i.length,n=0;n<t;n++)e.push(i[n]);return e}e=[],t=0;for(n in i)e[t++]=i[n];return e}function SO(i){if(i.ta&&typeof i.ta=="function")return i.ta();if(!i.Z||typeof i.Z!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(Nc(i)||typeof i=="string"){var e=[];i=i.length;for(var t=0;t<i;t++)e.push(t);return e}e=[],t=0;for(const n in i)e[t++]=n;return e}}}function EE(i,e){if(i.forEach&&typeof i.forEach=="function")i.forEach(e,void 0);else if(Nc(i)||typeof i=="string")Array.prototype.forEach.call(i,e,void 0);else for(var t=SO(i),n=EO(i),r=n.length,s=0;s<r;s++)e.call(void 0,n[s],t&&t[s],i)}var SE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xO(i,e){if(i){i=i.split("&");for(var t=0;t<i.length;t++){var n=i[t].indexOf("="),r=null;if(0<=n){var s=i[t].substring(0,n);r=i[t].substring(n+1)}else s=i[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Fr(i){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,i instanceof Fr){this.h=i.h,Zl(this,i.j),this.s=i.s,this.g=i.g,ec(this,i.m),this.l=i.l;var e=i.i,t=new jo;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),T_(this,t),this.o=i.o}else i&&(e=String(i).match(SE))?(this.h=!1,Zl(this,e[1]||"",!0),this.s=ao(e[2]||""),this.g=ao(e[3]||"",!0),ec(this,e[4]),this.l=ao(e[5]||"",!0),T_(this,e[6]||"",!0),this.o=ao(e[7]||"")):(this.h=!1,this.i=new jo(null,this.h))}Fr.prototype.toString=function(){var i=[],e=this.j;e&&i.push(oo(e,b_,!0),":");var t=this.g;return(t||e=="file")&&(i.push("//"),(e=this.s)&&i.push(oo(e,b_,!0),"@"),i.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&i.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&i.push("/"),i.push(oo(t,t.charAt(0)=="/"?AO:wO,!0))),(t=this.i.toString())&&i.push("?",t),(t=this.o)&&i.push("#",oo(t,IO)),i.join("")};function Bn(i){return new Fr(i)}function Zl(i,e,t){i.j=t?ao(e,!0):e,i.j&&(i.j=i.j.replace(/:$/,""))}function ec(i,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);i.m=e}else i.m=null}function T_(i,e,t){e instanceof jo?(i.i=e,kO(i.i,i.h)):(t||(e=oo(e,DO)),i.i=new jo(e,i.h))}function tt(i,e,t){i.i.set(e,t)}function Gc(i){return tt(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function ao(i,e){return i?e?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function oo(i,e,t){return typeof i=="string"?(i=encodeURI(i).replace(e,CO),t&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function CO(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var b_=/[#\/\?@]/g,wO=/[#\?:]/g,AO=/[#\?]/g,DO=/[#\?@]/g,IO=/#/g;function jo(i,e){this.h=this.g=null,this.i=i||null,this.j=!!e}function mr(i){i.g||(i.g=new Map,i.h=0,i.i&&xO(i.i,function(e,t){i.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}Y=jo.prototype;Y.add=function(i,e){mr(this),this.i=null,i=va(this,i);var t=this.g.get(i);return t||this.g.set(i,t=[]),t.push(e),this.h+=1,this};function xE(i,e){mr(i),e=va(i,e),i.g.has(e)&&(i.i=null,i.h-=i.g.get(e).length,i.g.delete(e))}function CE(i,e){return mr(i),e=va(i,e),i.g.has(e)}Y.forEach=function(i,e){mr(this),this.g.forEach(function(t,n){t.forEach(function(r){i.call(e,r,n,this)},this)},this)};Y.ta=function(){mr(this);const i=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let n=0;n<e.length;n++){const r=i[n];for(let s=0;s<r.length;s++)t.push(e[n])}return t};Y.Z=function(i){mr(this);let e=[];if(typeof i=="string")CE(this,i)&&(e=e.concat(this.g.get(va(this,i))));else{i=Array.from(this.g.values());for(let t=0;t<i.length;t++)e=e.concat(i[t])}return e};Y.set=function(i,e){return mr(this),this.i=null,i=va(this,i),CE(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[e]),this.h+=1,this};Y.get=function(i,e){return i?(i=this.Z(i),0<i.length?String(i[0]):e):e};function wE(i,e,t){xE(i,e),0<t.length&&(i.i=null,i.g.set(va(i,e),Hp(t)),i.h+=t.length)}Y.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var n=e[t];const s=encodeURIComponent(String(n)),a=this.Z(n);for(n=0;n<a.length;n++){var r=s;a[n]!==""&&(r+="="+encodeURIComponent(String(a[n]))),i.push(r)}}return this.i=i.join("&")};function va(i,e){return e=String(e),i.j&&(e=e.toLowerCase()),e}function kO(i,e){e&&!i.j&&(mr(i),i.i=null,i.g.forEach(function(t,n){var r=n.toLowerCase();n!=r&&(xE(this,n),wE(this,r,t))},i)),i.j=e}var PO=class{constructor(i,e){this.g=i,this.map=e}};function AE(i){this.l=i||RO,fe.PerformanceNavigationTiming?(i=fe.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(fe.g&&fe.g.Ka&&fe.g.Ka()&&fe.g.Ka().ec),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var RO=10;function DE(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function IE(i){return i.h?1:i.g?i.g.size:0}function pf(i,e){return i.h?i.h==e:i.g?i.g.has(e):!1}function rm(i,e){i.g?i.g.add(e):i.h=e}function kE(i,e){i.h&&i.h==e?i.h=null:i.g&&i.g.has(e)&&i.g.delete(e)}AE.prototype.cancel=function(){if(this.i=PE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function PE(i){if(i.h!=null)return i.i.concat(i.h.F);if(i.g!=null&&i.g.size!==0){let e=i.i;for(const t of i.g.values())e=e.concat(t.F);return e}return Hp(i.i)}var OO=class{stringify(i){return fe.JSON.stringify(i,void 0)}parse(i){return fe.JSON.parse(i,void 0)}};function LO(){this.g=new OO}function NO(i,e,t){const n=t||"";try{EE(i,function(r,s){let a=r;ou(r)&&(a=Qp(r)),e.push(n+s+"="+encodeURIComponent(a))})}catch(r){throw e.push(n+"type="+encodeURIComponent("_badmap")),r}}function MO(i,e){const t=new Vc;if(fe.Image){const n=new Image;n.onload=Qu(Zu,t,n,"TestLoadImage: loaded",!0,e),n.onerror=Qu(Zu,t,n,"TestLoadImage: error",!1,e),n.onabort=Qu(Zu,t,n,"TestLoadImage: abort",!1,e),n.ontimeout=Qu(Zu,t,n,"TestLoadImage: timeout",!1,e),fe.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=i}else e(!1)}function Zu(i,e,t,n,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(n)}catch{}}function fu(i){this.l=i.fc||null,this.j=i.ob||!1}Pt(fu,tm);fu.prototype.g=function(){return new zc(this.l,this.j)};fu.prototype.i=function(i){return function(){return i}}({});function zc(i,e){kt.call(this),this.F=i,this.u=e,this.m=void 0,this.readyState=sm,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Pt(zc,kt);var sm=0;Y=zc.prototype;Y.open=function(i,e){if(this.readyState!=sm)throw this.abort(),Error("Error reopening a connection");this.C=i,this.B=e,this.readyState=1,$o(this)};Y.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};i&&(e.body=i),(this.F||fe).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};Y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pu(this)),this.readyState=sm};Y.$a=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,$o(this)),this.g&&(this.readyState=3,$o(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof fe.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;RE(this)}else i.text().then(this.Za.bind(this),this.ka.bind(this))};function RE(i){i.j.read().then(i.Xa.bind(i)).catch(i.ka.bind(i))}Y.Xa=function(i){if(this.g){if(this.u&&i.value)this.response.push(i.value);else if(!this.u){var e=i.value?i.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!i.done}))&&(this.response=this.responseText+=e)}i.done?pu(this):$o(this),this.readyState==3&&RE(this)}};Y.Za=function(i){this.g&&(this.response=this.responseText=i,pu(this))};Y.Ya=function(i){this.g&&(this.response=i,pu(this))};Y.ka=function(){this.g&&pu(this)};function pu(i){i.readyState=4,i.l=null,i.j=null,i.A=null,$o(i)}Y.setRequestHeader=function(i,e){this.v.append(i,e)};Y.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""};Y.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,i.push(t[0]+": "+t[1]),t=e.next();return i.join(`\r
`)};function $o(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(zc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});var FO=fe.JSON.parse;function lt(i){kt.call(this),this.headers=new Map,this.u=i||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=OE,this.L=this.M=!1}Pt(lt,kt);var OE="",BO=/^https?$/i,UO=["POST","PUT"];Y=lt.prototype;Y.Oa=function(i){this.M=i};Y.ha=function(i,e,t,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+i);e=e?e.toUpperCase():"GET",this.I=i,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():cf.g(),this.C=this.u?v_(this.u):v_(cf),this.g.onreadystatechange=Kt(this.La,this);try{this.G=!0,this.g.open(e,String(i),!0),this.G=!1}catch(s){E_(this,s);return}if(i=t||"",t=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)t.set(r,n[r]);else if(typeof n.keys=="function"&&typeof n.get=="function")for(const s of n.keys())t.set(s,n.get(s));else throw Error("Unknown input type for opt_headers: "+String(n));n=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),r=fe.FormData&&i instanceof fe.FormData,!(0<=Yb(UO,e))||n||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ME(this),0<this.B&&((this.L=VO(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Kt(this.ua,this)):this.A=em(this.ua,this.B,this)),this.v=!0,this.g.send(i),this.v=!1}catch(s){E_(this,s)}};function VO(i){return ta&&typeof i.timeout=="number"&&i.ontimeout!==void 0}Y.ua=function(){typeof qp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ft(this,"timeout"),this.abort(8))};function E_(i,e){i.h=!1,i.g&&(i.l=!0,i.g.abort(),i.l=!1),i.j=e,i.m=5,LE(i),Wc(i)}function LE(i){i.F||(i.F=!0,Ft(i,"complete"),Ft(i,"error"))}Y.abort=function(i){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=i||7,Ft(this,"complete"),Ft(this,"abort"),Wc(this))};Y.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Wc(this,!0)),lt.$.N.call(this)};Y.La=function(){this.s||(this.G||this.v||this.l?NE(this):this.kb())};Y.kb=function(){NE(this)};function NE(i){if(i.h&&typeof qp<"u"&&(!i.C[1]||cn(i)!=4||i.da()!=2)){if(i.v&&cn(i)==4)em(i.La,0,i);else if(Ft(i,"readystatechange"),cn(i)==4){i.h=!1;try{const a=i.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var n;if(n=a===0){var r=String(i.I).match(SE)[1]||null;!r&&fe.self&&fe.self.location&&(r=fe.self.location.protocol.slice(0,-1)),n=!BO.test(r?r.toLowerCase():"")}t=n}if(t)Ft(i,"complete"),Ft(i,"success");else{i.m=6;try{var s=2<cn(i)?i.g.statusText:""}catch{s=""}i.j=s+" ["+i.da()+"]",LE(i)}}finally{Wc(i)}}}}function Wc(i,e){if(i.g){ME(i);const t=i.g,n=i.C[0]?()=>{}:null;i.g=null,i.C=null,e||Ft(i,"ready");try{t.onreadystatechange=n}catch{}}}function ME(i){i.g&&i.L&&(i.g.ontimeout=null),i.A&&(fe.clearTimeout(i.A),i.A=null)}Y.isActive=function(){return!!this.g};function cn(i){return i.g?i.g.readyState:0}Y.da=function(){try{return 2<cn(this)?this.g.status:-1}catch{return-1}};Y.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};Y.Wa=function(i){if(this.g){var e=this.g.responseText;return i&&e.indexOf(i)==0&&(e=e.substring(i.length)),FO(e)}};function S_(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.K){case OE:case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function jO(i){const e={};i=(i.g&&2<=cn(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let n=0;n<i.length;n++){if(No(i[n]))continue;var t=dO(i[n]);const r=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const s=e[r]||[];e[r]=s,s.push(t)}sO(e,function(n){return n.join(", ")})}Y.Ia=function(){return this.m};Y.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function FE(i){let e="";return zp(i,function(t,n){e+=n,e+=":",e+=t,e+=`\r
`}),e}function am(i,e,t){e:{for(n in t){var n=!1;break e}n=!0}n||(t=FE(t),typeof i=="string"?t!=null&&encodeURIComponent(String(t)):tt(i,e,t))}function Ja(i,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[i]||e}function BE(i){this.Ga=0,this.j=[],this.l=new Vc,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ja("failFast",!1,i),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ja("baseRetryDelayMs",5e3,i),this.hb=Ja("retryDelaySeedMs",1e4,i),this.eb=Ja("forwardChannelMaxRetries",2,i),this.xa=Ja("forwardChannelRequestTimeoutMs",2e4,i),this.va=i&&i.xmlHttpFactory||void 0,this.Ha=i&&i.dc||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.i=new AE(i&&i.concurrentRequestLimit),this.Ja=new LO,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=i&&i.bc||!1,i&&i.Ea&&this.l.Ea(),i&&i.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&i&&i.detectBufferingProxy||!1,this.qa=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.qa=i.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}Y=BE.prototype;Y.ra=8;Y.H=1;function om(i){if(UE(i),i.H==3){var e=i.W++,t=Bn(i.I);if(tt(t,"SID",i.K),tt(t,"RID",e),tt(t,"TYPE","terminate"),mu(i,t),e=new hu(i,i.l,e),e.L=2,e.v=Gc(Bn(t)),t=!1,fe.navigator&&fe.navigator.sendBeacon)try{t=fe.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&fe.Image&&(new Image().src=e.v,t=!0),t||(e.g=WE(e.l,null),e.g.ha(e.v)),e.G=Date.now(),du(e)}GE(i)}function Kc(i){i.g&&(lm(i),i.g.cancel(),i.g=null)}function UE(i){Kc(i),i.u&&(fe.clearTimeout(i.u),i.u=null),tc(i),i.i.cancel(),i.m&&(typeof i.m=="number"&&fe.clearTimeout(i.m),i.m=null)}function Xc(i){if(!DE(i.i)&&!i.m){i.m=!0;var e=i.Na;Fo||uE(),Bo||(Fo(),Bo=!0),Jp.add(e,i),i.C=0}}function $O(i,e){return IE(i.i)>=i.i.j-(i.m?1:0)?!1:i.m?(i.j=e.F.concat(i.j),!0):i.H==1||i.H==2||i.C>=(i.cb?0:i.eb)?!1:(i.m=lu(Kt(i.Na,i,e),HE(i,i.C)),i.C++,!0)}Y.Na=function(i){if(this.m)if(this.m=null,this.H==1){if(!i){this.W=Math.floor(1e5*Math.random()),i=this.W++;const r=new hu(this,this.l,i);let s=this.s;if(this.U&&(s?(s=eE(s),tE(s,this.U)):s=this.U),this.o!==null||this.O||(r.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var n=this.j[t];if("__data__"in n.map&&(n=n.map.__data__,typeof n=="string")){n=n.length;break t}n=void 0}if(n===void 0)break;if(e+=n,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=VE(this,r,e),t=Bn(this.I),tt(t,"RID",i),tt(t,"CVER",22),this.F&&tt(t,"X-HTTP-Session-Id",this.F),mu(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(FE(s)))+"&"+e:this.o&&am(t,this.o,s)),rm(this.i,r),this.bb&&tt(t,"TYPE","init"),this.P?(tt(t,"$req",e),tt(t,"SID","null"),r.aa=!0,df(r,t,null)):df(r,t,e),this.H=2}}else this.H==3&&(i?x_(this,i):this.j.length==0||DE(this.i)||x_(this))};function x_(i,e){var t;e?t=e.m:t=i.W++;const n=Bn(i.I);tt(n,"SID",i.K),tt(n,"RID",t),tt(n,"AID",i.V),mu(i,n),i.o&&i.s&&am(n,i.o,i.s),t=new hu(i,i.l,t,i.C+1),i.o===null&&(t.I=i.s),e&&(i.j=e.F.concat(i.j)),e=VE(i,t,1e3),t.setTimeout(Math.round(.5*i.xa)+Math.round(.5*i.xa*Math.random())),rm(i.i,t),df(t,n,e)}function mu(i,e){i.na&&zp(i.na,function(t,n){tt(e,n,t)}),i.h&&EE({},function(t,n){tt(e,n,t)})}function VE(i,e,t){t=Math.min(i.j.length,t);var n=i.h?Kt(i.h.Va,i.h,i):null;e:{var r=i.j;let s=-1;for(;;){const a=["count="+t];s==-1?0<t?(s=r[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let o=!0;for(let u=0;u<t;u++){let c=r[u].g;const h=r[u].map;if(c-=s,0>c)s=Math.max(0,r[u].g-100),o=!1;else try{NO(h,a,"req"+c+"_")}catch{n&&n(h)}}if(o){n=a.join("&");break e}}}return i=i.j.splice(0,t),e.F=i,n}function jE(i){if(!i.g&&!i.u){i.ba=1;var e=i.Ma;Fo||uE(),Bo||(Fo(),Bo=!0),Jp.add(e,i),i.A=0}}function um(i){return i.g||i.u||3<=i.A?!1:(i.ba++,i.u=lu(Kt(i.Ma,i),HE(i,i.A)),i.A++,!0)}Y.Ma=function(){if(this.u=null,$E(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var i=2*this.S;this.l.info("BP detection timer enabled: "+i),this.B=lu(Kt(this.jb,this),i)}};Y.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,di(10),Kc(this),$E(this))};function lm(i){i.B!=null&&(fe.clearTimeout(i.B),i.B=null)}function $E(i){i.g=new hu(i,i.l,"rpc",i.ba),i.o===null&&(i.g.I=i.s),i.g.O=0;var e=Bn(i.wa);tt(e,"RID","rpc"),tt(e,"SID",i.K),tt(e,"AID",i.V),tt(e,"CI",i.G?"0":"1"),!i.G&&i.qa&&tt(e,"TO",i.qa),tt(e,"TYPE","xmlhttp"),mu(i,e),i.o&&i.s&&am(e,i.o,i.s),i.L&&i.g.setTimeout(i.L);var t=i.g;i=i.pa,t.L=1,t.v=Gc(Bn(e)),t.s=null,t.S=!0,yE(t,i)}Y.ib=function(){this.v!=null&&(this.v=null,Kc(this),um(this),di(19))};function tc(i){i.v!=null&&(fe.clearTimeout(i.v),i.v=null)}function qE(i,e){var t=null;if(i.g==e){tc(i),lm(i),i.g=null;var n=2}else if(pf(i.i,e))t=e.F,kE(i.i,e),n=1;else return;if(i.H!=0){if(e.i)if(n==1){t=e.s?e.s.length:0,e=Date.now()-e.G;var r=i.C;n=jc(),Ft(n,new pE(n,t)),Xc(i)}else jE(i);else if(r=e.o,r==3||r==0&&0<e.ca||!(n==1&&$O(i,e)||n==2&&um(i)))switch(t&&0<t.length&&(e=i.i,e.i=e.i.concat(t)),r){case 1:Rr(i,5);break;case 4:Rr(i,10);break;case 3:Rr(i,6);break;default:Rr(i,2)}}}function HE(i,e){let t=i.ab+Math.floor(Math.random()*i.hb);return i.isActive()||(t*=2),t*e}function Rr(i,e){if(i.l.info("Error code "+e),e==2){var t=null;i.h&&(t=null);var n=Kt(i.pb,i);t||(t=new Fr("//www.google.com/images/cleardot.gif"),fe.location&&fe.location.protocol=="http"||Zl(t,"https"),Gc(t)),MO(t.toString(),n)}else di(2);i.H=0,i.h&&i.h.za(e),GE(i),UE(i)}Y.pb=function(i){i?(this.l.info("Successfully pinged google.com"),di(2)):(this.l.info("Failed to ping google.com"),di(1))};function GE(i){if(i.H=0,i.ma=[],i.h){const e=PE(i.i);(e.length!=0||i.j.length!=0)&&(p_(i.ma,e),p_(i.ma,i.j),i.i.i.length=0,Hp(i.j),i.j.length=0),i.h.ya()}}function zE(i,e,t){var n=t instanceof Fr?Bn(t):new Fr(t);if(n.g!="")e&&(n.g=e+"."+n.g),ec(n,n.m);else{var r=fe.location;n=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Fr(null);n&&Zl(s,n),e&&(s.g=e),r&&ec(s,r),t&&(s.l=t),n=s}return t=i.F,e=i.Da,t&&e&&tt(n,t,e),tt(n,"VER",i.ra),mu(i,n),n}function WE(i,e,t){if(e&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&i.Ha&&!i.va?new lt(new fu({ob:!0})):new lt(i.va),e.Oa(i.J),e}Y.isActive=function(){return!!this.h&&this.h.isActive(this)};function KE(){}Y=KE.prototype;Y.Ba=function(){};Y.Aa=function(){};Y.za=function(){};Y.ya=function(){};Y.isActive=function(){return!0};Y.Va=function(){};function ic(){if(ta&&!(10<=Number(tO)))throw Error("Environmental error: no available transport.")}ic.prototype.g=function(i,e){return new ki(i,e)};function ki(i,e){kt.call(this),this.g=new BE(e),this.l=i,this.h=e&&e.messageUrlParams||null,i=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.s=i,i=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(i?i["X-WebChannel-Content-Type"]=e.messageContentType:i={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(i?i["X-WebChannel-Client-Profile"]=e.Ca:i={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=i,(i=e&&e.cc)&&!No(i)&&(this.g.o=i),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!No(e)&&(this.g.F=e,i=this.h,i!==null&&e in i&&(i=this.h,e in i&&delete i[e])),this.j=new Ta(this)}Pt(ki,kt);ki.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var i=this.g,e=this.l,t=this.h||void 0;di(0),i.Y=e,i.na=t||{},i.G=i.aa,i.I=zE(i,null,i.Y),Xc(i)};ki.prototype.close=function(){om(this.g)};ki.prototype.u=function(i){var e=this.g;if(typeof i=="string"){var t={};t.__data__=i,i=t}else this.v&&(t={},t.__data__=Qp(i),i=t);e.j.push(new PO(e.fb++,i)),e.H==3&&Xc(e)};ki.prototype.N=function(){this.g.h=null,delete this.j,om(this.g),delete this.g,ki.$.N.call(this)};function XE(i){im.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var e=i.__sm__;if(e){e:{for(const t in e){i=t;break e}i=void 0}(this.i=i)&&(i=this.i,e=e!==null&&i in e?e[i]:void 0),this.data=e}else this.data=i}Pt(XE,im);function YE(){nm.call(this),this.status=1}Pt(YE,nm);function Ta(i){this.g=i}Pt(Ta,KE);Ta.prototype.Ba=function(){Ft(this.g,"a")};Ta.prototype.Aa=function(i){Ft(this.g,new XE(i))};Ta.prototype.za=function(i){Ft(this.g,new YE)};Ta.prototype.ya=function(){Ft(this.g,"b")};function qO(){this.blockSize=-1}function Xi(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Pt(Xi,qO);Xi.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function ld(i,e,t){t||(t=0);var n=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)n[r]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(r=0;16>r;++r)n[r]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=i.g[0],t=i.g[1],r=i.g[2];var s=i.g[3],a=e+(s^t&(r^s))+n[0]+3614090360&4294967295;e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[1]+3905402710&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[2]+606105819&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[3]+3250441966&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(s^t&(r^s))+n[4]+4118548399&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[5]+1200080426&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[6]+2821735955&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[7]+4249261313&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(s^t&(r^s))+n[8]+1770035416&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[9]+2336552879&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[10]+4294925233&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[11]+2304563134&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(s^t&(r^s))+n[12]+1804603682&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(r^e&(t^r))+n[13]+4254626195&4294967295,s=e+(a<<12&4294967295|a>>>20),a=r+(t^s&(e^t))+n[14]+2792965006&4294967295,r=s+(a<<17&4294967295|a>>>15),a=t+(e^r&(s^e))+n[15]+1236535329&4294967295,t=r+(a<<22&4294967295|a>>>10),a=e+(r^s&(t^r))+n[1]+4129170786&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[6]+3225465664&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[11]+643717713&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[0]+3921069994&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(r^s&(t^r))+n[5]+3593408605&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[10]+38016083&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[15]+3634488961&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[4]+3889429448&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(r^s&(t^r))+n[9]+568446438&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[14]+3275163606&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[3]+4107603335&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[8]+1163531501&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(r^s&(t^r))+n[13]+2850285829&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^r&(e^t))+n[2]+4243563512&4294967295,s=e+(a<<9&4294967295|a>>>23),a=r+(e^t&(s^e))+n[7]+1735328473&4294967295,r=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(r^s))+n[12]+2368359562&4294967295,t=r+(a<<20&4294967295|a>>>12),a=e+(t^r^s)+n[5]+4294588738&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[8]+2272392833&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[11]+1839030562&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[14]+4259657740&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(t^r^s)+n[1]+2763975236&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[4]+1272893353&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[7]+4139469664&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[10]+3200236656&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(t^r^s)+n[13]+681279174&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[0]+3936430074&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[3]+3572445317&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[6]+76029189&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(t^r^s)+n[9]+3654602809&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^r)+n[12]+3873151461&4294967295,s=e+(a<<11&4294967295|a>>>21),a=r+(s^e^t)+n[15]+530742520&4294967295,r=s+(a<<16&4294967295|a>>>16),a=t+(r^s^e)+n[2]+3299628645&4294967295,t=r+(a<<23&4294967295|a>>>9),a=e+(r^(t|~s))+n[0]+4096336452&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[7]+1126891415&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[14]+2878612391&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[5]+4237533241&4294967295,t=r+(a<<21&4294967295|a>>>11),a=e+(r^(t|~s))+n[12]+1700485571&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[3]+2399980690&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[10]+4293915773&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[1]+2240044497&4294967295,t=r+(a<<21&4294967295|a>>>11),a=e+(r^(t|~s))+n[8]+1873313359&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[15]+4264355552&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[6]+2734768916&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[13]+1309151649&4294967295,t=r+(a<<21&4294967295|a>>>11),a=e+(r^(t|~s))+n[4]+4149444226&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~r))+n[11]+3174756917&4294967295,s=e+(a<<10&4294967295|a>>>22),a=r+(e^(s|~t))+n[2]+718787259&4294967295,r=s+(a<<15&4294967295|a>>>17),a=t+(s^(r|~e))+n[9]+3951481745&4294967295,i.g[0]=i.g[0]+e&4294967295,i.g[1]=i.g[1]+(r+(a<<21&4294967295|a>>>11))&4294967295,i.g[2]=i.g[2]+r&4294967295,i.g[3]=i.g[3]+s&4294967295}Xi.prototype.j=function(i,e){e===void 0&&(e=i.length);for(var t=e-this.blockSize,n=this.m,r=this.h,s=0;s<e;){if(r==0)for(;s<=t;)ld(this,i,s),s+=this.blockSize;if(typeof i=="string"){for(;s<e;)if(n[r++]=i.charCodeAt(s++),r==this.blockSize){ld(this,n),r=0;break}}else for(;s<e;)if(n[r++]=i[s++],r==this.blockSize){ld(this,n),r=0;break}}this.h=r,this.i+=e};Xi.prototype.l=function(){var i=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);i[0]=128;for(var e=1;e<i.length-8;++e)i[e]=0;var t=8*this.i;for(e=i.length-8;e<i.length;++e)i[e]=t&255,t/=256;for(this.j(i),i=Array(16),e=t=0;4>e;++e)for(var n=0;32>n;n+=8)i[t++]=this.g[e]>>>n&255;return i};function qe(i,e){this.h=e;for(var t=[],n=!0,r=i.length-1;0<=r;r--){var s=i[r]|0;n&&s==e||(t[r]=s,n=!1)}this.g=t}var HO={};function cm(i){return-128<=i&&128>i?JR(i,function(e){return new qe([e|0],0>e?-1:0)}):new qe([i|0],0>i?-1:0)}function hn(i){if(isNaN(i)||!isFinite(i))return Ls;if(0>i)return Mt(hn(-i));for(var e=[],t=1,n=0;i>=t;n++)e[n]=i/t|0,t*=mf;return new qe(e,0)}function QE(i,e){if(i.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(i.charAt(0)=="-")return Mt(QE(i.substring(1),e));if(0<=i.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=hn(Math.pow(e,8)),n=Ls,r=0;r<i.length;r+=8){var s=Math.min(8,i.length-r),a=parseInt(i.substring(r,r+s),e);8>s?(s=hn(Math.pow(e,s)),n=n.R(s).add(hn(a))):(n=n.R(t),n=n.add(hn(a)))}return n}var mf=4294967296,Ls=cm(0),gf=cm(1),C_=cm(16777216);Y=qe.prototype;Y.ea=function(){if(Vi(this))return-Mt(this).ea();for(var i=0,e=1,t=0;t<this.g.length;t++){var n=this.D(t);i+=(0<=n?n:mf+n)*e,e*=mf}return i};Y.toString=function(i){if(i=i||10,2>i||36<i)throw Error("radix out of range: "+i);if(kn(this))return"0";if(Vi(this))return"-"+Mt(this).toString(i);for(var e=hn(Math.pow(i,6)),t=this,n="";;){var r=rc(t,e).g;t=nc(t,r.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(i);if(t=r,kn(t))return s+n;for(;6>s.length;)s="0"+s;n=s+n}};Y.D=function(i){return 0>i?0:i<this.g.length?this.g[i]:this.h};function kn(i){if(i.h!=0)return!1;for(var e=0;e<i.g.length;e++)if(i.g[e]!=0)return!1;return!0}function Vi(i){return i.h==-1}Y.X=function(i){return i=nc(this,i),Vi(i)?-1:kn(i)?0:1};function Mt(i){for(var e=i.g.length,t=[],n=0;n<e;n++)t[n]=~i.g[n];return new qe(t,~i.h).add(gf)}Y.abs=function(){return Vi(this)?Mt(this):this};Y.add=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0,r=0;r<=e;r++){var s=n+(this.D(r)&65535)+(i.D(r)&65535),a=(s>>>16)+(this.D(r)>>>16)+(i.D(r)>>>16);n=a>>>16,s&=65535,a&=65535,t[r]=a<<16|s}return new qe(t,t[t.length-1]&-2147483648?-1:0)};function nc(i,e){return i.add(Mt(e))}Y.R=function(i){if(kn(this)||kn(i))return Ls;if(Vi(this))return Vi(i)?Mt(this).R(Mt(i)):Mt(Mt(this).R(i));if(Vi(i))return Mt(this.R(Mt(i)));if(0>this.X(C_)&&0>i.X(C_))return hn(this.ea()*i.ea());for(var e=this.g.length+i.g.length,t=[],n=0;n<2*e;n++)t[n]=0;for(n=0;n<this.g.length;n++)for(var r=0;r<i.g.length;r++){var s=this.D(n)>>>16,a=this.D(n)&65535,o=i.D(r)>>>16,u=i.D(r)&65535;t[2*n+2*r]+=a*u,el(t,2*n+2*r),t[2*n+2*r+1]+=s*u,el(t,2*n+2*r+1),t[2*n+2*r+1]+=a*o,el(t,2*n+2*r+1),t[2*n+2*r+2]+=s*o,el(t,2*n+2*r+2)}for(n=0;n<e;n++)t[n]=t[2*n+1]<<16|t[2*n];for(n=e;n<2*e;n++)t[n]=0;return new qe(t,0)};function el(i,e){for(;(i[e]&65535)!=i[e];)i[e+1]+=i[e]>>>16,i[e]&=65535,e++}function Za(i,e){this.g=i,this.h=e}function rc(i,e){if(kn(e))throw Error("division by zero");if(kn(i))return new Za(Ls,Ls);if(Vi(i))return e=rc(Mt(i),e),new Za(Mt(e.g),Mt(e.h));if(Vi(e))return e=rc(i,Mt(e)),new Za(Mt(e.g),e.h);if(30<i.g.length){if(Vi(i)||Vi(e))throw Error("slowDivide_ only works with positive integers.");for(var t=gf,n=e;0>=n.X(i);)t=w_(t),n=w_(n);var r=gs(t,1),s=gs(n,1);for(n=gs(n,2),t=gs(t,2);!kn(n);){var a=s.add(n);0>=a.X(i)&&(r=r.add(t),s=a),n=gs(n,1),t=gs(t,1)}return e=nc(i,r.R(e)),new Za(r,e)}for(r=Ls;0<=i.X(e);){for(t=Math.max(1,Math.floor(i.ea()/e.ea())),n=Math.ceil(Math.log(t)/Math.LN2),n=48>=n?1:Math.pow(2,n-48),s=hn(t),a=s.R(e);Vi(a)||0<a.X(i);)t-=n,s=hn(t),a=s.R(e);kn(s)&&(s=gf),r=r.add(s),i=nc(i,a)}return new Za(r,i)}Y.gb=function(i){return rc(this,i).h};Y.and=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0;n<e;n++)t[n]=this.D(n)&i.D(n);return new qe(t,this.h&i.h)};Y.or=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0;n<e;n++)t[n]=this.D(n)|i.D(n);return new qe(t,this.h|i.h)};Y.xor=function(i){for(var e=Math.max(this.g.length,i.g.length),t=[],n=0;n<e;n++)t[n]=this.D(n)^i.D(n);return new qe(t,this.h^i.h)};function w_(i){for(var e=i.g.length+1,t=[],n=0;n<e;n++)t[n]=i.D(n)<<1|i.D(n-1)>>>31;return new qe(t,i.h)}function gs(i,e){var t=e>>5;e%=32;for(var n=i.g.length-t,r=[],s=0;s<n;s++)r[s]=0<e?i.D(s+t)>>>e|i.D(s+t+1)<<32-e:i.D(s+t);return new qe(r,i.h)}ic.prototype.createWebChannel=ic.prototype.g;ki.prototype.send=ki.prototype.u;ki.prototype.open=ki.prototype.m;ki.prototype.close=ki.prototype.close;$c.NO_ERROR=0;$c.TIMEOUT=8;$c.HTTP_ERROR=6;mE.COMPLETE="complete";gE.EventType=cu;cu.OPEN="a";cu.CLOSE="b";cu.ERROR="c";cu.MESSAGE="d";kt.prototype.listen=kt.prototype.O;lt.prototype.listenOnce=lt.prototype.P;lt.prototype.getLastError=lt.prototype.Sa;lt.prototype.getLastErrorCode=lt.prototype.Ia;lt.prototype.getStatus=lt.prototype.da;lt.prototype.getResponseJson=lt.prototype.Wa;lt.prototype.getResponseText=lt.prototype.ja;lt.prototype.send=lt.prototype.ha;lt.prototype.setWithCredentials=lt.prototype.Oa;Xi.prototype.digest=Xi.prototype.l;Xi.prototype.reset=Xi.prototype.reset;Xi.prototype.update=Xi.prototype.j;qe.prototype.add=qe.prototype.add;qe.prototype.multiply=qe.prototype.R;qe.prototype.modulo=qe.prototype.gb;qe.prototype.compare=qe.prototype.X;qe.prototype.toNumber=qe.prototype.ea;qe.prototype.toString=qe.prototype.toString;qe.prototype.getBits=qe.prototype.D;qe.fromNumber=hn;qe.fromString=QE;var GO=function(){return new ic},zO=function(){return jc()},cd=$c,WO=mE,KO=Wr,A_={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},XO=fu,tl=gE,YO=lt,QO=Xi,Ns=qe;const D_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}$t.UNAUTHENTICATED=new $t(null),$t.GOOGLE_CREDENTIALS=new $t("google-credentials-uid"),$t.FIRST_PARTY=new $t("first-party-uid"),$t.MOCK_USER=new $t("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ba="10.1.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $r=new By("@firebase/firestore");function I_(){return $r.logLevel}function se(i,...e){if($r.logLevel<=Be.DEBUG){const t=e.map(hm);$r.debug(`Firestore (${ba}): ${i}`,...t)}}function Un(i,...e){if($r.logLevel<=Be.ERROR){const t=e.map(hm);$r.error(`Firestore (${ba}): ${i}`,...t)}}function ia(i,...e){if($r.logLevel<=Be.WARN){const t=e.map(hm);$r.warn(`Firestore (${ba}): ${i}`,...t)}}function hm(i){if(typeof i=="string")return i;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(i)}catch{return i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(i="Unexpected state"){const e=`FIRESTORE (${ba}) INTERNAL ASSERTION FAILED: `+i;throw Un(e),new Error(e)}function St(i,e){i||be()}function Le(i,e){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class te extends ca{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class JO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t($t.UNAUTHENTICATED))}shutdown(){}}class ZO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class eL{constructor(e){this.t=e,this.currentUser=$t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve();let s=new ir;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ir,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const u=s;e.enqueueRetryable(async()=>{await u.promise,await r(this.currentUser)})},o=u=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(u=>o(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?o(u):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ir)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(St(typeof n.accessToken=="string"),new JE(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return St(e===null||typeof e=="string"),new $t(e)}}class tL{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=$t.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class iL{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new tL(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t($t.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rL{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{s.error!=null&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,se("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const r=s=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?r(s):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(St(typeof t.token=="string"),this.R=t.token,new nL(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sL(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE{static V(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=sL(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%e.length))}return n}}function Ue(i,e){return i<e?-1:i>e?1:0}function na(i,e,t){return i.length===e.length&&i.every((n,r)=>t(n,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new te(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new te(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new te(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new te(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Dt.fromMillis(Date.now())}static fromDate(e){return Dt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Dt(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ue(this.nanoseconds,e.nanoseconds):Ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ve(e)}static min(){return new ve(new Dt(0,0))}static max(){return new ve(new Dt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e,t,n){t===void 0?t=0:t>e.length&&be(),n===void 0?n=e.length-t:n>e.length-t&&be(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return qo.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qo?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const s=e.get(r),a=t.get(r);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class it extends qo{construct(e,t,n){return new it(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new te(q.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(r=>r.length>0))}return new it(t)}static emptyPath(){return new it([])}}const aL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ci extends qo{construct(e,t,n){return new ci(e,t,n)}static isValidIdentifier(e){return aL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ci.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ci(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(n.length===0)throw new te(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new te(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new te(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(n+=o,r++):(s(),r++)}if(s(),a)throw new te(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ci(t)}static emptyPath(){return new ci([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e){this.path=e}static fromPath(e){return new le(it.fromString(e))}static fromName(e){return new le(it.fromString(e).popFirst(5))}static empty(){return new le(it.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&it.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return it.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new le(new it(e.slice()))}}function oL(i,e){const t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,r=ve.fromTimestamp(n===1e9?new Dt(t+1,0):new Dt(t,n));return new ur(r,le.empty(),e)}function uL(i){return new ur(i.readTime,i.key,-1)}class ur{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ur(ve.min(),le.empty(),-1)}static max(){return new ur(ve.max(),le.empty(),-1)}}function lL(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=le.comparator(i.documentKey,e.documentKey),t!==0?t:Ue(i.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dm(i){if(i.code!==q.FAILED_PRECONDITION||i.message!==cL)throw i;se("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&be(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new H((n,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof H?t:H.resolve(t)}catch(t){return H.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):H.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):H.reject(t)}static resolve(e){return new H((t,n)=>{t(e)})}static reject(e){return new H((t,n)=>{n(e)})}static waitFor(e){return new H((t,n)=>{let r=0,s=0,a=!1;e.forEach(o=>{++r,o.next(()=>{++s,a&&s===r&&t()},u=>n(u))}),a=!0,s===r&&t()})}static or(e){let t=H.resolve(!1);for(const n of e)t=t.next(r=>r?H.resolve(r):n());return t}static forEach(e,t){const n=[];return e.forEach((r,s)=>{n.push(t.call(this,r,s))}),this.waitFor(n)}static mapArray(e,t){return new H((n,r)=>{const s=e.length,a=new Array(s);let o=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(h=>{a[c]=h,++o,o===s&&n(a)},h=>r(h))}})}static doWhile(e,t){return new H((n,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):n()};s()})}}function gu(i){return i.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.oe(n),this._e=n=>t.writeSequenceNumber(n))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}fm.ae=-1;function Yc(i){return i==null}function sc(i){return i===0&&1/i==-1/0}function dL(i){return typeof i=="number"&&Number.isInteger(i)&&!sc(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k_(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function _u(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function e2(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t){this.comparator=e,this.root=t||Nt.EMPTY}insert(e,t){return new ft(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Nt.BLACK,null,null))}remove(e){return new ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Nt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new il(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new il(this.root,e,this.comparator,!1)}getReverseIterator(){return new il(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new il(this.root,e,this.comparator,!0)}}class il{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Nt{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??Nt.RED,this.left=r??Nt.EMPTY,this.right=s??Nt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Nt(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Nt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Nt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Nt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Nt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw be();const e=this.left.check();if(e!==this.right.check())throw be();return e+(this.isRed()?0:1)}}Nt.EMPTY=null,Nt.RED=!0,Nt.BLACK=!1;Nt.EMPTY=new class{constructor(){this.size=0}get key(){throw be()}get value(){throw be()}get color(){throw be()}get left(){throw be()}get right(){throw be()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Nt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.comparator=e,this.data=new ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new P_(this.data.getIterator())}getIteratorFrom(e){return new P_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Yt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Yt(this.comparator);return t.data=e,t}}class P_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.fields=e,e.sort(ci.comparator)}static empty(){return new Jn([])}unionWith(e){let t=new Yt(ci.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Jn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return na(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new t2("Invalid base64 string: "+s):s}}(e);return new Qt(t)}static fromUint8Array(e){const t=function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s}(e);return new Qt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const fL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lr(i){if(St(!!i),typeof i=="string"){let e=0;const t=fL.exec(i);if(St(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:yt(i.seconds),nanos:yt(i.nanos)}}function yt(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function qr(i){return typeof i=="string"?Qt.fromBase64String(i):Qt.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pm(i){var e,t;return((t=(((e=i==null?void 0:i.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function mm(i){const e=i.mapValue.fields.__previous_value__;return pm(e)?mm(e):e}function Ho(i){const e=lr(i.mapValue.fields.__local_write_time__.timestampValue);return new Dt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pL{constructor(e,t,n,r,s,a,o,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=u,this.useFetchStreams=c}}class Go{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Go("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Go&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Hr(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?pm(i)?4:mL(i)?9007199254740991:10:be()}function bn(i,e){if(i===e)return!0;const t=Hr(i);if(t!==Hr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Ho(i).isEqual(Ho(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const a=lr(r.timestampValue),o=lr(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(r,s){return qr(r.bytesValue).isEqual(qr(s.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(r,s){return yt(r.geoPointValue.latitude)===yt(s.geoPointValue.latitude)&&yt(r.geoPointValue.longitude)===yt(s.geoPointValue.longitude)}(i,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return yt(r.integerValue)===yt(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const a=yt(r.doubleValue),o=yt(s.doubleValue);return a===o?sc(a)===sc(o):isNaN(a)&&isNaN(o)}return!1}(i,e);case 9:return na(i.arrayValue.values||[],e.arrayValue.values||[],bn);case 10:return function(r,s){const a=r.mapValue.fields||{},o=s.mapValue.fields||{};if(k_(a)!==k_(o))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(o[u]===void 0||!bn(a[u],o[u])))return!1;return!0}(i,e);default:return be()}}function zo(i,e){return(i.values||[]).find(t=>bn(t,e))!==void 0}function ra(i,e){if(i===e)return 0;const t=Hr(i),n=Hr(e);if(t!==n)return Ue(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ue(i.booleanValue,e.booleanValue);case 2:return function(s,a){const o=yt(s.integerValue||s.doubleValue),u=yt(a.integerValue||a.doubleValue);return o<u?-1:o>u?1:o===u?0:isNaN(o)?isNaN(u)?0:-1:1}(i,e);case 3:return R_(i.timestampValue,e.timestampValue);case 4:return R_(Ho(i),Ho(e));case 5:return Ue(i.stringValue,e.stringValue);case 6:return function(s,a){const o=qr(s),u=qr(a);return o.compareTo(u)}(i.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),u=a.split("/");for(let c=0;c<o.length&&c<u.length;c++){const h=Ue(o[c],u[c]);if(h!==0)return h}return Ue(o.length,u.length)}(i.referenceValue,e.referenceValue);case 8:return function(s,a){const o=Ue(yt(s.latitude),yt(a.latitude));return o!==0?o:Ue(yt(s.longitude),yt(a.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return function(s,a){const o=s.values||[],u=a.values||[];for(let c=0;c<o.length&&c<u.length;++c){const h=ra(o[c],u[c]);if(h)return h}return Ue(o.length,u.length)}(i.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===nl.mapValue&&a===nl.mapValue)return 0;if(s===nl.mapValue)return 1;if(a===nl.mapValue)return-1;const o=s.fields||{},u=Object.keys(o),c=a.fields||{},h=Object.keys(c);u.sort(),h.sort();for(let g=0;g<u.length&&g<h.length;++g){const y=Ue(u[g],h[g]);if(y!==0)return y;const v=ra(o[u[g]],c[h[g]]);if(v!==0)return v}return Ue(u.length,h.length)}(i.mapValue,e.mapValue);default:throw be()}}function R_(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return Ue(i,e);const t=lr(i),n=lr(e),r=Ue(t.seconds,n.seconds);return r!==0?r:Ue(t.nanos,n.nanos)}function sa(i){return _f(i)}function _f(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){const n=lr(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return qr(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return le.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",r=!0;for(const s of t.values||[])r?r=!1:n+=",",n+=_f(s);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){const n=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const a of n)s?s=!1:r+=",",r+=`${a}:${_f(t.fields[a])}`;return r+"}"}(i.mapValue):be()}function O_(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function yf(i){return!!i&&"integerValue"in i}function gm(i){return!!i&&"arrayValue"in i}function L_(i){return!!i&&"nullValue"in i}function N_(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function hd(i){return!!i&&"mapValue"in i}function vo(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){const e={mapValue:{fields:{}}};return _u(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=vo(n)),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=vo(i.arrayValue.values[t]);return e}return Object.assign({},i)}function mL(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.value=e}static empty(){return new an({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!hd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vo(t)}setAll(e){let t=ci.emptyPath(),n={},r=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const u=this.getFieldsMap(t);this.applyChanges(u,n,r),n={},r=[],t=o.popLast()}a?n[o.lastSegment()]=vo(a):r.push(o.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());hd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];hd(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){_u(t,(r,s)=>e[r]=s);for(const r of n)delete e[r]}clone(){return new an(vo(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e,t,n,r,s,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new Ht(e,0,ve.min(),ve.min(),ve.min(),an.empty(),0)}static newFoundDocument(e,t,n,r){return new Ht(e,1,t,ve.min(),n,r,0)}static newNoDocument(e,t){return new Ht(e,2,t,ve.min(),ve.min(),an.empty(),0)}static newUnknownDocument(e,t){return new Ht(e,3,t,ve.min(),ve.min(),an.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ve.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=an.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=an.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ve.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ht&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ht(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e,t){this.position=e,this.inclusive=t}}function M_(i,e,t){let n=0;for(let r=0;r<i.position.length;r++){const s=e[r],a=i.position[r];if(s.field.isKeyField()?n=le.comparator(le.fromName(a.referenceValue),t.key):n=ra(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function F_(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!bn(i.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(e,t="asc"){this.field=e,this.dir=t}}function gL(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{}class Tt extends i2{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new yL(e,t,n):t==="array-contains"?new bL(e,n):t==="in"?new EL(e,n):t==="not-in"?new SL(e,n):t==="array-contains-any"?new xL(e,n):new Tt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new vL(e,n):new TL(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ra(t,this.value)):t!==null&&Hr(this.value)===Hr(t)&&this.matchesComparison(ra(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return be()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Yi extends i2{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Yi(e,t)}matches(e){return n2(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le(t=>t.isInequality());return e!==null?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function n2(i){return i.op==="and"}function r2(i){return _L(i)&&n2(i)}function _L(i){for(const e of i.filters)if(e instanceof Yi)return!1;return!0}function vf(i){if(i instanceof Tt)return i.field.canonicalString()+i.op.toString()+sa(i.value);if(r2(i))return i.filters.map(e=>vf(e)).join(",");{const e=i.filters.map(t=>vf(t)).join(",");return`${i.op}(${e})`}}function s2(i,e){return i instanceof Tt?function(n,r){return r instanceof Tt&&n.op===r.op&&n.field.isEqual(r.field)&&bn(n.value,r.value)}(i,e):i instanceof Yi?function(n,r){return r instanceof Yi&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((s,a,o)=>s&&s2(a,r.filters[o]),!0):!1}(i,e):void be()}function a2(i){return i instanceof Tt?function(t){return`${t.field.canonicalString()} ${t.op} ${sa(t.value)}`}(i):i instanceof Yi?function(t){return t.op.toString()+" {"+t.getFilters().map(a2).join(" ,")+"}"}(i):"Filter"}class yL extends Tt{constructor(e,t,n){super(e,t,n),this.key=le.fromName(n.referenceValue)}matches(e){const t=le.comparator(e.key,this.key);return this.matchesComparison(t)}}class vL extends Tt{constructor(e,t){super(e,"in",t),this.keys=o2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class TL extends Tt{constructor(e,t){super(e,"not-in",t),this.keys=o2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function o2(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>le.fromName(n.referenceValue))}class bL extends Tt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gm(t)&&zo(t.arrayValue,this.value)}}class EL extends Tt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&zo(this.value.arrayValue,t)}}class SL extends Tt{constructor(e,t){super(e,"not-in",t)}matches(e){if(zo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!zo(this.value.arrayValue,t)}}class xL extends Tt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gm(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>zo(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CL{constructor(e,t=null,n=[],r=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=a,this.endAt=o,this.he=null}}function B_(i,e=null,t=[],n=[],r=null,s=null,a=null){return new CL(i,e,t,n,r,s,a)}function _m(i){const e=Le(i);if(e.he===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>vf(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Yc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>sa(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>sa(n)).join(",")),e.he=t}return e.he}function ym(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!gL(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!s2(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!F_(i.startAt,e.startAt)&&F_(i.endAt,e.endAt)}function Tf(i){return le.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e,t=null,n=[],r=[],s=null,a="F",o=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=u,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function wL(i,e,t,n,r,s,a,o){return new Ea(i,e,t,n,r,s,a,o)}function vm(i){return new Ea(i)}function U_(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function Tm(i){return i.explicitOrderBy.length>0?i.explicitOrderBy[0].field:null}function Qc(i){for(const e of i.filters){const t=e.getFirstInequalityField();if(t!==null)return t}return null}function u2(i){return i.collectionGroup!==null}function Fs(i){const e=Le(i);if(e.Pe===null){e.Pe=[];const t=Qc(e),n=Tm(e);if(t!==null&&n===null)t.isKeyField()||e.Pe.push(new Ms(t)),e.Pe.push(new Ms(ci.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.Pe.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new Ms(ci.keyField(),s))}}}return e.Pe}function Vn(i){const e=Le(i);if(!e.Ie)if(e.limitType==="F")e.Ie=B_(e.path,e.collectionGroup,Fs(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Fs(e)){const a=s.dir==="desc"?"asc":"desc";t.push(new Ms(s.field,a))}const n=e.endAt?new ac(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ac(e.startAt.position,e.startAt.inclusive):null;e.Ie=B_(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.Ie}function bf(i,e){e.getFirstInequalityField(),Qc(i);const t=i.filters.concat([e]);return new Ea(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function Ef(i,e,t){return new Ea(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function Jc(i,e){return ym(Vn(i),Vn(e))&&i.limitType===e.limitType}function l2(i){return`${_m(Vn(i))}|lt:${i.limitType}`}function Sf(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(r=>a2(r)).join(", ")}]`),Yc(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>sa(r)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>sa(r)).join(",")),`Target(${n})`}(Vn(i))}; limitType=${i.limitType})`}function Zc(i,e){return e.isFoundDocument()&&function(n,r){const s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):le.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(i,e)&&function(n,r){for(const s of Fs(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(i,e)&&function(n,r){for(const s of n.filters)if(!s.matches(r))return!1;return!0}(i,e)&&function(n,r){return!(n.startAt&&!function(a,o,u){const c=M_(a,o,u);return a.inclusive?c<=0:c<0}(n.startAt,Fs(n),r)||n.endAt&&!function(a,o,u){const c=M_(a,o,u);return a.inclusive?c>=0:c>0}(n.endAt,Fs(n),r))}(i,e)}function AL(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function c2(i){return(e,t)=>{let n=!1;for(const r of Fs(i)){const s=DL(r,e,t);if(s!==0)return s;n=n||r.field.isKeyField()}return 0}}function DL(i,e,t){const n=i.field.isKeyField()?le.comparator(e.key,t.key):function(s,a,o){const u=a.data.field(s),c=o.data.field(s);return u!==null&&c!==null?ra(u,c):be()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return be()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[r,s]of n)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){_u(this.inner,(t,n)=>{for(const[r,s]of n)e(r,s)})}isEmpty(){return e2(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL=new ft(le.comparator);function cr(){return IL}const h2=new ft(le.comparator);function uo(...i){let e=h2;for(const t of i)e=e.insert(t.key,t);return e}function kL(i){let e=h2;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Or(){return To()}function d2(){return To()}function To(){return new Sa(i=>i.toString(),(i,e)=>i.isEqual(e))}const PL=new Yt(le.comparator);function Oe(...i){let e=PL;for(const t of i)e=e.add(t);return e}const RL=new Yt(Ue);function OL(){return RL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f2(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sc(e)?"-0":e}}function p2(i){return{integerValue:""+i}}function LL(i,e){return dL(e)?p2(e):f2(i,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(){this._=void 0}}function NL(i,e,t){return i instanceof xf?function(r,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&pm(s)&&(s=mm(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):i instanceof oc?m2(i,e):i instanceof uc?g2(i,e):function(r,s){const a=FL(r,s),o=V_(a)+V_(r.Te);return yf(a)&&yf(r.Te)?p2(o):f2(r.serializer,o)}(i,e)}function ML(i,e,t){return i instanceof oc?m2(i,e):i instanceof uc?g2(i,e):t}function FL(i,e){return i instanceof Cf?function(n){return yf(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}class xf extends eh{}class oc extends eh{constructor(e){super(),this.elements=e}}function m2(i,e){const t=_2(e);for(const n of i.elements)t.some(r=>bn(r,n))||t.push(n);return{arrayValue:{values:t}}}class uc extends eh{constructor(e){super(),this.elements=e}}function g2(i,e){let t=_2(e);for(const n of i.elements)t=t.filter(r=>!bn(r,n));return{arrayValue:{values:t}}}class Cf extends eh{constructor(e,t){super(),this.serializer=e,this.Te=t}}function V_(i){return yt(i.integerValue||i.doubleValue)}function _2(i){return gm(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}function BL(i,e){return i.field.isEqual(e.field)&&function(n,r){return n instanceof oc&&r instanceof oc||n instanceof uc&&r instanceof uc?na(n.elements,r.elements,bn):n instanceof Cf&&r instanceof Cf?bn(n.Te,r.Te):n instanceof xf&&r instanceof xf}(i.transform,e.transform)}class Br{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Br}static exists(e){return new Br(void 0,e)}static updateTime(e){return new Br(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function pl(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class bm{}function y2(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new VL(i.key,Br.none()):new Em(i.key,i.data,Br.none());{const t=i.data,n=an.empty();let r=new Yt(ci.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),r=r.add(s)}return new th(i.key,n,new Jn(r.toArray()),Br.none())}}function UL(i,e,t){i instanceof Em?function(r,s,a){const o=r.value.clone(),u=$_(r.fieldTransforms,s,a.transformResults);o.setAll(u),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(i,e,t):i instanceof th?function(r,s,a){if(!pl(r.precondition,s))return void s.convertToUnknownDocument(a.version);const o=$_(r.fieldTransforms,s,a.transformResults),u=s.data;u.setAll(v2(r)),u.setAll(o),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(i,e,t):function(r,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function bo(i,e,t,n){return i instanceof Em?function(s,a,o,u){if(!pl(s.precondition,a))return o;const c=s.value.clone(),h=q_(s.fieldTransforms,u,a);return c.setAll(h),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),null}(i,e,t,n):i instanceof th?function(s,a,o,u){if(!pl(s.precondition,a))return o;const c=q_(s.fieldTransforms,u,a),h=a.data;return h.setAll(v2(s)),h.setAll(c),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(i,e,t,n):function(s,a,o){return pl(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(i,e,t)}function j_(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&na(n,r,(s,a)=>BL(s,a))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class Em extends bm{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class th extends bm{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function v2(i){const e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=i.data.field(t);e.set(t,n)}}),e}function $_(i,e,t){const n=new Map;St(i.length===t.length);for(let r=0;r<t.length;r++){const s=i[r],a=s.transform,o=e.data.field(s.field);n.set(s.field,ML(a,o,t[r]))}return n}function q_(i,e,t){const n=new Map;for(const r of i){const s=r.transform,a=t.data.field(r.field);n.set(r.field,NL(s,a,e))}return n}class VL extends bm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jL{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&UL(s,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=bo(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=bo(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=d2();return this.mutations.forEach(r=>{const s=e.get(r.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=t.has(r.key)?null:o;const u=y2(a,o);u!==null&&n.set(r.key,u),a.isValidDocument()||a.convertToNoDocument(ve.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Oe())}isEqual(e){return this.batchId===e.batchId&&na(this.mutations,e.mutations,(t,n)=>j_(t,n))&&na(this.baseMutations,e.baseMutations,(t,n)=>j_(t,n))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qL{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t,ke;function T2(i){if(i===void 0)return Un("GRPC error has no .code"),q.UNKNOWN;switch(i){case _t.OK:return q.OK;case _t.CANCELLED:return q.CANCELLED;case _t.UNKNOWN:return q.UNKNOWN;case _t.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case _t.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case _t.INTERNAL:return q.INTERNAL;case _t.UNAVAILABLE:return q.UNAVAILABLE;case _t.UNAUTHENTICATED:return q.UNAUTHENTICATED;case _t.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case _t.NOT_FOUND:return q.NOT_FOUND;case _t.ALREADY_EXISTS:return q.ALREADY_EXISTS;case _t.PERMISSION_DENIED:return q.PERMISSION_DENIED;case _t.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case _t.ABORTED:return q.ABORTED;case _t.OUT_OF_RANGE:return q.OUT_OF_RANGE;case _t.UNIMPLEMENTED:return q.UNIMPLEMENTED;case _t.DATA_LOSS:return q.DATA_LOSS;default:return be()}}(ke=_t||(_t={}))[ke.OK=0]="OK",ke[ke.CANCELLED=1]="CANCELLED",ke[ke.UNKNOWN=2]="UNKNOWN",ke[ke.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ke[ke.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ke[ke.NOT_FOUND=5]="NOT_FOUND",ke[ke.ALREADY_EXISTS=6]="ALREADY_EXISTS",ke[ke.PERMISSION_DENIED=7]="PERMISSION_DENIED",ke[ke.UNAUTHENTICATED=16]="UNAUTHENTICATED",ke[ke.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ke[ke.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ke[ke.ABORTED=10]="ABORTED",ke[ke.OUT_OF_RANGE=11]="OUT_OF_RANGE",ke[ke.UNIMPLEMENTED=12]="UNIMPLEMENTED",ke[ke.INTERNAL=13]="INTERNAL",ke[ke.UNAVAILABLE=14]="UNAVAILABLE",ke[ke.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return rl}static getOrCreateInstance(){return rl===null&&(rl=new Sm),rl}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let rl=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GL=new Ns([4294967295,4294967295],0);function H_(i){const e=HL().encode(i),t=new QO;return t.update(e),new Uint8Array(t.digest())}function G_(i){const e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ns([t,n],0),new Ns([r,s],0)]}class xm{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new lo(`Invalid padding: ${t}`);if(n<0)throw new lo(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new lo(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new lo(`Invalid padding when bitmap length is 0: ${t}`);this.de=8*e.length-t,this.Ae=Ns.fromNumber(this.de)}Re(e,t,n){let r=e.add(t.multiply(Ns.fromNumber(n)));return r.compare(GL)===1&&(r=new Ns([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ae).toNumber()}Ve(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.de===0)return!1;const t=H_(e),[n,r]=G_(t);for(let s=0;s<this.hashCount;s++){const a=this.Re(n,r,s);if(!this.Ve(a))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new xm(s,r,t);return n.forEach(o=>a.insert(o)),a}insert(e){if(this.de===0)return;const t=H_(e),[n,r]=G_(t);for(let s=0;s<this.hashCount;s++){const a=this.Re(n,r,s);this.me(a)}}me(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class lo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,yu.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ih(ve.min(),r,new ft(Ue),cr(),Oe())}}class yu{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new yu(n,t,Oe(),Oe(),Oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e,t,n,r){this.fe=e,this.removedTargetIds=t,this.key=n,this.ge=r}}class b2{constructor(e,t){this.targetId=e,this.pe=t}}class E2{constructor(e,t,n=Qt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class z_{constructor(){this.ye=0,this.we=K_(),this.Se=Qt.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return this.ye!==0}get Ce(){return this.De}Fe(e){e.approximateByteSize()>0&&(this.De=!0,this.Se=e)}Me(){let e=Oe(),t=Oe(),n=Oe();return this.we.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:be()}}),new yu(this.Se,this.be,e,t,n)}xe(){this.De=!1,this.we=K_()}Oe(e,t){this.De=!0,this.we=this.we.insert(e,t)}Ne(e){this.De=!0,this.we=this.we.remove(e)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class zL{constructor(e){this.qe=e,this.Qe=new Map,this.Ke=cr(),this.$e=W_(),this.Ue=new ft(Ue)}We(e){for(const t of e.fe)e.ge&&e.ge.isFoundDocument()?this.Ge(t,e.ge):this.ze(t,e.key,e.ge);for(const t of e.removedTargetIds)this.ze(t,e.key,e.ge)}je(e){this.forEachTarget(e,t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Fe(e.resumeToken);break;case 1:n.Le(),n.ve||n.xe(),n.Fe(e.resumeToken);break;case 2:n.Le(),n.ve||this.removeTarget(t);break;case 3:this.Je(t)&&(n.ke(),n.Fe(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Fe(e.resumeToken));break;default:be()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qe.forEach((n,r)=>{this.Je(r)&&t(r)})}Ze(e){var t,n;const r=e.targetId,s=e.pe.count,a=this.Xe(r);if(a){const o=a.target;if(Tf(o))if(s===0){const u=new le(o.path);this.ze(r,u,Ht.newNoDocument(u,ve.min()))}else St(s===1);else{const u=this.et(r);if(u!==s){const c=this.tt(e,u);if(c.status!==0){this.Ye(r);const h=c.status===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(r,h)}(t=Sm.instance)===null||t===void 0||t.notifyOnExistenceFilterMismatch(function(g,y,v,T){var S,A,k,P,M,R;const O={localCacheCount:v,existenceFilterCount:T.count},j=T.unchangedNames;return j&&(O.bloomFilter={applied:g===0,hashCount:(S=j==null?void 0:j.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(P=(k=(A=j==null?void 0:j.bits)===null||A===void 0?void 0:A.bitmap)===null||k===void 0?void 0:k.length)!==null&&P!==void 0?P:0,padding:(R=(M=j==null?void 0:j.bits)===null||M===void 0?void 0:M.padding)!==null&&R!==void 0?R:0},y&&(O.bloomFilter.mightContain=y)),O}(c.status,(n=c.nt)!==null&&n!==void 0?n:null,u,e.pe))}}}}tt(e,t){const{unchangedNames:n,count:r}=e.pe;if(!n||!n.bits)return{status:1};const{bits:{bitmap:s="",padding:a=0},hashCount:o=0}=n;let u,c;try{u=qr(s).toUint8Array()}catch(g){if(g instanceof t2)return ia("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw g}try{c=new xm(u,a,o)}catch(g){return ia(g instanceof lo?"BloomFilter error: ":"Applying bloom filter failed: ",g),{status:1}}const h=g=>{const y=this.qe.rt();return c.mightContain(`projects/${y.projectId}/databases/${y.database}/documents/${g}`)};return c.de===0?{status:1}:{status:r===t-this.it(e.targetId,h)?0:2,nt:h}}it(e,t){const n=this.qe.getRemoteKeysForTarget(e);let r=0;return n.forEach(s=>{t(s.path.canonicalString())||(this.ze(e,s,null),r++)}),r}st(e){const t=new Map;this.Qe.forEach((s,a)=>{const o=this.Xe(a);if(o){if(s.current&&Tf(o.target)){const u=new le(o.target.path);this.Ke.get(u)!==null||this.ot(a,u)||this.ze(a,u,Ht.newNoDocument(u,e))}s.Ce&&(t.set(a,s.Me()),s.xe())}});let n=Oe();this.$e.forEach((s,a)=>{let o=!0;a.forEachWhile(u=>{const c=this.Xe(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(n=n.add(s))}),this.Ke.forEach((s,a)=>a.setReadTime(e));const r=new ih(e,t,this.Ue,this.Ke,n);return this.Ke=cr(),this.$e=W_(),this.Ue=new ft(Ue),r}Ge(e,t){if(!this.Je(e))return;const n=this.ot(e,t.key)?2:0;this.He(e).Oe(t.key,n),this.Ke=this.Ke.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const r=this.He(e);this.ot(e,t)?r.Oe(t,1):r.Ne(t),this.$e=this.$e.insert(t,this._t(t).delete(e)),n&&(this.Ke=this.Ke.insert(t,n))}removeTarget(e){this.Qe.delete(e)}et(e){const t=this.He(e).Me();return this.qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Be(e){this.He(e).Be()}He(e){let t=this.Qe.get(e);return t||(t=new z_,this.Qe.set(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new Yt(Ue),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||se("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.Qe.get(e);return t&&t.ve?null:this.qe.ut(e)}Ye(e){this.Qe.set(e,new z_),this.qe.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ot(e,t){return this.qe.getRemoteKeysForTarget(e).has(t)}}function W_(){return new ft(le.comparator)}function K_(){return new ft(le.comparator)}const WL=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),KL=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),XL=(()=>({and:"AND",or:"OR"}))();class YL{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function wf(i,e){return i.useProto3Json||Yc(e)?e:{value:e}}function Af(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function S2(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function Bs(i){return St(!!i),ve.fromTimestamp(function(t){const n=lr(t);return new Dt(n.seconds,n.nanos)}(i))}function x2(i,e){return function(n){return new it(["projects",n.projectId,"databases",n.database])}(i).child("documents").child(e).canonicalString()}function C2(i){const e=it.fromString(i);return St(I2(e)),e}function dd(i,e){const t=C2(e);if(t.get(1)!==i.databaseId.projectId)throw new te(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new te(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new le(w2(t))}function Df(i,e){return x2(i.databaseId,e)}function QL(i){const e=C2(i);return e.length===4?it.emptyPath():w2(e)}function X_(i){return new it(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function w2(i){return St(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function JL(i,e){let t;if("targetChange"in e){e.targetChange;const n=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:be()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,h){return c.useProto3Json?(St(h===void 0||typeof h=="string"),Qt.fromBase64String(h||"")):(St(h===void 0||h instanceof Uint8Array),Qt.fromUint8Array(h||new Uint8Array))}(i,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(c){const h=c.code===void 0?q.UNKNOWN:T2(c.code);return new te(h,c.message||"")}(a);t=new E2(n,r,s,o||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=dd(i,n.document.name),s=Bs(n.document.updateTime),a=n.document.createTime?Bs(n.document.createTime):ve.min(),o=new an({mapValue:{fields:n.document.fields}}),u=Ht.newFoundDocument(r,s,a,o),c=n.targetIds||[],h=n.removedTargetIds||[];t=new ml(c,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=dd(i,n.document),s=n.readTime?Bs(n.readTime):ve.min(),a=Ht.newNoDocument(r,s),o=n.removedTargetIds||[];t=new ml([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=dd(i,n.document),s=n.removedTargetIds||[];t=new ml([],s,r,null)}else{if(!("filter"in e))return be();{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:s}=n,a=new qL(r,s),o=n.targetId;t=new b2(o,a)}}return t}function ZL(i,e){return{documents:[Df(i,e.path)]}}function eN(i,e){const t={structuredQuery:{}},n=e.path;e.collectionGroup!==null?(t.parent=Df(i,n),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Df(i,n.popLast()),t.structuredQuery.from=[{collectionId:n.lastSegment()}]);const r=function(u){if(u.length!==0)return D2(Yi.create(u,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(u){if(u.length!==0)return u.map(c=>function(g){return{field:vs(g.field),direction:nN(g.dir)}}(c))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=wf(i,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),t}function tN(i){let e=QL(i.parent);const t=i.structuredQuery,n=t.from?t.from.length:0;let r=null;if(n>0){St(n===1);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(g){const y=A2(g);return y instanceof Yi&&r2(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=function(g){return g.map(y=>function(T){return new Ms(Ts(T.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(y))}(t.orderBy));let o=null;t.limit&&(o=function(g){let y;return y=typeof g=="object"?g.value:g,Yc(y)?null:y}(t.limit));let u=null;t.startAt&&(u=function(g){const y=!!g.before,v=g.values||[];return new ac(v,y)}(t.startAt));let c=null;return t.endAt&&(c=function(g){const y=!g.before,v=g.values||[];return new ac(v,y)}(t.endAt)),wL(e,r,a,s,o,"F",u,c)}function iN(i,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return be()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function A2(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Ts(t.unaryFilter.field);return Tt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=Ts(t.unaryFilter.field);return Tt.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ts(t.unaryFilter.field);return Tt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ts(t.unaryFilter.field);return Tt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return be()}}(i):i.fieldFilter!==void 0?function(t){return Tt.create(Ts(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return be()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return Yi.create(t.compositeFilter.filters.map(n=>A2(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return be()}}(t.compositeFilter.op))}(i):be()}function nN(i){return WL[i]}function rN(i){return KL[i]}function sN(i){return XL[i]}function vs(i){return{fieldPath:i.canonicalString()}}function Ts(i){return ci.fromServerFormat(i.fieldPath)}function D2(i){return i instanceof Tt?function(t){if(t.op==="=="){if(N_(t.value))return{unaryFilter:{field:vs(t.field),op:"IS_NAN"}};if(L_(t.value))return{unaryFilter:{field:vs(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(N_(t.value))return{unaryFilter:{field:vs(t.field),op:"IS_NOT_NAN"}};if(L_(t.value))return{unaryFilter:{field:vs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vs(t.field),op:rN(t.op),value:t.value}}}(i):i instanceof Yi?function(t){const n=t.getFilters().map(r=>D2(r));return n.length===1?n[0]:{compositeFilter:{op:sN(t.op),filters:n}}}(i):be()}function I2(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e,t,n,r,s=ve.min(),a=ve.min(),o=Qt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=u}withSequenceNumber(e){return new Zn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Zn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Zn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Zn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e){this.ct=e}}function oN(i){const e=tN({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?Ef(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{constructor(){this.sn=new lN}addToCollectionParentIndex(e,t){return this.sn.add(t),H.resolve()}getCollectionParents(e,t){return H.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return H.resolve()}deleteFieldIndex(e,t){return H.resolve()}getDocumentsMatchingTarget(e,t){return H.resolve(null)}getIndexType(e,t){return H.resolve(0)}getFieldIndexes(e,t){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,t){return H.resolve(ur.min())}getMinOffsetFromCollectionGroup(e,t){return H.resolve(ur.min())}updateCollectionGroup(e,t,n){return H.resolve()}updateIndexEntries(e,t){return H.resolve()}}class lN{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Yt(it.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Yt(it.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new aa(0)}static On(){return new aa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(){this.changes=new Sa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ht.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?H.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(n!==null&&bo(n.mutation,r,Jn.empty(),Dt.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Oe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Oe()){const r=Or();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(s=>{let a=uo();return s.forEach((o,u)=>{a=a.insert(o,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=Or();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Oe()))}populateOverlays(e,t,n){const r=[];return n.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,n,r){let s=cr();const a=To(),o=function(){return To()}();return t.forEach((u,c)=>{const h=n.get(c.key);r.has(c.key)&&(h===void 0||h.mutation instanceof th)?s=s.insert(c.key,c):h!==void 0?(a.set(c.key,h.mutation.getFieldMask()),bo(h.mutation,c,h.mutation.getFieldMask(),Dt.now())):a.set(c.key,Jn.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,h)=>a.set(c,h)),t.forEach((c,h)=>{var g;return o.set(c,new hN(h,(g=a.get(c))!==null&&g!==void 0?g:null))}),o))}recalculateAndSaveOverlays(e,t){const n=To();let r=new ft((a,o)=>a-o),s=Oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(u=>{const c=t.get(u);if(c===null)return;let h=n.get(u)||Jn.empty();h=o.applyToLocalView(c,h),n.set(u,h);const g=(r.get(o.batchId)||Oe()).add(u);r=r.insert(o.batchId,g)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const u=o.getNext(),c=u.key,h=u.value,g=d2();h.forEach(y=>{if(!s.has(y)){const v=y2(t.get(y),n.get(y));v!==null&&g.set(y,v),s=s.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,c,g))}return H.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n){return function(s){return le.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):u2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{const a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):H.resolve(Or());let o=-1,u=s;return a.next(c=>H.forEach(c,(h,g)=>(o<g.largestBatchId&&(o=g.largestBatchId),s.get(h)?H.resolve():this.remoteDocumentCache.getEntry(e,h).next(y=>{u=u.insert(h,y)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,Oe())).next(h=>({batchId:o,changes:kL(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new le(t)).next(n=>{let r=uo();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let s=uo();return this.indexManager.getCollectionParents(e,r).next(a=>H.forEach(a,o=>{const u=function(h,g){return new Ea(g,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,o.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,n).next(c=>{c.forEach((h,g)=>{s=s.insert(h,g)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r))).next(s=>{r.forEach((o,u)=>{const c=u.getKey();s.get(c)===null&&(s=s.insert(c,Ht.newInvalidDocument(c)))});let a=uo();return s.forEach((o,u)=>{const c=r.get(o);c!==void 0&&bo(c.mutation,u,Jn.empty(),Dt.now()),Zc(t,u)&&(a=a.insert(o,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return H.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Bs(r.createTime)}}(t)),H.resolve()}getNamedQuery(e,t){return H.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,function(r){return{name:r.name,query:oN(r.bundledQuery),readTime:Bs(r.readTime)}}(t)),H.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pN{constructor(){this.overlays=new ft(le.comparator),this.cr=new Map}getOverlay(e,t){return H.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Or();return H.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&n.set(r,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((r,s)=>{this.ht(e,t,s)}),H.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.cr.get(n);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.cr.delete(n)),H.resolve()}getOverlaysForCollection(e,t,n){const r=Or(),s=t.length+1,a=new le(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const u=o.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>n&&r.set(u.getKey(),u)}return H.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new ft((c,h)=>c-h);const a=this.overlays.getIterator();for(;a.hasNext();){const c=a.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>n){let h=s.get(c.largestBatchId);h===null&&(h=Or(),s=s.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const o=Or(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,h)=>o.set(c,h)),!(o.size()>=r)););return H.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(r!==null){const a=this.cr.get(r.largestBatchId).delete(n.key);this.cr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new $L(t,n));let s=this.cr.get(t);s===void 0&&(s=Oe(),this.cr.set(t,s)),this.cr.set(t,s.add(n.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm{constructor(){this.lr=new Yt(Ct.hr),this.Pr=new Yt(Ct.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){const n=new Ct(e,t);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Er(new Ct(e,t))}dr(e,t){e.forEach(n=>this.removeReference(n,t))}Ar(e){const t=new le(new it([])),n=new Ct(t,e),r=new Ct(t,e+1),s=[];return this.Pr.forEachInRange([n,r],a=>{this.Er(a),s.push(a.key)}),s}Rr(){this.lr.forEach(e=>this.Er(e))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){const t=new le(new it([])),n=new Ct(t,e),r=new Ct(t,e+1);let s=Oe();return this.Pr.forEachInRange([n,r],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Ct(e,0),n=this.lr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Ct{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return le.comparator(e.key,t.key)||Ue(e.mr,t.mr)}static Ir(e,t){return Ue(e.mr,t.mr)||le.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new Yt(Ct.hr)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){const s=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new jL(s,t,n,r);this.mutationQueue.push(a);for(const o of r)this.pr=this.pr.add(new Ct(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return H.resolve(a)}lookupMutationBatch(e,t){return H.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.wr(n),s=r<0?0:r;return H.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?-1:this.gr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ct(t,0),r=new Ct(t,Number.POSITIVE_INFINITY),s=[];return this.pr.forEachInRange([n,r],a=>{const o=this.yr(a.mr);s.push(o)}),H.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Yt(Ue);return t.forEach(r=>{const s=new Ct(r,0),a=new Ct(r,Number.POSITIVE_INFINITY);this.pr.forEachInRange([s,a],o=>{n=n.add(o.mr)})}),H.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;le.isDocumentKey(s)||(s=s.child(""));const a=new Ct(new le(s),0);let o=new Yt(Ue);return this.pr.forEachWhile(u=>{const c=u.key.path;return!!n.isPrefixOf(c)&&(c.length===r&&(o=o.add(u.mr)),!0)},a),H.resolve(this.Sr(o))}Sr(e){const t=[];return e.forEach(n=>{const r=this.yr(n);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){St(this.br(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.pr;return H.forEach(t.mutations,r=>{const s=new Ct(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.pr=n})}Cn(e){}containsKey(e,t){const n=new Ct(t,0),r=this.pr.firstAfterOrEqual(n);return H.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}br(e,t){return this.wr(e)}wr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}yr(e){const t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e){this.Dr=e,this.docs=function(){return new ft(le.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,a=this.Dr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return H.resolve(n?n.document.mutableCopy():Ht.newInvalidDocument(t))}getEntries(e,t){let n=cr();return t.forEach(r=>{const s=this.docs.get(r);n=n.insert(r,s?s.document.mutableCopy():Ht.newInvalidDocument(r))}),H.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=cr();const a=t.path,o=new le(a.child("")),u=this.docs.getIteratorFrom(o);for(;u.hasNext();){const{key:c,value:{document:h}}=u.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||lL(uL(h),n)<=0||(r.has(h.key)||Zc(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return H.resolve(s)}getAllFromCollectionGroup(e,t,n,r){be()}vr(e,t){return H.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new _N(this)}getSize(e){return H.resolve(this.size)}}class _N extends cN{constructor(e){super(),this.sr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.sr.addEntry(e,r)):this.sr.removeEntry(n)}),H.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e){this.persistence=e,this.Cr=new Sa(t=>_m(t),ym),this.lastRemoteSnapshotVersion=ve.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new Cm,this.targetCount=0,this.Or=aa.xn()}forEachTarget(e,t){return this.Cr.forEach((n,r)=>t(r)),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Fr&&(this.Fr=t),H.resolve()}Ln(e){this.Cr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Or=new aa(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,H.resolve()}updateTargetData(e,t){return this.Ln(t),H.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,H.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.Cr.forEach((a,o)=>{o.sequenceNumber<=t&&n.get(o.targetId)===null&&(this.Cr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),H.waitFor(s).next(()=>r)}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,t){const n=this.Cr.get(t)||null;return H.resolve(n)}addMatchingKeys(e,t,n){return this.Mr.Tr(t,n),H.resolve()}removeMatchingKeys(e,t,n){this.Mr.dr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(a=>{s.push(r.markPotentiallyOrphaned(e,a))}),H.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),H.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Mr.Vr(t);return H.resolve(n)}containsKey(e,t){return H.resolve(this.Mr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(e,t){this.Nr={},this.overlays={},this.Br=new fm(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new yN(this),this.indexManager=new uN,this.remoteDocumentCache=function(r){return new gN(r)}(n=>this.referenceDelegate.qr(n)),this.serializer=new aN(t),this.Qr=new fN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new pN,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Nr[e.toKey()];return n||(n=new mN(t,this.referenceDelegate),this.Nr[e.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,n){se("MemoryPersistence","Starting transaction:",e);const r=new TN(this.Br.next());return this.referenceDelegate.Kr(),n(r).next(s=>this.referenceDelegate.$r(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ur(e,t){return H.or(Object.values(this.Nr).map(n=>()=>n.containsKey(e,t)))}}class TN extends hL{constructor(e){super(),this.currentSequenceNumber=e}}class wm{constructor(e){this.persistence=e,this.Wr=new Cm,this.Gr=null}static zr(e){return new wm(e)}get jr(){if(this.Gr)return this.Gr;throw be()}addReference(e,t,n){return this.Wr.addReference(n,t),this.jr.delete(n.toString()),H.resolve()}removeReference(e,t,n){return this.Wr.removeReference(n,t),this.jr.add(n.toString()),H.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),H.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach(r=>this.jr.add(r.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Kr(){this.Gr=new Set}$r(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.jr,n=>{const r=le.fromPath(n);return this.Hr(e,r).next(s=>{s||t.removeEntry(r,ve.min())})}).next(()=>(this.Gr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hr(e,t).next(n=>{n?this.jr.delete(t.toString()):this.jr.add(t.toString())})}qr(e){return 0}Hr(e,t){return H.or([()=>H.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Li=n,this.ki=r}static qi(e,t){let n=Oe(),r=Oe();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Am(e,t.fromCache,n,r)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.$i(e,t).next(s=>s||this.Ui(e,t,r,n)).next(s=>s||this.Wi(e,t))}$i(e,t){if(U_(t))return H.resolve(null);let n=Vn(t);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Ef(t,null,"F"),n=Vn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=Oe(...s);return this.Ki.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,n).next(u=>{const c=this.Gi(t,o);return this.zi(t,c,a,u.readTime)?this.$i(e,Ef(t,null,"F")):this.ji(e,c,t,u)}))})))}Ui(e,t,n,r){return U_(t)||r.isEqual(ve.min())?this.Wi(e,t):this.Ki.getDocuments(e,n).next(s=>{const a=this.Gi(t,s);return this.zi(t,a,n,r)?this.Wi(e,t):(I_()<=Be.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Sf(t)),this.ji(e,a,t,oL(r,-1)))})}Gi(e,t){let n=new Yt(c2(e));return t.forEach((r,s)=>{Zc(e,s)&&(n=n.add(s))}),n}zi(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Wi(e,t){return I_()<=Be.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",Sf(t)),this.Ki.getDocumentsMatchingQuery(e,t,ur.min())}ji(e,t,n,r){return this.Ki.getDocumentsMatchingQuery(e,n,r).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new ft(Ue),this.Yi=new Sa(s=>_m(s),ym),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(n)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dN(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function SN(i,e,t,n){return new EN(i,e,t,n)}async function k2(i,e){const t=Le(i);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next(s=>(r=s,t.es(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],o=[];let u=Oe();for(const c of r){a.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}for(const c of s){o.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(n,u).next(c=>({ts:c,removedBatchIds:a,addedBatchIds:o}))})})}function P2(i){const e=Le(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.kr.getLastRemoteSnapshotVersion(t))}function xN(i,e){const t=Le(i),n=e.snapshotVersion;let r=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Xi.newChangeBuffer({trackRemovals:!0});r=t.Ji;const o=[];e.targetChanges.forEach((h,g)=>{const y=r.get(g);if(!y)return;o.push(t.kr.removeMatchingKeys(s,h.removedDocuments,g).next(()=>t.kr.addMatchingKeys(s,h.addedDocuments,g)));let v=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?v=v.withResumeToken(Qt.EMPTY_BYTE_STRING,ve.min()).withLastLimboFreeSnapshotVersion(ve.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,n)),r=r.insert(g,v),function(S,A,k){return S.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0}(y,v,h)&&o.push(t.kr.updateTargetData(s,v))});let u=cr(),c=Oe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),o.push(CN(s,a,e.documentUpdates).next(h=>{u=h.ns,c=h.rs})),!n.isEqual(ve.min())){const h=t.kr.getLastRemoteSnapshotVersion(s).next(g=>t.kr.setTargetsMetadata(s,s.currentSequenceNumber,n));o.push(h)}return H.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.Ji=r,s))}function CN(i,e,t){let n=Oe(),r=Oe();return t.forEach(s=>n=n.add(s)),e.getEntries(i,n).next(s=>{let a=cr();return t.forEach((o,u)=>{const c=s.get(o);u.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(o)),u.isNoDocument()&&u.version.isEqual(ve.min())?(e.removeEntry(o,u.readTime),a=a.insert(o,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),a=a.insert(o,u)):se("LocalStore","Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",u.version)}),{ns:a,rs:r}})}function wN(i,e){const t=Le(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return t.kr.getTargetData(n,e).next(s=>s?(r=s,H.resolve(r)):t.kr.allocateTargetId(n).next(a=>(r=new Zn(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.kr.addTargetData(n,r).next(()=>r))))}).then(n=>{const r=t.Ji.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(n.targetId,n),t.Yi.set(e,n.targetId)),n})}async function If(i,e,t){const n=Le(i),r=n.Ji.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!gu(a))throw a;se("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ji=n.Ji.remove(e),n.Yi.delete(r.target)}function Y_(i,e,t){const n=Le(i);let r=ve.min(),s=Oe();return n.persistence.runTransaction("Execute query","readonly",a=>function(u,c,h){const g=Le(u),y=g.Yi.get(h);return y!==void 0?H.resolve(g.Ji.get(y)):g.kr.getTargetData(c,h)}(n,a,Vn(e)).next(o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,n.kr.getMatchingKeysForTargetId(a,o.targetId).next(u=>{s=u})}).next(()=>n.Hi.getDocumentsMatchingQuery(a,e,t?r:ve.min(),t?s:Oe())).next(o=>(AN(n,AL(e),o),{documents:o,ss:s})))}function AN(i,e,t){let n=i.Zi.get(e)||ve.min();t.forEach((r,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),i.Zi.set(e,n)}class Q_{constructor(){this.activeTargetIds=OL()}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class DN{constructor(){this.Hs=new Q_,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,n){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new Q_,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{Ys(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){se("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ro)e(0)}no(){se("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ro)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sl=null;function fd(){return sl===null?sl=function(){return 268435456+Math.round(2147483648*Math.random())}():sl++,"0x"+sl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jt="WebChannelConnection";class RN extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.To=n+"://"+t.host,this.Eo=`projects/${r}/databases/${s}`,this.Ao=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Ro(){return!1}Vo(t,n,r,s,a){const o=fd(),u=this.mo(t,n);se("RestConnection",`Sending RPC '${t}' ${o}:`,u,r);const c={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(c,s,a),this.po(t,u,c,r).then(h=>(se("RestConnection",`Received RPC '${t}' ${o}: `,h),h),h=>{throw ia("RestConnection",`RPC '${t}' ${o} failed with error: `,h,"url: ",u,"request:",r),h})}yo(t,n,r,s,a,o){return this.Vo(t,n,r,s,a)}fo(t,n,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ba}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),r&&r.headers.forEach((s,a)=>t[a]=s)}mo(t,n){const r=kN[t];return`${this.To}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}po(e,t,n,r){const s=fd();return new Promise((a,o)=>{const u=new YO;u.setWithCredentials(!0),u.listenOnce(WO.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case cd.NO_ERROR:const h=u.getResponseJson();se(jt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),a(h);break;case cd.TIMEOUT:se(jt,`RPC '${e}' ${s} timed out`),o(new te(q.DEADLINE_EXCEEDED,"Request time out"));break;case cd.HTTP_ERROR:const g=u.getStatus();if(se(jt,`RPC '${e}' ${s} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const v=y==null?void 0:y.error;if(v&&v.status&&v.message){const T=function(A){const k=A.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(k)>=0?k:q.UNKNOWN}(v.status);o(new te(T,v.message))}else o(new te(q.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new te(q.UNAVAILABLE,"Connection failed."));break;default:be()}}finally{se(jt,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(r);se(jt,`RPC '${e}' ${s} sending request:`,r),u.send(t,"POST",c,n,15)})}wo(e,t,n){const r=fd(),s=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=GO(),o=zO(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new XO({})),this.fo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const h=s.join("");se(jt,`Creating RPC '${e}' stream ${r}: ${h}`,u);const g=a.createWebChannel(h,u);let y=!1,v=!1;const T=new PN({so:A=>{v?se(jt,`Not sending because RPC '${e}' stream ${r} is closed:`,A):(y||(se(jt,`Opening RPC '${e}' stream ${r} transport.`),g.open(),y=!0),se(jt,`RPC '${e}' stream ${r} sending:`,A),g.send(A))},oo:()=>g.close()}),S=(A,k,P)=>{A.listen(k,M=>{try{P(M)}catch(R){setTimeout(()=>{throw R},0)}})};return S(g,tl.EventType.OPEN,()=>{v||se(jt,`RPC '${e}' stream ${r} transport opened.`)}),S(g,tl.EventType.CLOSE,()=>{v||(v=!0,se(jt,`RPC '${e}' stream ${r} transport closed`),T.Po())}),S(g,tl.EventType.ERROR,A=>{v||(v=!0,ia(jt,`RPC '${e}' stream ${r} transport errored:`,A),T.Po(new te(q.UNAVAILABLE,"The operation could not be completed")))}),S(g,tl.EventType.MESSAGE,A=>{var k;if(!v){const P=A.data[0];St(!!P);const M=P,R=M.error||((k=M[0])===null||k===void 0?void 0:k.error);if(R){se(jt,`RPC '${e}' stream ${r} received error:`,R);const O=R.status;let j=function(K){const oe=_t[K];if(oe!==void 0)return T2(oe)}(O),z=R.message;j===void 0&&(j=q.INTERNAL,z="Unknown error status: "+O+" with message "+R.message),v=!0,T.Po(new te(j,z)),g.close()}else se(jt,`RPC '${e}' stream ${r} received:`,P),T.Io(P)}}),S(o,KO.STAT_EVENT,A=>{A.stat===A_.PROXY?se(jt,`RPC '${e}' stream ${r} detected buffering proxy`):A.stat===A_.NOPROXY&&se(jt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{T.ho()},0),T}}function pd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(i){return new YL(i,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R2{constructor(e,t,n=1e3,r=1.5,s=6e4){this.ii=e,this.timerId=t,this.So=n,this.bo=r,this.Do=s,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(e){this.cancel();const t=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),r=Math.max(0,t-n);r>0&&se("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.vo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,r,()=>(this.Fo=Date.now(),e())),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){this.Co!==null&&(this.Co.skipDelay(),this.Co=null)}cancel(){this.Co!==null&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(e,t,n,r,s,a,o,u){this.ii=e,this.Bo=n,this.Lo=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new R2(e,t)}$o(){return this.state===1||this.state===5||this.Uo()}Uo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&this.qo===null&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,()=>this.jo()))}Ho(e){this.Jo(),this.stream.send(e)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(e,t){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,e!==4?this.Ko.reset():t&&t.code===q.RESOURCE_EXHAUSTED?(Un(t.toString()),Un("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):t&&t.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Zo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.uo(t)}Zo(){}auth(){this.state=1;const e=this.Xo(this.ko),t=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.ko===t&&this.e_(n,r)},n=>{e(()=>{const r=new te(q.UNKNOWN,"Fetching auth token failed: "+n.message);return this.t_(r)})})}e_(e,t){const n=this.Xo(this.ko);this.stream=this.n_(e,t),this.stream._o(()=>{n(()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,()=>(this.Uo()&&(this.state=3),Promise.resolve())),this.listener._o()))}),this.stream.uo(r=>{n(()=>this.t_(r))}),this.stream.onMessage(r=>{n(()=>this.onMessage(r))})}Wo(){this.state=5,this.Ko.xo(async()=>{this.state=0,this.start()})}t_(e){return se("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.ko===e?t():(se("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class LN extends ON{constructor(e,t,n,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,a),this.serializer=s}n_(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Ko.reset();const t=JL(this.serializer,e),n=function(s){if(!("targetChange"in s))return ve.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?ve.min():a.readTime?Bs(a.readTime):ve.min()}(e);return this.listener.r_(t,n)}i_(e){const t={};t.database=X_(this.serializer),t.addTarget=function(s,a){let o;const u=a.target;if(o=Tf(u)?{documents:ZL(s,u)}:{query:eN(s,u)},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=S2(s,a.resumeToken);const c=wf(s,a.expectedCount);c!==null&&(o.expectedCount=c)}else if(a.snapshotVersion.compareTo(ve.min())>0){o.readTime=Af(s,a.snapshotVersion.toTimestamp());const c=wf(s,a.expectedCount);c!==null&&(o.expectedCount=c)}return o}(this.serializer,e);const n=iN(this.serializer,e);n&&(t.labels=n),this.Ho(t)}s_(e){const t={};t.database=X_(this.serializer),t.removeTarget=e,this.Ho(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.h_=!1}P_(){if(this.h_)throw new te(q.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(e,t,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Vo(e,t,n,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new te(q.UNKNOWN,r.toString())})}yo(e,t,n,r){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.yo(e,t,n,s,a,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new te(q.UNKNOWN,s.toString())})}terminate(){this.h_=!0}}class MN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){this.T_===0&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve())))}m_(e){this.state==="Online"?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.R_("Offline")))}set(e){this.f_(),this.T_=0,e==="Online"&&(this.d_=!1),this.R_(e)}R_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}V_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(Un(t),this.d_=!1):se("OnlineStateTracker",t)}f_(){this.E_!==null&&(this.E_.cancel(),this.E_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=s,this.S_.Ys(a=>{n.enqueueAndForget(async()=>{Tu(this)&&(se("RemoteStore","Restarting streams for network reachability change."),await async function(u){const c=Le(u);c.y_.add(4),await vu(c),c.b_.set("Unknown"),c.y_.delete(4),await rh(c)}(this))})}),this.b_=new MN(n,r)}}async function rh(i){if(Tu(i))for(const e of i.w_)await e(!0)}async function vu(i){for(const e of i.w_)await e(!1)}function O2(i,e){const t=Le(i);t.p_.has(e.targetId)||(t.p_.set(e.targetId,e),km(t)?Im(t):xa(t).Uo()&&Dm(t,e))}function L2(i,e){const t=Le(i),n=xa(t);t.p_.delete(e),n.Uo()&&N2(t,e),t.p_.size===0&&(n.Uo()?n.zo():Tu(t)&&t.b_.set("Unknown"))}function Dm(i,e){if(i.D_.Be(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ve.min())>0){const t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xa(i).i_(e)}function N2(i,e){i.D_.Be(e),xa(i).s_(e)}function Im(i){i.D_=new zL({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>i.p_.get(e)||null,rt:()=>i.datastore.serializer.databaseId}),xa(i).start(),i.b_.A_()}function km(i){return Tu(i)&&!xa(i).$o()&&i.p_.size>0}function Tu(i){return Le(i).y_.size===0}function M2(i){i.D_=void 0}async function BN(i){i.p_.forEach((e,t)=>{Dm(i,e)})}async function UN(i,e){M2(i),km(i)?(i.b_.m_(e),Im(i)):i.b_.set("Unknown")}async function VN(i,e,t){if(i.b_.set("Online"),e instanceof E2&&e.state===2&&e.cause)try{await async function(r,s){const a=s.cause;for(const o of s.targetIds)r.p_.has(o)&&(await r.remoteSyncer.rejectListen(o,a),r.p_.delete(o),r.D_.removeTarget(o))}(i,e)}catch(n){se("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Z_(i,n)}else if(e instanceof ml?i.D_.We(e):e instanceof b2?i.D_.Ze(e):i.D_.je(e),!t.isEqual(ve.min()))try{const n=await P2(i.localStore);t.compareTo(n)>=0&&await function(s,a){const o=s.D_.st(a);return o.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const h=s.p_.get(c);h&&s.p_.set(c,h.withResumeToken(u.resumeToken,a))}}),o.targetMismatches.forEach((u,c)=>{const h=s.p_.get(u);if(!h)return;s.p_.set(u,h.withResumeToken(Qt.EMPTY_BYTE_STRING,h.snapshotVersion)),N2(s,u);const g=new Zn(h.target,u,c,h.sequenceNumber);Dm(s,g)}),s.remoteSyncer.applyRemoteEvent(o)}(i,t)}catch(n){se("RemoteStore","Failed to raise snapshot:",n),await Z_(i,n)}}async function Z_(i,e,t){if(!gu(e))throw e;i.y_.add(1),await vu(i),i.b_.set("Offline"),t||(t=()=>P2(i.localStore)),i.asyncQueue.enqueueRetryable(async()=>{se("RemoteStore","Retrying IndexedDB access"),await t(),i.y_.delete(1),await rh(i)})}async function ey(i,e){const t=Le(i);t.asyncQueue.verifyOperationInProgress(),se("RemoteStore","RemoteStore received new credentials");const n=Tu(t);t.y_.add(3),await vu(t),n&&t.b_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.y_.delete(3),await rh(t)}async function jN(i,e){const t=Le(i);e?(t.y_.delete(2),await rh(t)):e||(t.y_.add(2),await vu(t),t.b_.set("Unknown"))}function xa(i){return i.v_||(i.v_=function(t,n,r){const s=Le(t);return s.P_(),new LN(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(i.datastore,i.asyncQueue,{_o:BN.bind(null,i),uo:UN.bind(null,i),r_:VN.bind(null,i)}),i.w_.push(async e=>{e?(i.v_.Go(),km(i)?Im(i):i.b_.set("Unknown")):(await i.v_.stop(),M2(i))})),i.v_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new ir,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}static createAndSchedule(e,t,n,r,s){const a=Date.now()+n,o=new Pm(e,t,a,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new te(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function F2(i,e){if(Un("AsyncQueue",`${e}: ${i}`),gu(i))return new te(q.UNAVAILABLE,`${e}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(e){this.comparator=e?(t,n)=>e(t,n)||le.comparator(t.key,n.key):(t,n)=>le.comparator(t.key,n.key),this.keyedMap=uo(),this.sortedSet=new ft(this.comparator)}static emptySet(e){return new Us(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Us)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Us;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(){this.F_=new ft(le.comparator)}track(e){const t=e.doc.key,n=this.F_.get(t);n?e.type!==0&&n.type===3?this.F_=this.F_.insert(t,e):e.type===3&&n.type!==1?this.F_=this.F_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.F_=this.F_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.F_=this.F_.remove(t):e.type===1&&n.type===2?this.F_=this.F_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):be():this.F_=this.F_.insert(t,e)}M_(){const e=[];return this.F_.inorderTraversal((t,n)=>{e.push(n)}),e}}class oa{constructor(e,t,n,r,s,a,o,u,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new oa(e,t,Us.emptySet(t),a,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(){this.x_=void 0,this.listeners=[]}}class qN{constructor(){this.queries=new Sa(e=>l2(e),Jc),this.onlineState="Unknown",this.O_=new Set}}async function B2(i,e){const t=Le(i),n=e.query;let r=!1,s=t.queries.get(n);if(s||(r=!0,s=new $N),r)try{s.x_=await t.onListen(n)}catch(a){const o=F2(a,`Initialization of query '${Sf(e.query)}' failed`);return void e.onError(o)}t.queries.set(n,s),s.listeners.push(e),e.N_(t.onlineState),s.x_&&e.B_(s.x_)&&Rm(t)}async function U2(i,e){const t=Le(i),n=e.query;let r=!1;const s=t.queries.get(n);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),r=s.listeners.length===0)}if(r)return t.queries.delete(n),t.onUnlisten(n)}function HN(i,e){const t=Le(i);let n=!1;for(const r of e){const s=r.query,a=t.queries.get(s);if(a){for(const o of a.listeners)o.B_(r)&&(n=!0);a.x_=r}}n&&Rm(t)}function GN(i,e,t){const n=Le(i),r=n.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);n.queries.delete(e)}function Rm(i){i.O_.forEach(e=>{e.next()})}class V2{constructor(e,t,n){this.query=e,this.L_=t,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=n||{}}B_(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new oa(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.k_?this.Q_(e)&&(this.L_.next(e),t=!0):this.K_(e,this.onlineState)&&(this.U_(e),t=!0),this.q_=e,t}onError(e){this.L_.error(e)}N_(e){this.onlineState=e;let t=!1;return this.q_&&!this.k_&&this.K_(this.q_,e)&&(this.U_(this.q_),t=!0),t}K_(e,t){if(!e.fromCache)return!0;const n=t!=="Offline";return(!this.options.W_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Q_(e){if(e.docChanges.length>0)return!0;const t=this.q_&&this.q_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}U_(e){e=oa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.k_=!0,this.L_.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(e){this.key=e}}class $2{constructor(e){this.key=e}}class zN{constructor(e,t){this.query=e,this.X_=t,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=Oe(),this.mutatedKeys=Oe(),this.na=c2(e),this.ra=new Us(this.na)}get ia(){return this.X_}sa(e,t){const n=t?t.oa:new ty,r=t?t.ra:this.ra;let s=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((h,g)=>{const y=r.get(h),v=Zc(this.query,g)?g:null,T=!!y&&this.mutatedKeys.has(y.key),S=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let A=!1;y&&v?y.data.isEqual(v.data)?T!==S&&(n.track({type:3,doc:v}),A=!0):this._a(y,v)||(n.track({type:2,doc:v}),A=!0,(u&&this.na(v,u)>0||c&&this.na(v,c)<0)&&(o=!0)):!y&&v?(n.track({type:0,doc:v}),A=!0):y&&!v&&(n.track({type:1,doc:y}),A=!0,(u||c)&&(o=!0)),A&&(v?(a=a.add(v),s=S?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),s=s.delete(h.key),n.track({type:1,doc:h})}return{ra:a,oa:n,zi:o,mutatedKeys:s}}_a(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ra;this.ra=e.ra,this.mutatedKeys=e.mutatedKeys;const s=e.oa.M_();s.sort((c,h)=>function(y,v){const T=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return be()}};return T(y)-T(v)}(c.type,h.type)||this.na(c.doc,h.doc)),this.aa(n);const a=t?this.ua():[],o=this.ta.size===0&&this.current?1:0,u=o!==this.ea;return this.ea=o,s.length!==0||u?{snapshot:new oa(this.query,e.ra,r,s,e.mutatedKeys,o===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),ca:a}:{ca:a}}N_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ra:this.ra,oa:new ty,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(e){return!this.X_.has(e)&&!!this.ra.has(e)&&!this.ra.get(e).hasLocalMutations}aa(e){e&&(e.addedDocuments.forEach(t=>this.X_=this.X_.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.X_=this.X_.delete(t)),this.current=e.current)}ua(){if(!this.current)return[];const e=this.ta;this.ta=Oe(),this.ra.forEach(n=>{this.la(n.key)&&(this.ta=this.ta.add(n.key))});const t=[];return e.forEach(n=>{this.ta.has(n)||t.push(new $2(n))}),this.ta.forEach(n=>{e.has(n)||t.push(new j2(n))}),t}ha(e){this.X_=e.ss,this.ta=Oe();const t=this.sa(e.documents);return this.applyChanges(t,!0)}Pa(){return oa.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,this.ea===0,this.hasCachedResults)}}class WN{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class KN{constructor(e){this.key=e,this.Ia=!1}}class XN{constructor(e,t,n,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ta={},this.Ea=new Sa(o=>l2(o),Jc),this.da=new Map,this.Aa=new Set,this.Ra=new ft(le.comparator),this.Va=new Map,this.ma=new Cm,this.fa={},this.ga=new Map,this.pa=aa.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return this.ya===!0}}async function YN(i,e){const t=nM(i);let n,r;const s=t.Ea.get(e);if(s)n=s.targetId,t.sharedClientState.addLocalQueryTarget(n),r=s.view.Pa();else{const a=await wN(t.localStore,Vn(e)),o=t.sharedClientState.addLocalQueryTarget(a.targetId);n=a.targetId,r=await QN(t,e,n,o==="current",a.resumeToken),t.isPrimaryClient&&O2(t.remoteStore,a)}return r}async function QN(i,e,t,n,r){i.wa=(g,y,v)=>async function(S,A,k,P){let M=A.view.sa(k);M.zi&&(M=await Y_(S.localStore,A.query,!1).then(({documents:j})=>A.view.sa(j,M)));const R=P&&P.targetChanges.get(A.targetId),O=A.view.applyChanges(M,S.isPrimaryClient,R);return ny(S,A.targetId,O.ca),O.snapshot}(i,g,y,v);const s=await Y_(i.localStore,e,!0),a=new zN(e,s.ss),o=a.sa(s.documents),u=yu.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",r),c=a.applyChanges(o,i.isPrimaryClient,u);ny(i,t,c.ca);const h=new WN(e,t,a);return i.Ea.set(e,h),i.da.has(t)?i.da.get(t).push(e):i.da.set(t,[e]),c.snapshot}async function JN(i,e){const t=Le(i),n=t.Ea.get(e),r=t.da.get(n.targetId);if(r.length>1)return t.da.set(n.targetId,r.filter(s=>!Jc(s,e))),void t.Ea.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(n.targetId),t.sharedClientState.isActiveQueryTarget(n.targetId)||await If(t.localStore,n.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(n.targetId),L2(t.remoteStore,n.targetId),kf(t,n.targetId)}).catch(dm)):(kf(t,n.targetId),await If(t.localStore,n.targetId,!0))}async function q2(i,e){const t=Le(i);try{const n=await xN(t.localStore,e);e.targetChanges.forEach((r,s)=>{const a=t.Va.get(s);a&&(St(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?a.Ia=!0:r.modifiedDocuments.size>0?St(a.Ia):r.removedDocuments.size>0&&(St(a.Ia),a.Ia=!1))}),await G2(t,n,e)}catch(n){await dm(n)}}function iy(i,e,t){const n=Le(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const r=[];n.Ea.forEach((s,a)=>{const o=a.view.N_(e);o.snapshot&&r.push(o.snapshot)}),function(a,o){const u=Le(a);u.onlineState=o;let c=!1;u.queries.forEach((h,g)=>{for(const y of g.listeners)y.N_(o)&&(c=!0)}),c&&Rm(u)}(n.eventManager,e),r.length&&n.Ta.r_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function ZN(i,e,t){const n=Le(i);n.sharedClientState.updateQueryState(e,"rejected",t);const r=n.Va.get(e),s=r&&r.key;if(s){let a=new ft(le.comparator);a=a.insert(s,Ht.newNoDocument(s,ve.min()));const o=Oe().add(s),u=new ih(ve.min(),new Map,new ft(Ue),a,o);await q2(n,u),n.Ra=n.Ra.remove(s),n.Va.delete(e),Om(n)}else await If(n.localStore,e,!1).then(()=>kf(n,e,t)).catch(dm)}function kf(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const n of i.da.get(e))i.Ea.delete(n),t&&i.Ta.Sa(n,t);i.da.delete(e),i.isPrimaryClient&&i.ma.Ar(e).forEach(n=>{i.ma.containsKey(n)||H2(i,n)})}function H2(i,e){i.Aa.delete(e.path.canonicalString());const t=i.Ra.get(e);t!==null&&(L2(i.remoteStore,t),i.Ra=i.Ra.remove(e),i.Va.delete(t),Om(i))}function ny(i,e,t){for(const n of t)n instanceof j2?(i.ma.addReference(n.key,e),eM(i,n)):n instanceof $2?(se("SyncEngine","Document no longer in limbo: "+n.key),i.ma.removeReference(n.key,e),i.ma.containsKey(n.key)||H2(i,n.key)):be()}function eM(i,e){const t=e.key,n=t.path.canonicalString();i.Ra.get(t)||i.Aa.has(n)||(se("SyncEngine","New document in limbo: "+t),i.Aa.add(n),Om(i))}function Om(i){for(;i.Aa.size>0&&i.Ra.size<i.maxConcurrentLimboResolutions;){const e=i.Aa.values().next().value;i.Aa.delete(e);const t=new le(it.fromString(e)),n=i.pa.next();i.Va.set(n,new KN(t)),i.Ra=i.Ra.insert(t,n),O2(i.remoteStore,new Zn(Vn(vm(t.path)),n,"TargetPurposeLimboResolution",fm.ae))}}async function G2(i,e,t){const n=Le(i),r=[],s=[],a=[];n.Ea.isEmpty()||(n.Ea.forEach((o,u)=>{a.push(n.wa(u,e,t).then(c=>{if((c||t)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(u.targetId,c!=null&&c.fromCache?"not-current":"current"),c){r.push(c);const h=Am.qi(u.targetId,c);s.push(h)}}))}),await Promise.all(a),n.Ta.r_(r),await async function(u,c){const h=Le(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>H.forEach(c,y=>H.forEach(y.Li,v=>h.persistence.referenceDelegate.addReference(g,y.targetId,v)).next(()=>H.forEach(y.ki,v=>h.persistence.referenceDelegate.removeReference(g,y.targetId,v)))))}catch(g){if(!gu(g))throw g;se("LocalStore","Failed to update sequence numbers: "+g)}for(const g of c){const y=g.targetId;if(!g.fromCache){const v=h.Ji.get(y),T=v.snapshotVersion,S=v.withLastLimboFreeSnapshotVersion(T);h.Ji=h.Ji.insert(y,S)}}}(n.localStore,s))}async function tM(i,e){const t=Le(i);if(!t.currentUser.isEqual(e)){se("SyncEngine","User change. New user:",e.toKey());const n=await k2(t.localStore,e);t.currentUser=e,function(s,a){s.ga.forEach(o=>{o.forEach(u=>{u.reject(new te(q.CANCELLED,a))})}),s.ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await G2(t,n.ts)}}function iM(i,e){const t=Le(i),n=t.Va.get(e);if(n&&n.Ia)return Oe().add(n.key);{let r=Oe();const s=t.da.get(e);if(!s)return r;for(const a of s){const o=t.Ea.get(a);r=r.unionWith(o.view.ia)}return r}}function nM(i){const e=Le(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=q2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=iM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ZN.bind(null,e),e.Ta.r_=HN.bind(null,e.eventManager),e.Ta.Sa=GN.bind(null,e.eventManager),e}class ry{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=nh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return SN(this.persistence,new bN,e.initialUser,this.serializer)}createPersistence(e){return new vN(wm.zr,this.serializer)}createSharedClientState(e){return new DN}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class rM{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>iy(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=tM.bind(null,this.syncEngine),await jN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new qN}()}createDatastore(e){const t=nh(e.databaseInfo.databaseId),n=function(s){return new RN(s)}(e.databaseInfo);return function(s,a,o,u){return new NN(s,a,o,u)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,r,s,a,o){return new FN(n,r,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>iy(this.syncEngine,t,0),function(){return J_.v()?new J_:new IN}())}createSyncEngine(e,t){return function(r,s,a,o,u,c,h){const g=new XN(r,s,a,o,u,c);return h&&(g.ya=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const n=Le(t);se("RemoteStore","RemoteStore shutting down."),n.y_.add(5),await vu(n),n.S_.shutdown(),n.b_.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.va(this.observer.next,e)}error(e){this.observer.error?this.va(this.observer.error,e):Un("Uncaught Error in snapshot listener:",e.toString())}Ca(){this.muted=!0}va(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=$t.UNAUTHENTICATED,this.clientId=ZE.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async s=>{se("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(n,s=>(se("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new te(q.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ir;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=F2(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function md(i,e){i.asyncQueue.verifyOperationInProgress(),se("FirestoreClient","Initializing OfflineComponentProvider");const t=await i.getConfiguration();await e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(async r=>{n.isEqual(r)||(await k2(e.localStore,r),n=r)}),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e}async function sy(i,e){i.asyncQueue.verifyOperationInProgress();const t=await oM(i);se("FirestoreClient","Initializing OnlineComponentProvider");const n=await i.getConfiguration();await e.initialize(t,n),i.setCredentialChangeListener(r=>ey(e.remoteStore,r)),i.setAppCheckTokenChangeListener((r,s)=>ey(e.remoteStore,s)),i._onlineComponents=e}function aM(i){return i.name==="FirebaseError"?i.code===q.FAILED_PRECONDITION||i.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}async function oM(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){se("FirestoreClient","Using user provided OfflineComponentProvider");try{await md(i,i._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!aM(t))throw t;ia("Error using user provided cache. Falling back to memory cache: "+t),await md(i,new ry)}}else se("FirestoreClient","Using default OfflineComponentProvider"),await md(i,new ry);return i._offlineComponents}async function uM(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(se("FirestoreClient","Using user provided OnlineComponentProvider"),await sy(i,i._uninitializedComponentsProvider._online)):(se("FirestoreClient","Using default OnlineComponentProvider"),await sy(i,new rM))),i._onlineComponents}async function W2(i){const e=await uM(i),t=e.eventManager;return t.onListen=YN.bind(null,e.syncEngine),t.onUnlisten=JN.bind(null,e.syncEngine),t}function lM(i,e,t={}){const n=new ir;return i.asyncQueue.enqueueAndForget(async()=>function(s,a,o,u,c){const h=new z2({next:y=>{a.enqueueAndForget(()=>U2(s,g));const v=y.docs.has(o);!v&&y.fromCache?c.reject(new te(q.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&y.fromCache&&u&&u.source==="server"?c.reject(new te(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(y)},error:y=>c.reject(y)}),g=new V2(vm(o.path),h,{includeMetadataChanges:!0,W_:!0});return B2(s,g)}(await W2(i),i.asyncQueue,e,t,n)),n.promise}function cM(i,e,t={}){const n=new ir;return i.asyncQueue.enqueueAndForget(async()=>function(s,a,o,u,c){const h=new z2({next:y=>{a.enqueueAndForget(()=>U2(s,g)),y.fromCache&&u.source==="server"?c.reject(new te(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(y)},error:y=>c.reject(y)}),g=new V2(o,h,{includeMetadataChanges:!0,W_:!0});return B2(s,g)}(await W2(i),i.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K2(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ay=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X2(i,e,t){if(!t)throw new te(q.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function hM(i,e,t,n){if(e===!0&&n===!0)throw new te(q.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function oy(i){if(!le.isDocumentKey(i))throw new te(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function uy(i){if(le.isDocumentKey(i))throw new te(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function sh(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":be()}function Wo(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new te(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=sh(i);throw new te(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new te(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new te(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=K2((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new te(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new te(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new te(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ah{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ly({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new te(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new te(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ly(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new JO;switch(n.type){case"firstParty":return new iL(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new te(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=ay.get(t);n&&(se("ComponentProvider","Removing Datastore"),ay.delete(t),n.terminate())}(this),Promise.resolve()}}function dM(i,e,t,n={}){var r;const s=(i=Wo(i,ah))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&ia("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let o,u;if(typeof n.mockUserToken=="string")o=n.mockUserToken,u=$t.MOCK_USER;else{o=Ex(n.mockUserToken,(r=i._app)===null||r===void 0?void 0:r.options.projectId);const c=n.mockUserToken.sub||n.mockUserToken.user_id;if(!c)throw new te(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new $t(c)}i._authCredentials=new ZO(new JE(o,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Kr(this.firestore,e,this._query)}}class Di{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Di(this.firestore,e,this._key)}}class nr extends Kr{constructor(e,t,n){super(e,t,vm(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Di(this.firestore,null,new le(e))}withConverter(e){return new nr(this.firestore,e,this._path)}}function Pf(i,e,...t){if(i=xo(i),X2("collection","path",e),i instanceof ah){const n=it.fromString(e,...t);return uy(n),new nr(i,null,n)}{if(!(i instanceof Di||i instanceof nr))throw new te(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(it.fromString(e,...t));return uy(n),new nr(i.firestore,null,n)}}function fM(i,e,...t){if(i=xo(i),arguments.length===1&&(e=ZE.V()),X2("doc","path",e),i instanceof ah){const n=it.fromString(e,...t);return oy(n),new Di(i,null,new le(n))}{if(!(i instanceof Di||i instanceof nr))throw new te(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(it.fromString(e,...t));return oy(n),new Di(i.firestore,i instanceof nr?i.converter:null,new le(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new R2(this,"async_queue_retry"),this.Xa=()=>{const t=pd();t&&se("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const e=pd();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.eu(),this.tu(e)}enterRestrictedMode(e){if(!this.za){this.za=!0,this.Ya=e||!1;const t=pd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Xa)}}enqueue(e){if(this.eu(),this.za)return new Promise(()=>{});const t=new ir;return this.tu(()=>this.za&&this.Ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ga.push(e),this.nu()))}async nu(){if(this.Ga.length!==0){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(e){if(!gu(e))throw e;se("AsyncQueue","Operation failed with retryable error: "+e)}this.Ga.length>0&&this.Ko.xo(()=>this.nu())}}tu(e){const t=this.Wa.then(()=>(this.Ja=!0,e().catch(n=>{this.Ha=n,this.Ja=!1;const r=function(a){let o=a.message||"";return a.stack&&(o=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),o}(n);throw Un("INTERNAL UNHANDLED ERROR: ",r),n}).then(n=>(this.Ja=!1,n))));return this.Wa=t,t}enqueueAfterDelay(e,t,n){this.eu(),this.Za.indexOf(e)>-1&&(t=0);const r=Pm.createAndSchedule(this,e,t,n,s=>this.ru(s));return this.ja.push(r),r}eu(){this.Ha&&be()}verifyOperationInProgress(){}async iu(){let e;do e=this.Wa,await e;while(e!==this.Wa)}su(e){for(const t of this.ja)if(t.timerId===e)return!0;return!1}ou(e){return this.iu().then(()=>{this.ja.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.ja)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.iu()})}_u(e){this.Za.push(e)}ru(e){const t=this.ja.indexOf(e);this.ja.splice(t,1)}}class Lm extends ah{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=function(){return new pM}(),this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||J2(this),this._firestoreClient.terminate()}}function Y2(i,e){const t=typeof i=="object"?i:wC(),n=typeof i=="string"?i:e||"(default)",r=EC(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const s=Tx("firestore");s&&dM(r,...s)}return r}function Q2(i){return i._firestoreClient||J2(i),i._firestoreClient.verifyNotTerminated(),i._firestoreClient}function J2(i){var e,t,n;const r=i._freezeSettings(),s=function(o,u,c,h){return new pL(o,u,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,K2(h.experimentalLongPollingOptions),h.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,r);i._firestoreClient=new sM(i._authCredentials,i._appCheckCredentials,i._queue,s),!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=r.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ua(Qt.fromBase64String(e))}catch(t){throw new te(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ua(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new te(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ci(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new te(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new te(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ue(this._lat,e._lat)||Ue(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mM=/^__.*__$/;function tS(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw be()}}class Mm{constructor(e,t,n,r,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,s===void 0&&this.au(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get uu(){return this.settings.uu}cu(e){return new Mm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}lu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.cu({path:n,hu:!1});return r.Pu(e),r}Iu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.cu({path:n,hu:!1});return r.au(),r}Tu(e){return this.cu({path:void 0,hu:!0})}Eu(e){return Rf(e,this.settings.methodName,this.settings.du||!1,this.path,this.settings.Au)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}au(){if(this.path)for(let e=0;e<this.path.length;e++)this.Pu(this.path.get(e))}Pu(e){if(e.length===0)throw this.Eu("Document fields must not be empty");if(tS(this.uu)&&mM.test(e))throw this.Eu('Document fields cannot begin and end with "__"')}}class gM{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||nh(e)}Ru(e,t,n,r=!1){return new Mm({uu:e,methodName:t,Au:n,path:ci.emptyPath(),hu:!1,du:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _M(i){const e=i._freezeSettings(),t=nh(i._databaseId);return new gM(i._databaseId,!!e.ignoreUndefinedProperties,t)}function yM(i,e,t,n=!1){return Fm(t,i.Ru(n?4:3,e))}function Fm(i,e){if(iS(i=xo(i)))return TM("Unsupported field value:",e,i),vM(i,e);if(i instanceof eS)return function(n,r){if(!tS(r.uu))throw r.Eu(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Eu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.hu&&e.uu!==4)throw e.Eu("Nested arrays are not supported");return function(n,r){const s=[];let a=0;for(const o of n){let u=Fm(o,r.Tu(a));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),a++}return{arrayValue:{values:s}}}(i,e)}return function(n,r){if((n=xo(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return LL(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=Dt.fromDate(n);return{timestampValue:Af(r.serializer,s)}}if(n instanceof Dt){const s=new Dt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Af(r.serializer,s)}}if(n instanceof Nm)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ua)return{bytesValue:S2(r.serializer,n._byteString)};if(n instanceof Di){const s=r.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw r.Eu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:x2(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Eu(`Unsupported field value: ${sh(n)}`)}(i,e)}function vM(i,e){const t={};return e2(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_u(i,(n,r)=>{const s=Fm(r,e.lu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function iS(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Dt||i instanceof Nm||i instanceof ua||i instanceof Di||i instanceof eS)}function TM(i,e,t){if(!iS(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const n=sh(t);throw n==="an object"?e.Eu(i+" a custom object"):e.Eu(i+" "+n)}}const bM=new RegExp("[~\\*/\\[\\]]");function EM(i,e,t){if(e.search(bM)>=0)throw Rf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new Z2(...e.split("."))._internalPath}catch{throw Rf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function Rf(i,e,t,n,r){const s=n&&!n.isEmpty(),a=r!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${n}`),a&&(u+=` in document ${r}`),u+=")"),new te(q.INVALID_ARGUMENT,o+i+u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nS{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Di(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new SM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(oh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class SM extends nS{data(){return super.data()}}function oh(i,e){return typeof e=="string"?EM(i,e):e instanceof Z2?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xM(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new te(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bm{}class rS extends Bm{}function CM(i,e,...t){let n=[];e instanceof Bm&&n.push(e),n=n.concat(t),function(s){const a=s.filter(u=>u instanceof Um).length,o=s.filter(u=>u instanceof uh).length;if(a>1||a>0&&o>0)throw new te(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const r of n)i=r._apply(i);return i}class uh extends rS{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new uh(e,t,n)}_apply(e){const t=this._parse(e);return sS(e._query,t),new Kr(e.firestore,e.converter,bf(e._query,t))}_parse(e){const t=_M(e.firestore);return function(s,a,o,u,c,h,g){let y;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new te(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){hy(g,h);const v=[];for(const T of g)v.push(cy(u,s,T));y={arrayValue:{values:v}}}else y=cy(u,s,g)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||hy(g,h),y=yM(o,a,g,h==="in"||h==="not-in");return Tt.create(c,h,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function wM(i,e,t){const n=e,r=oh("where",i);return uh._create(r,n,t)}class Um extends Bm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Um(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Yi.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let a=r;const o=s.getFlattenedFilters();for(const u of o)sS(a,u),a=bf(a,u)}(e._query,t),new Kr(e.firestore,e.converter,bf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Vm extends rS{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Vm(e,t)}_apply(e){const t=function(r,s,a){if(r.startAt!==null)throw new te(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new te(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Ms(s,a);return function(c,h){if(Tm(c)===null){const g=Qc(c);g!==null&&aS(c,g,h.field)}}(r,o),o}(e._query,this._field,this._direction);return new Kr(e.firestore,e.converter,function(r,s){const a=r.explicitOrderBy.concat([s]);return new Ea(r.path,r.collectionGroup,a,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function AM(i,e="asc"){const t=e,n=oh("orderBy",i);return Vm._create(n,t)}function cy(i,e,t){if(typeof(t=xo(t))=="string"){if(t==="")throw new te(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!u2(e)&&t.indexOf("/")!==-1)throw new te(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(it.fromString(t));if(!le.isDocumentKey(n))throw new te(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return O_(i,new le(n))}if(t instanceof Di)return O_(i,t._key);throw new te(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${sh(t)}.`)}function hy(i,e){if(!Array.isArray(i)||i.length===0)throw new te(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function sS(i,e){if(e.isInequality()){const n=Qc(i),r=e.field;if(n!==null&&!n.isEqual(r))throw new te(q.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const s=Tm(i);s!==null&&aS(i,r,s)}const t=function(r,s){for(const a of r)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(i.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new te(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new te(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function aS(i,e,t){if(!t.isEqual(e))throw new te(q.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class DM{convertValue(e,t="none"){switch(Hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(qr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw be()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return _u(e,(r,s)=>{n[r]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new Nm(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=mm(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ho(e));default:return null}}convertTimestamp(e){const t=lr(e);return new Dt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=it.fromString(e);St(I2(n));const r=new Go(n.get(1),n.get(3)),s=new le(n.popFirst(5));return r.isEqual(t)||Un(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class oS extends nS{constructor(e,t,n,r,s,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new gl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(oh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class gl extends oS{data(e={}){return super.data(e)}}class IM{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new co(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new gl(this._firestore,this._userDataWriter,n.key,n,new co(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new te(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(o=>{const u=new gl(r._firestore,r._userDataWriter,o.doc.key,o.doc,new co(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const u=new gl(r._firestore,r._userDataWriter,o.doc.key,o.doc,new co(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,h=-1;return o.type!==0&&(c=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),h=a.indexOf(o.doc.key)),{type:kM(o.type),doc:u,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function kM(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return be()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PM(i){i=Wo(i,Di);const e=Wo(i.firestore,Lm);return lM(Q2(e),i._key).then(t=>RM(e,i,t))}class uS extends DM{constructor(e){super(),this.firestore=e}convertBytes(e){return new ua(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Di(this.firestore,null,t)}}function dy(i){i=Wo(i,Kr);const e=Wo(i.firestore,Lm),t=Q2(e),n=new uS(e);return xM(i._query),cM(t,i._query).then(r=>new IM(e,n,i,r))}function RM(i,e,t){const n=t.docs.get(e._key),r=new uS(i);return new oS(i,r,e._key,n,new co(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(r){ba=r})(CC),El(new Co("firestore",(n,{instanceIdentifier:r,options:s})=>{const a=n.getProvider("app").getImmediate(),o=new Lm(new eL(n.getProvider("auth-internal")),new rL(n.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new te(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Go(c.options.projectId,h)}(a,r),a);return s=Object.assign({useFetchStreams:t},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),As(D_,"4.1.0",e),As(D_,"4.1.0","esm2017")})();const OM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M6.75 2.25A.75.75 0 017.5 3v1.5h9V3A.75.75 0 0118 3v1.5h.75a3 3 0 013 3v11.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V7.5a3 3 0 013-3H6V3a.75.75 0 01.75-.75zm13.5 9a1.5 1.5 0 00-1.5-1.5H5.25a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-7.5z","clip-rule":"evenodd"}]}},LM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M7.72 12.53a.75.75 0 010-1.06l7.5-7.5a.75.75 0 111.06 1.06L9.31 12l6.97 6.97a.75.75 0 11-1.06 1.06l-7.5-7.5z","clip-rule":"evenodd"}]}},NM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z","clip-rule":"evenodd"}]}},MM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z","clip-rule":"evenodd"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z","clip-rule":"evenodd"}]}},FM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{d:"M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zM12.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0A.75.75 0 0115 4.5h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H15a.75.75 0 01-.75-.75V5.25z","clip-rule":"evenodd"}]}},BM={default:{a:{fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},path:[{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"}]},mini:{a:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},path:[{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"}]},solid:{a:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},path:[{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z","clip-rule":"evenodd"}]}};function fy(i,e,t){const n=i.slice();return n[6]=e[t],n}function py(i){let e,t=[i[6]],n={};for(let r=0;r<t.length;r+=1)n=rr(n,t[r]);return{c(){e=Iy("path"),yl(e,n)},m(r,s){Jt(r,e,s)},p(r,s){yl(e,n=Bf(t,[s&2&&r[6]]))},d(r){r&&Bt(e)}}}function UM(i){var a,o;let e,t=((a=i[1])==null?void 0:a.path)??[],n=[];for(let u=0;u<t.length;u+=1)n[u]=py(fy(i,t,u));let r=[(o=i[1])==null?void 0:o.a,{xmlns:"http://www.w3.org/2000/svg"},{width:i[0]},{height:i[0]},{"aria-hidden":"true"},i[2]],s={};for(let u=0;u<r.length;u+=1)s=rr(s,r[u]);return{c(){e=Iy("svg");for(let u=0;u<n.length;u+=1)n[u].c();yl(e,s)},m(u,c){Jt(u,e,c);for(let h=0;h<n.length;h+=1)n[h]&&n[h].m(e,null)},p(u,[c]){var h,g;if(c&2){t=((h=u[1])==null?void 0:h.path)??[];let y;for(y=0;y<t.length;y+=1){const v=fy(u,t,y);n[y]?n[y].p(v,c):(n[y]=py(v),n[y].c(),n[y].m(e,null))}for(;y<n.length;y+=1)n[y].d(1);n.length=t.length}yl(e,s=Bf(r,[c&2&&((g=u[1])==null?void 0:g.a),{xmlns:"http://www.w3.org/2000/svg"},c&1&&{width:u[0]},c&1&&{height:u[0]},{"aria-hidden":"true"},c&4&&u[2]]))},i:ut,o:ut,d(u){u&&Bt(e),Dy(n,u)}}}function VM(i,e,t){let n;const r=["src","size","solid","mini"];let s=_l(e,r),{src:a}=e,{size:o="100%"}=e,{solid:u=!1}=e,{mini:c=!1}=e;if(o!=="100%"&&o.slice(-1)!="x"&&o.slice(-1)!="m"&&o.slice(-1)!="%")try{o=parseInt(o)+"px"}catch{o="100%"}return i.$$set=h=>{e=rr(rr({},e),wy(h)),t(2,s=_l(e,r)),"src"in h&&t(3,a=h.src),"size"in h&&t(0,o=h.size),"solid"in h&&t(4,u=h.solid),"mini"in h&&t(5,c=h.mini)},i.$$.update=()=>{i.$$.dirty&56&&t(1,n=a==null?void 0:a[u?"solid":c?"mini":"default"])},[o,n,s,a,u,c]}class la extends qn{constructor(e){super(),$n(this,e,VM,UM,jn,{src:3,size:0,solid:4,mini:5})}}function jM(i){let e,t,n,r,s;return t=new la({props:{src:FM,size:"1.5em"}}),{c(){e=ze("button"),gi(t.$$.fragment),Ae(e,"class","bg-gray-700 p-1 rounded-md text-white")},m(a,o){Jt(a,e,o),ri(t,e,null),n=!0,r||(s=rn(e,"click",i[2]),r=!0)},p:ut,i(a){n||(je(t.$$.fragment,a),n=!0)},o(a){et(t.$$.fragment,a),n=!1},d(a){a&&Bt(e),si(t),r=!1,s()}}}function $M(i){let e,t,n,r,s;return t=new la({props:{src:BM,size:"1.5em"}}),{c(){e=ze("button"),gi(t.$$.fragment),Ae(e,"class","bg-gray-700 p-1 rounded-md text-white")},m(a,o){Jt(a,e,o),ri(t,e,null),n=!0,r||(s=rn(e,"click",i[1]),r=!0)},p:ut,i(a){n||(je(t.$$.fragment,a),n=!0)},o(a){et(t.$$.fragment,a),n=!1},d(a){a&&Bt(e),si(t),r=!1,s()}}}function qM(i){let e,t,n,r,s;const a=[$M,jM],o=[];function u(c,h){return h&1&&(e=null),e==null&&(e=!!c[0].paused()),e?0:1}return t=u(i,-1),n=o[t]=a[t](i),{c(){n.c(),r=Lf()},m(c,h){o[t].m(c,h),Jt(c,r,h),s=!0},p(c,[h]){let g=t;t=u(c,h),t===g?o[t].p(c,h):(Yo(),et(o[g],1,1,()=>{o[g]=null}),Qo(),n=o[t],n?n.p(c,h):(n=o[t]=a[t](c),n.c()),je(n,1),n.m(r.parentNode,r))},i(c){s||(je(n),s=!0)},o(c){et(n),s=!1},d(c){o[t].d(c),c&&Bt(r)}}}function HM(i,e,t){let{player:n}=e;const r=()=>{n.play(),t(0,n)},s=()=>{n.pause(),t(0,n)};return i.$$set=a=>{"player"in a&&t(0,n=a.player)},[n,r,s]}class GM extends qn{constructor(e){super(),$n(this,e,HM,qM,jn,{player:0})}}function zM(i){let e,t,n,r,s,a,o;return{c(){e=ze("select"),t=ze("option"),t.textContent="2 minutos",n=ze("option"),n.textContent="10 minutos",r=ze("option"),r.textContent="1 hora",s=ze("option"),s.textContent="24 horas",t.__value=1e3*60*2,t.value=t.__value,n.__value=1e3*60*10,n.value=n.__value,r.__value=1e3*60*60,r.value=r.__value,s.__value=1e3*60*60*24,s.value=s.__value,i[0]===void 0&&vl(()=>i[1].call(e))},m(u,c){Jt(u,e,c),Re(e,t),Re(e,n),Re(e,r),Re(e,s),Rg(e,i[0],!0),a||(o=rn(e,"change",i[1]),a=!0)},p(u,[c]){c&1&&Rg(e,u[0])},i:ut,o:ut,d(u){u&&Bt(e),a=!1,o()}}}function WM(i,e,t){let{scale:n}=e;function r(){n=nx(this),t(0,n)}return i.$$set=s=>{"scale"in s&&t(0,n=s.scale)},[n,r]}class KM extends qn{constructor(e){super(),$n(this,e,WM,zM,jn,{scale:0})}}var gd=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],Vs={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:typeof window=="object"&&window.navigator.userAgent.indexOf("MSIE")===-1,ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(i){return typeof console<"u"&&console.warn(i)},getWeek:function(i){var e=new Date(i.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},Ko={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(i){var e=i%100;if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},mi=function(i,e){return e===void 0&&(e=2),("000"+i).slice(e*-1)},Bi=function(i){return i===!0?1:0};function my(i,e){var t;return function(){var n=this,r=arguments;clearTimeout(t),t=setTimeout(function(){return i.apply(n,r)},e)}}var _d=function(i){return i instanceof Array?i:[i]};function ni(i,e,t){if(t===!0)return i.classList.add(e);i.classList.remove(e)}function Me(i,e,t){var n=window.document.createElement(i);return e=e||"",t=t||"",n.className=e,t!==void 0&&(n.textContent=t),n}function al(i){for(;i.firstChild;)i.removeChild(i.firstChild)}function lS(i,e){if(e(i))return i;if(i.parentNode)return lS(i.parentNode,e)}function ol(i,e){var t=Me("div","numInputWrapper"),n=Me("input","numInput "+i),r=Me("span","arrowUp"),s=Me("span","arrowDown");if(navigator.userAgent.indexOf("MSIE 9.0")===-1?n.type="number":(n.type="text",n.pattern="\\d*"),e!==void 0)for(var a in e)n.setAttribute(a,e[a]);return t.appendChild(n),t.appendChild(r),t.appendChild(s),t}function xi(i){try{if(typeof i.composedPath=="function"){var e=i.composedPath();return e[0]}return i.target}catch{return i.target}}var yd=function(){},lc=function(i,e,t){return t.months[e?"shorthand":"longhand"][i]},XM={D:yd,F:function(i,e,t){i.setMonth(t.months.longhand.indexOf(e))},G:function(i,e){i.setHours((i.getHours()>=12?12:0)+parseFloat(e))},H:function(i,e){i.setHours(parseFloat(e))},J:function(i,e){i.setDate(parseFloat(e))},K:function(i,e,t){i.setHours(i.getHours()%12+12*Bi(new RegExp(t.amPM[1],"i").test(e)))},M:function(i,e,t){i.setMonth(t.months.shorthand.indexOf(e))},S:function(i,e){i.setSeconds(parseFloat(e))},U:function(i,e){return new Date(parseFloat(e)*1e3)},W:function(i,e,t){var n=parseInt(e),r=new Date(i.getFullYear(),0,2+(n-1)*7,0,0,0,0);return r.setDate(r.getDate()-r.getDay()+t.firstDayOfWeek),r},Y:function(i,e){i.setFullYear(parseFloat(e))},Z:function(i,e){return new Date(e)},d:function(i,e){i.setDate(parseFloat(e))},h:function(i,e){i.setHours((i.getHours()>=12?12:0)+parseFloat(e))},i:function(i,e){i.setMinutes(parseFloat(e))},j:function(i,e){i.setDate(parseFloat(e))},l:yd,m:function(i,e){i.setMonth(parseFloat(e)-1)},n:function(i,e){i.setMonth(parseFloat(e)-1)},s:function(i,e){i.setSeconds(parseFloat(e))},u:function(i,e){return new Date(parseFloat(e))},w:yd,y:function(i,e){i.setFullYear(2e3+parseFloat(e))}},Dr={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},Eo={Z:function(i){return i.toISOString()},D:function(i,e,t){return e.weekdays.shorthand[Eo.w(i,e,t)]},F:function(i,e,t){return lc(Eo.n(i,e,t)-1,!1,e)},G:function(i,e,t){return mi(Eo.h(i,e,t))},H:function(i){return mi(i.getHours())},J:function(i,e){return e.ordinal!==void 0?i.getDate()+e.ordinal(i.getDate()):i.getDate()},K:function(i,e){return e.amPM[Bi(i.getHours()>11)]},M:function(i,e){return lc(i.getMonth(),!0,e)},S:function(i){return mi(i.getSeconds())},U:function(i){return i.getTime()/1e3},W:function(i,e,t){return t.getWeek(i)},Y:function(i){return mi(i.getFullYear(),4)},d:function(i){return mi(i.getDate())},h:function(i){return i.getHours()%12?i.getHours()%12:12},i:function(i){return mi(i.getMinutes())},j:function(i){return i.getDate()},l:function(i,e){return e.weekdays.longhand[i.getDay()]},m:function(i){return mi(i.getMonth()+1)},n:function(i){return i.getMonth()+1},s:function(i){return i.getSeconds()},u:function(i){return i.getTime()},w:function(i){return i.getDay()},y:function(i){return String(i.getFullYear()).substring(2)}},cS=function(i){var e=i.config,t=e===void 0?Vs:e,n=i.l10n,r=n===void 0?Ko:n,s=i.isMobile,a=s===void 0?!1:s;return function(o,u,c){var h=c||r;return t.formatDate!==void 0&&!a?t.formatDate(o,u,h):u.split("").map(function(g,y,v){return Eo[g]&&v[y-1]!=="\\"?Eo[g](o,h,t):g!=="\\"?g:""}).join("")}},Of=function(i){var e=i.config,t=e===void 0?Vs:e,n=i.l10n,r=n===void 0?Ko:n;return function(s,a,o,u){if(!(s!==0&&!s)){var c=u||r,h,g=s;if(s instanceof Date)h=new Date(s.getTime());else if(typeof s!="string"&&s.toFixed!==void 0)h=new Date(s);else if(typeof s=="string"){var y=a||(t||Vs).dateFormat,v=String(s).trim();if(v==="today")h=new Date,o=!0;else if(t&&t.parseDate)h=t.parseDate(s,y);else if(/Z$/.test(v)||/GMT$/.test(v))h=new Date(s);else{for(var T=void 0,S=[],A=0,k=0,P="";A<y.length;A++){var M=y[A],R=M==="\\",O=y[A-1]==="\\"||R;if(Dr[M]&&!O){P+=Dr[M];var j=new RegExp(P).exec(s);j&&(T=!0)&&S[M!=="Y"?"push":"unshift"]({fn:XM[M],val:j[++k]})}else R||(P+=".")}h=!t||!t.noCalendar?new Date(new Date().getFullYear(),0,1,0,0,0,0):new Date(new Date().setHours(0,0,0,0)),S.forEach(function(z){var ee=z.fn,K=z.val;return h=ee(h,K,c)||h}),h=T?h:void 0}}if(!(h instanceof Date&&!isNaN(h.getTime()))){t.errorHandler(new Error("Invalid date provided: "+g));return}return o===!0&&h.setHours(0,0,0,0),h}}};function Ci(i,e,t){return t===void 0&&(t=!0),t!==!1?new Date(i.getTime()).setHours(0,0,0,0)-new Date(e.getTime()).setHours(0,0,0,0):i.getTime()-e.getTime()}var YM=function(i,e,t){return i>Math.min(e,t)&&i<Math.max(e,t)},vd=function(i,e,t){return i*3600+e*60+t},QM=function(i){var e=Math.floor(i/3600),t=(i-e*3600)/60;return[e,t,i-e*3600-t*60]},JM={DAY:864e5};function Td(i){var e=i.defaultHour,t=i.defaultMinute,n=i.defaultSeconds;if(i.minDate!==void 0){var r=i.minDate.getHours(),s=i.minDate.getMinutes(),a=i.minDate.getSeconds();e<r&&(e=r),e===r&&t<s&&(t=s),e===r&&t===s&&n<a&&(n=i.minDate.getSeconds())}if(i.maxDate!==void 0){var o=i.maxDate.getHours(),u=i.maxDate.getMinutes();e=Math.min(e,o),e===o&&(t=Math.min(u,t)),e===o&&t===u&&(n=i.maxDate.getSeconds())}return{hours:e,minutes:t,seconds:n}}typeof Object.assign!="function"&&(Object.assign=function(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(!i)throw TypeError("Cannot convert undefined or null to object");for(var n=function(o){o&&Object.keys(o).forEach(function(u){return i[u]=o[u]})},r=0,s=e;r<s.length;r++){var a=s[r];n(a)}return i});var qt=globalThis&&globalThis.__assign||function(){return qt=Object.assign||function(i){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r])}return i},qt.apply(this,arguments)},gy=globalThis&&globalThis.__spreadArrays||function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var n=Array(i),r=0,e=0;e<t;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,r++)n[r]=s[a];return n},ZM=300;function eF(i,e){var t={config:qt(qt({},Vs),vt.defaultConfig),l10n:Ko};t.parseDate=Of({config:t.config,l10n:t.l10n}),t._handlers=[],t.pluginElements=[],t.loadedPlugins=[],t._bind=S,t._setHoursFromDate=y,t._positionCalendar=Je,t.changeMonth=xt,t.changeYear=De,t.clear=gt,t.close=Pi,t.onMouseOver=En,t._createElement=Me,t.createDay=j,t.destroy=Gn,t.isEnabled=Qe,t.jumpToDate=P,t.updateValue=Hi,t.open=Ca,t.redraw=Sn,t.set=Aa,t.setDate=Da,t.toggle=Jr;function n(){t.utils={getDaysInMonth:function(E,C){return E===void 0&&(E=t.currentMonth),C===void 0&&(C=t.currentYear),E===1&&(C%4===0&&C%100!==0||C%400===0)?29:t.l10n.daysInMonth[E]}}}function r(){t.element=t.input=i,t.isOpen=!1,wa(),ie(),Eu(),bu(),n(),t.isMobile||O(),k(),(t.selectedDates.length||t.config.noCalendar)&&(t.config.enableTime&&y(t.config.noCalendar?t.latestSelectedDateObj:void 0),Hi(!1)),o();var E=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!t.isMobile&&E&&Je(),Ze("onReady")}function s(){var E;return((E=t.calendarContainer)===null||E===void 0?void 0:E.getRootNode()).activeElement||document.activeElement}function a(E){return E.bind(t)}function o(){var E=t.config;E.weekNumbers===!1&&E.showMonths===1||E.noCalendar!==!0&&window.requestAnimationFrame(function(){if(t.calendarContainer!==void 0&&(t.calendarContainer.style.visibility="hidden",t.calendarContainer.style.display="block"),t.daysContainer!==void 0){var C=(t.days.offsetWidth+1)*E.showMonths;t.daysContainer.style.width=C+"px",t.calendarContainer.style.width=C+(t.weekWrapper!==void 0?t.weekWrapper.offsetWidth:0)+"px",t.calendarContainer.style.removeProperty("visibility"),t.calendarContainer.style.removeProperty("display")}})}function u(E){if(t.selectedDates.length===0){var C=t.config.minDate===void 0||Ci(new Date,t.config.minDate)>=0?new Date:new Date(t.config.minDate.getTime()),N=Td(t.config);C.setHours(N.hours,N.minutes,N.seconds,C.getMilliseconds()),t.selectedDates=[C],t.latestSelectedDateObj=C}E!==void 0&&E.type!=="blur"&&dh(E);var U=t._input.value;g(),Hi(),t._input.value!==U&&t._debouncedChange()}function c(E,C){return E%12+12*Bi(C===t.l10n.amPM[1])}function h(E){switch(E%24){case 0:case 12:return 12;default:return E%12}}function g(){if(!(t.hourElement===void 0||t.minuteElement===void 0)){var E=(parseInt(t.hourElement.value.slice(-2),10)||0)%24,C=(parseInt(t.minuteElement.value,10)||0)%60,N=t.secondElement!==void 0?(parseInt(t.secondElement.value,10)||0)%60:0;t.amPM!==void 0&&(E=c(E,t.amPM.textContent));var U=t.config.minTime!==void 0||t.config.minDate&&t.minDateHasTime&&t.latestSelectedDateObj&&Ci(t.latestSelectedDateObj,t.config.minDate,!0)===0,G=t.config.maxTime!==void 0||t.config.maxDate&&t.maxDateHasTime&&t.latestSelectedDateObj&&Ci(t.latestSelectedDateObj,t.config.maxDate,!0)===0;if(t.config.maxTime!==void 0&&t.config.minTime!==void 0&&t.config.minTime>t.config.maxTime){var J=vd(t.config.minTime.getHours(),t.config.minTime.getMinutes(),t.config.minTime.getSeconds()),_e=vd(t.config.maxTime.getHours(),t.config.maxTime.getMinutes(),t.config.maxTime.getSeconds()),re=vd(E,C,N);if(re>_e&&re<J){var Se=QM(J);E=Se[0],C=Se[1],N=Se[2]}}else{if(G){var ne=t.config.maxTime!==void 0?t.config.maxTime:t.config.maxDate;E=Math.min(E,ne.getHours()),E===ne.getHours()&&(C=Math.min(C,ne.getMinutes())),C===ne.getMinutes()&&(N=Math.min(N,ne.getSeconds()))}if(U){var ce=t.config.minTime!==void 0?t.config.minTime:t.config.minDate;E=Math.max(E,ce.getHours()),E===ce.getHours()&&C<ce.getMinutes()&&(C=ce.getMinutes()),C===ce.getMinutes()&&(N=Math.max(N,ce.getSeconds()))}}v(E,C,N)}}function y(E){var C=E||t.latestSelectedDateObj;C&&C instanceof Date&&v(C.getHours(),C.getMinutes(),C.getSeconds())}function v(E,C,N){t.latestSelectedDateObj!==void 0&&t.latestSelectedDateObj.setHours(E%24,C,N||0,0),!(!t.hourElement||!t.minuteElement||t.isMobile)&&(t.hourElement.value=mi(t.config.time_24hr?E:(12+E)%12+12*Bi(E%12===0)),t.minuteElement.value=mi(C),t.amPM!==void 0&&(t.amPM.textContent=t.l10n.amPM[Bi(E>=12)]),t.secondElement!==void 0&&(t.secondElement.value=mi(N)))}function T(E){var C=xi(E),N=parseInt(C.value)+(E.delta||0);(N/1e3>1||E.key==="Enter"&&!/[^\d]/.test(N.toString()))&&De(N)}function S(E,C,N,U){if(C instanceof Array)return C.forEach(function(G){return S(E,G,N,U)});if(E instanceof Array)return E.forEach(function(G){return S(G,C,N,U)});E.addEventListener(C,N,U),t._handlers.push({remove:function(){return E.removeEventListener(C,N,U)}})}function A(){Ze("onChange")}function k(){if(t.config.wrap&&["open","close","toggle","clear"].forEach(function(N){Array.prototype.forEach.call(t.element.querySelectorAll("[data-"+N+"]"),function(U){return S(U,"click",t[N])})}),t.isMobile){lh();return}var E=my(Xr,50);if(t._debouncedChange=my(A,ZM),t.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&S(t.daysContainer,"mouseover",function(N){t.config.mode==="range"&&En(xi(N))}),S(t._input,"keydown",st),t.calendarContainer!==void 0&&S(t.calendarContainer,"keydown",st),!t.config.inline&&!t.config.static&&S(window,"resize",E),window.ontouchstart!==void 0?S(window.document,"touchstart",Pe):S(window.document,"mousedown",Pe),S(window.document,"focus",Pe,{capture:!0}),t.config.clickOpens===!0&&(S(t._input,"focus",t.open),S(t._input,"click",t.open)),t.daysContainer!==void 0&&(S(t.monthNav,"click",hh),S(t.monthNav,["keyup","increment"],T),S(t.daysContainer,"click",Qr)),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0){var C=function(N){return xi(N).select()};S(t.timeContainer,["increment"],u),S(t.timeContainer,"blur",u,{capture:!0}),S(t.timeContainer,"click",M),S([t.hourElement,t.minuteElement],["focus","click"],C),t.secondElement!==void 0&&S(t.secondElement,"focus",function(){return t.secondElement&&t.secondElement.select()}),t.amPM!==void 0&&S(t.amPM,"click",function(N){u(N)})}t.config.allowInput&&S(t._input,"blur",Rt)}function P(E,C){var N=E!==void 0?t.parseDate(E):t.latestSelectedDateObj||(t.config.minDate&&t.config.minDate>t.now?t.config.minDate:t.config.maxDate&&t.config.maxDate<t.now?t.config.maxDate:t.now),U=t.currentYear,G=t.currentMonth;try{N!==void 0&&(t.currentYear=N.getFullYear(),t.currentMonth=N.getMonth())}catch(J){J.message="Invalid date supplied: "+N,t.config.errorHandler(J)}C&&t.currentYear!==U&&(Ze("onYearChange"),X()),C&&(t.currentYear!==U||t.currentMonth!==G)&&Ze("onMonthChange"),t.redraw()}function M(E){var C=xi(E);~C.className.indexOf("arrow")&&R(E,C.classList.contains("arrowUp")?1:-1)}function R(E,C,N){var U=E&&xi(E),G=N||U&&U.parentNode&&U.parentNode.firstChild,J=ka("increment");J.delta=C,G&&G.dispatchEvent(J)}function O(){var E=window.document.createDocumentFragment();if(t.calendarContainer=Me("div","flatpickr-calendar"),t.calendarContainer.tabIndex=-1,!t.config.noCalendar){if(E.appendChild(Ee()),t.innerContainer=Me("div","flatpickr-innerContainer"),t.config.weekNumbers){var C=mt(),N=C.weekWrapper,U=C.weekNumbers;t.innerContainer.appendChild(N),t.weekNumbers=U,t.weekWrapper=N}t.rContainer=Me("div","flatpickr-rContainer"),t.rContainer.appendChild(He()),t.daysContainer||(t.daysContainer=Me("div","flatpickr-days"),t.daysContainer.tabIndex=-1),we(),t.rContainer.appendChild(t.daysContainer),t.innerContainer.appendChild(t.rContainer),E.appendChild(t.innerContainer)}t.config.enableTime&&E.appendChild(Fe()),ni(t.calendarContainer,"rangeMode",t.config.mode==="range"),ni(t.calendarContainer,"animate",t.config.animate===!0),ni(t.calendarContainer,"multiMonth",t.config.showMonths>1),t.calendarContainer.appendChild(E);var G=t.config.appendTo!==void 0&&t.config.appendTo.nodeType!==void 0;if((t.config.inline||t.config.static)&&(t.calendarContainer.classList.add(t.config.inline?"inline":"static"),t.config.inline&&(!G&&t.element.parentNode?t.element.parentNode.insertBefore(t.calendarContainer,t._input.nextSibling):t.config.appendTo!==void 0&&t.config.appendTo.appendChild(t.calendarContainer)),t.config.static)){var J=Me("div","flatpickr-wrapper");t.element.parentNode&&t.element.parentNode.insertBefore(J,t.element),J.appendChild(t.element),t.altInput&&J.appendChild(t.altInput),J.appendChild(t.calendarContainer)}!t.config.static&&!t.config.inline&&(t.config.appendTo!==void 0?t.config.appendTo:window.document.body).appendChild(t.calendarContainer)}function j(E,C,N,U){var G=Qe(C,!0),J=Me("span",E,C.getDate().toString());return J.dateObj=C,J.$i=U,J.setAttribute("aria-label",t.formatDate(C,t.config.ariaDateFormat)),E.indexOf("hidden")===-1&&Ci(C,t.now)===0&&(t.todayDateElem=J,J.classList.add("today"),J.setAttribute("aria-current","date")),G?(J.tabIndex=-1,Pa(C)&&(J.classList.add("selected"),t.selectedDateElem=J,t.config.mode==="range"&&(ni(J,"startRange",t.selectedDates[0]&&Ci(C,t.selectedDates[0],!0)===0),ni(J,"endRange",t.selectedDates[1]&&Ci(C,t.selectedDates[1],!0)===0),E==="nextMonthDay"&&J.classList.add("inRange")))):J.classList.add("flatpickr-disabled"),t.config.mode==="range"&&ch(C)&&!Pa(C)&&J.classList.add("inRange"),t.weekNumbers&&t.config.showMonths===1&&E!=="prevMonthDay"&&U%7===6&&t.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+t.config.getWeek(C)+"</span>"),Ze("onDayCreate",J),J}function z(E){E.focus(),t.config.mode==="range"&&En(E)}function ee(E){for(var C=E>0?0:t.config.showMonths-1,N=E>0?t.config.showMonths:-1,U=C;U!=N;U+=E)for(var G=t.daysContainer.children[U],J=E>0?0:G.children.length-1,_e=E>0?G.children.length:-1,re=J;re!=_e;re+=E){var Se=G.children[re];if(Se.className.indexOf("hidden")===-1&&Qe(Se.dateObj))return Se}}function K(E,C){for(var N=E.className.indexOf("Month")===-1?E.dateObj.getMonth():t.currentMonth,U=C>0?t.config.showMonths:-1,G=C>0?1:-1,J=N-t.currentMonth;J!=U;J+=G)for(var _e=t.daysContainer.children[J],re=N-t.currentMonth===J?E.$i+C:C<0?_e.children.length-1:0,Se=_e.children.length,ne=re;ne>=0&&ne<Se&&ne!=(C>0?Se:-1);ne+=G){var ce=_e.children[ne];if(ce.className.indexOf("hidden")===-1&&Qe(ce.dateObj)&&Math.abs(E.$i-ne)>=Math.abs(C))return z(ce)}t.changeMonth(G),oe(ee(G),0)}function oe(E,C){var N=s(),U=Ut(N||document.body),G=E!==void 0?E:U?N:t.selectedDateElem!==void 0&&Ut(t.selectedDateElem)?t.selectedDateElem:t.todayDateElem!==void 0&&Ut(t.todayDateElem)?t.todayDateElem:ee(C>0?1:-1);G===void 0?t._input.focus():U?K(G,C):z(G)}function pe(E,C){for(var N=(new Date(E,C,1).getDay()-t.l10n.firstDayOfWeek+7)%7,U=t.utils.getDaysInMonth((C-1+12)%12,E),G=t.utils.getDaysInMonth(C,E),J=window.document.createDocumentFragment(),_e=t.config.showMonths>1,re=_e?"prevMonthDay hidden":"prevMonthDay",Se=_e?"nextMonthDay hidden":"nextMonthDay",ne=U+1-N,ce=0;ne<=U;ne++,ce++)J.appendChild(j("flatpickr-day "+re,new Date(E,C-1,ne),ne,ce));for(ne=1;ne<=G;ne++,ce++)J.appendChild(j("flatpickr-day",new Date(E,C,ne),ne,ce));for(var Te=G+1;Te<=42-N&&(t.config.showMonths===1||ce%7!==0);Te++,ce++)J.appendChild(j("flatpickr-day "+Se,new Date(E,C+1,Te%G),Te,ce));var Ri=Me("div","dayContainer");return Ri.appendChild(J),Ri}function we(){if(t.daysContainer!==void 0){al(t.daysContainer),t.weekNumbers&&al(t.weekNumbers);for(var E=document.createDocumentFragment(),C=0;C<t.config.showMonths;C++){var N=new Date(t.currentYear,t.currentMonth,1);N.setMonth(t.currentMonth+C),E.appendChild(pe(N.getFullYear(),N.getMonth()))}t.daysContainer.appendChild(E),t.days=t.daysContainer.firstChild,t.config.mode==="range"&&t.selectedDates.length===1&&En()}}function X(){if(!(t.config.showMonths>1||t.config.monthSelectorType!=="dropdown")){var E=function(U){return t.config.minDate!==void 0&&t.currentYear===t.config.minDate.getFullYear()&&U<t.config.minDate.getMonth()?!1:!(t.config.maxDate!==void 0&&t.currentYear===t.config.maxDate.getFullYear()&&U>t.config.maxDate.getMonth())};t.monthsDropdownContainer.tabIndex=-1,t.monthsDropdownContainer.innerHTML="";for(var C=0;C<12;C++)if(E(C)){var N=Me("option","flatpickr-monthDropdown-month");N.value=new Date(t.currentYear,C).getMonth().toString(),N.textContent=lc(C,t.config.shorthandCurrentMonth,t.l10n),N.tabIndex=-1,t.currentMonth===C&&(N.selected=!0),t.monthsDropdownContainer.appendChild(N)}}}function ge(){var E=Me("div","flatpickr-month"),C=window.document.createDocumentFragment(),N;t.config.showMonths>1||t.config.monthSelectorType==="static"?N=Me("span","cur-month"):(t.monthsDropdownContainer=Me("select","flatpickr-monthDropdown-months"),t.monthsDropdownContainer.setAttribute("aria-label",t.l10n.monthAriaLabel),S(t.monthsDropdownContainer,"change",function(_e){var re=xi(_e),Se=parseInt(re.value,10);t.changeMonth(Se-t.currentMonth),Ze("onMonthChange")}),X(),N=t.monthsDropdownContainer);var U=ol("cur-year",{tabindex:"-1"}),G=U.getElementsByTagName("input")[0];G.setAttribute("aria-label",t.l10n.yearAriaLabel),t.config.minDate&&G.setAttribute("min",t.config.minDate.getFullYear().toString()),t.config.maxDate&&(G.setAttribute("max",t.config.maxDate.getFullYear().toString()),G.disabled=!!t.config.minDate&&t.config.minDate.getFullYear()===t.config.maxDate.getFullYear());var J=Me("div","flatpickr-current-month");return J.appendChild(N),J.appendChild(U),C.appendChild(J),E.appendChild(C),{container:E,yearElement:G,monthElement:N}}function rt(){al(t.monthNav),t.monthNav.appendChild(t.prevMonthNav),t.config.showMonths&&(t.yearElements=[],t.monthElements=[]);for(var E=t.config.showMonths;E--;){var C=ge();t.yearElements.push(C.yearElement),t.monthElements.push(C.monthElement),t.monthNav.appendChild(C.container)}t.monthNav.appendChild(t.nextMonthNav)}function Ee(){return t.monthNav=Me("div","flatpickr-months"),t.yearElements=[],t.monthElements=[],t.prevMonthNav=Me("span","flatpickr-prev-month"),t.prevMonthNav.innerHTML=t.config.prevArrow,t.nextMonthNav=Me("span","flatpickr-next-month"),t.nextMonthNav.innerHTML=t.config.nextArrow,rt(),Object.defineProperty(t,"_hidePrevMonthArrow",{get:function(){return t.__hidePrevMonthArrow},set:function(E){t.__hidePrevMonthArrow!==E&&(ni(t.prevMonthNav,"flatpickr-disabled",E),t.__hidePrevMonthArrow=E)}}),Object.defineProperty(t,"_hideNextMonthArrow",{get:function(){return t.__hideNextMonthArrow},set:function(E){t.__hideNextMonthArrow!==E&&(ni(t.nextMonthNav,"flatpickr-disabled",E),t.__hideNextMonthArrow=E)}}),t.currentYearElement=t.yearElements[0],Zr(),t.monthNav}function Fe(){t.calendarContainer.classList.add("hasTime"),t.config.noCalendar&&t.calendarContainer.classList.add("noCalendar");var E=Td(t.config);t.timeContainer=Me("div","flatpickr-time"),t.timeContainer.tabIndex=-1;var C=Me("span","flatpickr-time-separator",":"),N=ol("flatpickr-hour",{"aria-label":t.l10n.hourAriaLabel});t.hourElement=N.getElementsByTagName("input")[0];var U=ol("flatpickr-minute",{"aria-label":t.l10n.minuteAriaLabel});if(t.minuteElement=U.getElementsByTagName("input")[0],t.hourElement.tabIndex=t.minuteElement.tabIndex=-1,t.hourElement.value=mi(t.latestSelectedDateObj?t.latestSelectedDateObj.getHours():t.config.time_24hr?E.hours:h(E.hours)),t.minuteElement.value=mi(t.latestSelectedDateObj?t.latestSelectedDateObj.getMinutes():E.minutes),t.hourElement.setAttribute("step",t.config.hourIncrement.toString()),t.minuteElement.setAttribute("step",t.config.minuteIncrement.toString()),t.hourElement.setAttribute("min",t.config.time_24hr?"0":"1"),t.hourElement.setAttribute("max",t.config.time_24hr?"23":"12"),t.hourElement.setAttribute("maxlength","2"),t.minuteElement.setAttribute("min","0"),t.minuteElement.setAttribute("max","59"),t.minuteElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(N),t.timeContainer.appendChild(C),t.timeContainer.appendChild(U),t.config.time_24hr&&t.timeContainer.classList.add("time24hr"),t.config.enableSeconds){t.timeContainer.classList.add("hasSeconds");var G=ol("flatpickr-second");t.secondElement=G.getElementsByTagName("input")[0],t.secondElement.value=mi(t.latestSelectedDateObj?t.latestSelectedDateObj.getSeconds():E.seconds),t.secondElement.setAttribute("step",t.minuteElement.getAttribute("step")),t.secondElement.setAttribute("min","0"),t.secondElement.setAttribute("max","59"),t.secondElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(Me("span","flatpickr-time-separator",":")),t.timeContainer.appendChild(G)}return t.config.time_24hr||(t.amPM=Me("span","flatpickr-am-pm",t.l10n.amPM[Bi((t.latestSelectedDateObj?t.hourElement.value:t.config.defaultHour)>11)]),t.amPM.title=t.l10n.toggleTitle,t.amPM.tabIndex=-1,t.timeContainer.appendChild(t.amPM)),t.timeContainer}function He(){t.weekdayContainer?al(t.weekdayContainer):t.weekdayContainer=Me("div","flatpickr-weekdays");for(var E=t.config.showMonths;E--;){var C=Me("div","flatpickr-weekdaycontainer");t.weekdayContainer.appendChild(C)}return pt(),t.weekdayContainer}function pt(){if(t.weekdayContainer){var E=t.l10n.firstDayOfWeek,C=gy(t.l10n.weekdays.shorthand);E>0&&E<C.length&&(C=gy(C.splice(E,C.length),C.splice(0,E)));for(var N=t.config.showMonths;N--;)t.weekdayContainer.children[N].innerHTML=`
      <span class='flatpickr-weekday'>
        `+C.join("</span><span class='flatpickr-weekday'>")+`
      </span>
      `}}function mt(){t.calendarContainer.classList.add("hasWeeks");var E=Me("div","flatpickr-weekwrapper");E.appendChild(Me("span","flatpickr-weekday",t.l10n.weekAbbreviation));var C=Me("div","flatpickr-weeks");return E.appendChild(C),{weekWrapper:E,weekNumbers:C}}function xt(E,C){C===void 0&&(C=!0);var N=C?E:E-t.currentMonth;N<0&&t._hidePrevMonthArrow===!0||N>0&&t._hideNextMonthArrow===!0||(t.currentMonth+=N,(t.currentMonth<0||t.currentMonth>11)&&(t.currentYear+=t.currentMonth>11?1:-1,t.currentMonth=(t.currentMonth+12)%12,Ze("onYearChange"),X()),we(),Ze("onMonthChange"),Zr())}function gt(E,C){if(E===void 0&&(E=!0),C===void 0&&(C=!0),t.input.value="",t.altInput!==void 0&&(t.altInput.value=""),t.mobileInput!==void 0&&(t.mobileInput.value=""),t.selectedDates=[],t.latestSelectedDateObj=void 0,C===!0&&(t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth()),t.config.enableTime===!0){var N=Td(t.config),U=N.hours,G=N.minutes,J=N.seconds;v(U,G,J)}t.redraw(),E&&Ze("onChange")}function Pi(){t.isOpen=!1,t.isMobile||(t.calendarContainer!==void 0&&t.calendarContainer.classList.remove("open"),t._input!==void 0&&t._input.classList.remove("active")),Ze("onClose")}function Gn(){t.config!==void 0&&Ze("onDestroy");for(var E=t._handlers.length;E--;)t._handlers[E].remove();if(t._handlers=[],t.mobileInput)t.mobileInput.parentNode&&t.mobileInput.parentNode.removeChild(t.mobileInput),t.mobileInput=void 0;else if(t.calendarContainer&&t.calendarContainer.parentNode)if(t.config.static&&t.calendarContainer.parentNode){var C=t.calendarContainer.parentNode;if(C.lastChild&&C.removeChild(C.lastChild),C.parentNode){for(;C.firstChild;)C.parentNode.insertBefore(C.firstChild,C);C.parentNode.removeChild(C)}}else t.calendarContainer.parentNode.removeChild(t.calendarContainer);t.altInput&&(t.input.type="text",t.altInput.parentNode&&t.altInput.parentNode.removeChild(t.altInput),delete t.altInput),t.input&&(t.input.type=t.input._type,t.input.classList.remove("flatpickr-input"),t.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(N){try{delete t[N]}catch{}})}function ae(E){return t.calendarContainer.contains(E)}function Pe(E){if(t.isOpen&&!t.config.inline){var C=xi(E),N=ae(C),U=C===t.input||C===t.altInput||t.element.contains(C)||E.path&&E.path.indexOf&&(~E.path.indexOf(t.input)||~E.path.indexOf(t.altInput)),G=!U&&!N&&!ae(E.relatedTarget),J=!t.config.ignoredFocusElements.some(function(_e){return _e.contains(C)});G&&J&&(t.config.allowInput&&t.setDate(t._input.value,!1,t.config.altInput?t.config.altFormat:t.config.dateFormat),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0&&t.input.value!==""&&t.input.value!==void 0&&u(),t.close(),t.config&&t.config.mode==="range"&&t.selectedDates.length===1&&t.clear(!1))}}function De(E){if(!(!E||t.config.minDate&&E<t.config.minDate.getFullYear()||t.config.maxDate&&E>t.config.maxDate.getFullYear())){var C=E,N=t.currentYear!==C;t.currentYear=C||t.currentYear,t.config.maxDate&&t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth=Math.min(t.config.maxDate.getMonth(),t.currentMonth):t.config.minDate&&t.currentYear===t.config.minDate.getFullYear()&&(t.currentMonth=Math.max(t.config.minDate.getMonth(),t.currentMonth)),N&&(t.redraw(),Ze("onYearChange"),X())}}function Qe(E,C){var N;C===void 0&&(C=!0);var U=t.parseDate(E,void 0,C);if(t.config.minDate&&U&&Ci(U,t.config.minDate,C!==void 0?C:!t.minDateHasTime)<0||t.config.maxDate&&U&&Ci(U,t.config.maxDate,C!==void 0?C:!t.maxDateHasTime)>0)return!1;if(!t.config.enable&&t.config.disable.length===0)return!0;if(U===void 0)return!1;for(var G=!!t.config.enable,J=(N=t.config.enable)!==null&&N!==void 0?N:t.config.disable,_e=0,re=void 0;_e<J.length;_e++){if(re=J[_e],typeof re=="function"&&re(U))return G;if(re instanceof Date&&U!==void 0&&re.getTime()===U.getTime())return G;if(typeof re=="string"){var Se=t.parseDate(re,void 0,!0);return Se&&Se.getTime()===U.getTime()?G:!G}else if(typeof re=="object"&&U!==void 0&&re.from&&re.to&&U.getTime()>=re.from.getTime()&&U.getTime()<=re.to.getTime())return G}return!G}function Ut(E){return t.daysContainer!==void 0?E.className.indexOf("hidden")===-1&&E.className.indexOf("flatpickr-disabled")===-1&&t.daysContainer.contains(E):!1}function Rt(E){var C=E.target===t._input,N=t._input.value.trimEnd()!==Ra();C&&N&&!(E.relatedTarget&&ae(E.relatedTarget))&&t.setDate(t._input.value,!0,E.target===t.altInput?t.config.altFormat:t.config.dateFormat)}function st(E){var C=xi(E),N=t.config.wrap?i.contains(C):C===t._input,U=t.config.allowInput,G=t.isOpen&&(!U||!N),J=t.config.inline&&N&&!U;if(E.keyCode===13&&N){if(U)return t.setDate(t._input.value,!0,C===t.altInput?t.config.altFormat:t.config.dateFormat),t.close(),C.blur();t.open()}else if(ae(C)||G||J){var _e=!!t.timeContainer&&t.timeContainer.contains(C);switch(E.keyCode){case 13:_e?(E.preventDefault(),u(),zn()):Qr(E);break;case 27:E.preventDefault(),zn();break;case 8:case 46:N&&!t.config.allowInput&&(E.preventDefault(),t.clear());break;case 37:case 39:if(!_e&&!N){E.preventDefault();var re=s();if(t.daysContainer!==void 0&&(U===!1||re&&Ut(re))){var Se=E.keyCode===39?1:-1;E.ctrlKey?(E.stopPropagation(),xt(Se),oe(ee(1),0)):oe(void 0,Se)}}else t.hourElement&&t.hourElement.focus();break;case 38:case 40:E.preventDefault();var ne=E.keyCode===40?1:-1;t.daysContainer&&C.$i!==void 0||C===t.input||C===t.altInput?E.ctrlKey?(E.stopPropagation(),De(t.currentYear-ne),oe(ee(1),0)):_e||oe(void 0,ne*7):C===t.currentYearElement?De(t.currentYear-ne):t.config.enableTime&&(!_e&&t.hourElement&&t.hourElement.focus(),u(E),t._debouncedChange());break;case 9:if(_e){var ce=[t.hourElement,t.minuteElement,t.secondElement,t.amPM].concat(t.pluginElements).filter(function(ei){return ei}),Te=ce.indexOf(C);if(Te!==-1){var Ri=ce[Te+(E.shiftKey?-1:1)];E.preventDefault(),(Ri||t._input).focus()}}else!t.config.noCalendar&&t.daysContainer&&t.daysContainer.contains(C)&&E.shiftKey&&(E.preventDefault(),t._input.focus());break}}if(t.amPM!==void 0&&C===t.amPM)switch(E.key){case t.l10n.amPM[0].charAt(0):case t.l10n.amPM[0].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[0],g(),Hi();break;case t.l10n.amPM[1].charAt(0):case t.l10n.amPM[1].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[1],g(),Hi();break}(N||ae(C))&&Ze("onKeyDown",E)}function En(E,C){if(C===void 0&&(C="flatpickr-day"),!(t.selectedDates.length!==1||E&&(!E.classList.contains(C)||E.classList.contains("flatpickr-disabled")))){for(var N=E?E.dateObj.getTime():t.days.firstElementChild.dateObj.getTime(),U=t.parseDate(t.selectedDates[0],void 0,!0).getTime(),G=Math.min(N,t.selectedDates[0].getTime()),J=Math.max(N,t.selectedDates[0].getTime()),_e=!1,re=0,Se=0,ne=G;ne<J;ne+=JM.DAY)Qe(new Date(ne),!0)||(_e=_e||ne>G&&ne<J,ne<U&&(!re||ne>re)?re=ne:ne>U&&(!Se||ne<Se)&&(Se=ne));var ce=Array.from(t.rContainer.querySelectorAll("*:nth-child(-n+"+t.config.showMonths+") > ."+C));ce.forEach(function(Te){var Ri=Te.dateObj,ei=Ri.getTime(),Zi=re>0&&ei<re||Se>0&&ei>Se;if(Zi){Te.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(Vt){Te.classList.remove(Vt)});return}else if(_e&&!Zi)return;["startRange","inRange","endRange","notAllowed"].forEach(function(Vt){Te.classList.remove(Vt)}),E!==void 0&&(E.classList.add(N<=t.selectedDates[0].getTime()?"startRange":"endRange"),U<N&&ei===U?Te.classList.add("startRange"):U>N&&ei===U&&Te.classList.add("endRange"),ei>=re&&(Se===0||ei<=Se)&&YM(ei,U,N)&&Te.classList.add("inRange"))})}}function Xr(){t.isOpen&&!t.config.static&&!t.config.inline&&Je()}function Ca(E,C){if(C===void 0&&(C=t._positionElement),t.isMobile===!0){if(E){E.preventDefault();var N=xi(E);N&&N.blur()}t.mobileInput!==void 0&&(t.mobileInput.focus(),t.mobileInput.click()),Ze("onOpen");return}else if(t._input.disabled||t.config.inline)return;var U=t.isOpen;t.isOpen=!0,U||(t.calendarContainer.classList.add("open"),t._input.classList.add("active"),Ze("onOpen"),Je(C)),t.config.enableTime===!0&&t.config.noCalendar===!0&&t.config.allowInput===!1&&(E===void 0||!t.timeContainer.contains(E.relatedTarget))&&setTimeout(function(){return t.hourElement.select()},50)}function gr(E){return function(C){var N=t.config["_"+E+"Date"]=t.parseDate(C,t.config.dateFormat),U=t.config["_"+(E==="min"?"max":"min")+"Date"];N!==void 0&&(t[E==="min"?"minDateHasTime":"maxDateHasTime"]=N.getHours()>0||N.getMinutes()>0||N.getSeconds()>0),t.selectedDates&&(t.selectedDates=t.selectedDates.filter(function(G){return Qe(G)}),!t.selectedDates.length&&E==="min"&&y(N),Hi()),t.daysContainer&&(Sn(),N!==void 0?t.currentYearElement[E]=N.getFullYear().toString():t.currentYearElement.removeAttribute(E),t.currentYearElement.disabled=!!U&&N!==void 0&&U.getFullYear()===N.getFullYear())}}function wa(){var E=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],C=qt(qt({},JSON.parse(JSON.stringify(i.dataset||{}))),e),N={};t.config.parseDate=C.parseDate,t.config.formatDate=C.formatDate,Object.defineProperty(t.config,"enable",{get:function(){return t.config._enable},set:function(ce){t.config._enable=Ia(ce)}}),Object.defineProperty(t.config,"disable",{get:function(){return t.config._disable},set:function(ce){t.config._disable=Ia(ce)}});var U=C.mode==="time";if(!C.dateFormat&&(C.enableTime||U)){var G=vt.defaultConfig.dateFormat||Vs.dateFormat;N.dateFormat=C.noCalendar||U?"H:i"+(C.enableSeconds?":S":""):G+" H:i"+(C.enableSeconds?":S":"")}if(C.altInput&&(C.enableTime||U)&&!C.altFormat){var J=vt.defaultConfig.altFormat||Vs.altFormat;N.altFormat=C.noCalendar||U?"h:i"+(C.enableSeconds?":S K":" K"):J+(" h:i"+(C.enableSeconds?":S":"")+" K")}Object.defineProperty(t.config,"minDate",{get:function(){return t.config._minDate},set:gr("min")}),Object.defineProperty(t.config,"maxDate",{get:function(){return t.config._maxDate},set:gr("max")});var _e=function(ce){return function(Te){t.config[ce==="min"?"_minTime":"_maxTime"]=t.parseDate(Te,"H:i:S")}};Object.defineProperty(t.config,"minTime",{get:function(){return t.config._minTime},set:_e("min")}),Object.defineProperty(t.config,"maxTime",{get:function(){return t.config._maxTime},set:_e("max")}),C.mode==="time"&&(t.config.noCalendar=!0,t.config.enableTime=!0),Object.assign(t.config,N,C);for(var re=0;re<E.length;re++)t.config[E[re]]=t.config[E[re]]===!0||t.config[E[re]]==="true";gd.filter(function(ce){return t.config[ce]!==void 0}).forEach(function(ce){t.config[ce]=_d(t.config[ce]||[]).map(a)}),t.isMobile=!t.config.disableMobile&&!t.config.inline&&t.config.mode==="single"&&!t.config.disable.length&&!t.config.enable&&!t.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var re=0;re<t.config.plugins.length;re++){var Se=t.config.plugins[re](t)||{};for(var ne in Se)gd.indexOf(ne)>-1?t.config[ne]=_d(Se[ne]).map(a).concat(t.config[ne]):typeof C[ne]>"u"&&(t.config[ne]=Se[ne])}C.altInputClass||(t.config.altInputClass=_r().className+" "+t.config.altInputClass),Ze("onParseConfig")}function _r(){return t.config.wrap?i.querySelector("[data-input]"):i}function ie(){typeof t.config.locale!="object"&&typeof vt.l10ns[t.config.locale]>"u"&&t.config.errorHandler(new Error("flatpickr: invalid locale "+t.config.locale)),t.l10n=qt(qt({},vt.l10ns.default),typeof t.config.locale=="object"?t.config.locale:t.config.locale!=="default"?vt.l10ns[t.config.locale]:void 0),Dr.D="("+t.l10n.weekdays.shorthand.join("|")+")",Dr.l="("+t.l10n.weekdays.longhand.join("|")+")",Dr.M="("+t.l10n.months.shorthand.join("|")+")",Dr.F="("+t.l10n.months.longhand.join("|")+")",Dr.K="("+t.l10n.amPM[0]+"|"+t.l10n.amPM[1]+"|"+t.l10n.amPM[0].toLowerCase()+"|"+t.l10n.amPM[1].toLowerCase()+")";var E=qt(qt({},e),JSON.parse(JSON.stringify(i.dataset||{})));E.time_24hr===void 0&&vt.defaultConfig.time_24hr===void 0&&(t.config.time_24hr=t.l10n.time_24hr),t.formatDate=cS(t),t.parseDate=Of({config:t.config,l10n:t.l10n})}function Je(E){if(typeof t.config.position=="function")return void t.config.position(t,E);if(t.calendarContainer!==void 0){Ze("onPreCalendarPosition");var C=E||t._positionElement,N=Array.prototype.reduce.call(t.calendarContainer.children,function(Su,ns){return Su+ns.offsetHeight},0),U=t.calendarContainer.offsetWidth,G=t.config.position.split(" "),J=G[0],_e=G.length>1?G[1]:null,re=C.getBoundingClientRect(),Se=window.innerHeight-re.bottom,ne=J==="above"||J!=="below"&&Se<N&&re.top>N,ce=window.pageYOffset+re.top+(ne?-N-2:C.offsetHeight+2);if(ni(t.calendarContainer,"arrowTop",!ne),ni(t.calendarContainer,"arrowBottom",ne),!t.config.inline){var Te=window.pageXOffset+re.left,Ri=!1,ei=!1;_e==="center"?(Te-=(U-re.width)/2,Ri=!0):_e==="right"&&(Te-=U-re.width,ei=!0),ni(t.calendarContainer,"arrowLeft",!Ri&&!ei),ni(t.calendarContainer,"arrowCenter",Ri),ni(t.calendarContainer,"arrowRight",ei);var Zi=window.document.body.offsetWidth-(window.pageXOffset+re.right),Vt=Te+U>window.document.body.offsetWidth,es=Zi+U>window.document.body.offsetWidth;if(ni(t.calendarContainer,"rightMost",Vt),!t.config.static)if(t.calendarContainer.style.top=ce+"px",!Vt)t.calendarContainer.style.left=Te+"px",t.calendarContainer.style.right="auto";else if(!es)t.calendarContainer.style.left="auto",t.calendarContainer.style.right=Zi+"px";else{var Ne=xe();if(Ne===void 0)return;var fh=window.document.body.offsetWidth,ts=Math.max(0,fh/2-U/2),is=".flatpickr-calendar.centerMost:before",ph=".flatpickr-calendar.centerMost:after",xn=Ne.cssRules.length,We="{left:"+re.left+"px;right:auto;}";ni(t.calendarContainer,"rightMost",!1),ni(t.calendarContainer,"centerMost",!0),Ne.insertRule(is+","+ph+We,xn),t.calendarContainer.style.left=ts+"px",t.calendarContainer.style.right="auto"}}}}function xe(){for(var E=null,C=0;C<document.styleSheets.length;C++){var N=document.styleSheets[C];if(N.cssRules){try{N.cssRules}catch{continue}E=N;break}}return E??Yr()}function Yr(){var E=document.createElement("style");return document.head.appendChild(E),E.sheet}function Sn(){t.config.noCalendar||t.isMobile||(X(),Zr(),we())}function zn(){t._input.focus(),window.navigator.userAgent.indexOf("MSIE")!==-1||navigator.msMaxTouchPoints!==void 0?setTimeout(t.close,0):t.close()}function Qr(E){E.preventDefault(),E.stopPropagation();var C=function(ce){return ce.classList&&ce.classList.contains("flatpickr-day")&&!ce.classList.contains("flatpickr-disabled")&&!ce.classList.contains("notAllowed")},N=lS(xi(E),C);if(N!==void 0){var U=N,G=t.latestSelectedDateObj=new Date(U.dateObj.getTime()),J=(G.getMonth()<t.currentMonth||G.getMonth()>t.currentMonth+t.config.showMonths-1)&&t.config.mode!=="range";if(t.selectedDateElem=U,t.config.mode==="single")t.selectedDates=[G];else if(t.config.mode==="multiple"){var _e=Pa(G);_e?t.selectedDates.splice(parseInt(_e),1):t.selectedDates.push(G)}else t.config.mode==="range"&&(t.selectedDates.length===2&&t.clear(!1,!1),t.latestSelectedDateObj=G,t.selectedDates.push(G),Ci(G,t.selectedDates[0],!0)!==0&&t.selectedDates.sort(function(ce,Te){return ce.getTime()-Te.getTime()}));if(g(),J){var re=t.currentYear!==G.getFullYear();t.currentYear=G.getFullYear(),t.currentMonth=G.getMonth(),re&&(Ze("onYearChange"),X()),Ze("onMonthChange")}if(Zr(),we(),Hi(),!J&&t.config.mode!=="range"&&t.config.showMonths===1?z(U):t.selectedDateElem!==void 0&&t.hourElement===void 0&&t.selectedDateElem&&t.selectedDateElem.focus(),t.hourElement!==void 0&&t.hourElement!==void 0&&t.hourElement.focus(),t.config.closeOnSelect){var Se=t.config.mode==="single"&&!t.config.enableTime,ne=t.config.mode==="range"&&t.selectedDates.length===2&&!t.config.enableTime;(Se||ne)&&zn()}A()}}var Wn={locale:[ie,pt],showMonths:[rt,o,He],minDate:[P],maxDate:[P],positionElement:[Ge],clickOpens:[function(){t.config.clickOpens===!0?(S(t._input,"focus",t.open),S(t._input,"click",t.open)):(t._input.removeEventListener("focus",t.open),t._input.removeEventListener("click",t.open))}]};function Aa(E,C){if(E!==null&&typeof E=="object"){Object.assign(t.config,E);for(var N in E)Wn[N]!==void 0&&Wn[N].forEach(function(U){return U()})}else t.config[E]=C,Wn[E]!==void 0?Wn[E].forEach(function(U){return U()}):gd.indexOf(E)>-1&&(t.config[E]=_d(C));t.redraw(),Hi(!0)}function yr(E,C){var N=[];if(E instanceof Array)N=E.map(function(U){return t.parseDate(U,C)});else if(E instanceof Date||typeof E=="number")N=[t.parseDate(E,C)];else if(typeof E=="string")switch(t.config.mode){case"single":case"time":N=[t.parseDate(E,C)];break;case"multiple":N=E.split(t.config.conjunction).map(function(U){return t.parseDate(U,C)});break;case"range":N=E.split(t.l10n.rangeSeparator).map(function(U){return t.parseDate(U,C)});break}else t.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(E)));t.selectedDates=t.config.allowInvalidPreload?N:N.filter(function(U){return U instanceof Date&&Qe(U,!1)}),t.config.mode==="range"&&t.selectedDates.sort(function(U,G){return U.getTime()-G.getTime()})}function Da(E,C,N){if(C===void 0&&(C=!1),N===void 0&&(N=t.config.dateFormat),E!==0&&!E||E instanceof Array&&E.length===0)return t.clear(C);yr(E,N),t.latestSelectedDateObj=t.selectedDates[t.selectedDates.length-1],t.redraw(),P(void 0,C),y(),t.selectedDates.length===0&&t.clear(!1),Hi(C),C&&Ze("onChange")}function Ia(E){return E.slice().map(function(C){return typeof C=="string"||typeof C=="number"||C instanceof Date?t.parseDate(C,void 0,!0):C&&typeof C=="object"&&C.from&&C.to?{from:t.parseDate(C.from,void 0),to:t.parseDate(C.to,void 0)}:C}).filter(function(C){return C})}function bu(){t.selectedDates=[],t.now=t.parseDate(t.config.now)||new Date;var E=t.config.defaultDate||((t.input.nodeName==="INPUT"||t.input.nodeName==="TEXTAREA")&&t.input.placeholder&&t.input.value===t.input.placeholder?null:t.input.value);E&&yr(E,t.config.dateFormat),t._initialDate=t.selectedDates.length>0?t.selectedDates[0]:t.config.minDate&&t.config.minDate.getTime()>t.now.getTime()?t.config.minDate:t.config.maxDate&&t.config.maxDate.getTime()<t.now.getTime()?t.config.maxDate:t.now,t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth(),t.selectedDates.length>0&&(t.latestSelectedDateObj=t.selectedDates[0]),t.config.minTime!==void 0&&(t.config.minTime=t.parseDate(t.config.minTime,"H:i")),t.config.maxTime!==void 0&&(t.config.maxTime=t.parseDate(t.config.maxTime,"H:i")),t.minDateHasTime=!!t.config.minDate&&(t.config.minDate.getHours()>0||t.config.minDate.getMinutes()>0||t.config.minDate.getSeconds()>0),t.maxDateHasTime=!!t.config.maxDate&&(t.config.maxDate.getHours()>0||t.config.maxDate.getMinutes()>0||t.config.maxDate.getSeconds()>0)}function Eu(){if(t.input=_r(),!t.input){t.config.errorHandler(new Error("Invalid input element specified"));return}t.input._type=t.input.type,t.input.type="text",t.input.classList.add("flatpickr-input"),t._input=t.input,t.config.altInput&&(t.altInput=Me(t.input.nodeName,t.config.altInputClass),t._input=t.altInput,t.altInput.placeholder=t.input.placeholder,t.altInput.disabled=t.input.disabled,t.altInput.required=t.input.required,t.altInput.tabIndex=t.input.tabIndex,t.altInput.type="text",t.input.setAttribute("type","hidden"),!t.config.static&&t.input.parentNode&&t.input.parentNode.insertBefore(t.altInput,t.input.nextSibling)),t.config.allowInput||t._input.setAttribute("readonly","readonly"),Ge()}function Ge(){t._positionElement=t.config.positionElement||t._input}function lh(){var E=t.config.enableTime?t.config.noCalendar?"time":"datetime-local":"date";t.mobileInput=Me("input",t.input.className+" flatpickr-mobile"),t.mobileInput.tabIndex=1,t.mobileInput.type=E,t.mobileInput.disabled=t.input.disabled,t.mobileInput.required=t.input.required,t.mobileInput.placeholder=t.input.placeholder,t.mobileFormatStr=E==="datetime-local"?"Y-m-d\\TH:i:S":E==="date"?"Y-m-d":"H:i:S",t.selectedDates.length>0&&(t.mobileInput.defaultValue=t.mobileInput.value=t.formatDate(t.selectedDates[0],t.mobileFormatStr)),t.config.minDate&&(t.mobileInput.min=t.formatDate(t.config.minDate,"Y-m-d")),t.config.maxDate&&(t.mobileInput.max=t.formatDate(t.config.maxDate,"Y-m-d")),t.input.getAttribute("step")&&(t.mobileInput.step=String(t.input.getAttribute("step"))),t.input.type="hidden",t.altInput!==void 0&&(t.altInput.type="hidden");try{t.input.parentNode&&t.input.parentNode.insertBefore(t.mobileInput,t.input.nextSibling)}catch{}S(t.mobileInput,"change",function(C){t.setDate(xi(C).value,!1,t.mobileFormatStr),Ze("onChange"),Ze("onClose")})}function Jr(E){if(t.isOpen===!0)return t.close();t.open(E)}function Ze(E,C){if(t.config!==void 0){var N=t.config[E];if(N!==void 0&&N.length>0)for(var U=0;N[U]&&U<N.length;U++)N[U](t.selectedDates,t.input.value,t,C);E==="onChange"&&(t.input.dispatchEvent(ka("change")),t.input.dispatchEvent(ka("input")))}}function ka(E){var C=document.createEvent("Event");return C.initEvent(E,!0,!0),C}function Pa(E){for(var C=0;C<t.selectedDates.length;C++){var N=t.selectedDates[C];if(N instanceof Date&&Ci(N,E)===0)return""+C}return!1}function ch(E){return t.config.mode!=="range"||t.selectedDates.length<2?!1:Ci(E,t.selectedDates[0])>=0&&Ci(E,t.selectedDates[1])<=0}function Zr(){t.config.noCalendar||t.isMobile||!t.monthNav||(t.yearElements.forEach(function(E,C){var N=new Date(t.currentYear,t.currentMonth,1);N.setMonth(t.currentMonth+C),t.config.showMonths>1||t.config.monthSelectorType==="static"?t.monthElements[C].textContent=lc(N.getMonth(),t.config.shorthandCurrentMonth,t.l10n)+" ":t.monthsDropdownContainer.value=N.getMonth().toString(),E.value=N.getFullYear().toString()}),t._hidePrevMonthArrow=t.config.minDate!==void 0&&(t.currentYear===t.config.minDate.getFullYear()?t.currentMonth<=t.config.minDate.getMonth():t.currentYear<t.config.minDate.getFullYear()),t._hideNextMonthArrow=t.config.maxDate!==void 0&&(t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth+1>t.config.maxDate.getMonth():t.currentYear>t.config.maxDate.getFullYear()))}function Ra(E){var C=E||(t.config.altInput?t.config.altFormat:t.config.dateFormat);return t.selectedDates.map(function(N){return t.formatDate(N,C)}).filter(function(N,U,G){return t.config.mode!=="range"||t.config.enableTime||G.indexOf(N)===U}).join(t.config.mode!=="range"?t.config.conjunction:t.l10n.rangeSeparator)}function Hi(E){E===void 0&&(E=!0),t.mobileInput!==void 0&&t.mobileFormatStr&&(t.mobileInput.value=t.latestSelectedDateObj!==void 0?t.formatDate(t.latestSelectedDateObj,t.mobileFormatStr):""),t.input.value=Ra(t.config.dateFormat),t.altInput!==void 0&&(t.altInput.value=Ra(t.config.altFormat)),E!==!1&&Ze("onValueUpdate")}function hh(E){var C=xi(E),N=t.prevMonthNav.contains(C),U=t.nextMonthNav.contains(C);N||U?xt(N?-1:1):t.yearElements.indexOf(C)>=0?C.select():C.classList.contains("arrowUp")?t.changeYear(t.currentYear+1):C.classList.contains("arrowDown")&&t.changeYear(t.currentYear-1)}function dh(E){E.preventDefault();var C=E.type==="keydown",N=xi(E),U=N;t.amPM!==void 0&&N===t.amPM&&(t.amPM.textContent=t.l10n.amPM[Bi(t.amPM.textContent===t.l10n.amPM[0])]);var G=parseFloat(U.getAttribute("min")),J=parseFloat(U.getAttribute("max")),_e=parseFloat(U.getAttribute("step")),re=parseInt(U.value,10),Se=E.delta||(C?E.which===38?1:-1:0),ne=re+_e*Se;if(typeof U.value<"u"&&U.value.length===2){var ce=U===t.hourElement,Te=U===t.minuteElement;ne<G?(ne=J+ne+Bi(!ce)+(Bi(ce)&&Bi(!t.amPM)),Te&&R(void 0,-1,t.hourElement)):ne>J&&(ne=U===t.hourElement?ne-J-Bi(!t.amPM):G,Te&&R(void 0,1,t.hourElement)),t.amPM&&ce&&(_e===1?ne+re===23:Math.abs(ne-re)>_e)&&(t.amPM.textContent=t.l10n.amPM[Bi(t.amPM.textContent===t.l10n.amPM[0])]),U.value=mi(ne)}}return r(),t}function js(i,e){for(var t=Array.prototype.slice.call(i).filter(function(a){return a instanceof HTMLElement}),n=[],r=0;r<t.length;r++){var s=t[r];try{if(s.getAttribute("data-fp-omit")!==null)continue;s._flatpickr!==void 0&&(s._flatpickr.destroy(),s._flatpickr=void 0),s._flatpickr=eF(s,e||{}),n.push(s._flatpickr)}catch(a){console.error(a)}}return n.length===1?n[0]:n}typeof HTMLElement<"u"&&typeof HTMLCollection<"u"&&typeof NodeList<"u"&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(i){return js(this,i)},HTMLElement.prototype.flatpickr=function(i){return js([this],i)});var vt=function(i,e){return typeof i=="string"?js(window.document.querySelectorAll(i),e):i instanceof Node?js([i],e):js(i,e)};vt.defaultConfig={};vt.l10ns={en:qt({},Ko),default:qt({},Ko)};vt.localize=function(i){vt.l10ns.default=qt(qt({},vt.l10ns.default),i)};vt.setDefaults=function(i){vt.defaultConfig=qt(qt({},vt.defaultConfig),i)};vt.parseDate=Of({});vt.formatDate=cS({});vt.compareDates=Ci;typeof jQuery<"u"&&typeof jQuery.fn<"u"&&(jQuery.fn.flatpickr=function(i){return js(this,i)});Date.prototype.fp_incr=function(i){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(typeof i=="string"?parseInt(i,10):i))};typeof window<"u"&&(window.flatpickr=vt);function tF(i){let e,t=[i[1]],n={};for(let r=0;r<t.length;r+=1)n=rr(n,t[r]);return{c(){e=ze("input"),Pg(e,n)},m(r,s){Jt(r,e,s),e.autofocus&&e.focus(),i[11](e)},p(r,s){Pg(e,n=Bf(t,[s&2&&r[1]]))},d(r){r&&Bt(e),i[11](null)}}}function iF(i){let e;const t=i[10].default,n=Q1(t,i,i[9],null),r=n||tF(i);return{c(){r&&r.c()},m(s,a){r&&r.m(s,a),e=!0},p(s,[a]){n?n.p&&(!e||a&512)&&Z1(n,t,s,s[9],e?J1(t,s[9],a,null):ex(s[9]),null):r&&r.p&&(!e||a&3)&&r.p(s,e?a:-1)},i(s){e||(je(r,s),e=!0)},o(s){et(r,s),e=!1},d(s){r&&r.d(s)}}}function nF(i){return i.charAt(2).toLowerCase()+i.substring(3)}function _y(i,e){var n;return(((n=i==null?void 0:i.config)==null?void 0:n.mode)??"single")==="single"?e[0]:e}function yy(i,e){return!!(i==e||i instanceof Date&&e instanceof Date&&i.valueOf()===e.valueOf()||Array.isArray(i)&&Array.isArray(e)&&i.length===e.length&&i.every((t,n)=>t===e[n]))}function rF(i,e,t){const n=["value","formattedValue","element","dateFormat","options","input","flatpickr"];let r=_l(e,n),{$$slots:s={},$$scope:a}=e;const o=new Set(["onChange","onOpen","onClose","onMonthChange","onYearChange","onReady","onValueUpdate","onDayCreate"]);let{value:u=void 0,formattedValue:c="",element:h=void 0,dateFormat:g=void 0}=e,{options:y={}}=e,v=!1,{input:T=void 0,flatpickr:S=void 0}=e;ky(()=>{const R=h??T,O=k(y);return O.onReady.push((j,z,ee)=>{u===void 0&&P(j,z,ee),ax().then(()=>{t(8,v=!0)})}),t(3,S=vt(R,Object.assign(O,h?{wrap:!0}:{}))),()=>{S.destroy()}});const A=Mf();function k(R={}){R=Object.assign({},R);for(const O of o){const j=(z,ee,K)=>{A(nF(O),[z,ee,K])};O in R?(Array.isArray(R[O])||(R[O]=[R[O]]),R[O].push(j)):R[O]=[j]}return R.onChange&&!R.onChange.includes(P)&&R.onChange.push(P),R}function P(R,O,j){const z=_y(j,R);!yy(u,z)&&(u||z)&&t(2,u=z),t(4,c=O)}function M(R){Ot[R?"unshift":"push"](()=>{T=R,t(0,T)})}return i.$$set=R=>{e=rr(rr({},e),wy(R)),t(1,r=_l(e,n)),"value"in R&&t(2,u=R.value),"formattedValue"in R&&t(4,c=R.formattedValue),"element"in R&&t(5,h=R.element),"dateFormat"in R&&t(6,g=R.dateFormat),"options"in R&&t(7,y=R.options),"input"in R&&t(0,T=R.input),"flatpickr"in R&&t(3,S=R.flatpickr),"$$scope"in R&&t(9,a=R.$$scope)},i.$$.update=()=>{if(i.$$.dirty&332&&S&&v&&(yy(u,_y(S,S.selectedDates))||S.setDate(u,!0,g)),i.$$.dirty&392&&S&&v)for(const[R,O]of Object.entries(k(y)))S.set(R,O)},[T,r,u,S,c,h,g,y,v,a,s,M]}class hS extends qn{constructor(e){super(),$n(this,e,rF,iF,jn,{value:2,formattedValue:4,element:5,dateFormat:6,options:7,input:0,flatpickr:3})}}function sF(i){let e,t,n,r,s;return r=new la({props:{src:OM,size:"1.5em"}}),{c(){e=ze("div"),t=ze("div"),n=ze("button"),gi(r.$$.fragment),Ae(n,"class","bg-gray-700 rounded-md p-1 text-white"),Ae(n,"data-toggle",""),Ae(t,"data-input",""),Ae(e,"class","flatpickr"),Ae(e,"id","date-picker")},m(a,o){Jt(a,e,o),Re(e,t),Re(t,n),ri(r,n,null),s=!0},p:ut,i(a){s||(je(r.$$.fragment,a),s=!0)},o(a){et(r.$$.fragment,a),s=!1},d(a){a&&Bt(e),si(r)}}}function aF(i){let e,t;return e=new hS({props:{element:"#date-picker",value:i[0],$$slots:{default:[sF]},$$scope:{ctx:i}}}),e.$on("close",i[1]),{c(){gi(e.$$.fragment)},m(n,r){ri(e,n,r),t=!0},p(n,[r]){const s={};r&1&&(s.value=n[0]),r&8&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(je(e.$$.fragment,n),t=!0)},o(n){et(e.$$.fragment,n),t=!1},d(n){si(e,n)}}}function oF(i,e,t){let{value:n}=e;const r=Mf();function s(a){t(0,n=a.detail[0][0]),r("change",{value:n})}return i.$$set=a=>{"value"in a&&t(0,n=a.value)},[n,s]}class uF extends qn{constructor(e){super(),$n(this,e,oF,aF,jn,{value:0})}}function lF(i){let e,t,n,r,s;return r=new la({props:{src:MM,size:"1.5em"}}),{c(){e=ze("div"),t=ze("div"),n=ze("button"),gi(r.$$.fragment),Ae(n,"class","bg-gray-700 rounded-md p-1 text-white"),Ae(n,"data-toggle",""),Ae(t,"data-input",""),Ae(e,"class","flatpickr"),Ae(e,"id","time-picker")},m(a,o){Jt(a,e,o),Re(e,t),Re(t,n),ri(r,n,null),s=!0},p:ut,i(a){s||(je(r.$$.fragment,a),s=!0)},o(a){et(r.$$.fragment,a),s=!1},d(a){a&&Bt(e),si(r)}}}function cF(i){let e,t;return e=new hS({props:{element:"#time-picker",value:i[0],options:{enableTime:!0,noCalendar:!0,time_24hr:!0},$$slots:{default:[lF]},$$scope:{ctx:i}}}),e.$on("close",i[1]),{c(){gi(e.$$.fragment)},m(n,r){ri(e,n,r),t=!0},p(n,[r]){const s={};r&1&&(s.value=n[0]),r&8&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(n){t||(je(e.$$.fragment,n),t=!0)},o(n){et(e.$$.fragment,n),t=!1},d(n){si(e,n)}}}function hF(i,e,t){let{value:n}=e;const r=Mf();function s(a){t(0,n=a.detail[0][0]),r("change",{value:n})}return i.$$set=a=>{"value"in a&&t(0,n=a.value)},[n,s]}class dF extends qn{constructor(e){super(),$n(this,e,hF,cF,jn,{value:0})}}function vy(i){let e,t,n,r,s,a=ul(i[5].getTime())+"",o,u,c,h,g,y,v,T,S,A,k,P,M=ul(i[5].getTime()+i[3])+"",R,O,j,z,ee,K,oe,pe,we,X,ge,rt,Ee,Fe,He,pt,mt,xt,gt;r=new la({props:{src:LM,size:"1.5em"}});function Pi(ie){i[16](ie)}function Gn(ie){i[17](ie)}function ae(ie){i[18](ie)}function Pe(ie){i[19](ie)}function De(ie){i[20](ie)}function Qe(ie){i[21](ie)}function Ut(ie){i[22](ie)}let Rt={};i[8]!==void 0&&(Rt.intervals=i[8]),i[2]!==void 0&&(Rt.sessions=i[2]),i[1]!==void 0&&(Rt.player=i[1]),i[9]!==void 0&&(Rt.flag=i[9]),i[6]!==void 0&&(Rt.now=i[6]),i[5]!==void 0&&(Rt.t0=i[5]),i[10]!==void 0&&(Rt.t1=i[10]),c=new qR({props:Rt}),Ot.push(()=>Fi(c,"intervals",Pi)),Ot.push(()=>Fi(c,"sessions",Gn)),Ot.push(()=>Fi(c,"player",ae)),Ot.push(()=>Fi(c,"flag",Pe)),Ot.push(()=>Fi(c,"now",De)),Ot.push(()=>Fi(c,"t0",Qe)),Ot.push(()=>Fi(c,"t1",Ut)),j=new la({props:{src:NM,size:"1.5em"}});let st=i[1]!=null&&Ty(i);function En(ie){i[25](ie)}let Xr={};i[12]!==void 0&&(Xr.value=i[12]),oe=new uF({props:Xr}),Ot.push(()=>Fi(oe,"value",En)),oe.$on("change",i[26]);function Ca(ie){i[27](ie)}let gr={};i[11]!==void 0&&(gr.value=i[11]),X=new dF({props:gr}),Ot.push(()=>Fi(X,"value",Ca)),X.$on("change",i[28]);function wa(ie){i[29](ie)}let _r={};return i[3]!==void 0&&(_r.scale=i[3]),He=new KM({props:_r}),Ot.push(()=>Fi(He,"scale",wa)),{c(){e=ze("div"),t=ze("div"),n=ze("button"),gi(r.$$.fragment),s=Ui(),o=$s(a),u=Ui(),gi(c.$$.fragment),k=Ui(),P=ze("button"),R=$s(M),O=Ui(),gi(j.$$.fragment),z=Ui(),ee=ze("div"),st&&st.c(),K=Ui(),gi(oe.$$.fragment),we=Ui(),gi(X.$$.fragment),rt=Ui(),Ee=ze("div"),Fe=Ui(),gi(He.$$.fragment),Ae(n,"class","flex p-1 space-x-1 bg-gray-700 text-white"),Ae(P,"class","flex p-1 space-x-1 bg-gray-700 text-white"),Ae(t,"class","flex w-full h-min bg-gray-500 items-center"),Ae(Ee,"class","w-full"),Ae(ee,"class","flex w-full p-4 bg-gray-500 items-center space-x-4"),Ae(e,"class","flex flex-col h-px")},m(ie,Je){Jt(ie,e,Je),Re(e,t),Re(t,n),ri(r,n,null),Re(n,s),Re(n,o),Re(t,u),ri(c,t,null),Re(t,k),Re(t,P),Re(P,R),Re(P,O),ri(j,P,null),Re(e,z),Re(e,ee),st&&st.m(ee,null),Re(ee,K),ri(oe,ee,null),Re(ee,we),ri(X,ee,null),Re(ee,rt),Re(ee,Ee),Re(ee,Fe),ri(He,ee,null),mt=!0,xt||(gt=[rn(n,"click",i[15]),rn(P,"click",i[23])],xt=!0)},p(ie,Je){(!mt||Je[0]&32)&&a!==(a=ul(ie[5].getTime())+"")&&bd(o,a);const xe={};!h&&Je[0]&256&&(h=!0,xe.intervals=ie[8],Mi(()=>h=!1)),!g&&Je[0]&4&&(g=!0,xe.sessions=ie[2],Mi(()=>g=!1)),!y&&Je[0]&2&&(y=!0,xe.player=ie[1],Mi(()=>y=!1)),!v&&Je[0]&512&&(v=!0,xe.flag=ie[9],Mi(()=>v=!1)),!T&&Je[0]&64&&(T=!0,xe.now=ie[6],Mi(()=>T=!1)),!S&&Je[0]&32&&(S=!0,xe.t0=ie[5],Mi(()=>S=!1)),!A&&Je[0]&1024&&(A=!0,xe.t1=ie[10],Mi(()=>A=!1)),c.$set(xe),(!mt||Je[0]&40)&&M!==(M=ul(ie[5].getTime()+ie[3])+"")&&bd(R,M),ie[1]!=null?st?(st.p(ie,Je),Je[0]&2&&je(st,1)):(st=Ty(ie),st.c(),je(st,1),st.m(ee,K)):st&&(Yo(),et(st,1,1,()=>{st=null}),Qo());const Yr={};!pe&&Je[0]&4096&&(pe=!0,Yr.value=ie[12],Mi(()=>pe=!1)),oe.$set(Yr);const Sn={};!ge&&Je[0]&2048&&(ge=!0,Sn.value=ie[11],Mi(()=>ge=!1)),X.$set(Sn);const zn={};!pt&&Je[0]&8&&(pt=!0,zn.scale=ie[3],Mi(()=>pt=!1)),He.$set(zn)},i(ie){mt||(je(r.$$.fragment,ie),je(c.$$.fragment,ie),je(j.$$.fragment,ie),je(st),je(oe.$$.fragment,ie),je(X.$$.fragment,ie),je(He.$$.fragment,ie),mt=!0)},o(ie){et(r.$$.fragment,ie),et(c.$$.fragment,ie),et(j.$$.fragment,ie),et(st),et(oe.$$.fragment,ie),et(X.$$.fragment,ie),et(He.$$.fragment,ie),mt=!1},d(ie){ie&&Bt(e),si(r),si(c),si(j),st&&st.d(),si(oe),si(X),si(He),xt=!1,Gr(gt)}}}function Ty(i){let e,t,n;function r(a){i[24](a)}let s={};return i[1]!==void 0&&(s.player=i[1]),e=new GM({props:s}),Ot.push(()=>Fi(e,"player",r)),{c(){gi(e.$$.fragment)},m(a,o){ri(e,a,o),n=!0},p(a,o){const u={};!t&&o[0]&2&&(t=!0,u.player=a[1],Mi(()=>t=!1)),e.$set(u)},i(a){n||(je(e.$$.fragment,a),n=!0)},o(a){et(e.$$.fragment,a),n=!1},d(a){si(e,a)}}}function fF(i){let e,t,n,r,s,a,o,u=i[2]!=null&&i[8]!=null&&vy(i);return{c(){e=ze("div"),t=ze("div"),n=ze("video"),r=ze("source"),a=Ui(),u&&u.c(),kg(r.src,s=i[0])||Ae(r,"src",s),Ae(n,"id","vid1"),Ae(n,"class","video-js w-full"),n.autoplay=!0,Ae(n,"preload","auto"),Ae(t,"data-vjs-player",""),Ae(t,"class","player-container"),Ae(e,"class","")},m(c,h){Jt(c,e,h),Re(e,t),Re(t,n),Re(n,r),i[14](n),Re(e,a),u&&u.m(e,null),o=!0},p(c,h){(!o||h[0]&1&&!kg(r.src,s=c[0]))&&Ae(r,"src",s),c[2]!=null&&c[8]!=null?u?(u.p(c,h),h[0]&260&&je(u,1)):(u=vy(c),u.c(),je(u,1),u.m(e,null)):u&&(Yo(),et(u,1,1,()=>{u=null}),Qo())},i(c){o||(je(u),o=!0)},o(c){et(u),o=!1},d(c){c&&Bt(e),i[14](null),u&&u.d()}}}function pF(i){const e=[];for(let t=0;t<i.length-1;t++){const n=i[t+1].getTime()-i[t].getTime();e.push(n)}return e}function by(i,e){const t=new Date(i.getTime());return t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(0),t}function ul(i){return new Date(i).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}function mF(i,e,t){let n,r,s,{camera:a}=e,{source:o}=e,u,c,h,g,y=!1,v=1e3*60*10,T=new Date("2023-07-24T18:00:00"),S,A,k=!1;ky(async()=>(P(),await j(),z(),()=>{c.dispose()}));function P(){t(1,c=F(u,{})),c.on("timeupdate",M)}async function M(){if(h==null)return;const ae=c.currentTime();await R(ae);const[Pe,De]=O(ae),Qe=h[Pe].time;k?k=!1:(T.setTime(Qe.getTime()+De*1e3),t(6,n=T))}async function R(ae){let Pe=h.map(De=>De.segments.length*2).reduce((De,Qe)=>De+Qe);for(;ae>Pe;)h[h.length-1].segments.push("PADDING"),Pe=h.map(De=>De.segments.length*2).reduce((De,Qe)=>De+Qe);z()}function O(ae){let Pe=ae,De=0;for(let Qe=0;Qe<h.length;Qe++)if(Pe-h[Qe].segments.length*2>0)Pe-=h[Qe].segments.length*2;else{De=Qe;break}return[De,Pe]}async function j(){if(a!=""){const ae=Y2();dy(Pf(ae,"sessions"));const Pe=await dy(CM(Pf(ae,"sessions"),wM("camera_id","==",a),AM("session_id"))).then(Ut=>Ut.docs.map(Rt=>({id:Rt.id,...Rt.data()}))),Qe=(await(await fetch(o)).text()).split(`
`).filter(Ut=>Ut.endsWith(".ts"));t(2,h=Pe.map(Ut=>new HR(Ut.id,Ut.time.toDate(),Qe.filter(Rt=>Rt.startsWith(`${Ut.session_id}-`))))),T.setTime(h[h.length-1].time.getTime()+h[h.length-1].segments.length*2e3)}}async function z(){if(t(9,y=!1),h!=null){const Pe=h.filter(De=>De.end.getTime()>=S.getTime()&&De.time.getTime()<=A.getTime()).map(De=>[De.time,De.end]).flat();Pe.length>0&&(Pe[0].getTime()<S.getTime()&&(Pe.shift(),t(9,y=!0)),Pe[Pe.length-1]>A&&Pe.pop()),Pe.unshift(S),Pe.push(A),t(8,g=pF(Pe))}}function ee(ae){let Pe=0;for(let De=0;De<h.length;De++)if(ae.getTime()>h[De].time.getTime()&&ae.getTime()>h[De].end.getTime())Pe+=h[De].segments.length*2;else if(ae.getTime()>h[De].time.getTime())Pe+=(ae.getTime()-h[De].time.getTime())/1e3;else break;return Pe}function K(ae){Ot[ae?"unshift":"push"](()=>{u=ae,t(7,u)})}const oe=()=>{t(4,T=new Date(T.getTime()-v))};function pe(ae){g=ae,t(8,g)}function we(ae){h=ae,t(2,h)}function X(ae){c=ae,t(1,c)}function ge(ae){y=ae,t(9,y)}function rt(ae){n=ae,t(6,n),t(4,T)}function Ee(ae){S=ae,t(5,S),t(6,n),t(3,v),t(4,T)}function Fe(ae){A=ae,t(10,A),t(6,n),t(3,v),t(5,S),t(4,T)}const He=()=>{t(4,T=new Date(T.getTime()+v))};function pt(ae){c=ae,t(1,c)}function mt(ae){r=ae,t(12,r),t(6,n),t(4,T)}const xt=()=>t(4,T=by(r,s));function gt(ae){s=ae,t(11,s),t(6,n),t(4,T)}const Pi=()=>t(4,T=by(r,s));function Gn(ae){v=ae,t(3,v)}return i.$$set=ae=>{"camera"in ae&&t(13,a=ae.camera),"source"in ae&&t(0,o=ae.source)},i.$$.update=()=>{i.$$.dirty[0]&16&&t(6,n=T),i.$$.dirty[0]&64&&t(12,r=new Date(n.getTime())),i.$$.dirty[0]&64&&t(11,s=new Date(n.getTime())),i.$$.dirty[0]&104&&(t(5,S=new Date(Math.floor(n.getTime()/v)*v)),t(10,A=new Date(S.getTime()+v)),z()),i.$$.dirty[0]&22&&c!=null&&h!=null&&(k=!0,c.currentTime(ee(T)))},[o,c,h,v,T,S,n,u,g,y,A,s,r,a,K,oe,pe,we,X,ge,rt,Ee,Fe,He,pt,mt,xt,gt,Pi,Gn]}class gF extends qn{constructor(e){super(),$n(this,e,mF,fF,jn,{camera:13,source:0},null,[-1,-1])}}function Ey(i){let e,t,n,r={ctx:i,current:null,token:null,hasCatch:!1,pending:vF,then:yF,catch:_F,value:1,blocks:[,,,]};return Og(t=i[1],r),{c(){e=Lf(),r.block.c()},m(s,a){Jt(s,e,a),r.block.m(s,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(s,a){i=s,r.ctx=i,a&2&&t!==(t=i[1])&&Og(t,r)||lx(r,i,a)},i(s){n||(je(r.block),n=!0)},o(s){for(let a=0;a<3;a+=1){const o=r.blocks[a];et(o)}n=!1},d(s){s&&Bt(e),r.block.d(s),r.token=null,r=null}}}function _F(i){return{c:ut,m:ut,p:ut,i:ut,o:ut,d:ut}}function yF(i){let e,t,n;function r(a){i[2](a)}let s={source:i[1]};return i[0]!==void 0&&(s.camera=i[0]),e=new gF({props:s}),Ot.push(()=>Fi(e,"camera",r)),{c(){gi(e.$$.fragment)},m(a,o){ri(e,a,o),n=!0},p(a,o){const u={};o&2&&(u.source=a[1]),!t&&o&1&&(t=!0,u.camera=a[0],Mi(()=>t=!1)),e.$set(u)},i(a){n||(je(e.$$.fragment,a),n=!0)},o(a){et(e.$$.fragment,a),n=!1},d(a){si(e,a)}}}function vF(i){let e;return{c(){e=$s("...")},m(t,n){Jt(t,e,n)},p:ut,i:ut,o:ut,d(t){t&&Bt(e)}}}function TF(i){let e,t,n=i[0]!=""&&Ey(i);return{c(){n&&n.c(),e=Lf()},m(r,s){n&&n.m(r,s),Jt(r,e,s),t=!0},p(r,[s]){r[0]!=""?n?(n.p(r,s),s&1&&je(n,1)):(n=Ey(r),n.c(),je(n,1),n.m(e.parentNode,e)):n&&(Yo(),et(n,1,1,()=>{n=null}),Qo())},i(r){t||(je(n),t=!0)},o(r){et(n),t=!1},d(r){n&&n.d(r),r&&Bt(e)}}}function bF(i,e,t){let{camera:n}=e,r;async function s(o){const u=Y2();return await PM(fM(Pf(u,"cameras"),o)).then(c=>c.data().output_uri)}function a(o){n=o,t(0,n)}return i.$$set=o=>{"camera"in o&&t(0,n=o.camera)},i.$$.update=()=>{i.$$.dirty&1&&n!=""&&t(1,r=s(n))},[n,r,a]}class dS extends qn{constructor(e){super(),$n(this,e,bF,TF,jn,{camera:0})}}const EF=document.querySelectorAll(".video-player");for(let i of EF)new dS({target:i,props:{camera:i.getAttribute("camera")}});function SF(i){return new dS({target:i,props:{camera:i.getAttribute("camera")}})}function xF(i,e){i.$set({camera:e})}window.initVideoPlayer=SF;window.setCamera=xF;
